!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PlanetKit=t():e.PlanetKit=t()}(self,(()=>(()=>{var e={9662:(e,t,r)=>{var n=r(7854),i=r(614),o=r(6330),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a function")}},9483:(e,t,r)=>{var n=r(7854),i=r(4411),o=r(6330),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a constructor")}},6077:(e,t,r)=>{var n=r(7854),i=r(614),o=n.String,s=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw s("Can't set "+o(e)+" as a prototype")}},1223:(e,t,r)=>{var n=r(5112),i=r(30),o=r(3070),s=n("unscopables"),a=Array.prototype;null==a[s]&&o.f(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},1530:(e,t,r)=>{"use strict";var n=r(8710).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},5787:(e,t,r)=>{var n=r(7854),i=r(7976),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},9670:(e,t,r)=>{var n=r(7854),i=r(111),o=n.String,s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not an object")}},7556:(e,t,r)=>{var n=r(7293);e.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},8533:(e,t,r)=>{"use strict";var n=r(2092).forEach,i=r(9341)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},1318:(e,t,r)=>{var n=r(5656),i=r(1400),o=r(6244),s=function(e){return function(t,r,s){var a,c=n(t),u=o(c),d=i(s,u);if(e&&r!=r){for(;u>d;)if((a=c[d++])!=a)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},2092:(e,t,r)=>{var n=r(9974),i=r(1702),o=r(8361),s=r(7908),a=r(6244),c=r(5417),u=i([].push),d=function(e){var t=1==e,r=2==e,i=3==e,d=4==e,l=6==e,h=7==e,p=5==e||l;return function(f,g,v,m){for(var S,E,_=s(f),y=o(_),T=n(g,v),R=a(y),A=0,w=m||c,b=t?w(f,R):r||h?w(f,0):void 0;R>A;A++)if((p||A in y)&&(E=T(S=y[A],A,_),e))if(t)b[A]=E;else if(E)switch(e){case 3:return!0;case 5:return S;case 6:return A;case 2:u(b,S)}else switch(e){case 4:return!1;case 7:u(b,S)}return l?-1:i||d?d:b}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},1194:(e,t,r)=>{var n=r(7293),i=r(5112),o=r(7392),s=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},9341:(e,t,r)=>{"use strict";var n=r(7293);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},1589:(e,t,r)=>{var n=r(7854),i=r(1400),o=r(6244),s=r(6135),a=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),d=i(void 0===r?n:r,n),l=a(c(d-u,0)),h=0;u<d;u++,h++)s(l,h,e[u]);return l.length=h,l}},206:(e,t,r)=>{var n=r(1702);e.exports=n([].slice)},7475:(e,t,r)=>{var n=r(7854),i=r(3157),o=r(4411),s=r(111),a=r(5112)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?c:t}},5417:(e,t,r)=>{var n=r(7475);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},7072:(e,t,r)=>{var n=r(5112)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},4326:(e,t,r)=>{var n=r(1702),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},648:(e,t,r)=>{var n=r(7854),i=r(1694),o=r(614),s=r(4326),a=r(5112)("toStringTag"),c=n.Object,u="Arguments"==s(function(){return arguments}());e.exports=i?s:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),a))?r:u?s(t):"Object"==(n=s(t))&&o(t.callee)?"Arguments":n}},9320:(e,t,r)=>{"use strict";var n=r(1702),i=r(2248),o=r(2423).getWeakData,s=r(9670),a=r(111),c=r(5787),u=r(408),d=r(2092),l=r(2597),h=r(9909),p=h.set,f=h.getterFor,g=d.find,v=d.findIndex,m=n([].splice),S=0,E=function(e){return e.frozen||(e.frozen=new _)},_=function(){this.entries=[]},y=function(e,t){return g(e.entries,(function(e){return e[0]===t}))};_.prototype={get:function(e){var t=y(this,e);if(t)return t[1]},has:function(e){return!!y(this,e)},set:function(e,t){var r=y(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=v(this.entries,(function(t){return t[0]===e}));return~t&&m(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,r,n){var d=e((function(e,i){c(e,h),p(e,{type:t,id:S++,frozen:void 0}),null!=i&&u(i,e[n],{that:e,AS_ENTRIES:r})})),h=d.prototype,g=f(t),v=function(e,t,r){var n=g(e),i=o(s(t),!0);return!0===i?E(n).set(t,r):i[n.id]=r,e};return i(h,{delete:function(e){var t=g(this);if(!a(e))return!1;var r=o(e);return!0===r?E(t).delete(e):r&&l(r,t.id)&&delete r[t.id]},has:function(e){var t=g(this);if(!a(e))return!1;var r=o(e);return!0===r?E(t).has(e):r&&l(r,t.id)}}),i(h,r?{get:function(e){var t=g(this);if(a(e)){var r=o(e);return!0===r?E(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),d}}},7710:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(1702),s=r(4705),a=r(1320),c=r(2423),u=r(408),d=r(5787),l=r(614),h=r(111),p=r(7293),f=r(7072),g=r(8003),v=r(9587);e.exports=function(e,t,r){var m=-1!==e.indexOf("Map"),S=-1!==e.indexOf("Weak"),E=m?"set":"add",_=i[e],y=_&&_.prototype,T=_,R={},A=function(e){var t=o(y[e]);a(y,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return S&&!h(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(s(e,!l(_)||!(S||y.forEach&&!p((function(){(new _).entries().next()})))))T=r.getConstructor(t,e,m,E),c.enable();else if(s(e,!0)){var w=new T,b=w[E](S?{}:-0,1)!=w,C=p((function(){w.has(1)})),O=f((function(e){new _(e)})),I=!S&&p((function(){for(var e=new _,t=5;t--;)e[E](t,t);return!e.has(-0)}));O||((T=t((function(e,t){d(e,y);var r=v(new _,e,T);return null!=t&&u(t,r[E],{that:r,AS_ENTRIES:m}),r}))).prototype=y,y.constructor=T),(C||I)&&(A("delete"),A("has"),m&&A("get")),(I||b)&&A(E),S&&y.clear&&delete y.clear}return R[e]=T,n({global:!0,forced:T!=_},R),g(T,e),S||r.setStrong(T,e,m),T}},9920:(e,t,r)=>{var n=r(2597),i=r(3887),o=r(1236),s=r(3070);e.exports=function(e,t,r){for(var a=i(t),c=s.f,u=o.f,d=0;d<a.length;d++){var l=a[d];n(e,l)||r&&n(r,l)||c(e,l,u(t,l))}}},4964:(e,t,r)=>{var n=r(5112)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},8544:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:(e,t,r)=>{"use strict";var n=r(3383).IteratorPrototype,i=r(30),o=r(9114),s=r(8003),a=r(7497),c=function(){return this};e.exports=function(e,t,r,u){var d=t+" Iterator";return e.prototype=i(n,{next:o(+!u,r)}),s(e,d,!1,!0),a[d]=c,e}},8880:(e,t,r)=>{var n=r(9781),i=r(3070),o=r(9114);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},9114:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6135:(e,t,r)=>{"use strict";var n=r(4948),i=r(3070),o=r(9114);e.exports=function(e,t,r){var s=n(t);s in e?i.f(e,s,o(0,r)):e[s]=r}},654:(e,t,r)=>{"use strict";var n=r(2109),i=r(6916),o=r(1913),s=r(6530),a=r(614),c=r(4994),u=r(9518),d=r(7674),l=r(8003),h=r(8880),p=r(1320),f=r(5112),g=r(7497),v=r(3383),m=s.PROPER,S=s.CONFIGURABLE,E=v.IteratorPrototype,_=v.BUGGY_SAFARI_ITERATORS,y=f("iterator"),T="keys",R="values",A="entries",w=function(){return this};e.exports=function(e,t,r,s,f,v,b){c(r,t,s);var C,O,I,P=function(e){if(e===f&&k)return k;if(!_&&e in L)return L[e];switch(e){case T:case R:case A:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",D=!1,L=e.prototype,M=L[y]||L["@@iterator"]||f&&L[f],k=!_&&M||P(f),x="Array"==t&&L.entries||M;if(x&&(C=u(x.call(new e)))!==Object.prototype&&C.next&&(o||u(C)===E||(d?d(C,E):a(C[y])||p(C,y,w)),l(C,N,!0,!0),o&&(g[N]=w)),m&&f==R&&M&&M.name!==R&&(!o&&S?h(L,"name",R):(D=!0,k=function(){return i(M,this)})),f)if(O={values:P(R),keys:v?k:P(T),entries:P(A)},b)for(I in O)(_||D||!(I in L))&&p(L,I,O[I]);else n({target:t,proto:!0,forced:_||D},O);return o&&!b||L[y]===k||p(L,y,k,{name:f}),g[t]=k,O}},7235:(e,t,r)=>{var n=r(857),i=r(2597),o=r(6061),s=r(3070).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},9781:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:(e,t,r)=>{var n=r(7854),i=r(111),o=n.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},8324:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(e,t,r)=>{var n=r(317)("span").classList,i=n&&n.constructor&&n.constructor.prototype;e.exports=i===Object.prototype?void 0:i},7871:e=>{e.exports="object"==typeof window},1528:(e,t,r)=>{var n=r(8113),i=r(7854);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},6833:(e,t,r)=>{var n=r(8113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},5268:(e,t,r)=>{var n=r(4326),i=r(7854);e.exports="process"==n(i.process)},1036:(e,t,r)=>{var n=r(8113);e.exports=/web0s(?!.*chrome)/i.test(n)},8113:(e,t,r)=>{var n=r(5005);e.exports=n("navigator","userAgent")||""},7392:(e,t,r)=>{var n,i,o=r(7854),s=r(8113),a=o.process,c=o.Deno,u=a&&a.versions||c&&c.version,d=u&&u.v8;d&&(i=(n=d.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},748:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(e,t,r)=>{var n=r(7854),i=r(1236).f,o=r(8880),s=r(1320),a=r(3505),c=r(9920),u=r(4705);e.exports=function(e,t){var r,d,l,h,p,f=e.target,g=e.global,v=e.stat;if(r=g?n:v?n[f]||a(f,{}):(n[f]||{}).prototype)for(d in t){if(h=t[d],l=e.noTargetGet?(p=i(r,d))&&p.value:r[d],!u(g?d:f+(v?".":"#")+d,e.forced)&&void 0!==l){if(typeof h==typeof l)continue;c(h,l)}(e.sham||l&&l.sham)&&o(h,"sham",!0),s(r,d,h,e)}}},7293:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},7007:(e,t,r)=>{"use strict";r(4916);var n=r(1702),i=r(1320),o=r(2261),s=r(7293),a=r(5112),c=r(8880),u=a("species"),d=RegExp.prototype;e.exports=function(e,t,r,l){var h=a(e),p=!s((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),f=p&&!s((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[u]=function(){return r},r.flags="",r[h]=/./[h]),r.exec=function(){return t=!0,null},r[h](""),!t}));if(!p||!f||r){var g=n(/./[h]),v=t(h,""[e],(function(e,t,r,i,s){var a=n(e),c=t.exec;return c===o||c===d.exec?p&&!s?{done:!0,value:g(t,r,i)}:{done:!0,value:a(r,t,i)}:{done:!1}}));i(String.prototype,e,v[0]),i(d,h,v[1])}l&&c(d[h],"sham",!0)}},6677:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},2104:e=>{var t=Function.prototype,r=t.apply,n=t.bind,i=t.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?i.bind(r):function(){return i.apply(r,arguments)})},9974:(e,t,r)=>{var n=r(1702),i=r(9662),o=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?o(e,t):function(){return e.apply(t,arguments)}}},7065:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(9662),s=r(111),a=r(2597),c=r(206),u=n.Function,d=i([].concat),l=i([].join),h={},p=function(e,t,r){if(!a(h,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";h[t]=u("C,a","return new C("+l(n,",")+")")}return h[t](e,r)};e.exports=u.bind||function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=d(n,c(arguments));return this instanceof i?p(t,r.length,r):t.apply(e,r)};return s(r)&&(i.prototype=r),i}},6916:e=>{var t=Function.prototype.call;e.exports=t.bind?t.bind(t):function(){return t.apply(t,arguments)}},6530:(e,t,r)=>{var n=r(9781),i=r(2597),o=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},1702:e=>{var t=Function.prototype,r=t.bind,n=t.call,i=r&&r.bind(n);e.exports=r?function(e){return e&&i(n,e)}:function(e){return e&&function(){return n.apply(e,arguments)}}},5005:(e,t,r)=>{var n=r(7854),i=r(614),o=function(e){return i(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e]):n[e]&&n[e][t]}},1246:(e,t,r)=>{var n=r(648),i=r(8173),o=r(7497),s=r(5112)("iterator");e.exports=function(e){if(null!=e)return i(e,s)||i(e,"@@iterator")||o[n(e)]}},8554:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9662),s=r(9670),a=r(6330),c=r(1246),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return s(i(r,e));throw u(a(e)+" is not iterable")}},8173:(e,t,r)=>{var n=r(9662);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},7854:(e,t,r)=>{var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},2597:(e,t,r)=>{var n=r(1702),i=r(7908),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},3501:e=>{e.exports={}},842:(e,t,r)=>{var n=r(7854);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},490:(e,t,r)=>{var n=r(5005);e.exports=n("document","documentElement")},4664:(e,t,r)=>{var n=r(9781),i=r(7293),o=r(317);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},8361:(e,t,r)=>{var n=r(7854),i=r(1702),o=r(7293),s=r(4326),a=n.Object,c=i("".split);e.exports=o((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"==s(e)?c(e,""):a(e)}:a},9587:(e,t,r)=>{var n=r(614),i=r(111),o=r(7674);e.exports=function(e,t,r){var s,a;return o&&n(s=t.constructor)&&s!==r&&i(a=s.prototype)&&a!==r.prototype&&o(e,a),e}},2788:(e,t,r)=>{var n=r(1702),i=r(614),o=r(5465),s=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},2423:(e,t,r)=>{var n=r(2109),i=r(1702),o=r(3501),s=r(111),a=r(2597),c=r(3070).f,u=r(8006),d=r(1156),l=r(2050),h=r(9711),p=r(6677),f=!1,g=h("meta"),v=0,m=function(e){c(e,g,{value:{objectID:"O"+v++,weakData:{}}})},S=e.exports={enable:function(){S.enable=function(){},f=!0;var e=u.f,t=i([].splice),r={};r[g]=1,e(r).length&&(u.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===g){t(n,i,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:d.f}))},fastKey:function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,g)){if(!l(e))return"F";if(!t)return"E";m(e)}return e[g].objectID},getWeakData:function(e,t){if(!a(e,g)){if(!l(e))return!0;if(!t)return!1;m(e)}return e[g].weakData},onFreeze:function(e){return p&&f&&l(e)&&!a(e,g)&&m(e),e}};o[g]=!0},9909:(e,t,r)=>{var n,i,o,s=r(8536),a=r(7854),c=r(1702),u=r(111),d=r(8880),l=r(2597),h=r(5465),p=r(6200),f=r(3501),g="Object already initialized",v=a.TypeError,m=a.WeakMap;if(s||h.state){var S=h.state||(h.state=new m),E=c(S.get),_=c(S.has),y=c(S.set);n=function(e,t){if(_(S,e))throw new v(g);return t.facade=e,y(S,e,t),t},i=function(e){return E(S,e)||{}},o=function(e){return _(S,e)}}else{var T=p("state");f[T]=!0,n=function(e,t){if(l(e,T))throw new v(g);return t.facade=e,d(e,T,t),t},i=function(e){return l(e,T)?e[T]:{}},o=function(e){return l(e,T)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw v("Incompatible receiver, "+e+" required");return r}}}},7659:(e,t,r)=>{var n=r(5112),i=r(7497),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},3157:(e,t,r)=>{var n=r(4326);e.exports=Array.isArray||function(e){return"Array"==n(e)}},614:e=>{e.exports=function(e){return"function"==typeof e}},4411:(e,t,r)=>{var n=r(1702),i=r(7293),o=r(614),s=r(648),a=r(5005),c=r(2788),u=function(){},d=[],l=a("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=n(h.exec),f=!h.exec(u),g=function(e){if(!o(e))return!1;try{return l(u,d,e),!0}catch(e){return!1}},v=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};v.sham=!0,e.exports=!l||i((function(){var e;return g(g.call)||!g(Object)||!g((function(){e=!0}))||e}))?v:g},4705:(e,t,r)=>{var n=r(7293),i=r(614),o=/#|\.prototype\./,s=function(e,t){var r=c[a(e)];return r==d||r!=u&&(i(t)?n(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=s.data={},u=s.NATIVE="N",d=s.POLYFILL="P";e.exports=s},111:(e,t,r)=>{var n=r(614);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},1913:e=>{e.exports=!1},7850:(e,t,r)=>{var n=r(111),i=r(4326),o=r(5112)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},2190:(e,t,r)=>{var n=r(7854),i=r(5005),o=r(614),s=r(7976),a=r(3307),c=n.Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&s(t.prototype,c(e))}},408:(e,t,r)=>{var n=r(7854),i=r(9974),o=r(6916),s=r(9670),a=r(6330),c=r(7659),u=r(6244),d=r(7976),l=r(8554),h=r(1246),p=r(9212),f=n.TypeError,g=function(e,t){this.stopped=e,this.result=t},v=g.prototype;e.exports=function(e,t,r){var n,m,S,E,_,y,T,R=r&&r.that,A=!(!r||!r.AS_ENTRIES),w=!(!r||!r.IS_ITERATOR),b=!(!r||!r.INTERRUPTED),C=i(t,R),O=function(e){return n&&p(n,"normal",e),new g(!0,e)},I=function(e){return A?(s(e),b?C(e[0],e[1],O):C(e[0],e[1])):b?C(e,O):C(e)};if(w)n=e;else{if(!(m=h(e)))throw f(a(e)+" is not iterable");if(c(m)){for(S=0,E=u(e);E>S;S++)if((_=I(e[S]))&&d(v,_))return _;return new g(!1)}n=l(e,m)}for(y=n.next;!(T=o(y,n)).done;){try{_=I(T.value)}catch(e){p(n,"throw",e)}if("object"==typeof _&&_&&d(v,_))return _}return new g(!1)}},9212:(e,t,r)=>{var n=r(6916),i=r(9670),o=r(8173);e.exports=function(e,t,r){var s,a;i(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw r;return r}s=n(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw r;if(a)throw s;return i(s),r}},3383:(e,t,r)=>{"use strict";var n,i,o,s=r(7293),a=r(614),c=r(30),u=r(9518),d=r(1320),l=r(5112),h=r(1913),p=l("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):f=!0),null==n||s((function(){var e={};return n[p].call(e)!==e}))?n={}:h&&(n=c(n)),a(n[p])||d(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},7497:e=>{e.exports={}},6244:(e,t,r)=>{var n=r(7466);e.exports=function(e){return n(e.length)}},5948:(e,t,r)=>{var n,i,o,s,a,c,u,d,l=r(7854),h=r(9974),p=r(1236).f,f=r(261).set,g=r(6833),v=r(1528),m=r(1036),S=r(5268),E=l.MutationObserver||l.WebKitMutationObserver,_=l.document,y=l.process,T=l.Promise,R=p(l,"queueMicrotask"),A=R&&R.value;A||(n=function(){var e,t;for(S&&(e=y.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?s():o=void 0,e}}o=void 0,e&&e.enter()},g||S||m||!E||!_?!v&&T&&T.resolve?((u=T.resolve(void 0)).constructor=T,d=h(u.then,u),s=function(){d(n)}):S?s=function(){y.nextTick(n)}:(f=h(f,l),s=function(){f(n)}):(a=!0,c=_.createTextNode(""),new E(n).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=A||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,s()),o=t}},3366:(e,t,r)=>{var n=r(7854);e.exports=n.Promise},133:(e,t,r)=>{var n=r(7392),i=r(7293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},8536:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2788),s=n.WeakMap;e.exports=i(s)&&/native code/.test(o(s))},8523:(e,t,r)=>{"use strict";var n=r(9662),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},3929:(e,t,r)=>{var n=r(7854),i=r(7850),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},1574:(e,t,r)=>{"use strict";var n=r(9781),i=r(1702),o=r(6916),s=r(7293),a=r(1956),c=r(5181),u=r(5296),d=r(7908),l=r(8361),h=Object.assign,p=Object.defineProperty,f=i([].concat);e.exports=!h||s((function(){if(n&&1!==h({b:1},h(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!=h({},e)[r]||a(h({},t)).join("")!=i}))?function(e,t){for(var r=d(e),i=arguments.length,s=1,h=c.f,p=u.f;i>s;)for(var g,v=l(arguments[s++]),m=h?f(a(v),h(v)):a(v),S=m.length,E=0;S>E;)g=m[E++],n&&!o(p,v,g)||(r[g]=v[g]);return r}:h},30:(e,t,r)=>{var n,i=r(9670),o=r(6048),s=r(748),a=r(3501),c=r(490),u=r(317),d=r(6200),l="prototype",h="script",p=d("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},v=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&n?v(n):(t=u("iframe"),r="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):v(n);for(var i=s.length;i--;)delete m[l][s[i]];return m()};a[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[l]=i(e),r=new f,f[l]=null,r[p]=e):r=m(),void 0===t?r:o(r,t)}},6048:(e,t,r)=>{var n=r(9781),i=r(3070),o=r(9670),s=r(5656),a=r(1956);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=s(t),c=a(t),u=c.length,d=0;u>d;)i.f(e,r=c[d++],n[r]);return e}},3070:(e,t,r)=>{var n=r(7854),i=r(9781),o=r(4664),s=r(9670),a=r(4948),c=n.TypeError,u=Object.defineProperty;t.f=i?u:function(e,t,r){if(s(e),t=a(t),s(r),o)try{return u(e,t,r)}catch(e){}if("get"in r||"set"in r)throw c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},1236:(e,t,r)=>{var n=r(9781),i=r(6916),o=r(5296),s=r(9114),a=r(5656),c=r(4948),u=r(2597),d=r(4664),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=a(e),t=c(t),d)try{return l(e,t)}catch(e){}if(u(e,t))return s(!i(o.f,e,t),e[t])}},1156:(e,t,r)=>{var n=r(4326),i=r(5656),o=r(8006).f,s=r(1589),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(i(e))}},8006:(e,t,r)=>{var n=r(6324),i=r(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},5181:(e,t)=>{t.f=Object.getOwnPropertySymbols},9518:(e,t,r)=>{var n=r(7854),i=r(2597),o=r(614),s=r(7908),a=r(6200),c=r(8544),u=a("IE_PROTO"),d=n.Object,l=d.prototype;e.exports=c?d.getPrototypeOf:function(e){var t=s(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof d?l:null}},2050:(e,t,r)=>{var n=r(7293),i=r(111),o=r(4326),s=r(7556),a=Object.isExtensible,c=n((function(){a(1)}));e.exports=c||s?function(e){return!!i(e)&&(!s||"ArrayBuffer"!=o(e))&&(!a||a(e))}:a},7976:(e,t,r)=>{var n=r(1702);e.exports=n({}.isPrototypeOf)},6324:(e,t,r)=>{var n=r(1702),i=r(2597),o=r(5656),s=r(1318).indexOf,a=r(3501),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,d=[];for(r in n)!i(a,r)&&i(n,r)&&c(d,r);for(;t.length>u;)i(n,r=t[u++])&&(~s(d,r)||c(d,r));return d}},1956:(e,t,r)=>{var n=r(6324),i=r(748);e.exports=Object.keys||function(e){return n(e,i)}},5296:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},7674:(e,t,r)=>{var n=r(1702),i=r(9670),o=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},288:(e,t,r)=>{"use strict";var n=r(1694),i=r(648);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},2140:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(614),s=r(111),a=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!s(n=i(r,e)))return n;if(o(r=e.valueOf)&&!s(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!s(n=i(r,e)))return n;throw a("Can't convert object to primitive value")}},3887:(e,t,r)=>{var n=r(5005),i=r(1702),o=r(8006),s=r(5181),a=r(9670),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=s.f;return r?c(t,r(e)):t}},857:(e,t,r)=>{var n=r(7854);e.exports=n},2534:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},9478:(e,t,r)=>{var n=r(9670),i=r(111),o=r(8523);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},8572:e=>{var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},2248:(e,t,r)=>{var n=r(1320);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},1320:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2597),s=r(8880),a=r(3505),c=r(2788),u=r(9909),d=r(6530).CONFIGURABLE,l=u.get,h=u.enforce,p=String(String).split("String");(e.exports=function(e,t,r,c){var u,l=!!c&&!!c.unsafe,f=!!c&&!!c.enumerable,g=!!c&&!!c.noTargetGet,v=c&&void 0!==c.name?c.name:t;i(r)&&("Symbol("===String(v).slice(0,7)&&(v="["+String(v).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(r,"name")||d&&r.name!==v)&&s(r,"name",v),(u=h(r)).source||(u.source=p.join("string"==typeof v?v:""))),e!==n?(l?!g&&e[t]&&(f=!0):delete e[t],f?e[t]=r:s(e,t,r)):f?e[t]=r:a(t,r)})(Function.prototype,"toString",(function(){return i(this)&&l(this).source||c(this)}))},7651:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9670),s=r(614),a=r(4326),c=r(2261),u=n.TypeError;e.exports=function(e,t){var r=e.exec;if(s(r)){var n=i(r,e,t);return null!==n&&o(n),n}if("RegExp"===a(e))return i(c,e,t);throw u("RegExp#exec called on incompatible receiver")}},2261:(e,t,r)=>{"use strict";var n,i,o=r(6916),s=r(1702),a=r(1340),c=r(7066),u=r(2999),d=r(2309),l=r(30),h=r(9909).get,p=r(9441),f=r(7168),g=d("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,m=v,S=s("".charAt),E=s("".indexOf),_=s("".replace),y=s("".slice),T=(i=/b*/g,o(v,n=/a/,"a"),o(v,i,"a"),0!==n.lastIndex||0!==i.lastIndex),R=u.BROKEN_CARET,A=void 0!==/()??/.exec("")[1];(T||A||R||p||f)&&(m=function(e){var t,r,n,i,s,u,d,p=this,f=h(p),w=a(e),b=f.raw;if(b)return b.lastIndex=p.lastIndex,t=o(m,b,w),p.lastIndex=b.lastIndex,t;var C=f.groups,O=R&&p.sticky,I=o(c,p),P=p.source,N=0,D=w;if(O&&(I=_(I,"y",""),-1===E(I,"g")&&(I+="g"),D=y(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==S(w,p.lastIndex-1))&&(P="(?: "+P+")",D=" "+D,N++),r=new RegExp("^(?:"+P+")",I)),A&&(r=new RegExp("^"+P+"$(?!\\s)",I)),T&&(n=p.lastIndex),i=o(v,O?r:p,D),O?i?(i.input=y(i.input,N),i[0]=y(i[0],N),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:T&&i&&(p.lastIndex=p.global?i.index+i[0].length:n),A&&i&&i.length>1&&o(g,i[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0)})),i&&C)for(i.groups=u=l(null),s=0;s<C.length;s++)u[(d=C[s])[0]]=i[d[1]];return i}),e.exports=m},7066:(e,t,r)=>{"use strict";var n=r(9670);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},2999:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp,o=n((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),s=o||n((function(){return!i("a","y").sticky})),a=o||n((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:o}},9441:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},4488:(e,t,r)=>{var n=r(7854).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},3505:(e,t,r)=>{var n=r(7854),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},6340:(e,t,r)=>{"use strict";var n=r(5005),i=r(3070),o=r(5112),s=r(9781),a=o("species");e.exports=function(e){var t=n(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},8003:(e,t,r)=>{var n=r(3070).f,i=r(2597),o=r(5112)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!i(e,o)&&n(e,o,{configurable:!0,value:t})}},6200:(e,t,r)=>{var n=r(2309),i=r(9711),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},5465:(e,t,r)=>{var n=r(7854),i=r(3505),o="__core-js_shared__",s=n[o]||i(o,{});e.exports=s},2309:(e,t,r)=>{var n=r(1913),i=r(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.1",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},6707:(e,t,r)=>{var n=r(9670),i=r(9483),o=r(5112)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},8710:(e,t,r)=>{var n=r(1702),i=r(9303),o=r(1340),s=r(4488),a=n("".charAt),c=n("".charCodeAt),u=n("".slice),d=function(e){return function(t,r){var n,d,l=o(s(t)),h=i(r),p=l.length;return h<0||h>=p?e?"":void 0:(n=c(l,h))<55296||n>56319||h+1===p||(d=c(l,h+1))<56320||d>57343?e?a(l,h):n:e?u(l,h,h+2):d-56320+(n-55296<<10)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},261:(e,t,r)=>{var n,i,o,s,a=r(7854),c=r(2104),u=r(9974),d=r(614),l=r(2597),h=r(7293),p=r(490),f=r(206),g=r(317),v=r(6833),m=r(5268),S=a.setImmediate,E=a.clearImmediate,_=a.process,y=a.Dispatch,T=a.Function,R=a.MessageChannel,A=a.String,w=0,b={},C="onreadystatechange";try{n=a.location}catch(e){}var O=function(e){if(l(b,e)){var t=b[e];delete b[e],t()}},I=function(e){return function(){O(e)}},P=function(e){O(e.data)},N=function(e){a.postMessage(A(e),n.protocol+"//"+n.host)};S&&E||(S=function(e){var t=f(arguments,1);return b[++w]=function(){c(d(e)?e:T(e),void 0,t)},i(w),w},E=function(e){delete b[e]},m?i=function(e){_.nextTick(I(e))}:y&&y.now?i=function(e){y.now(I(e))}:R&&!v?(s=(o=new R).port2,o.port1.onmessage=P,i=u(s.postMessage,s)):a.addEventListener&&d(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!h(N)?(i=N,a.addEventListener("message",P,!1)):i=C in g("script")?function(e){p.appendChild(g("script"))[C]=function(){p.removeChild(this),O(e)}}:function(e){setTimeout(I(e),0)}),e.exports={set:S,clear:E}},1400:(e,t,r)=>{var n=r(9303),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},5656:(e,t,r)=>{var n=r(8361),i=r(4488);e.exports=function(e){return n(i(e))}},9303:e=>{var t=Math.ceil,r=Math.floor;e.exports=function(e){var n=+e;return n!=n||0===n?0:(n>0?r:t)(n)}},7466:(e,t,r)=>{var n=r(9303),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},7908:(e,t,r)=>{var n=r(7854),i=r(4488),o=n.Object;e.exports=function(e){return o(i(e))}},7593:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(111),s=r(2190),a=r(8173),c=r(2140),u=r(5112),d=n.TypeError,l=u("toPrimitive");e.exports=function(e,t){if(!o(e)||s(e))return e;var r,n=a(e,l);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||s(r))return r;throw d("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},4948:(e,t,r)=>{var n=r(7593),i=r(2190);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},1694:(e,t,r)=>{var n={};n[r(5112)("toStringTag")]="z",e.exports="[object z]"===String(n)},1340:(e,t,r)=>{var n=r(7854),i=r(648),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6330:(e,t,r)=>{var n=r(7854).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},9711:(e,t,r)=>{var n=r(1702),i=0,o=Math.random(),s=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},3307:(e,t,r)=>{var n=r(133);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},6061:(e,t,r)=>{var n=r(5112);t.f=n},5112:(e,t,r)=>{var n=r(7854),i=r(2309),o=r(2597),s=r(9711),a=r(133),c=r(3307),u=i("wks"),d=n.Symbol,l=d&&d.for,h=c?d:d&&d.withoutSetter||s;e.exports=function(e){if(!o(u,e)||!a&&"string"!=typeof u[e]){var t="Symbol."+e;a&&o(d,e)?u[e]=d[e]:u[e]=c&&l?l(t):h(t)}return u[e]}},2222:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(7293),s=r(3157),a=r(111),c=r(7908),u=r(6244),d=r(6135),l=r(5417),h=r(1194),p=r(5112),f=r(7392),g=p("isConcatSpreadable"),v=9007199254740991,m="Maximum allowed index exceeded",S=i.TypeError,E=f>=51||!o((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),_=h("concat"),y=function(e){if(!a(e))return!1;var t=e[g];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,forced:!E||!_},{concat:function(e){var t,r,n,i,o,s=c(this),a=l(s,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(y(o=-1===t?s:arguments[t])){if(h+(i=u(o))>v)throw S(m);for(r=0;r<i;r++,h++)r in o&&d(a,h,o[r])}else{if(h>=v)throw S(m);d(a,h++,o)}return a.length=h,a}})},7327:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).filter;n({target:"Array",proto:!0,forced:!r(1194)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},9826:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).find,o=r(1223),s="find",a=!0;s in[]&&Array(1)[s]((function(){a=!1})),n({target:"Array",proto:!0,forced:a},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},9554:(e,t,r)=>{"use strict";var n=r(2109),i=r(8533);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},6992:(e,t,r)=>{"use strict";var n=r(5656),i=r(1223),o=r(7497),s=r(9909),a=r(3070).f,c=r(654),u=r(1913),d=r(9781),l="Array Iterator",h=s.set,p=s.getterFor(l);e.exports=c(Array,"Array",(function(e,t){h(this,{type:l,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var f=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!u&&d&&"values"!==f.name)try{a(f,"name",{value:"values"})}catch(e){}},9600:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(8361),s=r(5656),a=r(9341),c=i([].join),u=o!=Object,d=a("join",",");n({target:"Array",proto:!0,forced:u||!d},{join:function(e){return c(s(this),void 0===e?",":e)}})},5212:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).some;n({target:"Array",proto:!0,forced:!r(9341)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},3710:(e,t,r)=>{var n=r(1702),i=r(1320),o=Date.prototype,s="Invalid Date",a="toString",c=n(o[a]),u=n(o.getTime);String(new Date(NaN))!=s&&i(o,a,(function(){var e=u(this);return e==e?c(this):s}))},8309:(e,t,r)=>{var n=r(9781),i=r(6530).EXISTS,o=r(1702),s=r(3070).f,a=Function.prototype,c=o(a.toString),u=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,d=o(u.exec);n&&!i&&s(a,"name",{configurable:!0,get:function(){try{return d(u,c(this))[1]}catch(e){return""}}})},9601:(e,t,r)=>{var n=r(2109),i=r(1574);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},8011:(e,t,r)=>{r(2109)({target:"Object",stat:!0,sham:!r(9781)},{create:r(30)})},3321:(e,t,r)=>{var n=r(2109),i=r(9781);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:r(6048)})},9070:(e,t,r)=>{var n=r(2109),i=r(9781);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:r(3070).f})},3371:(e,t,r)=>{var n=r(2109),i=r(6677),o=r(7293),s=r(111),a=r(2423).onFreeze,c=Object.freeze;n({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!i},{freeze:function(e){return c&&s(e)?c(a(e)):e}})},5003:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(5656),s=r(1236).f,a=r(9781),c=i((function(){s(1)}));n({target:"Object",stat:!0,forced:!a||c,sham:!a},{getOwnPropertyDescriptor:function(e,t){return s(o(e),t)}})},9337:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(3887),s=r(5656),a=r(1236),c=r(6135);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=s(e),i=a.f,u=o(n),d={},l=0;u.length>l;)void 0!==(r=i(n,t=u[l++]))&&c(d,t,r);return d}})},489:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(7908),s=r(9518),a=r(8544);n({target:"Object",stat:!0,forced:i((function(){s(1)})),sham:!a},{getPrototypeOf:function(e){return s(o(e))}})},7941:(e,t,r)=>{var n=r(2109),i=r(7908),o=r(1956);n({target:"Object",stat:!0,forced:r(7293)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},8304:(e,t,r)=>{r(2109)({target:"Object",stat:!0},{setPrototypeOf:r(7674)})},1539:(e,t,r)=>{var n=r(1694),i=r(1320),o=r(288);n||i(Object.prototype,"toString",o,{unsafe:!0})},8674:(e,t,r)=>{"use strict";var n,i,o,s,a=r(2109),c=r(1913),u=r(7854),d=r(5005),l=r(6916),h=r(3366),p=r(1320),f=r(2248),g=r(7674),v=r(8003),m=r(6340),S=r(9662),E=r(614),_=r(111),y=r(5787),T=r(2788),R=r(408),A=r(7072),w=r(6707),b=r(261).set,C=r(5948),O=r(9478),I=r(842),P=r(8523),N=r(2534),D=r(8572),L=r(9909),M=r(4705),k=r(5112),x=r(7871),U=r(5268),V=r(7392),H=k("species"),j="Promise",$=L.getterFor(j),B=L.set,F=L.getterFor(j),q=h&&h.prototype,K=h,W=q,G=u.TypeError,Y=u.document,z=u.process,X=P.f,J=X,Z=!!(Y&&Y.createEvent&&u.dispatchEvent),Q=E(u.PromiseRejectionEvent),ee="unhandledrejection",te=!1,re=M(j,(function(){var e=T(K),t=e!==String(K);if(!t&&66===V)return!0;if(c&&!W.finally)return!0;if(V>=51&&/native code/.test(e))return!1;var r=new K((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[H]=n,!(te=r.then((function(){}))instanceof n)||!t&&x&&!Q})),ne=re||!A((function(e){K.all(e).catch((function(){}))})),ie=function(e){var t;return!(!_(e)||!E(t=e.then))&&t},oe=function(e,t){var r,n,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{a?(s||(2===t.rejection&&de(t),t.rejection=1),!0===a?r=o:(d&&d.enter(),r=a(o),d&&(d.exit(),i=!0)),r===e.promise?u(G("Promise-chain cycle")):(n=ie(r))?l(n,r,c,u):c(r)):u(o)}catch(e){d&&!i&&d.exit(),u(e)}},se=function(e,t){e.notified||(e.notified=!0,C((function(){for(var r,n=e.reactions;r=n.get();)oe(r,e);e.notified=!1,t&&!e.rejection&&ce(e)})))},ae=function(e,t,r){var n,i;Z?((n=Y.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Q&&(i=u["on"+e])?i(n):e===ee&&I("Unhandled promise rejection",r)},ce=function(e){l(b,u,(function(){var t,r=e.facade,n=e.value;if(ue(e)&&(t=N((function(){U?z.emit("unhandledRejection",n,r):ae(ee,r,n)})),e.rejection=U||ue(e)?2:1,t.error))throw t.value}))},ue=function(e){return 1!==e.rejection&&!e.parent},de=function(e){l(b,u,(function(){var t=e.facade;U?z.emit("rejectionHandled",t):ae("rejectionhandled",t,e.value)}))},le=function(e,t,r){return function(n){e(t,n,r)}},he=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,se(e,!0))},pe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw G("Promise can't be resolved itself");var n=ie(t);n?C((function(){var r={done:!1};try{l(n,t,le(pe,r,e),le(he,r,e))}catch(t){he(r,t,e)}})):(e.value=t,e.state=1,se(e,!1))}catch(t){he({done:!1},t,e)}}};if(re&&(W=(K=function(e){y(this,W),S(e),l(n,this);var t=$(this);try{e(le(pe,t),le(he,t))}catch(e){he(t,e)}}).prototype,(n=function(e){B(this,{type:j,done:!1,notified:!1,parent:!1,reactions:new D,rejection:!1,state:0,value:void 0})}).prototype=f(W,{then:function(e,t){var r=F(this),n=X(w(this,K));return r.parent=!0,n.ok=!E(e)||e,n.fail=E(t)&&t,n.domain=U?z.domain:void 0,0==r.state?r.reactions.add(n):C((function(){oe(n,r)})),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=$(e);this.promise=e,this.resolve=le(pe,t),this.reject=le(he,t)},P.f=X=function(e){return e===K||e===o?new i(e):J(e)},!c&&E(h)&&q!==Object.prototype)){s=q.then,te||(p(q,"then",(function(e,t){var r=this;return new K((function(e,t){l(s,r,e,t)})).then(e,t)}),{unsafe:!0}),p(q,"catch",W.catch,{unsafe:!0}));try{delete q.constructor}catch(e){}g&&g(q,W)}a({global:!0,wrap:!0,forced:re},{Promise:K}),v(K,j,!1,!0),m(j),o=d(j),a({target:j,stat:!0,forced:re},{reject:function(e){var t=X(this);return l(t.reject,void 0,e),t.promise}}),a({target:j,stat:!0,forced:c||re},{resolve:function(e){return O(c&&this===o?K:this,e)}}),a({target:j,stat:!0,forced:ne},{all:function(e){var t=this,r=X(t),n=r.resolve,i=r.reject,o=N((function(){var r=S(t.resolve),o=[],s=0,a=1;R(e,(function(e){var c=s++,u=!1;a++,l(r,t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=X(t),n=r.reject,i=N((function(){var i=S(t.resolve);R(e,(function(e){l(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},2419:(e,t,r)=>{var n=r(2109),i=r(5005),o=r(2104),s=r(7065),a=r(9483),c=r(9670),u=r(111),d=r(30),l=r(7293),h=i("Reflect","construct"),p=Object.prototype,f=[].push,g=l((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),v=!l((function(){h((function(){}))})),m=g||v;n({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,t){a(e),c(t);var r=arguments.length<3?e:a(arguments[2]);if(v&&!g)return h(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return o(f,n,t),new(o(s,e,n))}var i=r.prototype,l=d(u(i)?i:p),m=o(e,l,t);return u(m)?m:l}})},4916:(e,t,r)=>{"use strict";var n=r(2109),i=r(2261);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},7852:(e,t,r)=>{"use strict";var n,i=r(2109),o=r(1702),s=r(1236).f,a=r(7466),c=r(1340),u=r(3929),d=r(4488),l=r(4964),h=r(1913),p=o("".endsWith),f=o("".slice),g=Math.min,v=l("endsWith");i({target:"String",proto:!0,forced:!(!h&&!v&&(n=s(String.prototype,"endsWith"),n&&!n.writable)||v)},{endsWith:function(e){var t=c(d(this));u(e);var r=arguments.length>1?arguments[1]:void 0,n=t.length,i=void 0===r?n:g(a(r),n),o=c(e);return p?p(t,o,i):f(t,i-o.length,i)===o}})},8783:(e,t,r)=>{"use strict";var n=r(8710).charAt,i=r(1340),o=r(9909),s=r(654),a="String Iterator",c=o.set,u=o.getterFor(a);s(String,"String",(function(e){c(this,{type:a,string:i(e),index:0})}),(function(){var e,t=u(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},3123:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),s=r(7007),a=r(7850),c=r(9670),u=r(4488),d=r(6707),l=r(1530),h=r(7466),p=r(1340),f=r(8173),g=r(1589),v=r(7651),m=r(2261),S=r(2999),E=r(7293),_=S.UNSUPPORTED_Y,y=4294967295,T=Math.min,R=[].push,A=o(/./.exec),w=o(R),b=o("".slice);s("split",(function(e,t,r){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var o=p(u(this)),s=void 0===r?y:r>>>0;if(0===s)return[];if(void 0===e)return[o];if(!a(e))return i(t,o,e,s);for(var c,d,l,h=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),v=0,S=new RegExp(e.source,f+"g");(c=i(m,S,o))&&!((d=S.lastIndex)>v&&(w(h,b(o,v,c.index)),c.length>1&&c.index<o.length&&n(R,h,g(c,1)),l=c[0].length,v=d,h.length>=s));)S.lastIndex===c.index&&S.lastIndex++;return v===o.length?!l&&A(S,"")||w(h,""):w(h,b(o,v)),h.length>s?g(h,0,s):h}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:i(t,this,e,r)}:t,[function(t,r){var n=u(this),s=null==t?void 0:f(t,e);return s?i(s,t,n,r):i(o,p(n),t,r)},function(e,n){var i=c(this),s=p(e),a=r(o,i,s,n,o!==t);if(a.done)return a.value;var u=d(i,RegExp),f=i.unicode,g=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(_?"g":"y"),m=new u(_?"^(?:"+i.source+")":i,g),S=void 0===n?y:n>>>0;if(0===S)return[];if(0===s.length)return null===v(m,s)?[s]:[];for(var E=0,R=0,A=[];R<s.length;){m.lastIndex=_?0:R;var C,O=v(m,_?b(s,R):s);if(null===O||(C=T(h(m.lastIndex+(_?R:0)),s.length))===E)R=l(s,R,f);else{if(w(A,b(s,E,R)),A.length===S)return A;for(var I=1;I<=O.length-1;I++)if(w(A,O[I]),A.length===S)return A;R=E=C}}return w(A,b(s,E)),A}]}),!!E((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),_)},1817:(e,t,r)=>{"use strict";var n=r(2109),i=r(9781),o=r(7854),s=r(1702),a=r(2597),c=r(614),u=r(7976),d=r(1340),l=r(3070).f,h=r(9920),p=o.Symbol,f=p&&p.prototype;if(i&&c(p)&&(!("description"in f)||void 0!==p().description)){var g={},v=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),t=u(f,this)?new p(e):void 0===e?p():p(e);return""===e&&(g[t]=!0),t};h(v,p),v.prototype=f,f.constructor=v;var m="Symbol(test)"==String(p("test")),S=s(f.toString),E=s(f.valueOf),_=/^Symbol\((.*)\)[^)]+$/,y=s("".replace),T=s("".slice);l(f,"description",{configurable:!0,get:function(){var e=E(this),t=S(e);if(a(g,e))return"";var r=m?T(t,7,-1):y(t,_,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:v})}},2165:(e,t,r)=>{r(7235)("iterator")},2526:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(5005),s=r(2104),a=r(6916),c=r(1702),u=r(1913),d=r(9781),l=r(133),h=r(7293),p=r(2597),f=r(3157),g=r(614),v=r(111),m=r(7976),S=r(2190),E=r(9670),_=r(7908),y=r(5656),T=r(4948),R=r(1340),A=r(9114),w=r(30),b=r(1956),C=r(8006),O=r(1156),I=r(5181),P=r(1236),N=r(3070),D=r(5296),L=r(206),M=r(1320),k=r(2309),x=r(6200),U=r(3501),V=r(9711),H=r(5112),j=r(6061),$=r(7235),B=r(8003),F=r(9909),q=r(2092).forEach,K=x("hidden"),W="Symbol",G="prototype",Y=H("toPrimitive"),z=F.set,X=F.getterFor(W),J=Object[G],Z=i.Symbol,Q=Z&&Z[G],ee=i.TypeError,te=i.QObject,re=o("JSON","stringify"),ne=P.f,ie=N.f,oe=O.f,se=D.f,ae=c([].push),ce=k("symbols"),ue=k("op-symbols"),de=k("string-to-symbol-registry"),le=k("symbol-to-string-registry"),he=k("wks"),pe=!te||!te[G]||!te[G].findChild,fe=d&&h((function(){return 7!=w(ie({},"a",{get:function(){return ie(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=ne(J,t);n&&delete J[t],ie(e,t,r),n&&e!==J&&ie(J,t,n)}:ie,ge=function(e,t){var r=ce[e]=w(Q);return z(r,{type:W,tag:e,description:t}),d||(r.description=t),r},ve=function(e,t,r){e===J&&ve(ue,t,r),E(e);var n=T(t);return E(r),p(ce,n)?(r.enumerable?(p(e,K)&&e[K][n]&&(e[K][n]=!1),r=w(r,{enumerable:A(0,!1)})):(p(e,K)||ie(e,K,A(1,{})),e[K][n]=!0),fe(e,n,r)):ie(e,n,r)},me=function(e,t){E(e);var r=y(t),n=b(r).concat(ye(r));return q(n,(function(t){d&&!a(Se,r,t)||ve(e,t,r[t])})),e},Se=function(e){var t=T(e),r=a(se,this,t);return!(this===J&&p(ce,t)&&!p(ue,t))&&(!(r||!p(this,t)||!p(ce,t)||p(this,K)&&this[K][t])||r)},Ee=function(e,t){var r=y(e),n=T(t);if(r!==J||!p(ce,n)||p(ue,n)){var i=ne(r,n);return!i||!p(ce,n)||p(r,K)&&r[K][n]||(i.enumerable=!0),i}},_e=function(e){var t=oe(y(e)),r=[];return q(t,(function(e){p(ce,e)||p(U,e)||ae(r,e)})),r},ye=function(e){var t=e===J,r=oe(t?ue:y(e)),n=[];return q(r,(function(e){!p(ce,e)||t&&!p(J,e)||ae(n,ce[e])})),n};if(l||(M(Q=(Z=function(){if(m(Q,this))throw ee("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?R(arguments[0]):void 0,t=V(e),r=function(e){this===J&&a(r,ue,e),p(this,K)&&p(this[K],t)&&(this[K][t]=!1),fe(this,t,A(1,e))};return d&&pe&&fe(J,t,{configurable:!0,set:r}),ge(t,e)})[G],"toString",(function(){return X(this).tag})),M(Z,"withoutSetter",(function(e){return ge(V(e),e)})),D.f=Se,N.f=ve,P.f=Ee,C.f=O.f=_e,I.f=ye,j.f=function(e){return ge(H(e),e)},d&&(ie(Q,"description",{configurable:!0,get:function(){return X(this).description}}),u||M(J,"propertyIsEnumerable",Se,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!l,sham:!l},{Symbol:Z}),q(b(he),(function(e){$(e)})),n({target:W,stat:!0,forced:!l},{for:function(e){var t=R(e);if(p(de,t))return de[t];var r=Z(t);return de[t]=r,le[r]=t,r},keyFor:function(e){if(!S(e))throw ee(e+" is not a symbol");if(p(le,e))return le[e]},useSetter:function(){pe=!0},useSimple:function(){pe=!1}}),n({target:"Object",stat:!0,forced:!l,sham:!d},{create:function(e,t){return void 0===t?w(e):me(w(e),t)},defineProperty:ve,defineProperties:me,getOwnPropertyDescriptor:Ee}),n({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:_e,getOwnPropertySymbols:ye}),n({target:"Object",stat:!0,forced:h((function(){I.f(1)}))},{getOwnPropertySymbols:function(e){return I.f(_(e))}}),re&&n({target:"JSON",stat:!0,forced:!l||h((function(){var e=Z();return"[null]"!=re([e])||"{}"!=re({a:e})||"{}"!=re(Object(e))}))},{stringify:function(e,t,r){var n=L(arguments),i=t;if((v(t)||void 0!==e)&&!S(e))return f(t)||(t=function(e,t){if(g(i)&&(t=a(i,this,e,t)),!S(t))return t}),n[1]=t,s(re,null,n)}}),!Q[Y]){var Te=Q.valueOf;M(Q,Y,(function(e){return a(Te,this)}))}B(Z,W),U[K]=!0},8478:(e,t,r)=>{"use strict";r(7710)("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(9320))},4747:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),s=r(8533),a=r(8880),c=function(e){if(e&&e.forEach!==s)try{a(e,"forEach",s)}catch(t){e.forEach=s}};for(var u in i)i[u]&&c(n[u]&&n[u].prototype);c(o)},3948:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),s=r(6992),a=r(8880),c=r(5112),u=c("iterator"),d=c("toStringTag"),l=s.values,h=function(e,t){if(e){if(e[u]!==l)try{a(e,u,l)}catch(t){e[u]=l}if(e[d]||a(e,d,t),i[t])for(var r in s)if(e[r]!==s[r])try{a(e,r,s[r])}catch(t){e[r]=s[r]}}};for(var p in i)h(n[p]&&n[p].prototype,p);h(o,"DOMTokenList")},2564:(e,t,r)=>{var n=r(2109),i=r(7854),o=r(2104),s=r(614),a=r(8113),c=r(206),u=/MSIE .\./.test(a),d=i.Function,l=function(e){return function(t,r){var n=arguments.length>2,i=n?c(arguments,2):void 0;return e(n?function(){o(s(t)?t:d(t),this,i)}:t,r)}};n({global:!0,bind:!0,forced:u},{setTimeout:l(i.setTimeout),setInterval:l(i.setInterval)})},2968:e=>{var t;self,t=()=>(()=>{var e={9662:(e,t,r)=>{var n=r(7854),i=r(614),o=r(6330),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a function")}},9483:(e,t,r)=>{var n=r(7854),i=r(4411),o=r(6330),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a constructor")}},6077:(e,t,r)=>{var n=r(7854),i=r(614),o=n.String,s=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw s("Can't set "+o(e)+" as a prototype")}},1223:(e,t,r)=>{var n=r(5112),i=r(30),o=r(3070),s=n("unscopables"),a=Array.prototype;null==a[s]&&o.f(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},1530:(e,t,r)=>{"use strict";var n=r(8710).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},5787:(e,t,r)=>{var n=r(7854),i=r(7976),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},9670:(e,t,r)=>{var n=r(7854),i=r(111),o=n.String,s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not an object")}},4019:e=>{e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7556:(e,t,r)=>{var n=r(7293);e.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},260:(e,t,r)=>{"use strict";var n,i,o,s=r(4019),a=r(9781),c=r(7854),u=r(614),d=r(111),l=r(2597),h=r(648),p=r(6330),f=r(8880),g=r(1320),v=r(3070).f,m=r(7976),S=r(9518),E=r(7674),_=r(5112),y=r(9711),T=c.Int8Array,R=T&&T.prototype,A=c.Uint8ClampedArray,w=A&&A.prototype,b=T&&S(T),C=R&&S(R),O=Object.prototype,I=c.TypeError,P=_("toStringTag"),N=y("TYPED_ARRAY_TAG"),D=y("TYPED_ARRAY_CONSTRUCTOR"),L=s&&!!E&&"Opera"!==h(c.opera),M=!1,k={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},x={BigInt64Array:8,BigUint64Array:8},U=function(e){if(!d(e))return!1;var t=h(e);return l(k,t)||l(x,t)};for(n in k)(o=(i=c[n])&&i.prototype)?f(o,D,i):L=!1;for(n in x)(o=(i=c[n])&&i.prototype)&&f(o,D,i);if((!L||!u(b)||b===Function.prototype)&&(b=function(){throw I("Incorrect invocation")},L))for(n in k)c[n]&&E(c[n],b);if((!L||!C||C===O)&&(C=b.prototype,L))for(n in k)c[n]&&E(c[n].prototype,C);if(L&&S(w)!==C&&E(w,C),a&&!l(C,P))for(n in M=!0,v(C,P,{get:function(){return d(this)?this[N]:void 0}}),k)c[n]&&f(c[n],N,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:L,TYPED_ARRAY_CONSTRUCTOR:D,TYPED_ARRAY_TAG:M&&N,aTypedArray:function(e){if(U(e))return e;throw I("Target is not a typed array")},aTypedArrayConstructor:function(e){if(u(e)&&(!E||m(b,e)))return e;throw I(p(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(a){if(r)for(var i in k){var o=c[i];if(o&&l(o.prototype,e))try{delete o.prototype[e]}catch(r){try{o.prototype[e]=t}catch(e){}}}C[e]&&!r||g(C,e,r?t:L&&R[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(a){if(E){if(r)for(n in k)if((i=c[n])&&l(i,e))try{delete i[e]}catch(e){}if(b[e]&&!r)return;try{return g(b,e,r?t:L&&b[e]||t)}catch(e){}}for(n in k)!(i=c[n])||i[e]&&!r||g(i,e,t)}},isView:function(e){if(!d(e))return!1;var t=h(e);return"DataView"===t||l(k,t)||l(x,t)},isTypedArray:U,TypedArray:b,TypedArrayPrototype:C}},3331:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(9781),s=r(4019),a=r(6530),c=r(8880),u=r(2248),d=r(7293),l=r(5787),h=r(9303),p=r(7466),f=r(7067),g=r(1179),v=r(9518),m=r(7674),S=r(8006).f,E=r(3070).f,_=r(1285),y=r(1589),T=r(8003),R=r(9909),A=a.PROPER,w=a.CONFIGURABLE,b=R.get,C=R.set,O="ArrayBuffer",I="DataView",P="prototype",N="Wrong index",D=n[O],L=D,M=L&&L[P],k=n[I],x=k&&k[P],U=Object.prototype,V=n.Array,H=n.RangeError,j=i(_),$=i([].reverse),B=g.pack,F=g.unpack,q=function(e){return[255&e]},K=function(e){return[255&e,e>>8&255]},W=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},G=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Y=function(e){return B(e,23,4)},z=function(e){return B(e,52,8)},X=function(e,t){E(e[P],t,{get:function(){return b(this)[t]}})},J=function(e,t,r,n){var i=f(r),o=b(e);if(i+t>o.byteLength)throw H(N);var s=b(o.buffer).bytes,a=i+o.byteOffset,c=y(s,a,a+t);return n?c:$(c)},Z=function(e,t,r,n,i,o){var s=f(r),a=b(e);if(s+t>a.byteLength)throw H(N);for(var c=b(a.buffer).bytes,u=s+a.byteOffset,d=n(+i),l=0;l<t;l++)c[u+l]=d[o?l:t-l-1]};if(s){var Q=A&&D.name!==O;if(d((function(){D(1)}))&&d((function(){new D(-1)}))&&!d((function(){return new D,new D(1.5),new D(NaN),Q&&!w})))Q&&w&&c(D,"name",O);else{(L=function(e){return l(this,M),new D(f(e))})[P]=M;for(var ee,te=S(D),re=0;te.length>re;)(ee=te[re++])in L||c(L,ee,D[ee]);M.constructor=L}m&&v(x)!==U&&m(x,U);var ne=new k(new L(2)),ie=i(x.setInt8);ne.setInt8(0,2147483648),ne.setInt8(1,2147483649),!ne.getInt8(0)&&ne.getInt8(1)||u(x,{setInt8:function(e,t){ie(this,e,t<<24>>24)},setUint8:function(e,t){ie(this,e,t<<24>>24)}},{unsafe:!0})}else M=(L=function(e){l(this,M);var t=f(e);C(this,{bytes:j(V(t),0),byteLength:t}),o||(this.byteLength=t)})[P],x=(k=function(e,t,r){l(this,x),l(e,M);var n=b(e).byteLength,i=h(t);if(i<0||i>n)throw H("Wrong offset");if(i+(r=void 0===r?n-i:p(r))>n)throw H("Wrong length");C(this,{buffer:e,byteLength:r,byteOffset:i}),o||(this.buffer=e,this.byteLength=r,this.byteOffset=i)})[P],o&&(X(L,"byteLength"),X(k,"buffer"),X(k,"byteLength"),X(k,"byteOffset")),u(x,{getInt8:function(e){return J(this,1,e)[0]<<24>>24},getUint8:function(e){return J(this,1,e)[0]},getInt16:function(e){var t=J(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=J(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return G(J(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return G(J(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return F(J(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return F(J(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Z(this,1,e,q,t)},setUint8:function(e,t){Z(this,1,e,q,t)},setInt16:function(e,t){Z(this,2,e,K,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Z(this,2,e,K,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Z(this,4,e,W,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Z(this,4,e,W,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Z(this,4,e,Y,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Z(this,8,e,z,t,arguments.length>2?arguments[2]:void 0)}});T(L,O),T(k,I),e.exports={ArrayBuffer:L,DataView:k}},1048:(e,t,r)=>{"use strict";var n=r(7908),i=r(1400),o=r(6244),s=Math.min;e.exports=[].copyWithin||function(e,t){var r=n(this),a=o(r),c=i(e,a),u=i(t,a),d=arguments.length>2?arguments[2]:void 0,l=s((void 0===d?a:i(d,a))-u,a-c),h=1;for(u<c&&c<u+l&&(h=-1,u+=l-1,c+=l-1);l-- >0;)u in r?r[c]=r[u]:delete r[c],c+=h,u+=h;return r}},1285:(e,t,r)=>{"use strict";var n=r(7908),i=r(1400),o=r(6244);e.exports=function(e){for(var t=n(this),r=o(t),s=arguments.length,a=i(s>1?arguments[1]:void 0,r),c=s>2?arguments[2]:void 0,u=void 0===c?r:i(c,r);u>a;)t[a++]=e;return t}},8533:(e,t,r)=>{"use strict";var n=r(2092).forEach,i=r(9341)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},7745:(e,t,r)=>{var n=r(6244);e.exports=function(e,t){for(var r=0,i=n(t),o=new e(i);i>r;)o[r]=t[r++];return o}},8457:(e,t,r)=>{"use strict";var n=r(7854),i=r(9974),o=r(6916),s=r(7908),a=r(3411),c=r(7659),u=r(4411),d=r(6244),l=r(6135),h=r(8554),p=r(1246),f=n.Array;e.exports=function(e){var t=s(e),r=u(this),n=arguments.length,g=n>1?arguments[1]:void 0,v=void 0!==g;v&&(g=i(g,n>2?arguments[2]:void 0));var m,S,E,_,y,T,R=p(t),A=0;if(!R||this==f&&c(R))for(m=d(t),S=r?new this(m):f(m);m>A;A++)T=v?g(t[A],A):t[A],l(S,A,T);else for(y=(_=h(t,R)).next,S=r?new this:[];!(E=o(y,_)).done;A++)T=v?a(_,g,[E.value,A],!0):E.value,l(S,A,T);return S.length=A,S}},1318:(e,t,r)=>{var n=r(5656),i=r(1400),o=r(6244),s=function(e){return function(t,r,s){var a,c=n(t),u=o(c),d=i(s,u);if(e&&r!=r){for(;u>d;)if((a=c[d++])!=a)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},2092:(e,t,r)=>{var n=r(9974),i=r(1702),o=r(8361),s=r(7908),a=r(6244),c=r(5417),u=i([].push),d=function(e){var t=1==e,r=2==e,i=3==e,d=4==e,l=6==e,h=7==e,p=5==e||l;return function(f,g,v,m){for(var S,E,_=s(f),y=o(_),T=n(g,v),R=a(y),A=0,w=m||c,b=t?w(f,R):r||h?w(f,0):void 0;R>A;A++)if((p||A in y)&&(E=T(S=y[A],A,_),e))if(t)b[A]=E;else if(E)switch(e){case 3:return!0;case 5:return S;case 6:return A;case 2:u(b,S)}else switch(e){case 4:return!1;case 7:u(b,S)}return l?-1:i||d?d:b}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},6583:(e,t,r)=>{"use strict";var n=r(2104),i=r(5656),o=r(9303),s=r(6244),a=r(9341),c=Math.min,u=[].lastIndexOf,d=!!u&&1/[1].lastIndexOf(1,-0)<0,l=a("lastIndexOf"),h=d||!l;e.exports=h?function(e){if(d)return n(u,this,arguments)||0;var t=i(this),r=s(t),a=r-1;for(arguments.length>1&&(a=c(a,o(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:u},1194:(e,t,r)=>{var n=r(7293),i=r(5112),o=r(7392),s=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},9341:(e,t,r)=>{"use strict";var n=r(7293);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}},3671:(e,t,r)=>{var n=r(7854),i=r(9662),o=r(7908),s=r(8361),a=r(6244),c=n.TypeError,u=function(e){return function(t,r,n,u){i(r);var d=o(t),l=s(d),h=a(d),p=e?h-1:0,f=e?-1:1;if(n<2)for(;;){if(p in l){u=l[p],p+=f;break}if(p+=f,e?p<0:h<=p)throw c("Reduce of empty array with no initial value")}for(;e?p>=0:h>p;p+=f)p in l&&(u=r(u,l[p],p,d));return u}};e.exports={left:u(!1),right:u(!0)}},1589:(e,t,r)=>{var n=r(7854),i=r(1400),o=r(6244),s=r(6135),a=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),d=i(void 0===r?n:r,n),l=a(c(d-u,0)),h=0;u<d;u++,h++)s(l,h,e[u]);return l.length=h,l}},206:(e,t,r)=>{var n=r(1702);e.exports=n([].slice)},4362:(e,t,r)=>{var n=r(1589),i=Math.floor,o=function(e,t){var r=e.length,c=i(r/2);return r<8?s(e,t):a(e,o(n(e,0,c),t),o(n(e,c),t),t)},s=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},a=function(e,t,r,n){for(var i=t.length,o=r.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?n(t[s],r[a])<=0?t[s++]:r[a++]:s<i?t[s++]:r[a++];return e};e.exports=o},7475:(e,t,r)=>{var n=r(7854),i=r(3157),o=r(4411),s=r(111),a=r(5112)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?c:t}},5417:(e,t,r)=>{var n=r(7475);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},3411:(e,t,r)=>{var n=r(9670),i=r(9212);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},7072:(e,t,r)=>{var n=r(5112)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},4326:(e,t,r)=>{var n=r(1702),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},648:(e,t,r)=>{var n=r(7854),i=r(1694),o=r(614),s=r(4326),a=r(5112)("toStringTag"),c=n.Object,u="Arguments"==s(function(){return arguments}());e.exports=i?s:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),a))?r:u?s(t):"Object"==(n=s(t))&&o(t.callee)?"Arguments":n}},5631:(e,t,r)=>{"use strict";var n=r(3070).f,i=r(30),o=r(2248),s=r(9974),a=r(5787),c=r(408),u=r(654),d=r(6340),l=r(9781),h=r(2423).fastKey,p=r(9909),f=p.set,g=p.getterFor;e.exports={getConstructor:function(e,t,r,u){var d=e((function(e,n){a(e,p),f(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),l||(e.size=0),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),p=d.prototype,v=g(t),m=function(e,t,r){var n,i,o=v(e),s=S(e,t);return s?s.value=r:(o.last=s={index:i=h(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),l?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},S=function(e,t){var r,n=v(e),i=h(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return o(p,{clear:function(){for(var e=v(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,l?e.size=0:this.size=0},delete:function(e){var t=this,r=v(t),n=S(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),l?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=v(this),n=s(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!S(this,e)}}),o(p,r?{get:function(e){var t=S(this,e);return t&&t.value},set:function(e,t){return m(this,0===e?0:e,t)}}:{add:function(e){return m(this,e=0===e?0:e,e)}}),l&&n(p,"size",{get:function(){return v(this).size}}),d},setStrong:function(e,t,r){var n=t+" Iterator",i=g(t),o=g(n);u(e,t,(function(e,t){f(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),d(t)}}},7710:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(1702),s=r(4705),a=r(1320),c=r(2423),u=r(408),d=r(5787),l=r(614),h=r(111),p=r(7293),f=r(7072),g=r(8003),v=r(9587);e.exports=function(e,t,r){var m=-1!==e.indexOf("Map"),S=-1!==e.indexOf("Weak"),E=m?"set":"add",_=i[e],y=_&&_.prototype,T=_,R={},A=function(e){var t=o(y[e]);a(y,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return S&&!h(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(s(e,!l(_)||!(S||y.forEach&&!p((function(){(new _).entries().next()})))))T=r.getConstructor(t,e,m,E),c.enable();else if(s(e,!0)){var w=new T,b=w[E](S?{}:-0,1)!=w,C=p((function(){w.has(1)})),O=f((function(e){new _(e)})),I=!S&&p((function(){for(var e=new _,t=5;t--;)e[E](t,t);return!e.has(-0)}));O||((T=t((function(e,t){d(e,y);var r=v(new _,e,T);return null!=t&&u(t,r[E],{that:r,AS_ENTRIES:m}),r}))).prototype=y,y.constructor=T),(C||I)&&(A("delete"),A("has"),m&&A("get")),(I||b)&&A(E),S&&y.clear&&delete y.clear}return R[e]=T,n({global:!0,forced:T!=_},R),g(T,e),S||r.setStrong(T,e,m),T}},9920:(e,t,r)=>{var n=r(2597),i=r(3887),o=r(1236),s=r(3070);e.exports=function(e,t,r){for(var a=i(t),c=s.f,u=o.f,d=0;d<a.length;d++){var l=a[d];n(e,l)||r&&n(r,l)||c(e,l,u(t,l))}}},4964:(e,t,r)=>{var n=r(5112)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},8544:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:(e,t,r)=>{"use strict";var n=r(3383).IteratorPrototype,i=r(30),o=r(9114),s=r(8003),a=r(7497),c=function(){return this};e.exports=function(e,t,r,u){var d=t+" Iterator";return e.prototype=i(n,{next:o(+!u,r)}),s(e,d,!1,!0),a[d]=c,e}},8880:(e,t,r)=>{var n=r(9781),i=r(3070),o=r(9114);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},9114:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6135:(e,t,r)=>{"use strict";var n=r(4948),i=r(3070),o=r(9114);e.exports=function(e,t,r){var s=n(t);s in e?i.f(e,s,o(0,r)):e[s]=r}},654:(e,t,r)=>{"use strict";var n=r(2109),i=r(6916),o=r(1913),s=r(6530),a=r(614),c=r(4994),u=r(9518),d=r(7674),l=r(8003),h=r(8880),p=r(1320),f=r(5112),g=r(7497),v=r(3383),m=s.PROPER,S=s.CONFIGURABLE,E=v.IteratorPrototype,_=v.BUGGY_SAFARI_ITERATORS,y=f("iterator"),T="keys",R="values",A="entries",w=function(){return this};e.exports=function(e,t,r,s,f,v,b){c(r,t,s);var C,O,I,P=function(e){if(e===f&&k)return k;if(!_&&e in L)return L[e];switch(e){case T:case R:case A:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",D=!1,L=e.prototype,M=L[y]||L["@@iterator"]||f&&L[f],k=!_&&M||P(f),x="Array"==t&&L.entries||M;if(x&&(C=u(x.call(new e)))!==Object.prototype&&C.next&&(o||u(C)===E||(d?d(C,E):a(C[y])||p(C,y,w)),l(C,N,!0,!0),o&&(g[N]=w)),m&&f==R&&M&&M.name!==R&&(!o&&S?h(L,"name",R):(D=!0,k=function(){return i(M,this)})),f)if(O={values:P(R),keys:v?k:P(T),entries:P(A)},b)for(I in O)(_||D||!(I in L))&&p(L,I,O[I]);else n({target:t,proto:!0,forced:_||D},O);return o&&!b||L[y]===k||p(L,y,k,{name:f}),g[t]=k,O}},7235:(e,t,r)=>{var n=r(857),i=r(2597),o=r(6061),s=r(3070).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},9781:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:(e,t,r)=>{var n=r(7854),i=r(111),o=n.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},8324:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(e,t,r)=>{var n=r(317)("span").classList,i=n&&n.constructor&&n.constructor.prototype;e.exports=i===Object.prototype?void 0:i},8886:(e,t,r)=>{var n=r(8113).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},7871:e=>{e.exports="object"==typeof window},256:(e,t,r)=>{var n=r(8113);e.exports=/MSIE|Trident/.test(n)},1528:(e,t,r)=>{var n=r(8113),i=r(7854);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},6833:(e,t,r)=>{var n=r(8113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},5268:(e,t,r)=>{var n=r(4326),i=r(7854);e.exports="process"==n(i.process)},1036:(e,t,r)=>{var n=r(8113);e.exports=/web0s(?!.*chrome)/i.test(n)},8113:(e,t,r)=>{var n=r(5005);e.exports=n("navigator","userAgent")||""},7392:(e,t,r)=>{var n,i,o=r(7854),s=r(8113),a=o.process,c=o.Deno,u=a&&a.versions||c&&c.version,d=u&&u.v8;d&&(i=(n=d.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},8008:(e,t,r)=>{var n=r(8113).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},748:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(e,t,r)=>{var n=r(7854),i=r(1236).f,o=r(8880),s=r(1320),a=r(3505),c=r(9920),u=r(4705);e.exports=function(e,t){var r,d,l,h,p,f=e.target,g=e.global,v=e.stat;if(r=g?n:v?n[f]||a(f,{}):(n[f]||{}).prototype)for(d in t){if(h=t[d],l=e.noTargetGet?(p=i(r,d))&&p.value:r[d],!u(g?d:f+(v?".":"#")+d,e.forced)&&void 0!==l){if(typeof h==typeof l)continue;c(h,l)}(e.sham||l&&l.sham)&&o(h,"sham",!0),s(r,d,h,e)}}},7293:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},7007:(e,t,r)=>{"use strict";r(4916);var n=r(1702),i=r(1320),o=r(2261),s=r(7293),a=r(5112),c=r(8880),u=a("species"),d=RegExp.prototype;e.exports=function(e,t,r,l){var h=a(e),p=!s((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),f=p&&!s((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[u]=function(){return r},r.flags="",r[h]=/./[h]),r.exec=function(){return t=!0,null},r[h](""),!t}));if(!p||!f||r){var g=n(/./[h]),v=t(h,""[e],(function(e,t,r,i,s){var a=n(e),c=t.exec;return c===o||c===d.exec?p&&!s?{done:!0,value:g(t,r,i)}:{done:!0,value:a(r,t,i)}:{done:!1}}));i(String.prototype,e,v[0]),i(d,h,v[1])}l&&c(d[h],"sham",!0)}},6677:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},2104:(e,t,r)=>{var n=r(4374),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?s.bind(o):function(){return s.apply(o,arguments)})},9974:(e,t,r)=>{var n=r(1702),i=r(9662),o=r(4374),s=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},4374:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},7065:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(9662),s=r(111),a=r(2597),c=r(206),u=r(4374),d=n.Function,l=i([].concat),h=i([].join),p={},f=function(e,t,r){if(!a(p,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";p[t]=d("C,a","return new C("+h(n,",")+")")}return p[t](e,r)};e.exports=u?d.bind:function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=l(n,c(arguments));return this instanceof i?f(t,r.length,r):t.apply(e,r)};return s(r)&&(i.prototype=r),i}},6916:(e,t,r)=>{var n=r(4374),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},6530:(e,t,r)=>{var n=r(9781),i=r(2597),o=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},1702:(e,t,r)=>{var n=r(4374),i=Function.prototype,o=i.bind,s=i.call,a=n&&o.bind(s,s);e.exports=n?function(e){return e&&a(e)}:function(e){return e&&function(){return s.apply(e,arguments)}}},5005:(e,t,r)=>{var n=r(7854),i=r(614),o=function(e){return i(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e]):n[e]&&n[e][t]}},1246:(e,t,r)=>{var n=r(648),i=r(8173),o=r(7497),s=r(5112)("iterator");e.exports=function(e){if(null!=e)return i(e,s)||i(e,"@@iterator")||o[n(e)]}},8554:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9662),s=r(9670),a=r(6330),c=r(1246),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return s(i(r,e));throw u(a(e)+" is not iterable")}},8173:(e,t,r)=>{var n=r(9662);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},647:(e,t,r)=>{var n=r(1702),i=r(7908),o=Math.floor,s=n("".charAt),a=n("".replace),c=n("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,l,h){var p=r+e.length,f=n.length,g=d;return void 0!==l&&(l=i(l),g=u),a(h,g,(function(i,a){var u;switch(s(a,0)){case"$":return"$";case"&":return e;case"`":return c(t,0,r);case"'":return c(t,p);case"<":u=l[c(a,1,-1)];break;default:var d=+a;if(0===d)return i;if(d>f){var h=o(d/10);return 0===h?i:h<=f?void 0===n[h-1]?s(a,1):n[h-1]+s(a,1):i}u=n[d-1]}return void 0===u?"":u}))}},7854:(e,t,r)=>{var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},2597:(e,t,r)=>{var n=r(1702),i=r(7908),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},3501:e=>{e.exports={}},842:(e,t,r)=>{var n=r(7854);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},490:(e,t,r)=>{var n=r(5005);e.exports=n("document","documentElement")},4664:(e,t,r)=>{var n=r(9781),i=r(7293),o=r(317);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},1179:(e,t,r)=>{var n=r(7854).Array,i=Math.abs,o=Math.pow,s=Math.floor,a=Math.log,c=Math.LN2;e.exports={pack:function(e,t,r){var u,d,l,h=n(r),p=8*r-t-1,f=(1<<p)-1,g=f>>1,v=23===t?o(2,-24)-o(2,-77):0,m=e<0||0===e&&1/e<0?1:0,S=0;for((e=i(e))!=e||e===1/0?(d=e!=e?1:0,u=f):(u=s(a(e)/c),e*(l=o(2,-u))<1&&(u--,l*=2),(e+=u+g>=1?v/l:v*o(2,1-g))*l>=2&&(u++,l/=2),u+g>=f?(d=0,u=f):u+g>=1?(d=(e*l-1)*o(2,t),u+=g):(d=e*o(2,g-1)*o(2,t),u=0));t>=8;)h[S++]=255&d,d/=256,t-=8;for(u=u<<t|d,p+=t;p>0;)h[S++]=255&u,u/=256,p-=8;return h[--S]|=128*m,h},unpack:function(e,t){var r,n=e.length,i=8*n-t-1,s=(1<<i)-1,a=s>>1,c=i-7,u=n-1,d=e[u--],l=127&d;for(d>>=7;c>0;)l=256*l+e[u--],c-=8;for(r=l&(1<<-c)-1,l>>=-c,c+=t;c>0;)r=256*r+e[u--],c-=8;if(0===l)l=1-a;else{if(l===s)return r?NaN:d?-1/0:1/0;r+=o(2,t),l-=a}return(d?-1:1)*r*o(2,l-t)}}},8361:(e,t,r)=>{var n=r(7854),i=r(1702),o=r(7293),s=r(4326),a=n.Object,c=i("".split);e.exports=o((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"==s(e)?c(e,""):a(e)}:a},9587:(e,t,r)=>{var n=r(614),i=r(111),o=r(7674);e.exports=function(e,t,r){var s,a;return o&&n(s=t.constructor)&&s!==r&&i(a=s.prototype)&&a!==r.prototype&&o(e,a),e}},2788:(e,t,r)=>{var n=r(1702),i=r(614),o=r(5465),s=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},2423:(e,t,r)=>{var n=r(2109),i=r(1702),o=r(3501),s=r(111),a=r(2597),c=r(3070).f,u=r(8006),d=r(1156),l=r(2050),h=r(9711),p=r(6677),f=!1,g=h("meta"),v=0,m=function(e){c(e,g,{value:{objectID:"O"+v++,weakData:{}}})},S=e.exports={enable:function(){S.enable=function(){},f=!0;var e=u.f,t=i([].splice),r={};r[g]=1,e(r).length&&(u.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===g){t(n,i,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:d.f}))},fastKey:function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,g)){if(!l(e))return"F";if(!t)return"E";m(e)}return e[g].objectID},getWeakData:function(e,t){if(!a(e,g)){if(!l(e))return!0;if(!t)return!1;m(e)}return e[g].weakData},onFreeze:function(e){return p&&f&&l(e)&&!a(e,g)&&m(e),e}};o[g]=!0},9909:(e,t,r)=>{var n,i,o,s=r(8536),a=r(7854),c=r(1702),u=r(111),d=r(8880),l=r(2597),h=r(5465),p=r(6200),f=r(3501),g="Object already initialized",v=a.TypeError,m=a.WeakMap;if(s||h.state){var S=h.state||(h.state=new m),E=c(S.get),_=c(S.has),y=c(S.set);n=function(e,t){if(_(S,e))throw new v(g);return t.facade=e,y(S,e,t),t},i=function(e){return E(S,e)||{}},o=function(e){return _(S,e)}}else{var T=p("state");f[T]=!0,n=function(e,t){if(l(e,T))throw new v(g);return t.facade=e,d(e,T,t),t},i=function(e){return l(e,T)?e[T]:{}},o=function(e){return l(e,T)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw v("Incompatible receiver, "+e+" required");return r}}}},7659:(e,t,r)=>{var n=r(5112),i=r(7497),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},3157:(e,t,r)=>{var n=r(4326);e.exports=Array.isArray||function(e){return"Array"==n(e)}},614:e=>{e.exports=function(e){return"function"==typeof e}},4411:(e,t,r)=>{var n=r(1702),i=r(7293),o=r(614),s=r(648),a=r(5005),c=r(2788),u=function(){},d=[],l=a("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=n(h.exec),f=!h.exec(u),g=function(e){if(!o(e))return!1;try{return l(u,d,e),!0}catch(e){return!1}},v=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};v.sham=!0,e.exports=!l||i((function(){var e;return g(g.call)||!g(Object)||!g((function(){e=!0}))||e}))?v:g},4705:(e,t,r)=>{var n=r(7293),i=r(614),o=/#|\.prototype\./,s=function(e,t){var r=c[a(e)];return r==d||r!=u&&(i(t)?n(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=s.data={},u=s.NATIVE="N",d=s.POLYFILL="P";e.exports=s},5988:(e,t,r)=>{var n=r(111),i=Math.floor;e.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&i(e)===e}},111:(e,t,r)=>{var n=r(614);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},1913:e=>{e.exports=!1},7850:(e,t,r)=>{var n=r(111),i=r(4326),o=r(5112)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},2190:(e,t,r)=>{var n=r(7854),i=r(5005),o=r(614),s=r(7976),a=r(3307),c=n.Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&s(t.prototype,c(e))}},408:(e,t,r)=>{var n=r(7854),i=r(9974),o=r(6916),s=r(9670),a=r(6330),c=r(7659),u=r(6244),d=r(7976),l=r(8554),h=r(1246),p=r(9212),f=n.TypeError,g=function(e,t){this.stopped=e,this.result=t},v=g.prototype;e.exports=function(e,t,r){var n,m,S,E,_,y,T,R=r&&r.that,A=!(!r||!r.AS_ENTRIES),w=!(!r||!r.IS_ITERATOR),b=!(!r||!r.INTERRUPTED),C=i(t,R),O=function(e){return n&&p(n,"normal",e),new g(!0,e)},I=function(e){return A?(s(e),b?C(e[0],e[1],O):C(e[0],e[1])):b?C(e,O):C(e)};if(w)n=e;else{if(!(m=h(e)))throw f(a(e)+" is not iterable");if(c(m)){for(S=0,E=u(e);E>S;S++)if((_=I(e[S]))&&d(v,_))return _;return new g(!1)}n=l(e,m)}for(y=n.next;!(T=o(y,n)).done;){try{_=I(T.value)}catch(e){p(n,"throw",e)}if("object"==typeof _&&_&&d(v,_))return _}return new g(!1)}},9212:(e,t,r)=>{var n=r(6916),i=r(9670),o=r(8173);e.exports=function(e,t,r){var s,a;i(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw r;return r}s=n(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw r;if(a)throw s;return i(s),r}},3383:(e,t,r)=>{"use strict";var n,i,o,s=r(7293),a=r(614),c=r(30),u=r(9518),d=r(1320),l=r(5112),h=r(1913),p=l("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):f=!0),null==n||s((function(){var e={};return n[p].call(e)!==e}))?n={}:h&&(n=c(n)),a(n[p])||d(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},7497:e=>{e.exports={}},6244:(e,t,r)=>{var n=r(7466);e.exports=function(e){return n(e.length)}},5948:(e,t,r)=>{var n,i,o,s,a,c,u,d,l=r(7854),h=r(9974),p=r(1236).f,f=r(261).set,g=r(6833),v=r(1528),m=r(1036),S=r(5268),E=l.MutationObserver||l.WebKitMutationObserver,_=l.document,y=l.process,T=l.Promise,R=p(l,"queueMicrotask"),A=R&&R.value;A||(n=function(){var e,t;for(S&&(e=y.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?s():o=void 0,e}}o=void 0,e&&e.enter()},g||S||m||!E||!_?!v&&T&&T.resolve?((u=T.resolve(void 0)).constructor=T,d=h(u.then,u),s=function(){d(n)}):S?s=function(){y.nextTick(n)}:(f=h(f,l),s=function(){f(n)}):(a=!0,c=_.createTextNode(""),new E(n).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=A||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,s()),o=t}},3366:(e,t,r)=>{var n=r(7854);e.exports=n.Promise},133:(e,t,r)=>{var n=r(7392),i=r(7293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},590:(e,t,r)=>{var n=r(7293),i=r(5112),o=r(1913),s=i("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),o&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[s]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host}))},8536:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2788),s=n.WeakMap;e.exports=i(s)&&/native code/.test(o(s))},8523:(e,t,r)=>{"use strict";var n=r(9662),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},3929:(e,t,r)=>{var n=r(7854),i=r(7850),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},3009:(e,t,r)=>{var n=r(7854),i=r(7293),o=r(1702),s=r(1340),a=r(3111).trim,c=r(1361),u=n.parseInt,d=n.Symbol,l=d&&d.iterator,h=/^[+-]?0x/i,p=o(h.exec),f=8!==u(c+"08")||22!==u(c+"0x16")||l&&!i((function(){u(Object(l))}));e.exports=f?function(e,t){var r=a(s(e));return u(r,t>>>0||(p(h,r)?16:10))}:u},1574:(e,t,r)=>{"use strict";var n=r(9781),i=r(1702),o=r(6916),s=r(7293),a=r(1956),c=r(5181),u=r(5296),d=r(7908),l=r(8361),h=Object.assign,p=Object.defineProperty,f=i([].concat);e.exports=!h||s((function(){if(n&&1!==h({b:1},h(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!=h({},e)[r]||a(h({},t)).join("")!=i}))?function(e,t){for(var r=d(e),i=arguments.length,s=1,h=c.f,p=u.f;i>s;)for(var g,v=l(arguments[s++]),m=h?f(a(v),h(v)):a(v),S=m.length,E=0;S>E;)g=m[E++],n&&!o(p,v,g)||(r[g]=v[g]);return r}:h},30:(e,t,r)=>{var n,i=r(9670),o=r(6048),s=r(748),a=r(3501),c=r(490),u=r(317),d=r(6200),l="prototype",h="script",p=d("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},v=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&n?v(n):(t=u("iframe"),r="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):v(n);for(var i=s.length;i--;)delete m[l][s[i]];return m()};a[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[l]=i(e),r=new f,f[l]=null,r[p]=e):r=m(),void 0===t?r:o.f(r,t)}},6048:(e,t,r)=>{var n=r(9781),i=r(3353),o=r(3070),s=r(9670),a=r(5656),c=r(1956);t.f=n&&!i?Object.defineProperties:function(e,t){s(e);for(var r,n=a(t),i=c(t),u=i.length,d=0;u>d;)o.f(e,r=i[d++],n[r]);return e}},3070:(e,t,r)=>{var n=r(7854),i=r(9781),o=r(4664),s=r(3353),a=r(9670),c=r(4948),u=n.TypeError,d=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",p="configurable",f="writable";t.f=i?s?function(e,t,r){if(a(e),t=c(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&f in r&&!r[f]){var n=l(e,t);n&&n[f]&&(e[t]=r.value,r={configurable:p in r?r[p]:n[p],enumerable:h in r?r[h]:n[h],writable:!1})}return d(e,t,r)}:d:function(e,t,r){if(a(e),t=c(t),a(r),o)try{return d(e,t,r)}catch(e){}if("get"in r||"set"in r)throw u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},1236:(e,t,r)=>{var n=r(9781),i=r(6916),o=r(5296),s=r(9114),a=r(5656),c=r(4948),u=r(2597),d=r(4664),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=a(e),t=c(t),d)try{return l(e,t)}catch(e){}if(u(e,t))return s(!i(o.f,e,t),e[t])}},1156:(e,t,r)=>{var n=r(4326),i=r(5656),o=r(8006).f,s=r(1589),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(i(e))}},8006:(e,t,r)=>{var n=r(6324),i=r(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},5181:(e,t)=>{t.f=Object.getOwnPropertySymbols},9518:(e,t,r)=>{var n=r(7854),i=r(2597),o=r(614),s=r(7908),a=r(6200),c=r(8544),u=a("IE_PROTO"),d=n.Object,l=d.prototype;e.exports=c?d.getPrototypeOf:function(e){var t=s(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof d?l:null}},2050:(e,t,r)=>{var n=r(7293),i=r(111),o=r(4326),s=r(7556),a=Object.isExtensible,c=n((function(){a(1)}));e.exports=c||s?function(e){return!!i(e)&&(!s||"ArrayBuffer"!=o(e))&&(!a||a(e))}:a},7976:(e,t,r)=>{var n=r(1702);e.exports=n({}.isPrototypeOf)},6324:(e,t,r)=>{var n=r(1702),i=r(2597),o=r(5656),s=r(1318).indexOf,a=r(3501),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,d=[];for(r in n)!i(a,r)&&i(n,r)&&c(d,r);for(;t.length>u;)i(n,r=t[u++])&&(~s(d,r)||c(d,r));return d}},1956:(e,t,r)=>{var n=r(6324),i=r(748);e.exports=Object.keys||function(e){return n(e,i)}},5296:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},7674:(e,t,r)=>{var n=r(1702),i=r(9670),o=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},4699:(e,t,r)=>{var n=r(9781),i=r(1702),o=r(1956),s=r(5656),a=i(r(5296).f),c=i([].push),u=function(e){return function(t){for(var r,i=s(t),u=o(i),d=u.length,l=0,h=[];d>l;)r=u[l++],n&&!a(i,r)||c(h,e?[r,i[r]]:i[r]);return h}};e.exports={entries:u(!0),values:u(!1)}},288:(e,t,r)=>{"use strict";var n=r(1694),i=r(648);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},2140:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(614),s=r(111),a=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!s(n=i(r,e)))return n;if(o(r=e.valueOf)&&!s(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!s(n=i(r,e)))return n;throw a("Can't convert object to primitive value")}},3887:(e,t,r)=>{var n=r(5005),i=r(1702),o=r(8006),s=r(5181),a=r(9670),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=s.f;return r?c(t,r(e)):t}},857:(e,t,r)=>{var n=r(7854);e.exports=n},2534:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},9478:(e,t,r)=>{var n=r(9670),i=r(111),o=r(8523);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},8572:e=>{var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},2248:(e,t,r)=>{var n=r(1320);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},1320:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2597),s=r(8880),a=r(3505),c=r(2788),u=r(9909),d=r(6530).CONFIGURABLE,l=u.get,h=u.enforce,p=String(String).split("String");(e.exports=function(e,t,r,c){var u,l=!!c&&!!c.unsafe,f=!!c&&!!c.enumerable,g=!!c&&!!c.noTargetGet,v=c&&void 0!==c.name?c.name:t;i(r)&&("Symbol("===String(v).slice(0,7)&&(v="["+String(v).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(r,"name")||d&&r.name!==v)&&s(r,"name",v),(u=h(r)).source||(u.source=p.join("string"==typeof v?v:""))),e!==n?(l?!g&&e[t]&&(f=!0):delete e[t],f?e[t]=r:s(e,t,r)):f?e[t]=r:a(t,r)})(Function.prototype,"toString",(function(){return i(this)&&l(this).source||c(this)}))},7651:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9670),s=r(614),a=r(4326),c=r(2261),u=n.TypeError;e.exports=function(e,t){var r=e.exec;if(s(r)){var n=i(r,e,t);return null!==n&&o(n),n}if("RegExp"===a(e))return i(c,e,t);throw u("RegExp#exec called on incompatible receiver")}},2261:(e,t,r)=>{"use strict";var n,i,o=r(6916),s=r(1702),a=r(1340),c=r(7066),u=r(2999),d=r(2309),l=r(30),h=r(9909).get,p=r(9441),f=r(7168),g=d("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,m=v,S=s("".charAt),E=s("".indexOf),_=s("".replace),y=s("".slice),T=(i=/b*/g,o(v,n=/a/,"a"),o(v,i,"a"),0!==n.lastIndex||0!==i.lastIndex),R=u.BROKEN_CARET,A=void 0!==/()??/.exec("")[1];(T||A||R||p||f)&&(m=function(e){var t,r,n,i,s,u,d,p=this,f=h(p),w=a(e),b=f.raw;if(b)return b.lastIndex=p.lastIndex,t=o(m,b,w),p.lastIndex=b.lastIndex,t;var C=f.groups,O=R&&p.sticky,I=o(c,p),P=p.source,N=0,D=w;if(O&&(I=_(I,"y",""),-1===E(I,"g")&&(I+="g"),D=y(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==S(w,p.lastIndex-1))&&(P="(?: "+P+")",D=" "+D,N++),r=new RegExp("^(?:"+P+")",I)),A&&(r=new RegExp("^"+P+"$(?!\\s)",I)),T&&(n=p.lastIndex),i=o(v,O?r:p,D),O?i?(i.input=y(i.input,N),i[0]=y(i[0],N),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:T&&i&&(p.lastIndex=p.global?i.index+i[0].length:n),A&&i&&i.length>1&&o(g,i[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0)})),i&&C)for(i.groups=u=l(null),s=0;s<C.length;s++)u[(d=C[s])[0]]=i[d[1]];return i}),e.exports=m},7066:(e,t,r)=>{"use strict";var n=r(9670);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},2999:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp,o=n((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),s=o||n((function(){return!i("a","y").sticky})),a=o||n((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:o}},9441:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},4488:(e,t,r)=>{var n=r(7854).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},1150:e=>{e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},3505:(e,t,r)=>{var n=r(7854),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},6340:(e,t,r)=>{"use strict";var n=r(5005),i=r(3070),o=r(5112),s=r(9781),a=o("species");e.exports=function(e){var t=n(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},8003:(e,t,r)=>{var n=r(3070).f,i=r(2597),o=r(5112)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!i(e,o)&&n(e,o,{configurable:!0,value:t})}},6200:(e,t,r)=>{var n=r(2309),i=r(9711),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},5465:(e,t,r)=>{var n=r(7854),i=r(3505),o="__core-js_shared__",s=n[o]||i(o,{});e.exports=s},2309:(e,t,r)=>{var n=r(1913),i=r(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:n?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},6707:(e,t,r)=>{var n=r(9670),i=r(9483),o=r(5112)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},8710:(e,t,r)=>{var n=r(1702),i=r(9303),o=r(1340),s=r(4488),a=n("".charAt),c=n("".charCodeAt),u=n("".slice),d=function(e){return function(t,r){var n,d,l=o(s(t)),h=i(r),p=l.length;return h<0||h>=p?e?"":void 0:(n=c(l,h))<55296||n>56319||h+1===p||(d=c(l,h+1))<56320||d>57343?e?a(l,h):n:e?u(l,h,h+2):d-56320+(n-55296<<10)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},4986:(e,t,r)=>{var n=r(8113);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},6650:(e,t,r)=>{var n=r(1702),i=r(7466),o=r(1340),s=r(8415),a=r(4488),c=n(s),u=n("".slice),d=Math.ceil,l=function(e){return function(t,r,n){var s,l,h=o(a(t)),p=i(r),f=h.length,g=void 0===n?" ":o(n);return p<=f||""==g?h:((l=c(g,d((s=p-f)/g.length))).length>s&&(l=u(l,0,s)),e?h+l:l+h)}};e.exports={start:l(!1),end:l(!0)}},3197:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=2147483647,s=/[^\0-\u007E]/,a=/[.\u3002\uFF0E\uFF61]/g,c="Overflow: input needs wider integers to process",u=n.RangeError,d=i(a.exec),l=Math.floor,h=String.fromCharCode,p=i("".charCodeAt),f=i([].join),g=i([].push),v=i("".replace),m=i("".split),S=i("".toLowerCase),E=function(e){return e+22+75*(e<26)},_=function(e,t,r){var n=0;for(e=r?l(e/700):e>>1,e+=l(e/t);e>455;)e=l(e/35),n+=36;return l(n+36*e/(e+38))},y=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=p(e,r++);if(i>=55296&&i<=56319&&r<n){var o=p(e,r++);56320==(64512&o)?g(t,((1023&i)<<10)+(1023&o)+65536):(g(t,i),r--)}else g(t,i)}return t}(e);var r,n,i=e.length,s=128,a=0,d=72;for(r=0;r<e.length;r++)(n=e[r])<128&&g(t,h(n));var v=t.length,m=v;for(v&&g(t,"-");m<i;){var S=o;for(r=0;r<e.length;r++)(n=e[r])>=s&&n<S&&(S=n);var y=m+1;if(S-s>l((o-a)/y))throw u(c);for(a+=(S-s)*y,s=S,r=0;r<e.length;r++){if((n=e[r])<s&&++a>o)throw u(c);if(n==s){for(var T=a,R=36;;){var A=R<=d?1:R>=d+26?26:R-d;if(T<A)break;var w=T-A,b=36-A;g(t,h(E(A+w%b))),T=l(w/b),R+=36}g(t,h(E(T))),d=_(a,y,m==v),a=0,m++}}a++,s++}return f(t,"")};e.exports=function(e){var t,r,n=[],i=m(v(S(e),a,"."),".");for(t=0;t<i.length;t++)r=i[t],g(n,d(s,r)?"xn--"+y(r):r);return f(n,".")}},8415:(e,t,r)=>{"use strict";var n=r(7854),i=r(9303),o=r(1340),s=r(4488),a=n.RangeError;e.exports=function(e){var t=o(s(this)),r="",n=i(e);if(n<0||n==1/0)throw a("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r}},6091:(e,t,r)=>{var n=r(6530).PROPER,i=r(7293),o=r(1361);e.exports=function(e){return i((function(){return!!o[e]()||"​᠎"!=="​᠎"[e]()||n&&o[e].name!==e}))}},3111:(e,t,r)=>{var n=r(1702),i=r(4488),o=r(1340),s=r(1361),a=n("".replace),c="["+s+"]",u=RegExp("^"+c+c+"*"),d=RegExp(c+c+"*$"),l=function(e){return function(t){var r=o(i(t));return 1&e&&(r=a(r,u,"")),2&e&&(r=a(r,d,"")),r}};e.exports={start:l(1),end:l(2),trim:l(3)}},261:(e,t,r)=>{var n,i,o,s,a=r(7854),c=r(2104),u=r(9974),d=r(614),l=r(2597),h=r(7293),p=r(490),f=r(206),g=r(317),v=r(8053),m=r(6833),S=r(5268),E=a.setImmediate,_=a.clearImmediate,y=a.process,T=a.Dispatch,R=a.Function,A=a.MessageChannel,w=a.String,b=0,C={},O="onreadystatechange";try{n=a.location}catch(e){}var I=function(e){if(l(C,e)){var t=C[e];delete C[e],t()}},P=function(e){return function(){I(e)}},N=function(e){I(e.data)},D=function(e){a.postMessage(w(e),n.protocol+"//"+n.host)};E&&_||(E=function(e){v(arguments.length,1);var t=d(e)?e:R(e),r=f(arguments,1);return C[++b]=function(){c(t,void 0,r)},i(b),b},_=function(e){delete C[e]},S?i=function(e){y.nextTick(P(e))}:T&&T.now?i=function(e){T.now(P(e))}:A&&!m?(s=(o=new A).port2,o.port1.onmessage=N,i=u(s.postMessage,s)):a.addEventListener&&d(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!h(D)?(i=D,a.addEventListener("message",N,!1)):i=O in g("script")?function(e){p.appendChild(g("script"))[O]=function(){p.removeChild(this),I(e)}}:function(e){setTimeout(P(e),0)}),e.exports={set:E,clear:_}},863:(e,t,r)=>{var n=r(1702);e.exports=n(1..valueOf)},1400:(e,t,r)=>{var n=r(9303),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},7067:(e,t,r)=>{var n=r(7854),i=r(9303),o=r(7466),s=n.RangeError;e.exports=function(e){if(void 0===e)return 0;var t=i(e),r=o(t);if(t!==r)throw s("Wrong length or index");return r}},5656:(e,t,r)=>{var n=r(8361),i=r(4488);e.exports=function(e){return n(i(e))}},9303:e=>{var t=Math.ceil,r=Math.floor;e.exports=function(e){var n=+e;return n!=n||0===n?0:(n>0?r:t)(n)}},7466:(e,t,r)=>{var n=r(9303),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},7908:(e,t,r)=>{var n=r(7854),i=r(4488),o=n.Object;e.exports=function(e){return o(i(e))}},4590:(e,t,r)=>{var n=r(7854),i=r(3002),o=n.RangeError;e.exports=function(e,t){var r=i(e);if(r%t)throw o("Wrong offset");return r}},3002:(e,t,r)=>{var n=r(7854),i=r(9303),o=n.RangeError;e.exports=function(e){var t=i(e);if(t<0)throw o("The argument can't be less than 0");return t}},7593:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(111),s=r(2190),a=r(8173),c=r(2140),u=r(5112),d=n.TypeError,l=u("toPrimitive");e.exports=function(e,t){if(!o(e)||s(e))return e;var r,n=a(e,l);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||s(r))return r;throw d("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},4948:(e,t,r)=>{var n=r(7593),i=r(2190);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},1694:(e,t,r)=>{var n={};n[r(5112)("toStringTag")]="z",e.exports="[object z]"===String(n)},1340:(e,t,r)=>{var n=r(7854),i=r(648),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6330:(e,t,r)=>{var n=r(7854).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},9843:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(6916),s=r(9781),a=r(3832),c=r(260),u=r(3331),d=r(5787),l=r(9114),h=r(8880),p=r(5988),f=r(7466),g=r(7067),v=r(4590),m=r(4948),S=r(2597),E=r(648),_=r(111),y=r(2190),T=r(30),R=r(7976),A=r(7674),w=r(8006).f,b=r(7321),C=r(2092).forEach,O=r(6340),I=r(3070),P=r(1236),N=r(9909),D=r(9587),L=N.get,M=N.set,k=I.f,x=P.f,U=Math.round,V=i.RangeError,H=u.ArrayBuffer,j=H.prototype,$=u.DataView,B=c.NATIVE_ARRAY_BUFFER_VIEWS,F=c.TYPED_ARRAY_CONSTRUCTOR,q=c.TYPED_ARRAY_TAG,K=c.TypedArray,W=c.TypedArrayPrototype,G=c.aTypedArrayConstructor,Y=c.isTypedArray,z="BYTES_PER_ELEMENT",X="Wrong length",J=function(e,t){G(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},Z=function(e,t){k(e,t,{get:function(){return L(this)[t]}})},Q=function(e){var t;return R(j,e)||"ArrayBuffer"==(t=E(e))||"SharedArrayBuffer"==t},ee=function(e,t){return Y(e)&&!y(t)&&t in e&&p(+t)&&t>=0},te=function(e,t){return t=m(t),ee(e,t)?l(2,e[t]):x(e,t)},re=function(e,t,r){return t=m(t),!(ee(e,t)&&_(r)&&S(r,"value"))||S(r,"get")||S(r,"set")||r.configurable||S(r,"writable")&&!r.writable||S(r,"enumerable")&&!r.enumerable?k(e,t,r):(e[t]=r.value,e)};s?(B||(P.f=te,I.f=re,Z(W,"buffer"),Z(W,"byteOffset"),Z(W,"byteLength"),Z(W,"length")),n({target:"Object",stat:!0,forced:!B},{getOwnPropertyDescriptor:te,defineProperty:re}),e.exports=function(e,t,r){var s=e.match(/\d+$/)[0]/8,c=e+(r?"Clamped":"")+"Array",u="get"+e,l="set"+e,p=i[c],m=p,S=m&&m.prototype,E={},y=function(e,t){k(e,t,{get:function(){return function(e,t){var r=L(e);return r.view[u](t*s+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=L(e);r&&(n=(n=U(n))<0?0:n>255?255:255&n),i.view[l](t*s+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};B?a&&(m=t((function(e,t,r,n){return d(e,S),D(_(t)?Q(t)?void 0!==n?new p(t,v(r,s),n):void 0!==r?new p(t,v(r,s)):new p(t):Y(t)?J(m,t):o(b,m,t):new p(g(t)),e,m)})),A&&A(m,K),C(w(p),(function(e){e in m||h(m,e,p[e])})),m.prototype=S):(m=t((function(e,t,r,n){d(e,S);var i,a,c,u=0,l=0;if(_(t)){if(!Q(t))return Y(t)?J(m,t):o(b,m,t);i=t,l=v(r,s);var h=t.byteLength;if(void 0===n){if(h%s)throw V(X);if((a=h-l)<0)throw V(X)}else if((a=f(n)*s)+l>h)throw V(X);c=a/s}else c=g(t),i=new H(a=c*s);for(M(e,{buffer:i,byteOffset:l,byteLength:a,length:c,view:new $(i)});u<c;)y(e,u++)})),A&&A(m,K),S=m.prototype=T(W)),S.constructor!==m&&h(S,"constructor",m),h(S,F,m),q&&h(S,q,c),E[c]=m,n({global:!0,forced:m!=p,sham:!B},E),z in m||h(m,z,s),z in S||h(S,z,s),O(c)}):e.exports=function(){}},3832:(e,t,r)=>{var n=r(7854),i=r(7293),o=r(7072),s=r(260).NATIVE_ARRAY_BUFFER_VIEWS,a=n.ArrayBuffer,c=n.Int8Array;e.exports=!s||!i((function(){c(1)}))||!i((function(){new c(-1)}))||!o((function(e){new c,new c(null),new c(1.5),new c(e)}),!0)||i((function(){return 1!==new c(new a(2),1,void 0).length}))},3074:(e,t,r)=>{var n=r(7745),i=r(6304);e.exports=function(e,t){return n(i(e),t)}},7321:(e,t,r)=>{var n=r(9974),i=r(6916),o=r(9483),s=r(7908),a=r(6244),c=r(8554),u=r(1246),d=r(7659),l=r(260).aTypedArrayConstructor;e.exports=function(e){var t,r,h,p,f,g,v=o(this),m=s(e),S=arguments.length,E=S>1?arguments[1]:void 0,_=void 0!==E,y=u(m);if(y&&!d(y))for(g=(f=c(m,y)).next,m=[];!(p=i(g,f)).done;)m.push(p.value);for(_&&S>2&&(E=n(E,arguments[2])),r=a(m),h=new(l(v))(r),t=0;r>t;t++)h[t]=_?E(m[t],t):m[t];return h}},6304:(e,t,r)=>{var n=r(260),i=r(6707),o=n.TYPED_ARRAY_CONSTRUCTOR,s=n.aTypedArrayConstructor;e.exports=function(e){return s(i(e,e[o]))}},9711:(e,t,r)=>{var n=r(1702),i=0,o=Math.random(),s=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},3307:(e,t,r)=>{var n=r(133);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:(e,t,r)=>{var n=r(9781),i=r(7293);e.exports=n&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8053:(e,t,r)=>{var n=r(7854).TypeError;e.exports=function(e,t){if(e<t)throw n("Not enough arguments");return e}},6061:(e,t,r)=>{var n=r(5112);t.f=n},5112:(e,t,r)=>{var n=r(7854),i=r(2309),o=r(2597),s=r(9711),a=r(133),c=r(3307),u=i("wks"),d=n.Symbol,l=d&&d.for,h=c?d:d&&d.withoutSetter||s;e.exports=function(e){if(!o(u,e)||!a&&"string"!=typeof u[e]){var t="Symbol."+e;a&&o(d,e)?u[e]=d[e]:u[e]=c&&l?l(t):h(t)}return u[e]}},1361:e=>{e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},9575:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(7293),s=r(3331),a=r(9670),c=r(1400),u=r(7466),d=r(6707),l=s.ArrayBuffer,h=s.DataView,p=h.prototype,f=i(l.prototype.slice),g=i(p.getUint8),v=i(p.setUint8);n({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:o((function(){return!new l(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(f&&void 0===t)return f(a(this),e);for(var r=a(this).byteLength,n=c(e,r),i=c(void 0===t?r:t,r),o=new(d(this,l))(u(i-n)),s=new h(this),p=new h(o),m=0;n<i;)v(p,m++,g(s,n++));return o}})},2222:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(7293),s=r(3157),a=r(111),c=r(7908),u=r(6244),d=r(6135),l=r(5417),h=r(1194),p=r(5112),f=r(7392),g=p("isConcatSpreadable"),v=9007199254740991,m="Maximum allowed index exceeded",S=i.TypeError,E=f>=51||!o((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),_=h("concat"),y=function(e){if(!a(e))return!1;var t=e[g];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,forced:!E||!_},{concat:function(e){var t,r,n,i,o,s=c(this),a=l(s,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(y(o=-1===t?s:arguments[t])){if(h+(i=u(o))>v)throw S(m);for(r=0;r<i;r++,h++)r in o&&d(a,h,o[r])}else{if(h>=v)throw S(m);d(a,h++,o)}return a.length=h,a}})},7327:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).filter;n({target:"Array",proto:!0,forced:!r(1194)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},9826:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).find,o=r(1223),s="find",a=!0;s in[]&&Array(1)[s]((function(){a=!1})),n({target:"Array",proto:!0,forced:a},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},9554:(e,t,r)=>{"use strict";var n=r(2109),i=r(8533);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},1038:(e,t,r)=>{var n=r(2109),i=r(8457);n({target:"Array",stat:!0,forced:!r(7072)((function(e){Array.from(e)}))},{from:i})},6699:(e,t,r)=>{"use strict";var n=r(2109),i=r(1318).includes,o=r(1223);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},2772:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(1318).indexOf,s=r(9341),a=i([].indexOf),c=!!a&&1/a([1],1,-0)<0,u=s("indexOf");n({target:"Array",proto:!0,forced:c||!u},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return c?a(this,e,t)||0:o(this,e,t)}})},9753:(e,t,r)=>{r(2109)({target:"Array",stat:!0},{isArray:r(3157)})},6992:(e,t,r)=>{"use strict";var n=r(5656),i=r(1223),o=r(7497),s=r(9909),a=r(3070).f,c=r(654),u=r(1913),d=r(9781),l="Array Iterator",h=s.set,p=s.getterFor(l);e.exports=c(Array,"Array",(function(e,t){h(this,{type:l,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var f=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!u&&d&&"values"!==f.name)try{a(f,"name",{value:"values"})}catch(e){}},9600:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(8361),s=r(5656),a=r(9341),c=i([].join),u=o!=Object,d=a("join",",");n({target:"Array",proto:!0,forced:u||!d},{join:function(e){return c(s(this),void 0===e?",":e)}})},5827:(e,t,r)=>{"use strict";var n=r(2109),i=r(3671).left,o=r(9341),s=r(7392),a=r(5268);n({target:"Array",proto:!0,forced:!o("reduce")||!a&&s>79&&s<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},7042:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(3157),s=r(4411),a=r(111),c=r(1400),u=r(6244),d=r(5656),l=r(6135),h=r(5112),p=r(1194),f=r(206),g=p("slice"),v=h("species"),m=i.Array,S=Math.max;n({target:"Array",proto:!0,forced:!g},{slice:function(e,t){var r,n,i,h=d(this),p=u(h),g=c(e,p),E=c(void 0===t?p:t,p);if(o(h)&&(r=h.constructor,(s(r)&&(r===m||o(r.prototype))||a(r)&&null===(r=r[v]))&&(r=void 0),r===m||void 0===r))return f(h,g,E);for(n=new(void 0===r?m:r)(S(E-g,0)),i=0;g<E;g++,i++)g in h&&l(n,i,h[g]);return n.length=i,n}})},5212:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).some;n({target:"Array",proto:!0,forced:!r(9341)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},561:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(1400),s=r(9303),a=r(6244),c=r(7908),u=r(5417),d=r(6135),l=r(1194)("splice"),h=i.TypeError,p=Math.max,f=Math.min,g=9007199254740991,v="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var r,n,i,l,m,S,E=c(this),_=a(E),y=o(e,_),T=arguments.length;if(0===T?r=n=0:1===T?(r=0,n=_-y):(r=T-2,n=f(p(s(t),0),_-y)),_+r-n>g)throw h(v);for(i=u(E,n),l=0;l<n;l++)(m=y+l)in E&&d(i,l,E[m]);if(i.length=n,r<n){for(l=y;l<_-n;l++)S=l+r,(m=l+n)in E?E[S]=E[m]:delete E[S];for(l=_;l>_-n+r;l--)delete E[l-1]}else if(r>n)for(l=_-n;l>y;l--)S=l+r-1,(m=l+n-1)in E?E[S]=E[m]:delete E[S];for(l=0;l<r;l++)E[l+y]=arguments[l+2];return E.length=_-n+r,i}})},3843:(e,t,r)=>{var n=r(2109),i=r(7854),o=r(1702),s=i.Date,a=o(s.prototype.getTime);n({target:"Date",stat:!0},{now:function(){return a(new s)}})},3710:(e,t,r)=>{var n=r(1702),i=r(1320),o=Date.prototype,s="Invalid Date",a="toString",c=n(o[a]),u=n(o.getTime);String(new Date(NaN))!=s&&i(o,a,(function(){var e=u(this);return e==e?c(this):s}))},4812:(e,t,r)=>{var n=r(2109),i=r(7065);n({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},8309:(e,t,r)=>{var n=r(9781),i=r(6530).EXISTS,o=r(1702),s=r(3070).f,a=Function.prototype,c=o(a.toString),u=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,d=o(u.exec);n&&!i&&s(a,"name",{configurable:!0,get:function(){try{return d(u,c(this))[1]}catch(e){return""}}})},1532:(e,t,r)=>{"use strict";r(7710)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(5631))},9653:(e,t,r)=>{"use strict";var n=r(9781),i=r(7854),o=r(1702),s=r(4705),a=r(1320),c=r(2597),u=r(9587),d=r(7976),l=r(2190),h=r(7593),p=r(7293),f=r(8006).f,g=r(1236).f,v=r(3070).f,m=r(863),S=r(3111).trim,E="Number",_=i[E],y=_.prototype,T=i.TypeError,R=o("".slice),A=o("".charCodeAt),w=function(e){var t=h(e,"number");return"bigint"==typeof t?t:b(t)},b=function(e){var t,r,n,i,o,s,a,c,u=h(e,"number");if(l(u))throw T("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=S(u),43===(t=A(u,0))||45===t){if(88===(r=A(u,2))||120===r)return NaN}else if(48===t){switch(A(u,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+u}for(s=(o=R(u,2)).length,a=0;a<s;a++)if((c=A(o,a))<48||c>i)return NaN;return parseInt(o,n)}return+u};if(s(E,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var C,O=function(e){var t=arguments.length<1?0:_(w(e)),r=this;return d(y,r)&&p((function(){m(r)}))?u(Object(t),r,O):t},I=n?f(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),P=0;I.length>P;P++)c(_,C=I[P])&&!c(O,C)&&v(O,C,g(_,C));O.prototype=y,y.constructor=O,a(i,E,O)}},9601:(e,t,r)=>{var n=r(2109),i=r(1574);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},8011:(e,t,r)=>{r(2109)({target:"Object",stat:!0,sham:!r(9781)},{create:r(30)})},3321:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(6048).f;n({target:"Object",stat:!0,forced:Object.defineProperties!==o,sham:!i},{defineProperties:o})},9070:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(3070).f;n({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!i},{defineProperty:o})},9720:(e,t,r)=>{var n=r(2109),i=r(4699).entries;n({target:"Object",stat:!0},{entries:function(e){return i(e)}})},3371:(e,t,r)=>{var n=r(2109),i=r(6677),o=r(7293),s=r(111),a=r(2423).onFreeze,c=Object.freeze;n({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!i},{freeze:function(e){return c&&s(e)?c(a(e)):e}})},5003:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(5656),s=r(1236).f,a=r(9781),c=i((function(){s(1)}));n({target:"Object",stat:!0,forced:!a||c,sham:!a},{getOwnPropertyDescriptor:function(e,t){return s(o(e),t)}})},9337:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(3887),s=r(5656),a=r(1236),c=r(6135);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=s(e),i=a.f,u=o(n),d={},l=0;u.length>l;)void 0!==(r=i(n,t=u[l++]))&&c(d,t,r);return d}})},489:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(7908),s=r(9518),a=r(8544);n({target:"Object",stat:!0,forced:i((function(){s(1)})),sham:!a},{getPrototypeOf:function(e){return s(o(e))}})},3304:(e,t,r)=>{r(2109)({target:"Object",stat:!0},{is:r(1150)})},7941:(e,t,r)=>{var n=r(2109),i=r(7908),o=r(1956);n({target:"Object",stat:!0,forced:r(7293)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},8304:(e,t,r)=>{r(2109)({target:"Object",stat:!0},{setPrototypeOf:r(7674)})},1539:(e,t,r)=>{var n=r(1694),i=r(1320),o=r(288);n||i(Object.prototype,"toString",o,{unsafe:!0})},2479:(e,t,r)=>{var n=r(2109),i=r(4699).values;n({target:"Object",stat:!0},{values:function(e){return i(e)}})},1058:(e,t,r)=>{var n=r(2109),i=r(3009);n({global:!0,forced:parseInt!=i},{parseInt:i})},7727:(e,t,r)=>{"use strict";var n=r(2109),i=r(1913),o=r(3366),s=r(7293),a=r(5005),c=r(614),u=r(6707),d=r(9478),l=r(1320);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&s((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,a("Promise")),r=c(e);return this.then(r?function(r){return d(t,e()).then((function(){return r}))}:e,r?function(r){return d(t,e()).then((function(){throw r}))}:e)}}),!i&&c(o)){var h=a("Promise").prototype.finally;o.prototype.finally!==h&&l(o.prototype,"finally",h,{unsafe:!0})}},8674:(e,t,r)=>{"use strict";var n,i,o,s,a=r(2109),c=r(1913),u=r(7854),d=r(5005),l=r(6916),h=r(3366),p=r(1320),f=r(2248),g=r(7674),v=r(8003),m=r(6340),S=r(9662),E=r(614),_=r(111),y=r(5787),T=r(2788),R=r(408),A=r(7072),w=r(6707),b=r(261).set,C=r(5948),O=r(9478),I=r(842),P=r(8523),N=r(2534),D=r(8572),L=r(9909),M=r(4705),k=r(5112),x=r(7871),U=r(5268),V=r(7392),H=k("species"),j="Promise",$=L.getterFor(j),B=L.set,F=L.getterFor(j),q=h&&h.prototype,K=h,W=q,G=u.TypeError,Y=u.document,z=u.process,X=P.f,J=X,Z=!!(Y&&Y.createEvent&&u.dispatchEvent),Q=E(u.PromiseRejectionEvent),ee="unhandledrejection",te=!1,re=M(j,(function(){var e=T(K),t=e!==String(K);if(!t&&66===V)return!0;if(c&&!W.finally)return!0;if(V>=51&&/native code/.test(e))return!1;var r=new K((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[H]=n,!(te=r.then((function(){}))instanceof n)||!t&&x&&!Q})),ne=re||!A((function(e){K.all(e).catch((function(){}))})),ie=function(e){var t;return!(!_(e)||!E(t=e.then))&&t},oe=function(e,t){var r,n,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{a?(s||(2===t.rejection&&de(t),t.rejection=1),!0===a?r=o:(d&&d.enter(),r=a(o),d&&(d.exit(),i=!0)),r===e.promise?u(G("Promise-chain cycle")):(n=ie(r))?l(n,r,c,u):c(r)):u(o)}catch(e){d&&!i&&d.exit(),u(e)}},se=function(e,t){e.notified||(e.notified=!0,C((function(){for(var r,n=e.reactions;r=n.get();)oe(r,e);e.notified=!1,t&&!e.rejection&&ce(e)})))},ae=function(e,t,r){var n,i;Z?((n=Y.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Q&&(i=u["on"+e])?i(n):e===ee&&I("Unhandled promise rejection",r)},ce=function(e){l(b,u,(function(){var t,r=e.facade,n=e.value;if(ue(e)&&(t=N((function(){U?z.emit("unhandledRejection",n,r):ae(ee,r,n)})),e.rejection=U||ue(e)?2:1,t.error))throw t.value}))},ue=function(e){return 1!==e.rejection&&!e.parent},de=function(e){l(b,u,(function(){var t=e.facade;U?z.emit("rejectionHandled",t):ae("rejectionhandled",t,e.value)}))},le=function(e,t,r){return function(n){e(t,n,r)}},he=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,se(e,!0))},pe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw G("Promise can't be resolved itself");var n=ie(t);n?C((function(){var r={done:!1};try{l(n,t,le(pe,r,e),le(he,r,e))}catch(t){he(r,t,e)}})):(e.value=t,e.state=1,se(e,!1))}catch(t){he({done:!1},t,e)}}};if(re&&(W=(K=function(e){y(this,W),S(e),l(n,this);var t=$(this);try{e(le(pe,t),le(he,t))}catch(e){he(t,e)}}).prototype,(n=function(e){B(this,{type:j,done:!1,notified:!1,parent:!1,reactions:new D,rejection:!1,state:0,value:void 0})}).prototype=f(W,{then:function(e,t){var r=F(this),n=X(w(this,K));return r.parent=!0,n.ok=!E(e)||e,n.fail=E(t)&&t,n.domain=U?z.domain:void 0,0==r.state?r.reactions.add(n):C((function(){oe(n,r)})),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=$(e);this.promise=e,this.resolve=le(pe,t),this.reject=le(he,t)},P.f=X=function(e){return e===K||e===o?new i(e):J(e)},!c&&E(h)&&q!==Object.prototype)){s=q.then,te||(p(q,"then",(function(e,t){var r=this;return new K((function(e,t){l(s,r,e,t)})).then(e,t)}),{unsafe:!0}),p(q,"catch",W.catch,{unsafe:!0}));try{delete q.constructor}catch(e){}g&&g(q,W)}a({global:!0,wrap:!0,forced:re},{Promise:K}),v(K,j,!1,!0),m(j),o=d(j),a({target:j,stat:!0,forced:re},{reject:function(e){var t=X(this);return l(t.reject,void 0,e),t.promise}}),a({target:j,stat:!0,forced:c||re},{resolve:function(e){return O(c&&this===o?K:this,e)}}),a({target:j,stat:!0,forced:ne},{all:function(e){var t=this,r=X(t),n=r.resolve,i=r.reject,o=N((function(){var r=S(t.resolve),o=[],s=0,a=1;R(e,(function(e){var c=s++,u=!1;a++,l(r,t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=X(t),n=r.reject,i=N((function(){var i=S(t.resolve);R(e,(function(e){l(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},2419:(e,t,r)=>{var n=r(2109),i=r(5005),o=r(2104),s=r(7065),a=r(9483),c=r(9670),u=r(111),d=r(30),l=r(7293),h=i("Reflect","construct"),p=Object.prototype,f=[].push,g=l((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),v=!l((function(){h((function(){}))})),m=g||v;n({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,t){a(e),c(t);var r=arguments.length<3?e:a(arguments[2]);if(v&&!g)return h(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return o(f,n,t),new(o(s,e,n))}var i=r.prototype,l=d(u(i)?i:p),m=o(e,l,t);return u(m)?m:l}})},4603:(e,t,r)=>{var n=r(9781),i=r(7854),o=r(1702),s=r(4705),a=r(9587),c=r(8880),u=r(3070).f,d=r(8006).f,l=r(7976),h=r(7850),p=r(1340),f=r(7066),g=r(2999),v=r(1320),m=r(7293),S=r(2597),E=r(9909).enforce,_=r(6340),y=r(5112),T=r(9441),R=r(7168),A=y("match"),w=i.RegExp,b=w.prototype,C=i.SyntaxError,O=o(f),I=o(b.exec),P=o("".charAt),N=o("".replace),D=o("".indexOf),L=o("".slice),M=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,k=/a/g,x=/a/g,U=new w(k)!==k,V=g.MISSED_STICKY,H=g.UNSUPPORTED_Y;if(s("RegExp",n&&(!U||V||T||R||m((function(){return x[A]=!1,w(k)!=k||w(x)==x||"/a/i"!=w(k,"i")}))))){for(var j=function(e,t){var r,n,i,o,s,u,d=l(b,this),f=h(e),g=void 0===t,v=[],m=e;if(!d&&f&&g&&e.constructor===j)return e;if((f||l(b,e))&&(e=e.source,g&&(t="flags"in m?m.flags:O(m))),e=void 0===e?"":p(e),t=void 0===t?"":p(t),m=e,T&&"dotAll"in k&&(n=!!t&&D(t,"s")>-1)&&(t=N(t,/s/g,"")),r=t,V&&"sticky"in k&&(i=!!t&&D(t,"y")>-1)&&H&&(t=N(t,/y/g,"")),R&&(o=function(e){for(var t,r=e.length,n=0,i="",o=[],s={},a=!1,c=!1,u=0,d="";n<=r;n++){if("\\"===(t=P(e,n)))t+=P(e,++n);else if("]"===t)a=!1;else if(!a)switch(!0){case"["===t:a=!0;break;case"("===t:I(M,L(e,n+1))&&(n+=2,c=!0),i+=t,u++;continue;case">"===t&&c:if(""===d||S(s,d))throw new C("Invalid capture group name");s[d]=!0,o[o.length]=[d,u],c=!1,d="";continue}c?d+=t:i+=t}return[i,o]}(e),e=o[0],v=o[1]),s=a(w(e,t),d?this:b,j),(n||i||v.length)&&(u=E(s),n&&(u.dotAll=!0,u.raw=j(function(e){for(var t,r=e.length,n=0,i="",o=!1;n<=r;n++)"\\"!==(t=P(e,n))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+P(e,++n);return i}(e),r)),i&&(u.sticky=!0),v.length&&(u.groups=v)),e!==m)try{c(s,"source",""===m?"(?:)":m)}catch(e){}return s},$=function(e){e in j||u(j,e,{configurable:!0,get:function(){return w[e]},set:function(t){w[e]=t}})},B=d(w),F=0;B.length>F;)$(B[F++]);b.constructor=j,j.prototype=b,v(i,"RegExp",j)}_("RegExp")},4916:(e,t,r)=>{"use strict";var n=r(2109),i=r(2261);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},9714:(e,t,r)=>{"use strict";var n=r(1702),i=r(6530).PROPER,o=r(1320),s=r(9670),a=r(7976),c=r(1340),u=r(7293),d=r(7066),l="toString",h=RegExp.prototype,p=h[l],f=n(d),g=u((function(){return"/a/b"!=p.call({source:"a",flags:"b"})})),v=i&&p.name!=l;(g||v)&&o(RegExp.prototype,l,(function(){var e=s(this),t=c(e.source),r=e.flags;return"/"+t+"/"+c(void 0===r&&a(h,e)&&!("flags"in h)?f(e):r)}),{unsafe:!0})},189:(e,t,r)=>{"use strict";r(7710)("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(5631))},2023:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(3929),s=r(4488),a=r(1340),c=r(4964),u=i("".indexOf);n({target:"String",proto:!0,forced:!c("includes")},{includes:function(e){return!!~u(a(s(this)),a(o(e)),arguments.length>1?arguments[1]:void 0)}})},8783:(e,t,r)=>{"use strict";var n=r(8710).charAt,i=r(1340),o=r(9909),s=r(654),a="String Iterator",c=o.set,u=o.getterFor(a);s(String,"String",(function(e){c(this,{type:a,string:i(e),index:0})}),(function(){var e,t=u(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},4723:(e,t,r)=>{"use strict";var n=r(6916),i=r(7007),o=r(9670),s=r(7466),a=r(1340),c=r(4488),u=r(8173),d=r(1530),l=r(7651);i("match",(function(e,t,r){return[function(t){var r=c(this),i=null==t?void 0:u(t,e);return i?n(i,t,r):new RegExp(t)[e](a(r))},function(e){var n=o(this),i=a(e),c=r(t,n,i);if(c.done)return c.value;if(!n.global)return l(n,i);var u=n.unicode;n.lastIndex=0;for(var h,p=[],f=0;null!==(h=l(n,i));){var g=a(h[0]);p[f]=g,""===g&&(n.lastIndex=d(i,s(n.lastIndex),u)),f++}return 0===f?null:p}]}))},3112:(e,t,r)=>{"use strict";var n=r(2109),i=r(6650).start;n({target:"String",proto:!0,forced:r(4986)},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},5306:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),s=r(7007),a=r(7293),c=r(9670),u=r(614),d=r(9303),l=r(7466),h=r(1340),p=r(4488),f=r(1530),g=r(8173),v=r(647),m=r(7651),S=r(5112)("replace"),E=Math.max,_=Math.min,y=o([].concat),T=o([].push),R=o("".indexOf),A=o("".slice),w="$0"==="a".replace(/./,"$0"),b=!!/./[S]&&""===/./[S]("a","$0");s("replace",(function(e,t,r){var o=b?"$":"$0";return[function(e,r){var n=p(this),o=null==e?void 0:g(e,S);return o?i(o,e,n,r):i(t,h(n),e,r)},function(e,i){var s=c(this),a=h(e);if("string"==typeof i&&-1===R(i,o)&&-1===R(i,"$<")){var p=r(t,s,a,i);if(p.done)return p.value}var g=u(i);g||(i=h(i));var S=s.global;if(S){var w=s.unicode;s.lastIndex=0}for(var b=[];;){var C=m(s,a);if(null===C)break;if(T(b,C),!S)break;""===h(C[0])&&(s.lastIndex=f(a,l(s.lastIndex),w))}for(var O,I="",P=0,N=0;N<b.length;N++){for(var D=h((C=b[N])[0]),L=E(_(d(C.index),a.length),0),M=[],k=1;k<C.length;k++)T(M,void 0===(O=C[k])?O:String(O));var x=C.groups;if(g){var U=y([D],M,L,a);void 0!==x&&T(U,x);var V=h(n(i,void 0,U))}else V=v(D,a,L,M,x,i);L>=P&&(I+=A(a,P,L)+V,P=L+D.length)}return I+A(a,P)}]}),!!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!w||b)},3123:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),s=r(7007),a=r(7850),c=r(9670),u=r(4488),d=r(6707),l=r(1530),h=r(7466),p=r(1340),f=r(8173),g=r(1589),v=r(7651),m=r(2261),S=r(2999),E=r(7293),_=S.UNSUPPORTED_Y,y=4294967295,T=Math.min,R=[].push,A=o(/./.exec),w=o(R),b=o("".slice);s("split",(function(e,t,r){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var o=p(u(this)),s=void 0===r?y:r>>>0;if(0===s)return[];if(void 0===e)return[o];if(!a(e))return i(t,o,e,s);for(var c,d,l,h=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),v=0,S=new RegExp(e.source,f+"g");(c=i(m,S,o))&&!((d=S.lastIndex)>v&&(w(h,b(o,v,c.index)),c.length>1&&c.index<o.length&&n(R,h,g(c,1)),l=c[0].length,v=d,h.length>=s));)S.lastIndex===c.index&&S.lastIndex++;return v===o.length?!l&&A(S,"")||w(h,""):w(h,b(o,v)),h.length>s?g(h,0,s):h}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:i(t,this,e,r)}:t,[function(t,r){var n=u(this),s=null==t?void 0:f(t,e);return s?i(s,t,n,r):i(o,p(n),t,r)},function(e,n){var i=c(this),s=p(e),a=r(o,i,s,n,o!==t);if(a.done)return a.value;var u=d(i,RegExp),f=i.unicode,g=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(_?"g":"y"),m=new u(_?"^(?:"+i.source+")":i,g),S=void 0===n?y:n>>>0;if(0===S)return[];if(0===s.length)return null===v(m,s)?[s]:[];for(var E=0,R=0,A=[];R<s.length;){m.lastIndex=_?0:R;var C,O=v(m,_?b(s,R):s);if(null===O||(C=T(h(m.lastIndex+(_?R:0)),s.length))===E)R=l(s,R,f);else{if(w(A,b(s,E,R)),A.length===S)return A;for(var I=1;I<=O.length-1;I++)if(w(A,O[I]),A.length===S)return A;R=E=C}}return w(A,b(s,E)),A}]}),!!E((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),_)},6755:(e,t,r)=>{"use strict";var n,i=r(2109),o=r(1702),s=r(1236).f,a=r(7466),c=r(1340),u=r(3929),d=r(4488),l=r(4964),h=r(1913),p=o("".startsWith),f=o("".slice),g=Math.min,v=l("startsWith");i({target:"String",proto:!0,forced:!(!h&&!v&&(n=s(String.prototype,"startsWith"),n&&!n.writable)||v)},{startsWith:function(e){var t=c(d(this));u(e);var r=a(g(arguments.length>1?arguments[1]:void 0,t.length)),n=c(e);return p?p(t,n,r):f(t,r,r+n.length)===n}})},3210:(e,t,r)=>{"use strict";var n=r(2109),i=r(3111).trim;n({target:"String",proto:!0,forced:r(6091)("trim")},{trim:function(){return i(this)}})},1817:(e,t,r)=>{"use strict";var n=r(2109),i=r(9781),o=r(7854),s=r(1702),a=r(2597),c=r(614),u=r(7976),d=r(1340),l=r(3070).f,h=r(9920),p=o.Symbol,f=p&&p.prototype;if(i&&c(p)&&(!("description"in f)||void 0!==p().description)){var g={},v=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),t=u(f,this)?new p(e):void 0===e?p():p(e);return""===e&&(g[t]=!0),t};h(v,p),v.prototype=f,f.constructor=v;var m="Symbol(test)"==String(p("test")),S=s(f.toString),E=s(f.valueOf),_=/^Symbol\((.*)\)[^)]+$/,y=s("".replace),T=s("".slice);l(f,"description",{configurable:!0,get:function(){var e=E(this),t=S(e);if(a(g,e))return"";var r=m?T(t,7,-1):y(t,_,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:v})}},2165:(e,t,r)=>{r(7235)("iterator")},2526:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(5005),s=r(2104),a=r(6916),c=r(1702),u=r(1913),d=r(9781),l=r(133),h=r(7293),p=r(2597),f=r(3157),g=r(614),v=r(111),m=r(7976),S=r(2190),E=r(9670),_=r(7908),y=r(5656),T=r(4948),R=r(1340),A=r(9114),w=r(30),b=r(1956),C=r(8006),O=r(1156),I=r(5181),P=r(1236),N=r(3070),D=r(6048),L=r(5296),M=r(206),k=r(1320),x=r(2309),U=r(6200),V=r(3501),H=r(9711),j=r(5112),$=r(6061),B=r(7235),F=r(8003),q=r(9909),K=r(2092).forEach,W=U("hidden"),G="Symbol",Y="prototype",z=j("toPrimitive"),X=q.set,J=q.getterFor(G),Z=Object[Y],Q=i.Symbol,ee=Q&&Q[Y],te=i.TypeError,re=i.QObject,ne=o("JSON","stringify"),ie=P.f,oe=N.f,se=O.f,ae=L.f,ce=c([].push),ue=x("symbols"),de=x("op-symbols"),le=x("string-to-symbol-registry"),he=x("symbol-to-string-registry"),pe=x("wks"),fe=!re||!re[Y]||!re[Y].findChild,ge=d&&h((function(){return 7!=w(oe({},"a",{get:function(){return oe(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=ie(Z,t);n&&delete Z[t],oe(e,t,r),n&&e!==Z&&oe(Z,t,n)}:oe,ve=function(e,t){var r=ue[e]=w(ee);return X(r,{type:G,tag:e,description:t}),d||(r.description=t),r},me=function(e,t,r){e===Z&&me(de,t,r),E(e);var n=T(t);return E(r),p(ue,n)?(r.enumerable?(p(e,W)&&e[W][n]&&(e[W][n]=!1),r=w(r,{enumerable:A(0,!1)})):(p(e,W)||oe(e,W,A(1,{})),e[W][n]=!0),ge(e,n,r)):oe(e,n,r)},Se=function(e,t){E(e);var r=y(t),n=b(r).concat(Te(r));return K(n,(function(t){d&&!a(Ee,r,t)||me(e,t,r[t])})),e},Ee=function(e){var t=T(e),r=a(ae,this,t);return!(this===Z&&p(ue,t)&&!p(de,t))&&(!(r||!p(this,t)||!p(ue,t)||p(this,W)&&this[W][t])||r)},_e=function(e,t){var r=y(e),n=T(t);if(r!==Z||!p(ue,n)||p(de,n)){var i=ie(r,n);return!i||!p(ue,n)||p(r,W)&&r[W][n]||(i.enumerable=!0),i}},ye=function(e){var t=se(y(e)),r=[];return K(t,(function(e){p(ue,e)||p(V,e)||ce(r,e)})),r},Te=function(e){var t=e===Z,r=se(t?de:y(e)),n=[];return K(r,(function(e){!p(ue,e)||t&&!p(Z,e)||ce(n,ue[e])})),n};if(l||(k(ee=(Q=function(){if(m(ee,this))throw te("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?R(arguments[0]):void 0,t=H(e),r=function(e){this===Z&&a(r,de,e),p(this,W)&&p(this[W],t)&&(this[W][t]=!1),ge(this,t,A(1,e))};return d&&fe&&ge(Z,t,{configurable:!0,set:r}),ve(t,e)})[Y],"toString",(function(){return J(this).tag})),k(Q,"withoutSetter",(function(e){return ve(H(e),e)})),L.f=Ee,N.f=me,D.f=Se,P.f=_e,C.f=O.f=ye,I.f=Te,$.f=function(e){return ve(j(e),e)},d&&(oe(ee,"description",{configurable:!0,get:function(){return J(this).description}}),u||k(Z,"propertyIsEnumerable",Ee,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!l,sham:!l},{Symbol:Q}),K(b(pe),(function(e){B(e)})),n({target:G,stat:!0,forced:!l},{for:function(e){var t=R(e);if(p(le,t))return le[t];var r=Q(t);return le[t]=r,he[r]=t,r},keyFor:function(e){if(!S(e))throw te(e+" is not a symbol");if(p(he,e))return he[e]},useSetter:function(){fe=!0},useSimple:function(){fe=!1}}),n({target:"Object",stat:!0,forced:!l,sham:!d},{create:function(e,t){return void 0===t?w(e):Se(w(e),t)},defineProperty:me,defineProperties:Se,getOwnPropertyDescriptor:_e}),n({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:ye,getOwnPropertySymbols:Te}),n({target:"Object",stat:!0,forced:h((function(){I.f(1)}))},{getOwnPropertySymbols:function(e){return I.f(_(e))}}),ne&&n({target:"JSON",stat:!0,forced:!l||h((function(){var e=Q();return"[null]"!=ne([e])||"{}"!=ne({a:e})||"{}"!=ne(Object(e))}))},{stringify:function(e,t,r){var n=M(arguments),i=t;if((v(t)||void 0!==e)&&!S(e))return f(t)||(t=function(e,t){if(g(i)&&(t=a(i,this,e,t)),!S(t))return t}),n[1]=t,s(ne,null,n)}}),!ee[z]){var Re=ee.valueOf;k(ee,z,(function(e){return a(Re,this)}))}F(Q,G),V[W]=!0},2990:(e,t,r)=>{"use strict";var n=r(1702),i=r(260),o=n(r(1048)),s=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(e,t){return o(s(this),e,t,arguments.length>2?arguments[2]:void 0)}))},8927:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).every,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("every",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},3105:(e,t,r)=>{"use strict";var n=r(260),i=r(6916),o=r(1285),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("fill",(function(e){var t=arguments.length;return i(o,s(this),e,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}))},5035:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).filter,o=r(3074),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("filter",(function(e){var t=i(s(this),e,arguments.length>1?arguments[1]:void 0);return o(this,t)}))},7174:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).findIndex,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("findIndex",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},4345:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).find,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("find",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},2846:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).forEach,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("forEach",(function(e){i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},4731:(e,t,r)=>{"use strict";var n=r(260),i=r(1318).includes,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("includes",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},7209:(e,t,r)=>{"use strict";var n=r(260),i=r(1318).indexOf,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("indexOf",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},6319:(e,t,r)=>{"use strict";var n=r(7854),i=r(7293),o=r(1702),s=r(260),a=r(6992),c=r(5112)("iterator"),u=n.Uint8Array,d=o(a.values),l=o(a.keys),h=o(a.entries),p=s.aTypedArray,f=s.exportTypedArrayMethod,g=u&&u.prototype,v=!i((function(){g[c].call([1])})),m=!!g&&g.values&&g[c]===g.values&&"values"===g.values.name,S=function(){return d(p(this))};f("entries",(function(){return h(p(this))}),v),f("keys",(function(){return l(p(this))}),v),f("values",S,v||!m,{name:"values"}),f(c,S,v||!m,{name:"values"})},8867:(e,t,r)=>{"use strict";var n=r(260),i=r(1702),o=n.aTypedArray,s=n.exportTypedArrayMethod,a=i([].join);s("join",(function(e){return a(o(this),e)}))},7789:(e,t,r)=>{"use strict";var n=r(260),i=r(2104),o=r(6583),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return i(o,s(this),t>1?[e,arguments[1]]:[e])}))},3739:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).map,o=r(6304),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("map",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(o(e))(t)}))}))},4483:(e,t,r)=>{"use strict";var n=r(260),i=r(3671).right,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return i(o(this),e,t,t>1?arguments[1]:void 0)}))},9368:(e,t,r)=>{"use strict";var n=r(260),i=r(3671).left,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return i(o(this),e,t,t>1?arguments[1]:void 0)}))},2056:(e,t,r)=>{"use strict";var n=r(260),i=n.aTypedArray,o=n.exportTypedArrayMethod,s=Math.floor;o("reverse",(function(){for(var e,t=this,r=i(t).length,n=s(r/2),o=0;o<n;)e=t[o],t[o++]=t[--r],t[r]=e;return t}))},3462:(e,t,r)=>{"use strict";var n=r(7854),i=r(6916),o=r(260),s=r(6244),a=r(4590),c=r(7908),u=r(7293),d=n.RangeError,l=n.Int8Array,h=l&&l.prototype,p=h&&h.set,f=o.aTypedArray,g=o.exportTypedArrayMethod,v=!u((function(){var e=new Uint8ClampedArray(2);return i(p,e,{length:1,0:3},1),3!==e[1]})),m=v&&o.NATIVE_ARRAY_BUFFER_VIEWS&&u((function(){var e=new l(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));g("set",(function(e){f(this);var t=a(arguments.length>1?arguments[1]:void 0,1),r=c(e);if(v)return i(p,this,r,t);var n=this.length,o=s(r),u=0;if(o+t>n)throw d("Wrong length");for(;u<o;)this[t+u]=r[u++]}),!v||m)},678:(e,t,r)=>{"use strict";var n=r(260),i=r(6304),o=r(7293),s=r(206),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("slice",(function(e,t){for(var r=s(a(this),e,t),n=i(this),o=0,c=r.length,u=new n(c);c>o;)u[o]=r[o++];return u}),o((function(){new Int8Array(1).slice()})))},7462:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).some,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("some",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},3824:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(7293),s=r(9662),a=r(4362),c=r(260),u=r(8886),d=r(256),l=r(7392),h=r(8008),p=n.Array,f=c.aTypedArray,g=c.exportTypedArrayMethod,v=n.Uint16Array,m=v&&i(v.prototype.sort),S=!(!m||o((function(){m(new v(2),null)}))&&o((function(){m(new v(2),{})}))),E=!!m&&!o((function(){if(l)return l<74;if(u)return u<67;if(d)return!0;if(h)return h<602;var e,t,r=new v(516),n=p(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(m(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));g("sort",(function(e){return void 0!==e&&s(e),E?m(this,e):a(f(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!E||S)},5021:(e,t,r)=>{"use strict";var n=r(260),i=r(7466),o=r(1400),s=r(6304),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("subarray",(function(e,t){var r=a(this),n=r.length,c=o(e,n);return new(s(r))(r.buffer,r.byteOffset+c*r.BYTES_PER_ELEMENT,i((void 0===t?n:o(t,n))-c))}))},2974:(e,t,r)=>{"use strict";var n=r(7854),i=r(2104),o=r(260),s=r(7293),a=r(206),c=n.Int8Array,u=o.aTypedArray,d=o.exportTypedArrayMethod,l=[].toLocaleString,h=!!c&&s((function(){l.call(new c(1))}));d("toLocaleString",(function(){return i(l,h?a(u(this)):u(this),a(arguments))}),s((function(){return[1,2].toLocaleString()!=new c([1,2]).toLocaleString()}))||!s((function(){c.prototype.toLocaleString.call([1,2])})))},5016:(e,t,r)=>{"use strict";var n=r(260).exportTypedArrayMethod,i=r(7293),o=r(7854),s=r(1702),a=o.Uint8Array,c=a&&a.prototype||{},u=[].toString,d=s([].join);i((function(){u.call({})}))&&(u=function(){return d(this)});var l=c.toString!=u;n("toString",u,l)},2472:(e,t,r)=>{r(9843)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},4747:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),s=r(8533),a=r(8880),c=function(e){if(e&&e.forEach!==s)try{a(e,"forEach",s)}catch(t){e.forEach=s}};for(var u in i)i[u]&&c(n[u]&&n[u].prototype);c(o)},3948:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),s=r(6992),a=r(8880),c=r(5112),u=c("iterator"),d=c("toStringTag"),l=s.values,h=function(e,t){if(e){if(e[u]!==l)try{a(e,u,l)}catch(t){e[u]=l}if(e[d]||a(e,d,t),i[t])for(var r in s)if(e[r]!==s[r])try{a(e,r,s[r])}catch(t){e[r]=s[r]}}};for(var p in i)h(n[p]&&n[p].prototype,p);h(o,"DOMTokenList")},2564:(e,t,r)=>{var n=r(2109),i=r(7854),o=r(2104),s=r(614),a=r(8113),c=r(206),u=r(8053),d=/MSIE .\./.test(a),l=i.Function,h=function(e){return function(t,r){var n=u(arguments.length,1)>2,i=s(t)?t:l(t),a=n?c(arguments,2):void 0;return e(n?function(){o(i,this,a)}:i,r)}};n({global:!0,bind:!0,forced:d},{setTimeout:h(i.setTimeout),setInterval:h(i.setInterval)})},1637:(e,t,r)=>{"use strict";r(6992);var n=r(2109),i=r(7854),o=r(5005),s=r(6916),a=r(1702),c=r(590),u=r(1320),d=r(2248),l=r(8003),h=r(4994),p=r(9909),f=r(5787),g=r(614),v=r(2597),m=r(9974),S=r(648),E=r(9670),_=r(111),y=r(1340),T=r(30),R=r(9114),A=r(8554),w=r(1246),b=r(8053),C=r(5112),O=r(4362),I=C("iterator"),P="URLSearchParams",N=P+"Iterator",D=p.set,L=p.getterFor(P),M=p.getterFor(N),k=o("fetch"),x=o("Request"),U=o("Headers"),V=x&&x.prototype,H=U&&U.prototype,j=i.RegExp,$=i.TypeError,B=i.decodeURIComponent,F=i.encodeURIComponent,q=a("".charAt),K=a([].join),W=a([].push),G=a("".replace),Y=a([].shift),z=a([].splice),X=a("".split),J=a("".slice),Z=/\+/g,Q=Array(4),ee=function(e){return Q[e-1]||(Q[e-1]=j("((?:%[\\da-f]{2}){"+e+"})","gi"))},te=function(e){try{return B(e)}catch(t){return e}},re=function(e){var t=G(e,Z," "),r=4;try{return B(t)}catch(e){for(;r;)t=G(t,ee(r--),te);return t}},ne=/[!'()~]|%20/g,ie={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},oe=function(e){return ie[e]},se=function(e){return G(F(e),ne,oe)},ae=h((function(e,t){D(this,{type:N,iterator:A(L(e).entries),kind:t})}),"Iterator",(function(){var e=M(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),ce=function(e){this.entries=[],this.url=null,void 0!==e&&(_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===q(e,0)?J(e,1):e:y(e)))};ce.prototype={type:P,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,a,c,u=w(e);if(u)for(r=(t=A(e,u)).next;!(n=s(r,t)).done;){if(o=(i=A(E(n.value))).next,(a=s(o,i)).done||(c=s(o,i)).done||!s(o,i).done)throw $("Expected sequence with length 2");W(this.entries,{key:y(a.value),value:y(c.value)})}else for(var d in e)v(e,d)&&W(this.entries,{key:d,value:y(e[d])})},parseQuery:function(e){if(e)for(var t,r,n=X(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=X(t,"="),W(this.entries,{key:re(Y(r)),value:re(K(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],W(r,se(e.key)+"="+se(e.value));return K(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ue=function(){f(this,de),D(this,new ce(arguments.length>0?arguments[0]:void 0))},de=ue.prototype;if(d(de,{append:function(e,t){b(arguments.length,2);var r=L(this);W(r.entries,{key:y(e),value:y(t)}),r.updateURL()},delete:function(e){b(arguments.length,1);for(var t=L(this),r=t.entries,n=y(e),i=0;i<r.length;)r[i].key===n?z(r,i,1):i++;t.updateURL()},get:function(e){b(arguments.length,1);for(var t=L(this).entries,r=y(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){b(arguments.length,1);for(var t=L(this).entries,r=y(e),n=[],i=0;i<t.length;i++)t[i].key===r&&W(n,t[i].value);return n},has:function(e){b(arguments.length,1);for(var t=L(this).entries,r=y(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){b(arguments.length,1);for(var r,n=L(this),i=n.entries,o=!1,s=y(e),a=y(t),c=0;c<i.length;c++)(r=i[c]).key===s&&(o?z(i,c--,1):(o=!0,r.value=a));o||W(i,{key:s,value:a}),n.updateURL()},sort:function(){var e=L(this);O(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=L(this).entries,n=m(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new ae(this,"keys")},values:function(){return new ae(this,"values")},entries:function(){return new ae(this,"entries")}},{enumerable:!0}),u(de,I,de.entries,{name:"entries"}),u(de,"toString",(function(){return L(this).serialize()}),{enumerable:!0}),l(ue,P),n({global:!0,forced:!c},{URLSearchParams:ue}),!c&&g(U)){var le=a(H.has),he=a(H.set),pe=function(e){if(_(e)){var t,r=e.body;if(S(r)===P)return t=e.headers?new U(e.headers):new U,le(t,"content-type")||he(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),T(e,{body:R(0,y(r)),headers:R(0,t)})}return e};if(g(k)&&n({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return k(e,arguments.length>1?pe(arguments[1]):{})}}),g(x)){var fe=function(e){return f(this,V),new x(e,arguments.length>1?pe(arguments[1]):{})};V.constructor=fe,fe.prototype=V,n({global:!0,forced:!0},{Request:fe})}}e.exports={URLSearchParams:ue,getState:L}},285:(e,t,r)=>{"use strict";r(8783);var n,i=r(2109),o=r(9781),s=r(590),a=r(7854),c=r(9974),u=r(1702),d=r(6048).f,l=r(1320),h=r(5787),p=r(2597),f=r(1574),g=r(8457),v=r(1589),m=r(8710).codeAt,S=r(3197),E=r(1340),_=r(8003),y=r(8053),T=r(1637),R=r(9909),A=R.set,w=R.getterFor("URL"),b=T.URLSearchParams,C=T.getState,O=a.URL,I=a.TypeError,P=a.parseInt,N=Math.floor,D=Math.pow,L=u("".charAt),M=u(/./.exec),k=u([].join),x=u(1..toString),U=u([].pop),V=u([].push),H=u("".replace),j=u([].shift),$=u("".split),B=u("".slice),F=u("".toLowerCase),q=u([].unshift),K="Invalid scheme",W="Invalid host",G="Invalid port",Y=/[a-z]/i,z=/[\d+-.a-z]/i,X=/\d/,J=/^0x/i,Z=/^[0-7]+$/,Q=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,re=/[\0\t\n\r #/:<>?@[\\\]^|]/,ne=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,ie=/[\t\n\r]/g,oe=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)q(t,e%256),e=N(e/256);return k(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,o=0;o<8;o++)0!==e[o]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=o),++i);return i>r&&(t=n,r=i),t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=x(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},se={},ae=f({},se,{" ":1,'"':1,"<":1,">":1,"`":1}),ce=f({},ae,{"#":1,"?":1,"{":1,"}":1}),ue=f({},ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),de=function(e,t){var r=m(e,0);return r>32&&r<127&&!p(t,e)?e:encodeURIComponent(e)},le={ftp:21,file:null,http:80,https:443,ws:80,wss:443},he=function(e,t){var r;return 2==e.length&&M(Y,L(e,0))&&(":"==(r=L(e,1))||!t&&"|"==r)},pe=function(e){var t;return e.length>1&&he(B(e,0,2))&&(2==e.length||"/"===(t=L(e,2))||"\\"===t||"?"===t||"#"===t)},fe=function(e){return"."===e||"%2e"===F(e)},ge={},ve={},me={},Se={},Ee={},_e={},ye={},Te={},Re={},Ae={},we={},be={},Ce={},Oe={},Ie={},Pe={},Ne={},De={},Le={},Me={},ke={},xe=function(e,t,r){var n,i,o,s=E(e);if(t){if(i=this.parse(s))throw I(i);this.searchParams=null}else{if(void 0!==r&&(n=new xe(r,!0)),i=this.parse(s,null,n))throw I(i);(o=C(new b)).bindURL(this),this.searchParams=o}};xe.prototype={type:"URL",parse:function(e,t,r){var i,o,s,a,c,u=this,d=t||ge,l=0,h="",f=!1,m=!1,S=!1;for(e=E(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=H(e,ne,"")),e=H(e,ie,""),i=g(e);l<=i.length;){switch(o=i[l],d){case ge:if(!o||!M(Y,o)){if(t)return K;d=me;continue}h+=F(o),d=ve;break;case ve:if(o&&(M(z,o)||"+"==o||"-"==o||"."==o))h+=F(o);else{if(":"!=o){if(t)return K;h="",d=me,l=0;continue}if(t&&(u.isSpecial()!=p(le,h)||"file"==h&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&le[u.scheme]==u.port&&(u.port=null));h="","file"==u.scheme?d=Oe:u.isSpecial()&&r&&r.scheme==u.scheme?d=Se:u.isSpecial()?d=Te:"/"==i[l+1]?(d=Ee,l++):(u.cannotBeABaseURL=!0,V(u.path,""),d=Le)}break;case me:if(!r||r.cannotBeABaseURL&&"#"!=o)return K;if(r.cannotBeABaseURL&&"#"==o){u.scheme=r.scheme,u.path=v(r.path),u.query=r.query,u.fragment="",u.cannotBeABaseURL=!0,d=ke;break}d="file"==r.scheme?Oe:_e;continue;case Se:if("/"!=o||"/"!=i[l+1]){d=_e;continue}d=Re,l++;break;case Ee:if("/"==o){d=Ae;break}d=De;continue;case _e:if(u.scheme=r.scheme,o==n)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.query=r.query;else if("/"==o||"\\"==o&&u.isSpecial())d=ye;else if("?"==o)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.query="",d=Me;else{if("#"!=o){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.path.length--,d=De;continue}u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.query=r.query,u.fragment="",d=ke}break;case ye:if(!u.isSpecial()||"/"!=o&&"\\"!=o){if("/"!=o){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,d=De;continue}d=Ae}else d=Re;break;case Te:if(d=Re,"/"!=o||"/"!=L(h,l+1))continue;l++;break;case Re:if("/"!=o&&"\\"!=o){d=Ae;continue}break;case Ae:if("@"==o){f&&(h="%40"+h),f=!0,s=g(h);for(var _=0;_<s.length;_++){var y=s[_];if(":"!=y||S){var T=de(y,ue);S?u.password+=T:u.username+=T}else S=!0}h=""}else if(o==n||"/"==o||"?"==o||"#"==o||"\\"==o&&u.isSpecial()){if(f&&""==h)return"Invalid authority";l-=g(h).length+1,h="",d=we}else h+=o;break;case we:case be:if(t&&"file"==u.scheme){d=Pe;continue}if(":"!=o||m){if(o==n||"/"==o||"?"==o||"#"==o||"\\"==o&&u.isSpecial()){if(u.isSpecial()&&""==h)return W;if(t&&""==h&&(u.includesCredentials()||null!==u.port))return;if(a=u.parseHost(h))return a;if(h="",d=Ne,t)return;continue}"["==o?m=!0:"]"==o&&(m=!1),h+=o}else{if(""==h)return W;if(a=u.parseHost(h))return a;if(h="",d=Ce,t==be)return}break;case Ce:if(!M(X,o)){if(o==n||"/"==o||"?"==o||"#"==o||"\\"==o&&u.isSpecial()||t){if(""!=h){var R=P(h,10);if(R>65535)return G;u.port=u.isSpecial()&&R===le[u.scheme]?null:R,h=""}if(t)return;d=Ne;continue}return G}h+=o;break;case Oe:if(u.scheme="file","/"==o||"\\"==o)d=Ie;else{if(!r||"file"!=r.scheme){d=De;continue}if(o==n)u.host=r.host,u.path=v(r.path),u.query=r.query;else if("?"==o)u.host=r.host,u.path=v(r.path),u.query="",d=Me;else{if("#"!=o){pe(k(v(i,l),""))||(u.host=r.host,u.path=v(r.path),u.shortenPath()),d=De;continue}u.host=r.host,u.path=v(r.path),u.query=r.query,u.fragment="",d=ke}}break;case Ie:if("/"==o||"\\"==o){d=Pe;break}r&&"file"==r.scheme&&!pe(k(v(i,l),""))&&(he(r.path[0],!0)?V(u.path,r.path[0]):u.host=r.host),d=De;continue;case Pe:if(o==n||"/"==o||"\\"==o||"?"==o||"#"==o){if(!t&&he(h))d=De;else if(""==h){if(u.host="",t)return;d=Ne}else{if(a=u.parseHost(h))return a;if("localhost"==u.host&&(u.host=""),t)return;h="",d=Ne}continue}h+=o;break;case Ne:if(u.isSpecial()){if(d=De,"/"!=o&&"\\"!=o)continue}else if(t||"?"!=o)if(t||"#"!=o){if(o!=n&&(d=De,"/"!=o))continue}else u.fragment="",d=ke;else u.query="",d=Me;break;case De:if(o==n||"/"==o||"\\"==o&&u.isSpecial()||!t&&("?"==o||"#"==o)){if(".."===(c=F(c=h))||"%2e."===c||".%2e"===c||"%2e%2e"===c?(u.shortenPath(),"/"==o||"\\"==o&&u.isSpecial()||V(u.path,"")):fe(h)?"/"==o||"\\"==o&&u.isSpecial()||V(u.path,""):("file"==u.scheme&&!u.path.length&&he(h)&&(u.host&&(u.host=""),h=L(h,0)+":"),V(u.path,h)),h="","file"==u.scheme&&(o==n||"?"==o||"#"==o))for(;u.path.length>1&&""===u.path[0];)j(u.path);"?"==o?(u.query="",d=Me):"#"==o&&(u.fragment="",d=ke)}else h+=de(o,ce);break;case Le:"?"==o?(u.query="",d=Me):"#"==o?(u.fragment="",d=ke):o!=n&&(u.path[0]+=de(o,se));break;case Me:t||"#"!=o?o!=n&&("'"==o&&u.isSpecial()?u.query+="%27":u.query+="#"==o?"%23":de(o,se)):(u.fragment="",d=ke);break;case ke:o!=n&&(u.fragment+=de(o,ae))}l++}},parseHost:function(e){var t,r,n;if("["==L(e,0)){if("]"!=L(e,e.length-1))return W;if(t=function(e){var t,r,n,i,o,s,a,c=[0,0,0,0,0,0,0,0],u=0,d=null,l=0,h=function(){return L(e,l)};if(":"==h()){if(":"!=L(e,1))return;l+=2,d=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=r=0;r<4&&M(ee,h());)t=16*t+P(h(),16),l++,r++;if("."==h()){if(0==r)return;if(l-=r,u>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;l++}if(!M(X,h()))return;for(;M(X,h());){if(o=P(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;l++}c[u]=256*c[u]+i,2!=++n&&4!=n||u++}if(4!=n)return;break}if(":"==h()){if(l++,!h())return}else if(h())return;c[u++]=t}else{if(null!==d)return;l++,d=++u}}if(null!==d)for(s=u-d,u=7;0!=u&&s>0;)a=c[u],c[u--]=c[d+s-1],c[d+--s]=a;else if(8!=u)return;return c}(B(e,1,-1)),!t)return W;this.host=t}else if(this.isSpecial()){if(e=S(e),M(te,e))return W;if(t=function(e){var t,r,n,i,o,s,a,c=$(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=c[n]))return e;if(o=10,i.length>1&&"0"==L(i,0)&&(o=M(J,i)?16:8,i=B(i,8==o?1:2)),""===i)s=0;else{if(!M(10==o?Q:8==o?Z:ee,i))return e;s=P(i,o)}V(r,s)}for(n=0;n<t;n++)if(s=r[n],n==t-1){if(s>=D(256,5-t))return null}else if(s>255)return null;for(a=U(r),n=0;n<r.length;n++)a+=r[n]*D(256,3-n);return a}(e),null===t)return W;this.host=t}else{if(M(re,e))return W;for(t="",r=g(e),n=0;n<r.length;n++)t+=de(r[n],se);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return p(le,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&he(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=oe(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?s[0]:s.length?"/"+k(s,"/"):"",null!==a&&(u+="?"+a),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw I(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new Ue(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+oe(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(E(e)+":",ge)},getUsername:function(){return this.username},setUsername:function(e){var t=g(E(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=de(t[r],ue)}},getPassword:function(){return this.password},setPassword:function(e){var t=g(E(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=de(t[r],ue)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?oe(e):oe(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,we)},getHostname:function(){var e=this.host;return null===e?"":oe(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,be)},getPort:function(){var e=this.port;return null===e?"":E(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=E(e))?this.port=null:this.parse(e,Ce))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+k(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ne))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=E(e))?this.query=null:("?"==L(e,0)&&(e=B(e,1)),this.query="",this.parse(e,Me)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=E(e))?("#"==L(e,0)&&(e=B(e,1)),this.fragment="",this.parse(e,ke)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ue=function(e){var t=h(this,Ve),r=y(arguments.length,1)>1?arguments[1]:void 0,n=A(t,new xe(e,!1,r));o||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Ve=Ue.prototype,He=function(e,t){return{get:function(){return w(this)[e]()},set:t&&function(e){return w(this)[t](e)},configurable:!0,enumerable:!0}};if(o&&d(Ve,{href:He("serialize","setHref"),origin:He("getOrigin"),protocol:He("getProtocol","setProtocol"),username:He("getUsername","setUsername"),password:He("getPassword","setPassword"),host:He("getHost","setHost"),hostname:He("getHostname","setHostname"),port:He("getPort","setPort"),pathname:He("getPathname","setPathname"),search:He("getSearch","setSearch"),searchParams:He("getSearchParams"),hash:He("getHash","setHash")}),l(Ve,"toJSON",(function(){return w(this).serialize()}),{enumerable:!0}),l(Ve,"toString",(function(){return w(this).serialize()}),{enumerable:!0}),O){var je=O.createObjectURL,$e=O.revokeObjectURL;je&&l(Ue,"createObjectURL",c(je,O)),$e&&l(Ue,"revokeObjectURL",c($e,O))}_(Ue,"URL"),i({global:!0,forced:!s,sham:!o},{URL:Ue})},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,o,s;if(a(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=c(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,console&&console.warn}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=d.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,d=f(c,u);for(r=0;r<u;++r)n(d[r],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,o,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},5666:e=>{var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new O(n||[]);return o._invoke=function(e,t,r){var n=l;return function(i,o){if(n===p)throw new Error("Generator is already running");if(n===f){if("throw"===i)throw o;return P()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=w(s,r);if(a){if(a===g)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=d(e,t,r);if("normal"===c.type){if(n=r.done?f:h,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l="suspendedStart",h="suspendedYield",p="executing",f="completed",g={};function v(){}function m(){}function S(){}var E={};c(E,o,(function(){return this}));var _=Object.getPrototypeOf,y=_&&_(_(I([])));y&&y!==r&&n.call(y,o)&&(E=y);var T=S.prototype=v.prototype=Object.create(E);function R(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(i,o,s,a){var c=d(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(l).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,w(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=d(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function I(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=S,c(T,"constructor",S),c(S,"constructor",m),m.displayName=c(S,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,c(e,a,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},R(A.prototype),c(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new A(u(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},R(T),c(T,a,"Generator"),c(T,o,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{AMP_TERM_CODE:()=>Bt,CALL_TYPE:()=>gt,LOG_LEVEL:()=>Dt,PLANET_REL_CODE:()=>Kt,RESOLUTION:()=>nr,VIDEO_STATE:()=>St,WTP_STATE:()=>Pr,Wtp:()=>Tn,WtpCall:()=>Wr,WtpConference:()=>gn,WtpTestCall:()=>yn,WtpUtil:()=>lt}),r(1539),r(8674),r(4916),r(5306),r(6992),r(9575),r(2472),r(2990),r(8927),r(3105),r(5035),r(4345),r(7174),r(2846),r(4731),r(7209),r(6319),r(8867),r(7789),r(3739),r(9368),r(4483),r(2056),r(3462),r(678),r(7462),r(3824),r(5021),r(2974),r(5016),r(9554),r(4747),r(6755),r(8304),r(489),r(2419),r(8011),r(9070),r(2526),r(1817),r(2165),r(8783),r(3948);const e=(e,t)=>{const r=[],n=e.split(/\r\n/);let i;for(let e=0;e<n.length;){const o=n[e];if(/^m=(?:audio|video)/.test(o))i={index:e,stripped:[]},r.push(i);else if(i){const r=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(r&&t===r[2]){n.splice(e,1),i.stripped.push(r[1]);continue}}e++}for(const e of r){const t=n[e.index].split(" ");for(let r=3;r<t.length;)-1===e.stripped.indexOf(t[r])?r++:t.splice(r,1);n[e.index]=t.join(" ")}return n.join("\r\n")};function t(t){return t.sdp=e(t.sdp||"","telephone-event"),Promise.resolve(t)}var i,o;r(5666),r(1532),r(9720),r(9601),r(8309),r(9826),r(2564),r(2222),r(7941),r(9600),r(3843),r(3710),r(9714),r(1058),r(3123),r(4603),r(3210),r(4723),r(9653),r(5827),r(3304),r(3112),r(7042),r(1038),r(9753);class s{constructor(e){this.parameters={};for(const t in e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}setParam(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())}getParam(e){if(e)return this.parameters[e.toLowerCase()]}hasParam(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())}deleteParam(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){const t=this.parameters[e];return delete this.parameters[e],t}}clearParams(){this.parameters={}}}class a extends s{constructor(e,t,r,n,i,o){if(super(i),this.headers={},!r)throw new TypeError('missing or invalid "host" parameter');e=e||"sip";for(const e in o)o.hasOwnProperty(e)&&this.setHeader(e,o[e]);this.raw={scheme:e,user:t,host:r,port:n},this.normal={scheme:e.toLowerCase(),user:t,host:r.toLowerCase(),port:n}}get scheme(){return this.normal.scheme}set scheme(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()}get user(){return this.normal.user}set user(e){this.normal.user=this.raw.user=e}get host(){return this.normal.host}set host(e){this.raw.host=e,this.normal.host=e.toLowerCase()}get aor(){return this.normal.user+"@"+this.normal.host}get port(){return this.normal.port}set port(e){this.normal.port=this.raw.port=e}setHeader(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]}getHeader(e){if(e)return this.headers[this.headerize(e)]}hasHeader(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))}deleteHeader(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){const t=this.headers[e];return delete this.headers[e],t}}clearHeaders(){this.headers={}}clone(){return new a(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))}toRaw(){return this._toString(this._raw)}toString(){return this._toString(this._normal)}get _normal(){return this.normal}get _raw(){return this.raw}_toString(e){let t=e.scheme+":";e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,(e.port||0===e.port)&&(t+=":"+e.port);for(const e in this.parameters)this.parameters.hasOwnProperty(e)&&(t+=";"+e,null!==this.parameters[e]&&(t+="="+this.parameters[e]));const r=[];for(const e in this.headers)if(this.headers.hasOwnProperty(e))for(const t in this.headers[e])this.headers[e].hasOwnProperty(t)&&r.push(e+"="+this.headers[e][t]);return r.length>0&&(t+="?"+r.join("&")),t}escapeUser(e){let t;try{t=decodeURIComponent(e)}catch(e){throw e}return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}headerize(e){const t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length;let i="";for(let e=0;e<n;e++)0!==e&&(i+="-"),i+=r[e].charAt(0).toUpperCase()+r[e].substring(1);return t[i]&&(i=t[i]),i}}!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e[e.debug=3]="debug"}(i||(i={}));class c{constructor(e,t,r){this.logger=e,this.category=t,this.label=r}error(e){this.genericLog(i.error,e)}warn(e){this.genericLog(i.warn,e)}log(e){this.genericLog(i.log,e)}debug(e){this.genericLog(i.debug,e)}genericLog(e,t){this.logger.genericLog(e,this.category,this.label,t)}}class u{constructor(){this.builtinEnabled=!0,this._level=i.log,this.loggers={},this.logger=this.getLogger("sip:loggerfactory")}get level(){return this._level}set level(e){e>=0&&e<=3?this._level=e:e>3?this._level=3:i.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))}get connector(){return this._connector}set connector(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0}getLogger(e,t){if(t&&3===this.level)return new c(this,e,t);if(this.loggers[e])return this.loggers[e];{const t=new c(this,e);return this.loggers[e]=t,t}}genericLog(e,t,r,n){this.level>=e&&this.builtinEnabled&&this.print(e,t,r,n),this.connector&&this.connector(i[e],t,r,n)}print(e,t,r,n){if("string"==typeof n){const e=[new Date,t];r&&e.push(r),n=e.concat(n).join(" | ")}switch(e){case i.error:case i.warn:case i.log:case i.debug:}}}class d extends s{constructor(e,t,r){super(r),this.uri=e,this._displayName=t}get friendlyName(){return this.displayName||this.uri.aor}get displayName(){return this._displayName}set displayName(e){this._displayName=e}clone(){return new d(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))}toString(){let e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";e+="<"+this.uri.toString()+">";for(const t in this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e}}class l extends Error{constructor(e,t,r,n){super(),this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,l)}static buildMessage(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e)))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e)))}function o(e){switch(e.type){case"literal":return'"'+n(e.text)+'"';case"class":const t=e.parts.map((e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){const t=e.map(o);let r,n;if(t.sort(),t.length>0){for(r=1,n=1;r<t.length;r++)t[r-1]!==t[r]&&(t[n]=t[r],n++);t.length=n}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+((s=t)?'"'+n(s)+'"':"end of input")+" found.";var s}}!function(e){e.parse=function(e,t){const r={startRule:t};try{!function(e,t){t=void 0!==t?t:{};const r={},n={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231};let i=119;const o=["\r\n",E("\r\n",!1),/^[0-9]/,_([["0","9"]],!1,!1),/^[a-zA-Z]/,_([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,_([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,_([["\0","ÿ"]],!1,!1),/^["]/,_(['"'],!1,!1)," ",E(" ",!1),"\t",E("\t",!1),/^[a-zA-Z0-9]/,_([["a","z"],["A","Z"],["0","9"]],!1,!1),";",E(";",!1),"/",E("/",!1),"?",E("?",!1),":",E(":",!1),"@",E("@",!1),"&",E("&",!1),"=",E("=",!1),"+",E("+",!1),"$",E("$",!1),",",E(",",!1),"-",E("-",!1),"_",E("_",!1),".",E(".",!1),"!",E("!",!1),"~",E("~",!1),"*",E("*",!1),"'",E("'",!1),"(",E("(",!1),")",E(")",!1),"%",E("%",!1),function(){return" "},function(){return":"},/^[!-~]/,_([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,_([["","￿"]],!1,!1),/^[\x80-\xBF]/,_([["","¿"]],!1,!1),/^[a-f]/,_([["a","f"]],!1,!1),"`",E("`",!1),"<",E("<",!1),">",E(">",!1),"\\",E("\\",!1),"[",E("[",!1),"]",E("]",!1),"{",E("{",!1),"}",E("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,_([["!","'"]],!1,!1),/^[*-[]/,_([["*","["]],!1,!1),/^[\]-~]/,_([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,_([["#","["]],!1,!1),/^[\0-\t]/,_([["\0","\t"]],!1,!1),/^[\x0B-\f]/,_([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,_([["",""]],!1,!1),function(){(t=t||{data:{}}).data.uri=new a(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){(t=t||{data:{}}).data.uri=new a(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",E("sips",!0),"sip",E("sip",!0),function(e){(t=t||{data:{}}).data.scheme=e},function(){(t=t||{data:{}}).data.user=decodeURIComponent(m().slice(0,-1))},function(){(t=t||{data:{}}).data.password=m()},function(){return(t=t||{data:{}}).data.host=m(),t.data.host},function(){return(t=t||{data:{}}).data.host_type="domain",m()},/^[a-zA-Z0-9_\-]/,_([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,_([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return(t=t||{data:{}}).data.host_type="IPv6",m()},"::",E("::",!1),function(){return(t=t||{data:{}}).data.host_type="IPv6",m()},function(){return(t=t||{data:{}}).data.host_type="IPv4",m()},"25",E("25",!1),/^[0-5]/,_([["0","5"]],!1,!1),"2",E("2",!1),/^[0-4]/,_([["0","4"]],!1,!1),"1",E("1",!1),/^[1-9]/,_([["1","9"]],!1,!1),function(e){return t=t||{data:{}},e=parseInt(e.join("")),t.data.port=e,e},"transport=",E("transport=",!0),"udp",E("udp",!0),"tcp",E("tcp",!0),"sctp",E("sctp",!0),"tls",E("tls",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",E("user=",!0),"phone",E("phone",!0),"ip",E("ip",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",E("method=",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",E("ttl=",!0),function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",E("maddr=",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",E("lr",!0),function(){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,r){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),r=null===r?void 0:r[1],t.data.uri_params[e.toLowerCase()]=r},function(e,r){e=e.join("").toLowerCase(),r=r.join(""),(t=t||{data:{}}).data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(r):t.data.uri_headers[e]=[r]},function(){"Refer_To"===(t=t||{data:{}}).startRule&&(t.data.uri=new a(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",E("//",!1),function(){(t=t||{data:{}}).data.scheme=m()},E("SIP",!0),function(){(t=t||{data:{}}).data.sip_version=m()},"INVITE",E("INVITE",!1),"ACK",E("ACK",!1),"VXACH",E("VXACH",!1),"OPTIONS",E("OPTIONS",!1),"BYE",E("BYE",!1),"CANCEL",E("CANCEL",!1),"REGISTER",E("REGISTER",!1),"SUBSCRIBE",E("SUBSCRIBE",!1),"NOTIFY",E("NOTIFY",!1),"REFER",E("REFER",!1),"PUBLISH",E("PUBLISH",!1),function(){return(t=t||{data:{}}).data.method=m(),t.data.method},function(e){(t=t||{data:{}}).data.status_code=parseInt(e.join(""))},function(){(t=t||{data:{}}).data.reason_phrase=m()},function(){(t=t||{data:{}}).data=m()},function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new d(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:c,offset:S().start.offset,parsed:e})},function(e){'"'===(e=m().trim())[0]&&(e=e.substring(1,e.length-1)),(t=t||{data:{}}).data.displayName=e},"q",E("q",!0),function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.q=e},"expires",E("expires",!0),function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",E("0",!1),function(){return parseFloat(m())},function(e,r){(t=t||{data:{}}).data.params||(t.data.params={}),r=null===r?void 0:r[1],t.data.params[e.toLowerCase()]=r},"render",E("render",!0),"session",E("session",!0),"icon",E("icon",!0),"alert",E("alert",!0),function(){"Content_Disposition"===(t=t||{data:{}}).startRule&&(t.data.type=m().toLowerCase())},"handling",E("handling",!0),"optional",E("optional",!0),"required",E("required",!0),function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},function(){(t=t||{data:{}}).data=m()},"text",E("text",!0),"image",E("image",!0),"audio",E("audio",!0),"video",E("video",!0),"application",E("application",!0),"message",E("message",!0),"multipart",E("multipart",!0),"x-",E("x-",!0),function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},function(e){(t=t||{data:{}}).data=e},function(e){(t=t||{data:{}}).data.event=e.toLowerCase()},function(){var e=(t=t||{data:{}}).data.tag;t.data=new d(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",E("tag",!0),function(e){(t=t||{data:{}}).data.tag=e},function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},function(e){(t=t||{data:{}}).data=e},function(){(t=t||{data:{}}).data=new d(t.data.uri,t.data.displayName,t.data.params)},"digest",E("Digest",!0),"realm",E("realm",!0),function(e){(t=t||{data:{}}).data.realm=e},"domain",E("domain",!0),"nonce",E("nonce",!0),function(e){(t=t||{data:{}}).data.nonce=e},"opaque",E("opaque",!0),function(e){(t=t||{data:{}}).data.opaque=e},"stale",E("stale",!0),"true",E("true",!0),function(){(t=t||{data:{}}).data.stale=!0},"false",E("false",!0),function(){(t=t||{data:{}}).data.stale=!1},"algorithm",E("algorithm",!0),"md5",E("MD5",!0),"md5-sess",E("MD5-sess",!0),function(e){(t=t||{data:{}}).data.algorithm=e.toUpperCase()},"qop",E("qop",!0),"auth-int",E("auth-int",!0),"auth",E("auth",!0),function(e){(t=t||{data:{}}).data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new d(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:c,offset:S().start.offset,parsed:e})},function(){(t=t||{data:{}}).data=new d(t.data.uri,t.data.displayName,t.data.params)},function(){(t=t||{data:{}}).data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){(t=t||{data:{}}).data={call_id:t.data}},"from-tag",E("from-tag",!0),function(e){(t=t||{data:{}}).data.replaces_from_tag=e},"to-tag",E("to-tag",!0),function(e){(t=t||{data:{}}).data.replaces_to_tag=e},"early-only",E("early-only",!0),function(){(t=t||{data:{}}).data.early_only=!0},function(e,t){return t},function(e,t){return function(e,t){return[e].concat(t)}(e,t)},function(e){"Require"===(t=t||{data:{}}).startRule&&(t.data=e||[])},function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},"active",E("active",!0),"pending",E("pending",!0),"terminated",E("terminated",!0),function(){(t=t||{data:{}}).data.state=m()},"reason",E("reason",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.reason=e)},function(e){t=t||{data:{}},void 0!==e&&(t.data.expires=e)},"retry_after",E("retry_after",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.retry_after=e)},"deactivated",E("deactivated",!0),"probation",E("probation",!0),"rejected",E("rejected",!0),"timeout",E("timeout",!0),"giveup",E("giveup",!0),"noresource",E("noresource",!0),"invariant",E("invariant",!0),function(e){"Supported"===(t=t||{data:{}}).startRule&&(t.data=e||[])},function(){var e=(t=t||{data:{}}).data.tag;t.data=new d(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",E("ttl",!0),function(e){(t=t||{data:{}}).data.ttl=e},"maddr",E("maddr",!0),function(e){(t=t||{data:{}}).data.maddr=e},"received",E("received",!0),function(e){(t=t||{data:{}}).data.received=e},"branch",E("branch",!0),function(e){(t=t||{data:{}}).data.branch=e},"rport",E("rport",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.rport=e.join(""))},function(e){(t=t||{data:{}}).data.protocol=e},E("UDP",!0),E("TCP",!0),E("TLS",!0),E("SCTP",!0),function(e){(t=t||{data:{}}).data.transport=e},function(){(t=t||{data:{}}).data.host=m()},function(e){(t=t||{data:{}}).data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.deltaSeconds=e)},"refresher",E("refresher",!1),"uas",E("uas",!1),"uac",E("uac",!1),function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.refresher=e)},function(e){"Min_SE"===(t=t||{data:{}}).startRule&&(t.data=e)},"stuns",E("stuns",!0),"stun",E("stun",!0),function(e){(t=t||{data:{}}).data.scheme=e},function(e){(t=t||{data:{}}).data.host=e},"?transport=",E("?transport=",!1),"turns",E("turns",!0),"turn",E("turn",!0),function(e){(t=t||{data:{}}).data.transport=e},function(){(t=t||{data:{}}).data=m()},"Referred-By",E("Referred-By",!1),"b",E("b",!1),"cid",E("cid",!1)],s=[A('2 ""6 7!'),A('4"""5!7#'),A('4$""5!7%'),A('4&""5!7\''),A(";'.# &;("),A('4(""5!7)'),A('4*""5!7+'),A('2,""6,7-'),A('2.""6.7/'),A('40""5!71'),A('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),A(";).# &;,"),A('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),A('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),A('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),A(';.." &"'),A("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),A('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),A('4\\""5!7].# &;3'),A('4^""5!7_'),A('4`""5!7a'),A(';!.) &4b""5!7c'),A('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),A('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),A('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),A('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),A("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),A("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),A("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),A("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),A("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),A('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),A('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),A("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),A("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),A("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),A("%;//0#;&/'$8\":~\" )(\"'#&'#"),A("%;&/0#;//'$8\":~\" )(\"'#&'#"),A("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),A('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),A("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),A("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),A(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),A('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),A("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),A("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),A('%3""5$7.) &3""5#7/\' 8!:!! )'),A('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),A("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),A('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),A('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),A('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),A("%;U.) &;\\.# &;X/& 8!:! )"),A('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),A('$4""5!7/,#0)*4""5!7&&&#'),A('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),A('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),A('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),A('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),A("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),A("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),A('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),A('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),A('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),A(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),A('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),A('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),A('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),A('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),A('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),A('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),A('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),A('%$;j/&#0#*;j&&&#/"!&,)'),A('%$;j/&#0#*;j&&&#/"!&,)'),A(";k.) &;+.# &;-"),A('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),A('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),A('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),A("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),A("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),A('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),A(";.# &;r"),A("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),A(";M.# &;t"),A("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),A('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),A('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),A('%24""6475/,#;{/#$+")("\'#&\'#'),A("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),A(";*.) &;+.# &;-"),A(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),A('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),A('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),A("$;~0#*;~&"),A(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),A('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),A(";.# &;"),A('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),A('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),A("$;y0#*;y&"),A('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),A('2Õ""6Õ7Ö'),A('2×""6×7Ø'),A('2Ù""6Ù7Ú'),A('2Û""6Û7Ü'),A('2Ý""6Ý7Þ'),A('2ß""6ß7à'),A('2á""6á7â'),A('2ã""6ã7ä'),A('2å""6å7æ'),A('2ç""6ç7è'),A('2é""6é7ê'),A("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),A("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),A("%;/' 8!:ì!! )"),A("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),A("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),A("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),A("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),A("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),A("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),A("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),A(";.) &;.# &; "),A("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),A("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),A("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),A('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),A('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),A(";6.) &;T.# &;H"),A("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),A(";¥.# &; "),A('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),A("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),A("%;©/& 8!:č! )"),A("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),A(";«.# &;¬"),A('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),A('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),A(";6.# &;®"),A('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),A(";­.# &;6"),A("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),A(";6.# &;H"),A("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),A("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),A("%;/' 8!:ğ!! )"),A('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),A('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),A("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),A(";¹.# &; "),A("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),A("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),A("%;/' 8!:Ħ!! )"),A("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),A(";¾"),A("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),A("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),A("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),A(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),A("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),A("%;I/' 8!:Ĭ!! )"),A("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),A(";t.# &;w"),A("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),A("%;I/' 8!:ı!! )"),A("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),A('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),A('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),A('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),A('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),A("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),A("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),A("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),A("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),A('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),A("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),A("%;/& 8!:Ő! )"),A('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),A('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),A("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),A("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),A("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),A('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),A(';1." &"'),A('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),A("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),A(";¹.# &; "),A("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),A("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),A(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),A("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),A("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),A("%3Ƃ\"\"5(7ƃ/F#;</=$;\\.) &;Y.# &;X/($8#:Ƅ#! )(#'#(\"'#&'#"),A("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),A("%3ƈ\"\"5%7Ɖ/A#;</8$$;!0#*;!&/($8#:Ɗ#! )(#'#(\"'#&'#"),A("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),A('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),A('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),A('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),A("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),A('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),A('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),A(";¾"),A('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),A(";ô.# &; "),A('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),A('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),A("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),A("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),A("$;%0#*;%&"),A("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),A('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),A('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),A("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),A(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),A('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),A('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),A('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),A('%3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\' 8!:Ʃ!! )'),A("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),A("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),A("%;ă/,#;ă/#$+\")(\"'#&'#"),A("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),A("%;q/T#$;m0#*;m&/D$%; /,#;ø/#$+\")(\"'#&'#.\" &\"/#$+#)(#'#(\"'#&'#"),A('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),A(";.# &;L"),A("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),A("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")];let c=0,u=0;const h=[{line:1,column:1}];let p,f=0,g=[],v=0;if(void 0!==t.startRule){if(!(t.startRule in n))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=n[t.startRule]}function m(){return e.substring(u,c)}function S(){return T(u,c)}function E(e,t){return{type:"literal",text:e,ignoreCase:t}}function _(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function y(t){let r,n=h[t];if(n)return n;for(r=t-1;!h[r];)r--;for(n=h[r],n={line:n.line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return h[t]=n,n}function T(e,t){const r=y(e),n=y(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function R(e){c<f||(c>f&&(f=c,g=[]),g.push(e))}function A(e){return e.split("").map((e=>e.charCodeAt(0)-32))}if(t.data={},p=function t(n){const i=s[n];let a=0;const d=[];let l=i.length;const h=[],p=[];let f;for(;;){for(;a<l;)switch(i[a]){case 0:p.push(o[i[a+1]]),a+=2;break;case 1:p.push(void 0),a++;break;case 2:p.push(null),a++;break;case 3:p.push(r),a++;break;case 4:p.push([]),a++;break;case 5:p.push(c),a++;break;case 6:p.pop(),a++;break;case 7:c=p.pop(),a++;break;case 8:p.length-=i[a+1],a+=2;break;case 9:p.splice(-2,1),a++;break;case 10:p[p.length-2].push(p.pop()),a++;break;case 11:p.push(p.splice(p.length-i[a+1],i[a+1])),a+=2;break;case 12:p.push(e.substring(p.pop(),c)),a++;break;case 13:h.push(l),d.push(a+3+i[a+1]+i[a+2]),p[p.length-1]?(l=a+3+i[a+1],a+=3):(l=a+3+i[a+1]+i[a+2],a+=3+i[a+1]);break;case 14:h.push(l),d.push(a+3+i[a+1]+i[a+2]),p[p.length-1]===r?(l=a+3+i[a+1],a+=3):(l=a+3+i[a+1]+i[a+2],a+=3+i[a+1]);break;case 15:h.push(l),d.push(a+3+i[a+1]+i[a+2]),p[p.length-1]!==r?(l=a+3+i[a+1],a+=3):(l=a+3+i[a+1]+i[a+2],a+=3+i[a+1]);break;case 16:p[p.length-1]!==r?(h.push(l),d.push(a),l=a+2+i[a+1],a+=2):a+=2+i[a+1];break;case 17:h.push(l),d.push(a+3+i[a+1]+i[a+2]),e.length>c?(l=a+3+i[a+1],a+=3):(l=a+3+i[a+1]+i[a+2],a+=3+i[a+1]);break;case 18:h.push(l),d.push(a+4+i[a+2]+i[a+3]),e.substr(c,o[i[a+1]].length)===o[i[a+1]]?(l=a+4+i[a+2],a+=4):(l=a+4+i[a+2]+i[a+3],a+=4+i[a+2]);break;case 19:h.push(l),d.push(a+4+i[a+2]+i[a+3]),e.substr(c,o[i[a+1]].length).toLowerCase()===o[i[a+1]]?(l=a+4+i[a+2],a+=4):(l=a+4+i[a+2]+i[a+3],a+=4+i[a+2]);break;case 20:h.push(l),d.push(a+4+i[a+2]+i[a+3]),o[i[a+1]].test(e.charAt(c))?(l=a+4+i[a+2],a+=4):(l=a+4+i[a+2]+i[a+3],a+=4+i[a+2]);break;case 21:p.push(e.substr(c,i[a+1])),c+=i[a+1],a+=2;break;case 22:p.push(o[i[a+1]]),c+=o[i[a+1]].length,a+=2;break;case 23:p.push(r),0===v&&R(o[i[a+1]]),a+=2;break;case 24:u=p[p.length-1-i[a+1]],a+=2;break;case 25:u=c,a++;break;case 26:f=i.slice(a+4,a+4+i[a+3]).map((function(e){return p[p.length-1-e]})),p.splice(p.length-i[a+2],i[a+2],o[i[a+1]].apply(null,f)),a+=4+i[a+3];break;case 27:p.push(t(i[a+1])),a+=2;break;case 28:v++,a++;break;case 29:v--,a++;break;default:throw new Error("Invalid opcode: "+i[a]+".")}if(!(h.length>0))break;l=h.pop(),a=d.pop()}return p[0]}(i),p!==r&&c===e.length)return p;throw p!==r&&c<e.length&&R({type:"end"}),w=g,b=f<e.length?e.charAt(f):null,C=f<e.length?T(f,f+1):T(f,f),new l(l.buildMessage(w,b),w,b,C);var w,b,C}(e,r)}catch(e){r.data=-1}return r.data},e.nameAddrHeaderParse=function(t){const r=e.parse(t,"Name_Addr_Header");return-1!==r?r:void 0},e.URIParse=function(t){const r=e.parse(t,"SIP_URI");return-1!==r?r:void 0}}(o||(o={}));class h{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=h.hexChars,r=h.hexOut;let n,i,o,s;for(s=0;s<4;s+=1)for(i=8*s,n=e[s],o=0;o<8;o+=2)r[i+1+o]=t.charAt(15&n),n>>>=4,r[i+0+o]=t.charAt(15&n),n>>>=4;return r.join("")}static _md5cycle(e,t){let r=e[0],n=e[1],i=e[2],o=e[3];r+=(n&i|~n&o)+t[0]-680876936|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[1]-389564586|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[2]+606105819|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[3]-1044525330|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&o)+t[4]-176418897|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[5]+1200080426|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[6]-1473231341|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[7]-45705983|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&o)+t[8]+1770035416|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[9]-1958414417|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[10]-42063|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[11]-1990404162|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&o)+t[12]+1804603682|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[13]-40341101|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[14]-1502002290|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[15]+1236535329|0,n=(n<<22|n>>>10)+i|0,r+=(n&o|i&~o)+t[1]-165796510|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[6]-1069501632|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[11]+643717713|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[0]-373897302|0,n=(n<<20|n>>>12)+i|0,r+=(n&o|i&~o)+t[5]-701558691|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[10]+38016083|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[15]-660478335|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[4]-405537848|0,n=(n<<20|n>>>12)+i|0,r+=(n&o|i&~o)+t[9]+568446438|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[14]-1019803690|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[3]-187363961|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[8]+1163531501|0,n=(n<<20|n>>>12)+i|0,r+=(n&o|i&~o)+t[13]-1444681467|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[2]-51403784|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[7]+1735328473|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[12]-1926607734|0,n=(n<<20|n>>>12)+i|0,r+=(n^i^o)+t[5]-378558|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[8]-2022574463|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[11]+1839030562|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[14]-35309556|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^o)+t[1]-1530992060|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[4]+1272893353|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[7]-155497632|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[10]-1094730640|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^o)+t[13]+681279174|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[0]-358537222|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[3]-722521979|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[6]+76029189|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^o)+t[9]-640364487|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[12]-421815835|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[15]+530742520|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[2]-995338651|0,n=(n<<23|n>>>9)+i|0,r+=(i^(n|~o))+t[0]-198630844|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[7]+1126891415|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[14]-1416354905|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[5]-57434055|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[12]+1700485571|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[3]-1894986606|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[10]-1051523|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[1]-2054922799|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[8]+1873313359|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[15]-30611744|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[6]-1560198380|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[13]+1309151649|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[4]-145523070|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[11]-1120210379|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[2]+718787259|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[9]-343485551|0,n=(n<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(h.stateIdentity),this}appendStr(e){const t=this._buffer8,r=this._buffer32;let n,i,o=this._bufferLength;for(i=0;i<e.length;i+=1){if(n=e.charCodeAt(i),n<128)t[o++]=n;else if(n<2048)t[o++]=192+(n>>>6),t[o++]=63&n|128;else if(n<55296||n>56319)t[o++]=224+(n>>>12),t[o++]=n>>>6&63|128,t[o++]=63&n|128;else{if(n=1024*(n-55296)+(e.charCodeAt(++i)-56320)+65536,n>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[o++]=240+(n>>>18),t[o++]=n>>>12&63|128,t[o++]=n>>>6&63|128,t[o++]=63&n|128}o>=64&&(this._dataLength+=64,h._md5cycle(this._state,r),o-=64,r[0]=r[16])}return this._bufferLength=o,this}appendAsciiStr(e){const t=this._buffer8,r=this._buffer32;let n,i=this._bufferLength,o=0;for(;;){for(n=Math.min(e.length-o,64-i);n--;)t[i++]=e.charCodeAt(o++);if(i<64)break;this._dataLength+=64,h._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}appendByteArray(e){const t=this._buffer8,r=this._buffer32;let n,i=this._bufferLength,o=0;for(;;){for(n=Math.min(e.length-o,64-i);n--;)t[i++]=e[o++];if(i<64)break;this._dataLength+=64,h._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}getState(){const e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}}setState(e){const t=e.buffer,r=e.state,n=this._state;let i;for(this._dataLength=e.length,this._bufferLength=e.buflen,n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],i=0;i<t.length;i+=1)this._buffer8[i]=t.charCodeAt(i)}end(e=!1){const t=this._bufferLength,r=this._buffer8,n=this._buffer32,i=1+(t>>2);let o;if(this._dataLength+=t,r[t]=128,r[t+1]=r[t+2]=r[t+3]=0,n.set(h.buffer32Identity.subarray(i),i),t>55&&(h._md5cycle(this._state,n),n.set(h.buffer32Identity)),o=8*this._dataLength,o<=4294967295)n[14]=o;else{const e=o.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),r=parseInt(e[1],16)||0;n[14]=t,n[15]=r}return h._md5cycle(this._state,n),e?this._state:h._hex(this._state)}}h.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),h.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),h.hexChars="0123456789abcdef",h.hexOut=[],h.onePassHasher=new h,h.hashStr("hello");const p={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"};function f(e,t=32){let r="";for(let n=0;n<e;n++)r+=Math.floor(Math.random()*t).toString(t);return r}function g(e){return p[e]||""}function v(){return f(10)}function m(e){const t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length;let i="";for(let e=0;e<n;e++)0!==e&&(i+="-"),i+=r[e].charAt(0).toUpperCase()+r[e].substring(1);return t[i]&&(i=t[i]),i}function S(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}function E(e){return h.hashStr(e)}class _{constructor(e,t,r,n){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=r,this.password=n,this.ha1=t,this.nc=0,this.ncHex="00000000"}authenticate(e,t,r){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=f(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(r),!0}toString(){const e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")}updateNcHex(){const e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e}calculateResponse(e){let t,r;t=this.ha1,""!==t&&void 0!==t||(t=E(this.username+":"+this.realm+":"+this.password)),"auth"===this.qop?(r=E(this.method+":"+this.uri),this.response=E(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+r)):"auth-int"===this.qop?(r=E(this.method+":"+this.uri+":"+E(e||"")),this.response=E(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+r)):void 0===this.qop&&(r=E(this.method+":"+this.uri),this.response=E(t+":"+this.nonce+":"+r))}}var y,T,R,A,w;!function(e){e.ACK="ACK",e.BYE="BYE",e.CANCEL="CANCEL",e.INFO="INFO",e.INVITE="INVITE",e.MESSAGE="MESSAGE",e.NOTIFY="NOTIFY",e.OPTIONS="OPTIONS",e.REGISTER="REGISTER",e.UPDATE="UPDATE",e.SUBSCRIBE="SUBSCRIBE",e.PUBLISH="PUBLISH",e.REFER="REFER",e.PRACK="PRACK"}(y||(y={}));class b{constructor(e,t,r,n,i,o,s){this.headers={},this.extraHeaders=[],this.options=b.getDefaultOptions(),i&&(this.options=Object.assign(Object.assign({},this.options),i),this.options.optionTags&&this.options.optionTags.length&&(this.options.optionTags=this.options.optionTags.slice()),this.options.routeSet&&this.options.routeSet.length&&(this.options.routeSet=this.options.routeSet.slice())),o&&o.length&&(this.extraHeaders=o.slice()),s&&(this.body={body:s.content,contentType:s.contentType}),this.method=e,this.ruri=t.clone(),this.fromURI=r.clone(),this.fromTag=this.options.fromTag?this.options.fromTag:v(),this.from=b.makeNameAddrHeader(this.fromURI,this.options.fromDisplayName,this.fromTag),this.toURI=n.clone(),this.toTag=this.options.toTag,this.to=b.makeNameAddrHeader(this.toURI,this.options.toDisplayName,this.toTag),this.callId=this.options.callId?this.options.callId:this.options.callIdPrefix+f(15),this.cseq=this.options.cseq,this.setHeader("route",this.options.routeSet),this.setHeader("via",""),this.setHeader("to",this.to.toString()),this.setHeader("from",this.from.toString()),this.setHeader("cseq",this.cseq+" "+this.method),this.setHeader("call-id",this.callId),this.setHeader("max-forwards","70")}static getDefaultOptions(){return{callId:"",callIdPrefix:"",cseq:1,toDisplayName:"",toTag:"",fromDisplayName:"",fromTag:"",forceRport:!1,hackViaTcp:!1,optionTags:["outbound"],routeSet:[],userAgentString:"sip.js",viaHost:""}}static makeNameAddrHeader(e,t,r){const n={};return r&&(n.tag=r),new d(e,t,n)}getHeader(e){const t=this.headers[m(e)];if(t){if(t[0])return t[0]}else{const t=new RegExp("^\\s*"+e+"\\s*:","i");for(const e of this.extraHeaders)if(t.test(e))return e.substring(e.indexOf(":")+1).trim()}}getHeaders(e){const t=[],r=this.headers[m(e)];if(r)for(const e of r)t.push(e);else{const r=new RegExp("^\\s*"+e+"\\s*:","i");for(const e of this.extraHeaders)r.test(e)&&t.push(e.substring(e.indexOf(":")+1).trim())}return t}hasHeader(e){if(this.headers[m(e)])return!0;{const t=new RegExp("^\\s*"+e+"\\s*:","i");for(const e of this.extraHeaders)if(t.test(e))return!0}return!1}setHeader(e,t){this.headers[m(e)]=t instanceof Array?t:[t]}setViaHeader(e,t){this.options.hackViaTcp&&(t="TCP");let r="SIP/2.0/"+t;r+=" "+this.options.viaHost+";branch="+e,this.options.forceRport&&(r+=";rport"),this.setHeader("via",r),this.branch=e}toString(){let e="";e+=this.method+" "+this.ruri.toRaw()+" SIP/2.0\r\n";for(const t in this.headers)if(this.headers[t])for(const r of this.headers[t])e+=t+": "+r+"\r\n";for(const t of this.extraHeaders)e+=t.trim()+"\r\n";return e+="Supported: "+this.options.optionTags.join(", ")+"\r\n",e+="User-Agent: "+this.options.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+S(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+S(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e}}function C(e,t){const r="\r\n";if(t.statusCode<100||t.statusCode>699)throw new TypeError("Invalid statusCode: "+t.statusCode);const n=t.reasonPhrase?t.reasonPhrase:g(t.statusCode);let i="SIP/2.0 "+t.statusCode+" "+n+r;t.statusCode>=100&&t.statusCode,t.statusCode;const o="From: "+e.getHeader("From")+r,s="Call-ID: "+e.callId+r,a="CSeq: "+e.cseq+" "+e.method+r,c=e.getHeaders("via").reduce(((e,t)=>e+"Via: "+t+r),"");let u="To: "+e.getHeader("to");if(t.statusCode>100&&!e.parseHeader("to").hasParam("tag")){let e=t.toTag;e||(e=v()),u+=";tag="+e}u+=r;let d="";t.supported&&(d="Supported: "+t.supported.join(", ")+r);let l="";t.userAgent&&(l="User-Agent: "+t.userAgent+r);let h="";return t.extraHeaders&&(h=t.extraHeaders.reduce(((e,t)=>e+t.trim()+r),"")),i+=c,i+=o,i+=u,i+=a,i+=s,i+=d,i+=l,i+=h,t.body?(i+="Content-Type: "+t.body.contentType+r,i+="Content-Length: "+S(t.body.content)+r+r,i+=t.body.content):i+="Content-Length: 0\r\n\r\n",{message:i}}class O extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class I extends O{constructor(e){super(e||"Unspecified transport error.")}}class P{constructor(e,t,r,n,i){this._transport=e,this._user=t,this._id=r,this._state=n,this.listeners=new Array,this.logger=t.loggerFactory.getLogger(i,r),this.logger.debug(`Constructing ${this.typeToString()} with id ${this.id}.`)}dispose(){this.logger.debug(`Destroyed ${this.typeToString()} with id ${this.id}.`)}get id(){return this._id}get kind(){throw new Error("Invalid kind.")}get state(){return this._state}get transport(){return this._transport}addStateChangeListener(e,t){const r=()=>{this.removeStateChangeListener(r),e()};!0===(null==t?void 0:t.once)?this.listeners.push(r):this.listeners.push(e)}notifyStateChangeListeners(){this.listeners.slice().forEach((e=>e()))}removeStateChangeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}logTransportError(e,t){this.logger.error(e.message),this.logger.error(`Transport error occurred in ${this.typeToString()} with id ${this.id}.`),this.logger.error(t)}send(e){return this.transport.send(e).catch((e=>{if(e instanceof I)throw this.onTransportError(e),e;let t;throw t=e&&"string"==typeof e.message?new I(e.message):new I,this.onTransportError(t),t}))}setState(e){this.logger.debug(`State change to "${e}" on ${this.typeToString()} with id ${this.id}.`),this._state=e,this._user.onStateChange&&this._user.onStateChange(e),this.notifyStateChangeListeners()}typeToString(){return"UnknownType"}}class N extends P{constructor(e,t,r,n,i){super(t,r,N.makeId(e),n,i),this._request=e,this.user=r,e.setViaHeader(this.id,t.protocol)}static makeId(e){if("CANCEL"===e.method){if(!e.branch)throw new Error("Outgoing CANCEL request without a branch.");return e.branch}return"z9hG4bK"+Math.floor(1e7*Math.random())}get request(){return this._request}onRequestTimeout(){this.user.onRequestTimeout&&this.user.onRequestTimeout()}}!function(e){e.Accepted="Accepted",e.Calling="Calling",e.Completed="Completed",e.Confirmed="Confirmed",e.Proceeding="Proceeding",e.Terminated="Terminated",e.Trying="Trying"}(T||(T={}));class D extends N{constructor(e,t,r){super(e,t,r,T.Trying,"sip.transaction.nict"),this.F=setTimeout((()=>this.timerF()),32e3),this.send(e.toString()).catch((e=>{this.logTransportError(e,"Failed to send initial outgoing request.")}))}dispose(){this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),super.dispose()}get kind(){return"nict"}receiveResponse(e){const t=e.statusCode;if(!t||t<100||t>699)throw new Error(`Invalid status code ${t}`);switch(this.state){case T.Trying:if(t>=100&&t<=199)return this.stateTransition(T.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=699)return this.stateTransition(T.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Proceeding:if(t>=100&&t<=199&&this.user.receiveResponse)return this.user.receiveResponse(e);if(t>=200&&t<=699)return this.stateTransition(T.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Completed:case T.Terminated:return;default:throw new Error(`Invalid state ${this.state}`)}const r=`Non-INVITE client transaction received unexpected ${t} response while in state ${this.state}.`;this.logger.warn(r)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(T.Terminated,!0)}typeToString(){return"non-INVITE client transaction"}stateTransition(e,t=!1){const r=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Trying:r();break;case T.Proceeding:this.state!==T.Trying&&r();break;case T.Completed:this.state!==T.Trying&&this.state!==T.Proceeding&&r();break;case T.Terminated:this.state!==T.Trying&&this.state!==T.Proceeding&&this.state!==T.Completed&&(t||r());break;default:r()}e===T.Completed&&(this.F&&(clearTimeout(this.F),this.F=void 0),this.K=setTimeout((()=>this.timerK()),0)),e===T.Terminated&&this.dispose(),this.setState(e)}timerF(){this.logger.debug(`Timer F expired for non-INVITE client transaction ${this.id}.`),this.state!==T.Trying&&this.state!==T.Proceeding||(this.onRequestTimeout(),this.stateTransition(T.Terminated))}timerK(){this.state===T.Completed&&this.stateTransition(T.Terminated)}}class L extends P{constructor(e,t,r,n,i){super(t,r,e.viaBranch,n,i),this._request=e,this.user=r}get request(){return this._request}}class M extends L{constructor(e,t,r){super(e,t,r,T.Proceeding,"sip.transaction.ist")}dispose(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),super.dispose()}get kind(){return"ist"}receiveRequest(e){switch(this.state){case T.Proceeding:if(e.method===y.INVITE)return void(this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")})));break;case T.Accepted:if(e.method===y.INVITE)return;break;case T.Completed:if(e.method===y.INVITE){if(!this.lastFinalResponse)throw new Error("Last final response undefined.");return void this.send(this.lastFinalResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of final response.")}))}if(e.method===y.ACK)return void this.stateTransition(T.Confirmed);break;case T.Confirmed:case T.Terminated:if(e.method===y.INVITE||e.method===y.ACK)return;break;default:throw new Error(`Invalid state ${this.state}`)}const t=`INVITE server transaction received unexpected ${e.method} request while in state ${this.state}.`;this.logger.warn(t)}receiveResponse(e,t){if(e<100||e>699)throw new Error(`Invalid status code ${e}`);switch(this.state){case T.Proceeding:if(e>=100&&e<=199)return this.lastProvisionalResponse=t,e>100&&this.startProgressExtensionTimer(),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send 1xx response.")}));if(e>=200&&e<=299)return this.lastFinalResponse=t,this.stateTransition(T.Accepted),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send 2xx response.")}));if(e>=300&&e<=699)return this.lastFinalResponse=t,this.stateTransition(T.Completed),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send non-2xx final response.")}));break;case T.Accepted:if(e>=200&&e<=299)return void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send 2xx response.")}));break;case T.Completed:case T.Confirmed:case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}const r=`INVITE server transaction received unexpected ${e} response from TU while in state ${this.state}.`;throw this.logger.error(r),new Error(r)}retransmitAcceptedResponse(){this.state===T.Accepted&&this.lastFinalResponse&&this.send(this.lastFinalResponse).catch((e=>{this.logTransportError(e,"Failed to send 2xx response.")}))}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e)}typeToString(){return"INVITE server transaction"}stateTransition(e){const t=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Proceeding:t();break;case T.Accepted:case T.Completed:this.state!==T.Proceeding&&t();break;case T.Confirmed:this.state!==T.Completed&&t();break;case T.Terminated:this.state!==T.Accepted&&this.state!==T.Completed&&this.state!==T.Confirmed&&t();break;default:t()}this.stopProgressExtensionTimer(),e===T.Accepted&&(this.L=setTimeout((()=>this.timerL()),32e3)),e===T.Completed&&(this.H=setTimeout((()=>this.timerH()),32e3)),e===T.Confirmed&&(this.I=setTimeout((()=>this.timerI()),0)),e===T.Terminated&&this.dispose(),this.setState(e)}startProgressExtensionTimer(){void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval((()=>{if(this.logger.debug(`Progress extension timer expired for INVITE server transaction ${this.id}.`),!this.lastProvisionalResponse)throw new Error("Last provisional response undefined.");this.send(this.lastProvisionalResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")}))}),6e4))}stopProgressExtensionTimer(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)}timerG(){}timerH(){this.logger.debug(`Timer H expired for INVITE server transaction ${this.id}.`),this.state===T.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(T.Terminated))}timerI(){this.logger.debug(`Timer I expired for INVITE server transaction ${this.id}.`),this.stateTransition(T.Terminated)}timerL(){this.logger.debug(`Timer L expired for INVITE server transaction ${this.id}.`),this.state===T.Accepted&&this.stateTransition(T.Terminated)}}class k{constructor(e,t){this.core=e,this.dialogState=t,this.core.dialogs.set(this.id,this)}static initialDialogStateForUserAgentClient(e,t){const r=t.getHeaders("record-route").reverse(),n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof d))throw new Error("Contact not instance of NameAddrHeader.");const i=n.uri,o=e.cseq,s=e.callId,a=e.fromTag,c=t.toTag;if(!s)throw new Error("Call id undefined.");if(!a)throw new Error("From tag undefined.");if(!c)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");const u=e.from.uri,l=e.to.uri;if(!t.statusCode)throw new Error("Incoming response status code undefined.");return{id:s+a+c,early:t.statusCode<200,callId:s,localTag:a,remoteTag:c,localSequenceNumber:o,remoteSequenceNumber:void 0,localURI:u,remoteURI:l,remoteTarget:i,routeSet:r,secure:!1}}static initialDialogStateForUserAgentServer(e,t,r=!1){const n=e.getHeaders("record-route"),i=e.parseHeader("contact");if(!i)throw new Error("Contact undefined.");if(!(i instanceof d))throw new Error("Contact not instance of NameAddrHeader.");const o=i.uri,s=e.cseq,a=e.callId,c=t,u=e.fromTag,l=e.from.uri;return{id:a+c+u,early:r,callId:a,localTag:c,remoteTag:u,localSequenceNumber:void 0,remoteSequenceNumber:s,localURI:e.to.uri,remoteURI:l,remoteTarget:o,routeSet:n,secure:!1}}dispose(){this.core.dialogs.delete(this.id)}get id(){return this.dialogState.id}get early(){return this.dialogState.early}get callId(){return this.dialogState.callId}get localTag(){return this.dialogState.localTag}get remoteTag(){return this.dialogState.remoteTag}get localSequenceNumber(){return this.dialogState.localSequenceNumber}get remoteSequenceNumber(){return this.dialogState.remoteSequenceNumber}get localURI(){return this.dialogState.localURI}get remoteURI(){return this.dialogState.remoteURI}get remoteTarget(){return this.dialogState.remoteTarget}get routeSet(){return this.dialogState.routeSet}get secure(){return this.dialogState.secure}get userAgentCore(){return this.core}confirm(){this.dialogState.early=!1}receiveRequest(e){if(e.method!==y.ACK){if(this.remoteSequenceNumber){if(e.cseq<=this.remoteSequenceNumber)throw new Error("Out of sequence in dialog request. Did you forget to call sequenceGuard()?");this.dialogState.remoteSequenceNumber=e.cseq}this.remoteSequenceNumber||(this.dialogState.remoteSequenceNumber=e.cseq)}}recomputeRouteSet(e){this.dialogState.routeSet=e.getHeaders("record-route").reverse()}createOutgoingRequestMessage(e,t){const r=this.remoteURI,n=this.remoteTag,i=this.localURI,o=this.localTag,s=this.callId;let a;a=t&&t.cseq?t.cseq:this.dialogState.localSequenceNumber?this.dialogState.localSequenceNumber+=1:this.dialogState.localSequenceNumber=1;const c=this.remoteTarget,u=this.routeSet,d=t&&t.extraHeaders,l=t&&t.body;return this.userAgentCore.makeOutgoingRequestMessage(e,c,i,r,{callId:s,cseq:a,fromTag:o,toTag:n,routeSet:u},d,l)}incrementLocalSequenceNumber(){if(!this.dialogState.localSequenceNumber)throw new Error("Local sequence number undefined.");this.dialogState.localSequenceNumber+=1}sequenceGuard(e){return!(e.method!==y.ACK&&this.remoteSequenceNumber&&e.cseq<=this.remoteSequenceNumber&&(this.core.replyStateless(e,{statusCode:500}),1))}}class x{constructor(){this.headers={}}addHeader(e,t){const r={raw:t};e=m(e),this.headers[e]?this.headers[e].push(r):this.headers[e]=[r]}getHeader(e){const t=this.headers[m(e)];if(t)return t[0]?t[0].raw:void 0}getHeaders(e){const t=this.headers[m(e)],r=[];if(!t)return[];for(const e of t)r.push(e.raw);return r}hasHeader(e){return!!this.headers[m(e)]}parseHeader(e,t=0){if(e=m(e),!this.headers[e])return;if(t>=this.headers[e].length)return;const r=this.headers[e][t],n=r.raw;if(r.parsed)return r.parsed;const i=o.parse(n,e.replace(/-/g,"_"));return-1===i?void this.headers[e].splice(t,1):(r.parsed=i,i)}s(e,t=0){return this.parseHeader(e,t)}setHeader(e,t){this.headers[m(e)]=[{raw:t}]}toString(){return this.data}}class U extends x{constructor(){super()}}class V extends x{constructor(){super()}}function H(e){return"application/sdp"===e?"session":"render"}function j(e){const t="string"==typeof e?e:e.body,r="string"==typeof e?"application/sdp":e.contentType;return{contentDisposition:H(r),contentType:r,content:t}}function $(e){return!(!e||"string"!=typeof e.content||"string"!=typeof e.contentType||void 0!==e.contentDisposition)||"string"==typeof e.contentDisposition}function B(e){let t,r,n;if(e instanceof U&&e.body){const i=e.parseHeader("Content-Disposition");t=i?i.type:void 0,r=e.parseHeader("Content-Type"),n=e.body}if(e instanceof V&&e.body){const i=e.parseHeader("Content-Disposition");t=i?i.type:void 0,r=e.parseHeader("Content-Type"),n=e.body}if(e instanceof b&&e.body)if(t=e.getHeader("Content-Disposition"),r=e.getHeader("Content-Type"),"string"==typeof e.body){if(!r)throw new Error("Header content type header does not equal body content type.");n=e.body}else{if(r&&r!==e.body.contentType)throw new Error("Header content type header does not equal body content type.");r=e.body.contentType,n=e.body.body}if($(e)&&(t=e.contentDisposition,r=e.contentType,n=e.content),n){if(r&&!t&&(t=H(r)),!t)throw new Error("Content disposition undefined.");if(!r)throw new Error("Content type undefined.");return{contentDisposition:t,contentType:r,content:n}}}!function(e){e.Initial="Initial",e.Early="Early",e.AckWait="AckWait",e.Confirmed="Confirmed",e.Terminated="Terminated"}(R||(R={})),function(e){e.Initial="Initial",e.HaveLocalOffer="HaveLocalOffer",e.HaveRemoteOffer="HaveRemoteOffer",e.Stable="Stable",e.Closed="Closed"}(A||(A={}));class F extends N{constructor(e,t,r){super(e,t,r,T.Calling,"sip.transaction.ict"),this.ackRetransmissionCache=new Map,this.B=setTimeout((()=>this.timerB()),32e3),this.send(e.toString()).catch((e=>{this.logTransportError(e,"Failed to send initial outgoing request.")}))}dispose(){this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),super.dispose()}get kind(){return"ict"}ackResponse(e){const t=e.toTag;if(!t)throw new Error("To tag undefined.");const r="z9hG4bK"+Math.floor(1e7*Math.random());e.setViaHeader(r,this.transport.protocol),this.ackRetransmissionCache.set(t,e),this.send(e.toString()).catch((e=>{this.logTransportError(e,"Failed to send ACK to 2xx response.")}))}receiveResponse(e){const t=e.statusCode;if(!t||t<100||t>699)throw new Error(`Invalid status code ${t}`);switch(this.state){case T.Calling:if(t>=100&&t<=199)return this.stateTransition(T.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(T.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=300&&t<=699)return this.stateTransition(T.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Proceeding:if(t>=100&&t<=199)return void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(T.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=300&&t<=699)return this.stateTransition(T.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Accepted:if(t>=200&&t<=299){if(!this.ackRetransmissionCache.has(e.toTag))return this.ackRetransmissionCache.set(e.toTag,void 0),void(this.user.receiveResponse&&this.user.receiveResponse(e));const t=this.ackRetransmissionCache.get(e.toTag);return t?void this.send(t.toString()).catch((e=>{this.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")})):void 0}break;case T.Completed:if(t>=300&&t<=699)return void this.ack(e);break;case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}const r=`Received unexpected ${t} response while in state ${this.state}.`;this.logger.warn(r)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(T.Terminated,!0)}typeToString(){return"INVITE client transaction"}ack(e){const t=this.request.ruri,r=this.request.callId,n=this.request.cseq,i=this.request.getHeader("from"),o=e.getHeader("to"),s=this.request.getHeader("via"),a=this.request.getHeader("route");if(!i)throw new Error("From undefined.");if(!o)throw new Error("To undefined.");if(!s)throw new Error("Via undefined.");let c=`ACK ${t} SIP/2.0\r\n`;a&&(c+=`Route: ${a}\r\n`),c+=`Via: ${s}\r\n`,c+=`To: ${o}\r\n`,c+=`From: ${i}\r\n`,c+=`Call-ID: ${r}\r\n`,c+=`CSeq: ${n} ACK\r\n`,c+="Max-Forwards: 70\r\n",c+="Content-Length: 0\r\n\r\n",this.send(c).catch((e=>{this.logTransportError(e,"Failed to send ACK to non-2xx response.")}))}stateTransition(e,t=!1){const r=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Calling:r();break;case T.Proceeding:this.state!==T.Calling&&r();break;case T.Accepted:case T.Completed:this.state!==T.Calling&&this.state!==T.Proceeding&&r();break;case T.Terminated:this.state!==T.Calling&&this.state!==T.Accepted&&this.state!==T.Completed&&(t||r());break;default:r()}this.B&&(clearTimeout(this.B),this.B=void 0),T.Proceeding,e===T.Completed&&(this.D=setTimeout((()=>this.timerD()),0)),e===T.Accepted&&(this.M=setTimeout((()=>this.timerM()),32e3)),e===T.Terminated&&this.dispose(),this.setState(e)}timerA(){}timerB(){this.logger.debug(`Timer B expired for INVITE client transaction ${this.id}.`),this.state===T.Calling&&(this.onRequestTimeout(),this.stateTransition(T.Terminated))}timerD(){this.logger.debug(`Timer D expired for INVITE client transaction ${this.id}.`),this.state===T.Completed&&this.stateTransition(T.Terminated)}timerM(){this.logger.debug(`Timer M expired for INVITE client transaction ${this.id}.`),this.state===T.Accepted&&this.stateTransition(T.Terminated)}}class q{constructor(e,t,r,n){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=n,this.challenged=!1,this.stale=!1,this.logger=this.loggerFactory.getLogger("sip.user-agent-client"),this.init()}dispose(){this.transaction.dispose()}get loggerFactory(){return this.core.loggerFactory}get transaction(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction}cancel(e,t={}){if(!this.transaction)throw new Error("Transaction undefined.");if(!this.message.to)throw new Error("To undefined.");if(!this.message.from)throw new Error("From undefined.");const r=this.core.makeOutgoingRequestMessage(y.CANCEL,this.message.ruri,this.message.from.uri,this.message.to.uri,{toTag:this.message.toTag,fromTag:this.message.fromTag,callId:this.message.callId,cseq:this.message.cseq},t.extraHeaders);return r.branch=this.message.branch,this.message.headers.Route&&(r.headers.Route=this.message.headers.Route),e&&r.setHeader("Reason",e),this.transaction.state===T.Proceeding?new q(D,this.core,r):this.transaction.addStateChangeListener((()=>{this.transaction&&this.transaction.state===T.Proceeding&&new q(D,this.core,r)}),{once:!0}),r}authenticationGuard(e,t){const r=e.statusCode;if(!r)throw new Error("Response status code undefined.");if(401!==r&&407!==r)return!0;let n,i;if(401===r?(n=e.parseHeader("www-authenticate"),i="authorization"):(n=e.parseHeader("proxy-authenticate"),i="proxy-authorization"),!n)return this.logger.warn(r+" with wrong or missing challenge, cannot authenticate"),!0;if(this.challenged&&(this.stale||!0!==n.stale))return this.logger.warn(r+" apparently in authentication loop, cannot authenticate"),!0;if(!this.credentials&&(this.credentials=this.core.configuration.authenticationFactory(),!this.credentials))return this.logger.warn("Unable to obtain credentials, cannot authenticate"),!0;if(!this.credentials.authenticate(this.message,n))return!0;this.challenged=!0,n.stale&&(this.stale=!0);let o=this.message.cseq+=1;return t&&t.localSequenceNumber&&(t.incrementLocalSequenceNumber(),o=this.message.cseq=t.localSequenceNumber),this.message.setHeader("cseq",o+" "+this.message.method),this.message.setHeader(i,this.credentials.toString()),this.init(),!1}onRequestTimeout(){this.logger.warn("User agent client request timed out. Generating internal 408 Request Timeout.");const e=new V;e.statusCode=408,e.reasonPhrase="Request Timeout",this.receiveResponse(e)}onTransportError(e){this.logger.error(e.message),this.logger.error("User agent client request transport error. Generating internal 503 Service Unavailable.");const t=new V;t.statusCode=503,t.reasonPhrase="Service Unavailable",this.receiveResponse(t)}receiveResponse(e){if(!this.authenticationGuard(e))return;const t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e});break;case/^2[0-9]{2}$/.test(t):this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e});break;case/^3[0-9]{2}$/.test(t):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error(`Invalid status code ${t}`)}}init(){const e={loggerFactory:this.loggerFactory,onRequestTimeout:()=>this.onRequestTimeout(),onStateChange:e=>{e===T.Terminated&&(this.core.userAgentClients.delete(r),t===this._transaction&&this.dispose())},onTransportError:e=>this.onTransportError(e),receiveResponse:e=>this.receiveResponse(e)},t=new this.transactionConstructor(this.message,this.core.transport,e);this._transaction=t;const r=t.id+t.request.method;this.core.userAgentClients.set(r,this)}}class K extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.BYE,r);super(D,e.userAgentCore,n,t),e.dispose()}}class W extends L{constructor(e,t,r){super(e,t,r,T.Trying,"sip.transaction.nist")}dispose(){this.J&&(clearTimeout(this.J),this.J=void 0),super.dispose()}get kind(){return"nist"}receiveRequest(e){switch(this.state){case T.Trying:break;case T.Proceeding:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")}));break;case T.Completed:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of final response.")}));break;case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}}receiveResponse(e,t){if(e<100||e>699)throw new Error(`Invalid status code ${e}`);if(e>100&&e<=199)throw new Error("Provisional response other than 100 not allowed.");switch(this.state){case T.Trying:if(this.lastResponse=t,e>=100&&e<200)return this.stateTransition(T.Proceeding),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send provisional response.")}));if(e>=200&&e<=699)return this.stateTransition(T.Completed),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send final response.")}));break;case T.Proceeding:if(this.lastResponse=t,e>=200&&e<=699)return this.stateTransition(T.Completed),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send final response.")}));break;case T.Completed:return;case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}const r=`Non-INVITE server transaction received unexpected ${e} response from TU while in state ${this.state}.`;throw this.logger.error(r),new Error(r)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(T.Terminated,!0)}typeToString(){return"non-INVITE server transaction"}stateTransition(e,t=!1){const r=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Trying:r();break;case T.Proceeding:this.state!==T.Trying&&r();break;case T.Completed:this.state!==T.Trying&&this.state!==T.Proceeding&&r();break;case T.Terminated:this.state!==T.Proceeding&&this.state!==T.Completed&&(t||r());break;default:r()}e===T.Completed&&(this.J=setTimeout((()=>this.timerJ()),0)),e===T.Terminated&&this.dispose(),this.setState(e)}timerJ(){this.logger.debug(`Timer J expired for NON-INVITE server transaction ${this.id}.`),this.state===T.Completed&&this.stateTransition(T.Terminated)}}class G extends O{constructor(e){super(e||"Transaction state error.")}}class Y{constructor(e,t,r,n){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=n,this.logger=this.loggerFactory.getLogger("sip.user-agent-server"),this.toTag=r.toTag?r.toTag:v(),this.init()}dispose(){this.transaction.dispose()}get loggerFactory(){return this.core.loggerFactory}get transaction(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction}accept(e={statusCode:200}){if(!this.acceptable)throw new G(`${this.message.method} not acceptable in state ${this.transaction.state}.`);const t=e.statusCode;if(t<200||t>299)throw new TypeError(`Invalid statusCode: ${t}`);return this.reply(e)}progress(e={statusCode:180}){if(!this.progressable)throw new G(`${this.message.method} not progressable in state ${this.transaction.state}.`);const t=e.statusCode;if(t<101||t>199)throw new TypeError(`Invalid statusCode: ${t}`);return this.reply(e)}redirect(e,t={statusCode:302}){if(!this.redirectable)throw new G(`${this.message.method} not redirectable in state ${this.transaction.state}.`);const r=t.statusCode;if(r<300||r>399)throw new TypeError(`Invalid statusCode: ${r}`);const n=new Array;return e.forEach((e=>n.push(`Contact: ${e.toString()}`))),t.extraHeaders=(t.extraHeaders||[]).concat(n),this.reply(t)}reject(e={statusCode:480}){if(!this.rejectable)throw new G(`${this.message.method} not rejectable in state ${this.transaction.state}.`);const t=e.statusCode;if(t<400||t>699)throw new TypeError(`Invalid statusCode: ${t}`);return this.reply(e)}trying(e){if(!this.tryingable)throw new G(`${this.message.method} not tryingable in state ${this.transaction.state}.`);return this.reply({statusCode:100})}receiveCancel(e){this.delegate&&this.delegate.onCancel&&this.delegate.onCancel(e)}get acceptable(){if(this.transaction instanceof M)return this.transaction.state===T.Proceeding||this.transaction.state===T.Accepted;if(this.transaction instanceof W)return this.transaction.state===T.Trying||this.transaction.state===T.Proceeding;throw new Error("Unknown transaction type.")}get progressable(){if(this.transaction instanceof M)return this.transaction.state===T.Proceeding;if(this.transaction instanceof W)return!1;throw new Error("Unknown transaction type.")}get redirectable(){if(this.transaction instanceof M)return this.transaction.state===T.Proceeding;if(this.transaction instanceof W)return this.transaction.state===T.Trying||this.transaction.state===T.Proceeding;throw new Error("Unknown transaction type.")}get rejectable(){if(this.transaction instanceof M)return this.transaction.state===T.Proceeding;if(this.transaction instanceof W)return this.transaction.state===T.Trying||this.transaction.state===T.Proceeding;throw new Error("Unknown transaction type.")}get tryingable(){if(this.transaction instanceof M)return this.transaction.state===T.Proceeding;if(this.transaction instanceof W)return this.transaction.state===T.Trying;throw new Error("Unknown transaction type.")}reply(e){e.toTag||100===e.statusCode||(e.toTag=this.toTag),e.userAgent=e.userAgent||this.core.configuration.userAgentHeaderFieldValue,e.supported=e.supported||this.core.configuration.supportedOptionTagsResponse;const t=C(this.message,e);return this.transaction.receiveResponse(e.statusCode,t.message),t}init(){const e={loggerFactory:this.loggerFactory,onStateChange:e=>{e===T.Terminated&&(this.core.userAgentServers.delete(r),this.dispose())},onTransportError:e=>{this.logger.error(e.message),this.delegate&&this.delegate.onTransportError?this.delegate.onTransportError(e):this.logger.error("User agent server response transport error.")}},t=new this.transactionConstructor(this.message,this.core.transport,e);this._transaction=t;const r=t.id;this.core.userAgentServers.set(t.id,this)}}class z extends Y{constructor(e,t,r){super(W,e.userAgentCore,t,r)}}class X extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.INFO,r);super(D,e.userAgentCore,n,t)}}class J extends Y{constructor(e,t,r){super(W,e.userAgentCore,t,r)}}class Z extends q{constructor(e,t,r){super(D,e,t,r)}}class Q extends Y{constructor(e,t,r){super(W,e,t,r)}}class ee extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.NOTIFY,r);super(D,e.userAgentCore,n,t)}}class te extends Y{constructor(e,t,r){const n=void 0!==e.userAgentCore?e.userAgentCore:e;super(W,n,t,r)}}class re extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.PRACK,r);super(D,e.userAgentCore,n,t),e.signalingStateTransition(n)}}class ne extends Y{constructor(e,t,r){super(W,e.userAgentCore,t,r),e.signalingStateTransition(t),this.dialog=e}accept(e={statusCode:200}){return e.body&&this.dialog.signalingStateTransition(e.body),super.accept(e)}}class ie extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.INVITE,r);super(F,e.userAgentCore,n,t),this.delegate=t,e.signalingStateTransition(n),e.reinviteUserAgentClient=this,this.dialog=e}receiveResponse(e){if(!this.authenticationGuard(e,this.dialog))return;const t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:this.dialog,prack:e=>{throw new Error("Unimplemented.")}});break;case/^2[0-9]{2}$/.test(t):this.dialog.signalingStateTransition(e),this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e,session:this.dialog,ack:e=>this.dialog.ack(e)});break;case/^3[0-9]{2}$/.test(t):this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentClient=void 0,this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentClient=void 0,this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error(`Invalid status code ${t}`)}}}class oe extends Y{constructor(e,t,r){super(M,e.userAgentCore,t,r),e.reinviteUserAgentServer=this,this.dialog=e}accept(e={statusCode:200}){e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(this.dialog.routeSet.map((e=>`Record-Route: ${e}`)));const t=super.accept(e),r=this.dialog,n=Object.assign(Object.assign({},t),{session:r});return e.body&&this.dialog.signalingStateTransition(e.body),this.dialog.reConfirm(),n}progress(e={statusCode:180}){const t=super.progress(e),r=this.dialog,n=Object.assign(Object.assign({},t),{session:r});return e.body&&this.dialog.signalingStateTransition(e.body),n}redirect(e,t={statusCode:302}){throw this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentServer=void 0,new Error("Unimplemented.")}reject(e={statusCode:488}){return this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentServer=void 0,super.reject(e)}}class se extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.REFER,r);super(D,e.userAgentCore,n,t)}}class ae extends Y{constructor(e,t,r){const n=void 0!==e.userAgentCore?e.userAgentCore:e;super(W,n,t,r)}}class ce extends k{constructor(e,t,r,n){super(t,r),this.initialTransaction=e,this._signalingState=A.Initial,this.ackWait=!1,this.ackProcessing=!1,this.delegate=n,e instanceof M&&(this.ackWait=!0),this.early||this.start2xxRetransmissionTimer(),this.signalingStateTransition(e.request),this.logger=t.loggerFactory.getLogger("sip.invite-dialog"),this.logger.log(`INVITE dialog ${this.id} constructed`)}dispose(){super.dispose(),this._signalingState=A.Closed,this._offer=void 0,this._answer=void 0,this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.logger.log(`INVITE dialog ${this.id} destroyed`)}get sessionState(){return this.early?R.Early:this.ackWait?R.AckWait:this._signalingState===A.Closed?R.Terminated:R.Confirmed}get signalingState(){return this._signalingState}get offer(){return this._offer}get answer(){return this._answer}confirm(){this.early&&this.start2xxRetransmissionTimer(),super.confirm()}reConfirm(){this.reinviteUserAgentServer&&this.startReInvite2xxRetransmissionTimer()}ack(e={}){let t;if(this.logger.log(`INVITE dialog ${this.id} sending ACK request`),this.reinviteUserAgentClient){if(!(this.reinviteUserAgentClient.transaction instanceof F))throw new Error("Transaction not instance of InviteClientTransaction.");t=this.reinviteUserAgentClient.transaction,this.reinviteUserAgentClient=void 0}else{if(!(this.initialTransaction instanceof F))throw new Error("Initial transaction not instance of InviteClientTransaction.");t=this.initialTransaction}const r=this.createOutgoingRequestMessage(y.ACK,{cseq:t.request.cseq,extraHeaders:e.extraHeaders,body:e.body});return t.ackResponse(r),this.signalingStateTransition(r),{message:r}}bye(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending BYE request`),this.initialTransaction instanceof M){if(this.early)throw new Error("UAS MUST NOT send a BYE on early dialogs.");if(this.ackWait&&this.initialTransaction.state!==T.Terminated)throw new Error("UAS MUST NOT send a BYE on a confirmed dialog until it has received an ACK for its 2xx response or until the server transaction times out.")}return new K(this,e,t)}info(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending INFO request`),this.early)throw new Error("Dialog not confirmed.");return new X(this,e,t)}invite(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending INVITE request`),this.early)throw new Error("Dialog not confirmed.");if(this.reinviteUserAgentClient)throw new Error("There is an ongoing re-INVITE client transaction.");if(this.reinviteUserAgentServer)throw new Error("There is an ongoing re-INVITE server transaction.");return new ie(this,e,t)}message(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending MESSAGE request`),this.early)throw new Error("Dialog not confirmed.");const r=this.createOutgoingRequestMessage(y.MESSAGE,t);return new Z(this.core,r,e)}notify(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending NOTIFY request`),this.early)throw new Error("Dialog not confirmed.");return new ee(this,e,t)}prack(e,t){return this.logger.log(`INVITE dialog ${this.id} sending PRACK request`),new re(this,e,t)}refer(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending REFER request`),this.early)throw new Error("Dialog not confirmed.");return new se(this,e,t)}receiveRequest(e){if(this.logger.log(`INVITE dialog ${this.id} received ${e.method} request`),e.method!==y.ACK)if(this.sequenceGuard(e)){if(super.receiveRequest(e),e.method===y.INVITE){const t=()=>{const e=this.ackWait?"waiting for initial ACK":"processing initial ACK";this.logger.warn(`INVITE dialog ${this.id} received re-INVITE while ${e}`);let t="RFC 5407 suggests the following to avoid this race condition... ";t+=" Note: Implementation issues are outside the scope of this document,",t+=" but the following tip is provided for avoiding race conditions of",t+=" this type.  The caller can delay sending re-INVITE F6 for some period",t+=" of time (2 seconds, perhaps), after which the caller can reasonably",t+=" assume that its ACK has been received.  Implementors can decouple the",t+=" actions of the user (e.g., pressing the hold button) from the actions",t+=" of the protocol (the sending of re-INVITE F6), so that the UA can",t+=" behave like this.  In this case, it is the implementor's choice as to",t+=" how long to wait.  In most cases, such an implementation may be",t+=" useful to prevent the type of race condition shown in this section.",t+=" This document expresses no preference about whether or not they",t+=" should wait for an ACK to be delivered.  After considering the impact",t+=" on user experience, implementors should decide whether or not to wait",t+=" for a while, because the user experience depends on the",t+=" implementation and has no direct bearing on protocol behavior.",this.logger.warn("RFC 5407 suggests the following to avoid this race condition...  Note: Implementation issues are outside the scope of this document, but the following tip is provided for avoiding race conditions of this type.  The caller can delay sending re-INVITE F6 for some period of time (2 seconds, perhaps), after which the caller can reasonably assume that its ACK has been received.  Implementors can decouple the actions of the user (e.g., pressing the hold button) from the actions of the protocol (the sending of re-INVITE F6), so that the UA can behave like this.  In this case, it is the implementor's choice as to how long to wait.  In most cases, such an implementation may be useful to prevent the type of race condition shown in this section. This document expresses no preference about whether or not they should wait for an ACK to be delivered.  After considering the impact on user experience, implementors should decide whether or not to wait for a while, because the user experience depends on the implementation and has no direct bearing on protocol behavior.")},r=[`Retry-After: ${Math.floor(10*Math.random())+1}`];if(this.ackProcessing)return this.core.replyStateless(e,{statusCode:500,extraHeaders:r}),void t();if(this.ackWait&&this.signalingState!==A.Stable)return this.core.replyStateless(e,{statusCode:500,extraHeaders:r}),void t();if(this.reinviteUserAgentServer)return void this.core.replyStateless(e,{statusCode:500,extraHeaders:r});if(this.reinviteUserAgentClient)return void this.core.replyStateless(e,{statusCode:491})}if(e.method===y.INVITE){const t=e.parseHeader("contact");if(!t)throw new Error("Contact undefined.");if(!(t instanceof d))throw new Error("Contact not instance of NameAddrHeader.");this.dialogState.remoteTarget=t.uri}switch(e.method){case y.BYE:{const t=new z(this,e);this.delegate&&this.delegate.onBye?this.delegate.onBye(t):t.accept(),this.dispose()}break;case y.INFO:{const t=new J(this,e);this.delegate&&this.delegate.onInfo?this.delegate.onInfo(t):t.reject({statusCode:469,extraHeaders:["Recv-Info :"]})}break;case y.INVITE:{const t=new oe(this,e);this.signalingStateTransition(e),this.delegate&&this.delegate.onInvite?this.delegate.onInvite(t):t.reject({statusCode:488})}break;case y.MESSAGE:{const t=new Q(this.core,e);this.delegate&&this.delegate.onMessage?this.delegate.onMessage(t):t.accept()}break;case y.NOTIFY:{const t=new te(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(t):t.accept()}break;case y.PRACK:{const t=new ne(this,e);this.delegate&&this.delegate.onPrack?this.delegate.onPrack(t):t.accept()}break;case y.REFER:{const t=new ae(this,e);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(t):t.reject()}break;default:this.logger.log(`INVITE dialog ${this.id} received unimplemented ${e.method} request`),this.core.replyStateless(e,{statusCode:501})}}else this.logger.log(`INVITE dialog ${this.id} rejected out of order ${e.method} request.`);else{if(this.ackWait){if(this.initialTransaction instanceof F)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);if(this.initialTransaction.request.cseq!==e.cseq)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);this.ackWait=!1}else{if(!this.reinviteUserAgentServer)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);if(this.reinviteUserAgentServer.transaction.request.cseq!==e.cseq)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);this.reinviteUserAgentServer=void 0}if(this.signalingStateTransition(e),this.delegate&&this.delegate.onAck){const t=this.delegate.onAck({message:e});t instanceof Promise&&(this.ackProcessing=!0,t.then((()=>this.ackProcessing=!1)).catch((()=>this.ackProcessing=!1)))}}}reliableSequenceGuard(e){const t=e.statusCode;if(!t)throw new Error("Status code undefined");if(t>100&&t<200){const t=e.getHeader("require"),r=e.getHeader("rseq"),n=t&&t.includes("100rel")&&r?Number(r):void 0;if(n){if(this.rseq&&this.rseq+1!==n)return!1;this.rseq=this.rseq?this.rseq+1:n}}return!0}signalingStateRollback(){this._signalingState!==A.HaveLocalOffer&&this.signalingState!==A.HaveRemoteOffer||this._rollbackOffer&&this._rollbackAnswer&&(this._signalingState=A.Stable,this._offer=this._rollbackOffer,this._answer=this._rollbackAnswer)}signalingStateTransition(e){const t=B(e);if(t&&"session"===t.contentDisposition){if(this._signalingState===A.Stable&&(this._rollbackOffer=this._offer,this._rollbackAnswer=this._answer),e instanceof U)switch(this._signalingState){case A.Initial:case A.Stable:this._signalingState=A.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case A.HaveLocalOffer:this._signalingState=A.Stable,this._answer=t;break;case A.HaveRemoteOffer:case A.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof V)switch(this._signalingState){case A.Initial:case A.Stable:this._signalingState=A.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case A.HaveLocalOffer:this._signalingState=A.Stable,this._answer=t;break;case A.HaveRemoteOffer:case A.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof b)switch(this._signalingState){case A.Initial:case A.Stable:this._signalingState=A.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case A.HaveLocalOffer:break;case A.HaveRemoteOffer:this._signalingState=A.Stable,this._answer=t;break;case A.Closed:break;default:throw new Error("Unexpected signaling state.")}if($(e))switch(this._signalingState){case A.Initial:case A.Stable:this._signalingState=A.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case A.HaveLocalOffer:break;case A.HaveRemoteOffer:this._signalingState=A.Stable,this._answer=t;break;case A.Closed:break;default:throw new Error("Unexpected signaling state.")}}}start2xxRetransmissionTimer(){if(this.initialTransaction instanceof M){const e=this.initialTransaction;let t=500;const r=()=>{this.ackWait?(this.logger.log("No ACK for 2xx response received, attempting retransmission"),e.retransmitAcceptedResponse(),t=Math.min(2*t,4e3),this.invite2xxTimer=setTimeout(r,t)):this.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(r,t);const n=()=>{e.state===T.Terminated&&(e.removeStateChangeListener(n),this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.ackWait&&(this.delegate&&this.delegate.onAckTimeout?this.delegate.onAckTimeout():this.bye()))};e.addStateChangeListener(n)}}startReInvite2xxRetransmissionTimer(){if(this.reinviteUserAgentServer&&this.reinviteUserAgentServer.transaction instanceof M){const e=this.reinviteUserAgentServer.transaction;let t=500;const r=()=>{this.reinviteUserAgentServer?(this.logger.log("No ACK for 2xx response received, attempting retransmission"),e.retransmitAcceptedResponse(),t=Math.min(2*t,4e3),this.invite2xxTimer=setTimeout(r,t)):this.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(r,t);const n=()=>{e.state===T.Terminated&&(e.removeStateChangeListener(n),this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.reinviteUserAgentServer)};e.addStateChangeListener(n)}}}class ue extends q{constructor(e,t,r){super(F,e,t,r),this.confirmedDialogAcks=new Map,this.confirmedDialogs=new Map,this.earlyDialogs=new Map,this.delegate=r}dispose(){this.earlyDialogs.forEach((e=>e.dispose())),this.earlyDialogs.clear(),super.dispose()}onTransportError(e){if(this.transaction.state===T.Calling)return super.onTransportError(e);this.logger.error(e.message),this.logger.error("User agent client request transport error while sending ACK.")}receiveResponse(e){if(!this.authenticationGuard(e))return;const t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):return void(this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e}));case/^1[0-9]{2}$/.test(t):{if(!e.toTag)return void this.logger.warn("Non-100 1xx INVITE response received without a to tag, dropping.");if(!e.parseHeader("contact"))return void this.logger.error("Non-100 1xx INVITE response received without a Contact header field, dropping.");const t=k.initialDialogStateForUserAgentClient(this.message,e);let r=this.earlyDialogs.get(t.id);if(!r){const e=this.transaction;if(!(e instanceof F))throw new Error("Transaction not instance of InviteClientTransaction.");r=new ce(e,this.core,t),this.earlyDialogs.set(r.id,r)}if(!r.reliableSequenceGuard(e))return void this.logger.warn("1xx INVITE reliable response received out of order or is a retransmission, dropping.");r.signalingState!==A.Initial&&r.signalingState!==A.HaveLocalOffer||r.signalingStateTransition(e);const n=r;this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:n,prack:e=>n.prack(void 0,e)})}return;case/^2[0-9]{2}$/.test(t):{if(!e.toTag)return void this.logger.error("2xx INVITE response received without a to tag, dropping.");if(!e.parseHeader("contact"))return void this.logger.error("2xx INVITE response received without a Contact header field, dropping.");const t=k.initialDialogStateForUserAgentClient(this.message,e);let r=this.confirmedDialogs.get(t.id);if(r){const e=this.confirmedDialogAcks.get(t.id);if(e){const t=this.transaction;if(!(t instanceof F))throw new Error("Client transaction not instance of InviteClientTransaction.");t.ackResponse(e.message)}return}if(r=this.earlyDialogs.get(t.id),r)r.confirm(),r.recomputeRouteSet(e),this.earlyDialogs.delete(r.id),this.confirmedDialogs.set(r.id,r);else{const e=this.transaction;if(!(e instanceof F))throw new Error("Transaction not instance of InviteClientTransaction.");r=new ce(e,this.core,t),this.confirmedDialogs.set(r.id,r)}r.signalingState!==A.Initial&&r.signalingState!==A.HaveLocalOffer||r.signalingStateTransition(e);const n=r;if(this.delegate&&this.delegate.onAccept)this.delegate.onAccept({message:e,session:n,ack:e=>{const t=n.ack(e);return this.confirmedDialogAcks.set(n.id,t),t}});else{const e=n.ack();this.confirmedDialogAcks.set(n.id,e)}}return;case/^3[0-9]{2}$/.test(t):return this.earlyDialogs.forEach((e=>e.dispose())),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e}));case/^[4-6][0-9]{2}$/.test(t):return this.earlyDialogs.forEach((e=>e.dispose())),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e}));default:throw new Error(`Invalid status code ${t}`)}throw new Error(`Executing what should be an unreachable code path receiving ${t} response.`)}}class de extends q{constructor(e,t,r){super(D,e,t,r)}}class le extends q{constructor(e,t,r){super(D,e,t,r)}}!function(e){e.Initial="Initial",e.NotifyWait="NotifyWait",e.Pending="Pending",e.Active="Active",e.Terminated="Terminated"}(w||(w={}));const he=[y.ACK,y.BYE,y.CANCEL,y.INFO,y.INVITE,y.MESSAGE,y.NOTIFY,y.OPTIONS,y.PRACK,y.REFER,y.REGISTER,y.SUBSCRIBE];class pe extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(y.SUBSCRIBE,r);super(D,e.userAgentCore,n,t),this.dialog=e}waitNotifyStop(){}receiveResponse(e){if(e.statusCode&&e.statusCode>=200&&e.statusCode<300){const t=e.getHeader("Expires");if(t){const e=Number(t);this.dialog.subscriptionExpires>e&&(this.dialog.subscriptionExpires=e)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE")}e.statusCode&&e.statusCode>=400&&e.statusCode<700&&[404,405,410,416,480,481,482,483,484,485,489,501,604].includes(e.statusCode)&&this.dialog.terminate(),super.receiveResponse(e)}}class fe extends k{constructor(e,t,r,n,i,o){super(n,i),this.delegate=o,this._autoRefresh=!1,this._subscriptionEvent=e,this._subscriptionExpires=t,this._subscriptionExpiresInitial=t,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this._subscriptionRefresh=void 0,this._subscriptionRefreshLastSet=void 0,this._subscriptionState=r,this.logger=n.loggerFactory.getLogger("sip.subscribe-dialog"),this.logger.log(`SUBSCRIBE dialog ${this.id} constructed`)}static initialDialogStateForSubscription(e,t){const r=t.getHeaders("record-route"),n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof d))throw new Error("Contact not instance of NameAddrHeader.");const i=n.uri,o=e.cseq,s=e.callId,a=e.fromTag,c=t.fromTag;if(!s)throw new Error("Call id undefined.");if(!a)throw new Error("From tag undefined.");if(!c)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");return{id:s+a+c,early:!1,callId:s,localTag:a,remoteTag:c,localSequenceNumber:o,remoteSequenceNumber:void 0,localURI:e.from.uri,remoteURI:e.to.uri,remoteTarget:i,routeSet:r,secure:!1}}dispose(){super.dispose(),this.N&&(clearTimeout(this.N),this.N=void 0),this.refreshTimerClear(),this.logger.log(`SUBSCRIBE dialog ${this.id} destroyed`)}get autoRefresh(){return this._autoRefresh}set autoRefresh(e){this._autoRefresh=!0,this.refreshTimerSet()}get subscriptionEvent(){return this._subscriptionEvent}get subscriptionExpires(){const e=Math.floor(Date.now()/1e3)-this._subscriptionExpiresLastSet,t=this._subscriptionExpires-e;return Math.max(t,0)}set subscriptionExpires(e){if(e<0)throw new Error("Expires must be greater than or equal to zero.");if(this._subscriptionExpires=e,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this.autoRefresh){const t=this.subscriptionRefresh;(void 0===t||t>=e)&&this.refreshTimerSet()}}get subscriptionExpiresInitial(){return this._subscriptionExpiresInitial}get subscriptionRefresh(){if(void 0===this._subscriptionRefresh||void 0===this._subscriptionRefreshLastSet)return;const e=Math.floor(Date.now()/1e3)-this._subscriptionRefreshLastSet,t=this._subscriptionRefresh-e;return Math.max(t,0)}get subscriptionState(){return this._subscriptionState}receiveRequest(e){this.logger.log(`SUBSCRIBE dialog ${this.id} received ${e.method} request`),this.sequenceGuard(e)?(super.receiveRequest(e),e.method===y.NOTIFY?this.onNotify(e):(this.logger.log(`SUBSCRIBE dialog ${this.id} received unimplemented ${e.method} request`),this.core.replyStateless(e,{statusCode:501}))):this.logger.log(`SUBSCRIBE dialog ${this.id} rejected out of order ${e.method} request.`)}refresh(){const e="Allow: "+he.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: "+this.subscriptionExpiresInitial),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)}subscribe(e,t={}){if(this.subscriptionState!==w.Pending&&this.subscriptionState!==w.Active)throw new Error(`Invalid state ${this.subscriptionState}. May only re-subscribe while in state "pending" or "active".`);this.logger.log(`SUBSCRIBE dialog ${this.id} sending SUBSCRIBE request`);const r=new pe(this,e,t);return this.N&&(clearTimeout(this.N),this.N=void 0),this.N=setTimeout((()=>this.timerN()),32e3),r}terminate(){this.stateTransition(w.Terminated),this.onTerminated()}unsubscribe(){const e="Allow: "+he.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: 0"),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)}onNotify(e){const t=e.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return void this.core.replyStateless(e,{statusCode:489});this.N&&(clearTimeout(this.N),this.N=void 0);const r=e.parseHeader("Subscription-State");if(!r||!r.state)return void this.core.replyStateless(e,{statusCode:489});const n=r.state,i=r.expires?Math.max(r.expires,0):void 0;switch(n){case"pending":this.stateTransition(w.Pending,i);break;case"active":this.stateTransition(w.Active,i);break;case"terminated":this.stateTransition(w.Terminated,i);break;default:this.logger.warn("Unrecognized subscription state.")}const o=new te(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(o):o.accept()}onRefresh(e){this.delegate&&this.delegate.onRefresh&&this.delegate.onRefresh(e)}onTerminated(){this.delegate&&this.delegate.onTerminated&&this.delegate.onTerminated()}refreshTimerClear(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=void 0)}refreshTimerSet(){if(this.refreshTimerClear(),this.autoRefresh&&this.subscriptionExpires>0){const e=900*this.subscriptionExpires;this._subscriptionRefresh=Math.floor(e/1e3),this._subscriptionRefreshLastSet=Math.floor(Date.now()/1e3),this.refreshTimer=setTimeout((()=>{this.refreshTimer=void 0,this._subscriptionRefresh=void 0,this._subscriptionRefreshLastSet=void 0,this.onRefresh(this.refresh())}),e)}}stateTransition(e,t){const r=()=>{this.logger.warn(`Invalid subscription state transition from ${this.subscriptionState} to ${e}`)};switch(e){case w.Initial:case w.NotifyWait:return void r();case w.Pending:if(this.subscriptionState!==w.NotifyWait&&this.subscriptionState!==w.Pending)return void r();break;case w.Active:case w.Terminated:if(this.subscriptionState!==w.NotifyWait&&this.subscriptionState!==w.Pending&&this.subscriptionState!==w.Active)return void r();break;default:return void r()}e===w.Pending&&t&&(this.subscriptionExpires=t),e===w.Active&&t&&(this.subscriptionExpires=t),e===w.Terminated&&this.dispose(),this._subscriptionState=e}timerN(){this.logger.warn("Timer N expired for SUBSCRIBE dialog. Timed out waiting for NOTIFY."),this.subscriptionState!==w.Terminated&&(this.stateTransition(w.Terminated),this.onTerminated())}}class ge extends q{constructor(e,t,r){const n=t.getHeader("Event");if(!n)throw new Error("Event undefined");const i=t.getHeader("Expires");if(!i)throw new Error("Expires undefined");super(D,e,t,r),this.delegate=r,this.subscriberId=t.callId+t.fromTag+n,this.subscriptionExpiresRequested=this.subscriptionExpires=Number(i),this.subscriptionEvent=n,this.subscriptionState=w.NotifyWait,this.waitNotifyStart()}dispose(){super.dispose()}onNotify(e){const t=e.message.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return this.logger.warn("Failed to parse event."),void e.reject({statusCode:489});const r=e.message.parseHeader("Subscription-State");if(!r||!r.state)return this.logger.warn("Failed to parse subscription state."),void e.reject({statusCode:489});const n=r.state;switch(n){case"pending":case"active":case"terminated":break;default:return this.logger.warn(`Invalid subscription state ${n}`),void e.reject({statusCode:489})}if("terminated"!==n&&!e.message.parseHeader("contact"))return this.logger.warn("Failed to parse contact."),void e.reject({statusCode:489});if(this.dialog)throw new Error("Dialog already created. This implementation only supports install of single subscriptions.");switch(this.waitNotifyStop(),this.subscriptionExpires=r.expires?Math.min(this.subscriptionExpires,Math.max(r.expires,0)):this.subscriptionExpires,n){case"pending":this.subscriptionState=w.Pending;break;case"active":this.subscriptionState=w.Active;break;case"terminated":this.subscriptionState=w.Terminated;break;default:throw new Error(`Unrecognized state ${n}.`)}if(this.subscriptionState!==w.Terminated){const t=fe.initialDialogStateForSubscription(this.message,e.message);this.dialog=new fe(this.subscriptionEvent,this.subscriptionExpires,this.subscriptionState,this.core,t)}if(this.delegate&&this.delegate.onNotify){const t=e,r=this.dialog;this.delegate.onNotify({request:t,subscription:r})}else e.accept()}waitNotifyStart(){this.N||(this.core.subscribers.set(this.subscriberId,this),this.N=setTimeout((()=>this.timerN()),32e3))}waitNotifyStop(){this.N&&(this.core.subscribers.delete(this.subscriberId),clearTimeout(this.N),this.N=void 0)}receiveResponse(e){if(this.authenticationGuard(e)){if(e.statusCode&&e.statusCode>=200&&e.statusCode<300){const t=e.getHeader("Expires");if(t){const e=Number(t);e>this.subscriptionExpiresRequested&&this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),e<this.subscriptionExpires&&(this.subscriptionExpires=e)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE");this.dialog&&this.dialog.subscriptionExpires>this.subscriptionExpires&&(this.dialog.subscriptionExpires=this.subscriptionExpires)}e.statusCode&&e.statusCode>=300&&e.statusCode<700&&this.waitNotifyStop(),super.receiveResponse(e)}}timerN(){this.logger.warn("Timer N expired for SUBSCRIBE user agent client. Timed out waiting for NOTIFY."),this.waitNotifyStop(),this.delegate&&this.delegate.onNotifyTimeout&&this.delegate.onNotifyTimeout()}}class ve extends Y{constructor(e,t,r){super(M,e,t,r),this.core=e}dispose(){this.earlyDialog&&this.earlyDialog.dispose(),super.dispose()}accept(e={statusCode:200}){if(!this.acceptable)throw new G(`${this.message.method} not acceptable in state ${this.transaction.state}.`);if(!this.confirmedDialog)if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{const e=this.transaction;if(!(e instanceof M))throw new Error("Transaction not instance of InviteClientTransaction.");const t=k.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new ce(e,this.core,t)}const t=this.message.getHeaders("record-route").map((e=>`Record-Route: ${e}`)),r=`Contact: ${this.core.configuration.contact.toString()}`,n="Allow: "+he.toString();if(!e.body)if(this.confirmedDialog.signalingState===A.Stable)e.body=this.confirmedDialog.answer;else if(this.confirmedDialog.signalingState===A.Initial||this.confirmedDialog.signalingState===A.HaveRemoteOffer)throw new Error("Response must have a body.");e.statusCode=e.statusCode||200,e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(n),e.extraHeaders.push(r);const i=super.accept(e),o=this.confirmedDialog,s=Object.assign(Object.assign({},i),{session:o});return e.body&&this.confirmedDialog.signalingState!==A.Stable&&this.confirmedDialog.signalingStateTransition(e.body),s}progress(e={statusCode:180}){if(!this.progressable)throw new G(`${this.message.method} not progressable in state ${this.transaction.state}.`);if(!this.earlyDialog){const e=this.transaction;if(!(e instanceof M))throw new Error("Transaction not instance of InviteClientTransaction.");const t=k.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new ce(e,this.core,t)}const t=this.message.getHeaders("record-route").map((e=>`Record-Route: ${e}`)),r=`Contact: ${this.core.configuration.contact}`;e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(r);const n=super.progress(e),i=this.earlyDialog,o=Object.assign(Object.assign({},n),{session:i});return e.body&&this.earlyDialog.signalingState!==A.Stable&&this.earlyDialog.signalingStateTransition(e.body),o}redirect(e,t={statusCode:302}){return super.redirect(e,t)}reject(e={statusCode:486}){return super.reject(e)}}class me extends Y{constructor(e,t,r){super(W,e,t,r),this.core=e}}class Se extends Y{constructor(e,t,r){super(W,e,t,r),this.core=e}}const Ee=["application/sdp","application/dtmf-relay"];class _e{constructor(e,t={}){this.userAgentClients=new Map,this.userAgentServers=new Map,this.configuration=e,this.delegate=t,this.dialogs=new Map,this.subscribers=new Map,this.logger=e.loggerFactory.getLogger("sip.user-agent-core")}dispose(){this.reset()}reset(){this.dialogs.forEach((e=>e.dispose())),this.dialogs.clear(),this.subscribers.forEach((e=>e.dispose())),this.subscribers.clear(),this.userAgentClients.forEach((e=>e.dispose())),this.userAgentClients.clear(),this.userAgentServers.forEach((e=>e.dispose())),this.userAgentServers.clear()}get loggerFactory(){return this.configuration.loggerFactory}get transport(){const e=this.configuration.transportAccessor();if(!e)throw new Error("Transport undefined.");return e}invite(e,t){return new ue(this,e,t)}message(e,t){return new Z(this,e,t)}publish(e,t){return new de(this,e,t)}register(e,t){return new le(this,e,t)}subscribe(e,t){return new ge(this,e,t)}request(e,t){return new q(D,this,e,t)}makeOutgoingRequestMessage(e,t,r,n,i,o,s){const a=this.configuration.sipjsId,c=this.configuration.displayName,u=this.configuration.viaForceRport,d=this.configuration.hackViaTcp,l=this.configuration.supportedOptionTags.slice();e===y.REGISTER&&l.push("path","gruu"),e===y.INVITE&&(this.configuration.contact.pubGruu||this.configuration.contact.tempGruu)&&l.push("gruu");const h={callIdPrefix:a,forceRport:u,fromDisplayName:c,hackViaTcp:d,optionTags:l,routeSet:this.configuration.routeSet,userAgentString:this.configuration.userAgentHeaderFieldValue,viaHost:this.configuration.viaHost},p=Object.assign(Object.assign({},h),i);return new b(e,t,r,n,p,o,s)}receiveIncomingRequestFromTransport(e){this.receiveRequestFromTransport(e)}receiveIncomingResponseFromTransport(e){this.receiveResponseFromTransport(e)}replyStateless(e,t){const r=this.configuration.userAgentHeaderFieldValue,n=this.configuration.supportedOptionTagsResponse;t=Object.assign(Object.assign({},t),{userAgent:r,supported:n});const i=C(e,t);return this.transport.send(i.message).catch((t=>{t instanceof Error&&this.logger.error(t.message),this.logger.error(`Transport error occurred sending stateless reply to ${e.method} request.`)})),i}receiveRequestFromTransport(e){const t=e.viaBranch,r=this.userAgentServers.get(t);e.method===y.ACK&&r&&r.transaction.state===T.Accepted&&r instanceof ve?this.logger.warn(`Discarding out of dialog ACK after 2xx response sent on transaction ${t}.`):e.method!==y.CANCEL?r?r.transaction.receiveRequest(e):this.receiveRequest(e):r?(this.replyStateless(e,{statusCode:200}),r.transaction instanceof M&&r.transaction.state===T.Proceeding&&r instanceof ve&&r.receiveCancel(e)):this.replyStateless(e,{statusCode:481})}receiveRequest(e){if(!he.includes(e.method)){const t="Allow: "+he.toString();return void this.replyStateless(e,{statusCode:405,extraHeaders:[t]})}if(!e.ruri)throw new Error("Request-URI undefined.");if("sip"!==e.ruri.scheme)return void this.replyStateless(e,{statusCode:416});const t=e.ruri,r=e=>!!e&&e.user===t.user;if(!r(this.configuration.aor)&&!(r(this.configuration.contact.uri)||r(this.configuration.contact.pubGruu)||r(this.configuration.contact.tempGruu)))return this.logger.warn("Request-URI does not point to us."),void(e.method!==y.ACK&&this.replyStateless(e,{statusCode:404}));if(e.method!==y.INVITE||e.hasHeader("Contact")){if(!e.toTag){const t=e.viaBranch;if(!this.userAgentServers.has(t)&&Array.from(this.userAgentServers.values()).some((t=>t.transaction.request.fromTag===e.fromTag&&t.transaction.request.callId===e.callId&&t.transaction.request.cseq===e.cseq)))return void this.replyStateless(e,{statusCode:482})}e.toTag?this.receiveInsideDialogRequest(e):this.receiveOutsideDialogRequest(e)}else this.replyStateless(e,{statusCode:400,reasonPhrase:"Missing Contact Header"})}receiveInsideDialogRequest(e){if(e.method===y.NOTIFY){const t=e.parseHeader("Event");if(!t||!t.event)return void this.replyStateless(e,{statusCode:489});const r=e.callId+e.toTag+t.event,n=this.subscribers.get(r);if(n){const t=new te(this,e);return void n.onNotify(t)}}const t=e.callId+e.toTag+e.fromTag,r=this.dialogs.get(t);if(r){if(e.method===y.OPTIONS){const t="Allow: "+he.toString(),r="Accept: "+Ee.toString();return void this.replyStateless(e,{statusCode:200,extraHeaders:[t,r]})}r.receiveRequest(e)}else e.method!==y.ACK&&this.replyStateless(e,{statusCode:481})}receiveOutsideDialogRequest(e){switch(e.method){case y.ACK:break;case y.BYE:this.replyStateless(e,{statusCode:481});break;case y.CANCEL:throw new Error(`Unexpected out of dialog request method ${e.method}.`);case y.INFO:this.replyStateless(e,{statusCode:405});break;case y.INVITE:{const t=new ve(this,e);this.delegate.onInvite?this.delegate.onInvite(t):t.reject()}break;case y.MESSAGE:{const t=new Q(this,e);this.delegate.onMessage?this.delegate.onMessage(t):t.accept()}break;case y.NOTIFY:{const t=new te(this,e);this.delegate.onNotify?this.delegate.onNotify(t):t.reject({statusCode:405})}break;case y.OPTIONS:{const t="Allow: "+he.toString(),r="Accept: "+Ee.toString();this.replyStateless(e,{statusCode:200,extraHeaders:[t,r]})}break;case y.REFER:{const t=new ae(this,e);this.delegate.onRefer?this.delegate.onRefer(t):t.reject({statusCode:405})}break;case y.REGISTER:{const t=new me(this,e);this.delegate.onRegister?this.delegate.onRegister(t):t.reject({statusCode:405})}break;case y.SUBSCRIBE:{const t=new Se(this,e);this.delegate.onSubscribe?this.delegate.onSubscribe(t):t.reject({statusCode:480})}break;default:throw new Error(`Unexpected out of dialog request method ${e.method}.`)}}receiveResponseFromTransport(e){if(e.getHeaders("via").length>1)return void this.logger.warn("More than one Via header field present in the response, dropping");const t=e.viaBranch+e.method,r=this.userAgentClients.get(t);r?r.transaction.receiveResponse(e):this.logger.warn(`Discarding unmatched ${e.statusCode} response to ${e.method} ${t}.`)}}var ye,Te,Re,Ae;!function(e){function t(e,t){let r=t,n=0,i=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===n;){if(i=e.indexOf("\r\n",r),-1===i)return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?r=i+2:n=i}return n}function r(e,t,r,n){const i=t.indexOf(":",r),s=t.substring(r,i).trim(),a=t.substring(i+1,n).trim();let c;switch(s.toLowerCase()){case"via":case"v":e.addHeader("via",a),1===e.getHeaders("via").length?(c=e.parseHeader("Via"),c&&(e.via=c,e.viaBranch=c.branch)):c=0;break;case"from":case"f":e.setHeader("from",a),c=e.parseHeader("from"),c&&(e.from=c,e.fromTag=c.getParam("tag"));break;case"to":case"t":e.setHeader("to",a),c=e.parseHeader("to"),c&&(e.to=c,e.toTag=c.getParam("tag"));break;case"record-route":if(c=o.parse(a,"Record_Route"),-1===c){c=void 0;break}if(!(c instanceof Array)){c=void 0;break}c.forEach((t=>{e.addHeader("record-route",a.substring(t.position,t.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=t.parsed}));break;case"call-id":case"i":e.setHeader("call-id",a),c=e.parseHeader("call-id"),c&&(e.callId=a);break;case"contact":case"m":if(c=o.parse(a,"Contact"),-1===c){c=void 0;break}if(!(c instanceof Array)){c=void 0;break}c.forEach((t=>{e.addHeader("contact",a.substring(t.position,t.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=t.parsed}));break;case"content-length":case"l":e.setHeader("content-length",a),c=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",a),c=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",a),c=e.parseHeader("cseq"),c&&(e.cseq=c.value),e instanceof V&&(e.method=c.method);break;case"max-forwards":e.setHeader("max-forwards",a),c=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",a),c=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",a),c=e.parseHeader("proxy-authenticate");break;case"refer-to":case"r":e.setHeader("refer-to",a),c=e.parseHeader("refer-to"),c&&(e.referTo=c);break;default:e.addHeader(s.toLowerCase(),a),c=0}return void 0!==c||{error:"error parsing header '"+s+"'"}}e.getHeader=t,e.parseHeader=r,e.parseMessage=function(e,n){let i=0,s=e.indexOf("\r\n");if(-1===s)return void n.warn("no CRLF found, not a SIP message, discarded");const a=e.substring(0,s),c=o.parse(a,"Request_Response");let u,d;if(-1!==c){for(c.status_code?(u=new V,u.statusCode=c.status_code,u.reasonPhrase=c.reason_phrase):(u=new U,u.method=c.method,u.ruri=c.uri),u.data=e,i=s+2;;){if(s=t(e,i),-2===s){d=i+2;break}if(-1===s)return void n.error("malformed message");if(!0!==r(u,e,i,s))return void n.error(c.error);i=s+2}return u.hasHeader("content-length")?u.body=e.substr(d,Number(u.getHeader("content-length"))):u.body=e.substring(d),u}n.warn('error parsing first line of SIP message: "'+a+'"')}}(ye||(ye={}));class we{constructor(e,t,r){e.debug("SessionDescriptionHandler.constructor"),this.logger=e,this.mediaStreamFactory=t,this.sessionDescriptionHandlerConfiguration=r,this._localMediaStream=new MediaStream,this._remoteMediaStream=new MediaStream,this._peerConnection=new RTCPeerConnection(null==r?void 0:r.peerConnectionConfiguration),this.initPeerConnectionEventHandlers()}get localMediaStream(){return this._localMediaStream}get remoteMediaStream(){return this._remoteMediaStream}get dataChannel(){return this._dataChannel}get peerConnection(){return this._peerConnection}get peerConnectionDelegate(){return this._peerConnectionDelegate}set peerConnectionDelegate(e){this._peerConnectionDelegate=e}static dispatchAddTrackEvent(e,t){e.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:t}))}static dispatchRemoveTrackEvent(e,t){e.dispatchEvent(new MediaStreamTrackEvent("removetrack",{track:t}))}close(){this.logger.debug("SessionDescriptionHandler.close"),void 0!==this._peerConnection&&(this._peerConnection.getReceivers().forEach((e=>{e.track&&e.track.stop()})),this._peerConnection.getSenders().forEach((e=>{e.track&&e.track.stop()})),this._dataChannel&&this._dataChannel.close(),this._peerConnection.close(),this._peerConnection=void 0)}getDescription(e,t){var r,n;if(this.logger.debug("SessionDescriptionHandler.getDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));this.onDataChannel=null==e?void 0:e.onDataChannel;const i=null===(r=null==e?void 0:e.offerOptions)||void 0===r?void 0:r.iceRestart,o=void 0===(null==e?void 0:e.iceGatheringTimeout)?null===(n=this.sessionDescriptionHandlerConfiguration)||void 0===n?void 0:n.iceGatheringTimeout:null==e?void 0:e.iceGatheringTimeout;return this.getLocalMediaStream(e).then((()=>this.createDataChannel(e))).then((()=>this.createLocalOfferOrAnswer(e))).then((e=>this.applyModifiers(e,t))).then((e=>this.setLocalSessionDescription(e))).then((()=>this.waitForIceGatheringComplete(i,o))).then((()=>this.getLocalSessionDescription())).then((e=>({body:e.sdp,contentType:"application/sdp"}))).catch((e=>{throw this.logger.error("SessionDescriptionHandler.getDescription failed - "+e),e}))}hasDescription(e){return this.logger.debug("SessionDescriptionHandler.hasDescription"),"application/sdp"===e}sendDtmf(e,t){if(this.logger.debug("SessionDescriptionHandler.sendDtmf"),void 0===this._peerConnection)return this.logger.error("SessionDescriptionHandler.sendDtmf failed - peer connection closed"),!1;const r=this._peerConnection.getSenders();if(0===r.length)return this.logger.error("SessionDescriptionHandler.sendDtmf failed - no senders"),!1;const n=r[0].dtmf;if(!n)return this.logger.error("SessionDescriptionHandler.sendDtmf failed - no DTMF sender"),!1;const i=null==t?void 0:t.duration,o=null==t?void 0:t.interToneGap;try{n.insertDTMF(e,i,o)}catch(e){return this.logger.error(e),!1}return this.logger.log("SessionDescriptionHandler.sendDtmf sent via RTP: "+e.toString()),!0}setDescription(e,t,r){if(this.logger.debug("SessionDescriptionHandler.setDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));this.onDataChannel=null==t?void 0:t.onDataChannel;const n="have-local-offer"===this._peerConnection.signalingState?"answer":"offer";return this.getLocalMediaStream(t).then((()=>this.applyModifiers({sdp:e,type:n},r))).then((e=>this.setRemoteSessionDescription(e))).catch((e=>{throw this.logger.error("SessionDescriptionHandler.setDescription failed - "+e),e}))}applyModifiers(e,t){return this.logger.debug("SessionDescriptionHandler.applyModifiers"),t&&0!==t.length?t.reduce(((e,t)=>e.then(t)),Promise.resolve(e)).then((e=>{if(this.logger.debug("SessionDescriptionHandler.applyModifiers - modified sdp"),!e.sdp||!e.type)throw new Error("Invalid SDP.");return{sdp:e.sdp,type:e.type}})):Promise.resolve(e)}createDataChannel(e){if(void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));if(!0!==(null==e?void 0:e.dataChannel))return Promise.resolve();if(this._dataChannel)return Promise.resolve();switch(this._peerConnection.signalingState){case"stable":this.logger.debug("SessionDescriptionHandler.createDataChannel - creating data channel");try{return this._dataChannel=this._peerConnection.createDataChannel((null==e?void 0:e.dataChannelLabel)||"",null==e?void 0:e.dataChannelOptions),this.onDataChannel&&this.onDataChannel(this._dataChannel),Promise.resolve()}catch(e){return Promise.reject(e)}case"have-remote-offer":return Promise.resolve();default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}}createLocalOfferOrAnswer(e){if(void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));switch(this._peerConnection.signalingState){case"stable":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP offer"),this._peerConnection.createOffer(null==e?void 0:e.offerOptions);case"have-remote-offer":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP answer"),this._peerConnection.createAnswer(null==e?void 0:e.answerOptions);default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}}getLocalMediaStream(e){if(this.logger.debug("SessionDescriptionHandler.getLocalMediaStream"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));let t=Object.assign({},null==e?void 0:e.constraints);if(this.localMediaStreamConstraints){if(t.audio=t.audio||this.localMediaStreamConstraints.audio,t.video=t.video||this.localMediaStreamConstraints.video,JSON.stringify(this.localMediaStreamConstraints.audio)===JSON.stringify(t.audio)&&JSON.stringify(this.localMediaStreamConstraints.video)===JSON.stringify(t.video))return Promise.resolve()}else void 0===t.audio&&void 0===t.video&&(t={audio:!0});return this.localMediaStreamConstraints=t,this.mediaStreamFactory(t,this).then((e=>this.setLocalMediaStream(e)))}setLocalMediaStream(e){if(this.logger.debug("SessionDescriptionHandler.setLocalMediaStream"),!this._peerConnection)throw new Error("Peer connection undefined.");const t=this._peerConnection,r=this._localMediaStream,n=[],i=e=>{const i=e.kind;if("audio"!==i&&"video"!==i)throw new Error(`Unknown new track kind ${i}.`);const o=t.getSenders().find((e=>e.track&&e.track.kind===i));o?n.push(new Promise((e=>{this.logger.debug(`SessionDescriptionHandler.setLocalMediaStream - replacing sender ${i} track`),e()})).then((()=>o.replaceTrack(e).then((()=>{const t=r.getTracks().find((e=>e.kind===i));t&&(t.stop(),r.removeTrack(t),we.dispatchRemoveTrackEvent(r,t)),r.addTrack(e),we.dispatchAddTrackEvent(r,e)})).catch((e=>{throw this.logger.error(`SessionDescriptionHandler.setLocalMediaStream - failed to replace sender ${i} track`),e}))))):n.push(new Promise((e=>{this.logger.debug(`SessionDescriptionHandler.setLocalMediaStream - adding sender ${i} track`),e()})).then((()=>{try{t.addTrack(e,r)}catch(e){throw this.logger.error(`SessionDescriptionHandler.setLocalMediaStream - failed to add sender ${i} track`),e}r.addTrack(e),we.dispatchAddTrackEvent(r,e)})))},o=e.getAudioTracks();o.length&&i(o[0]);const s=e.getVideoTracks();return s.length&&i(s[0]),n.reduce(((e,t)=>e.then((()=>t))),Promise.resolve())}getLocalSessionDescription(){if(this.logger.debug("SessionDescriptionHandler.getLocalSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));const e=this._peerConnection.localDescription;return e?Promise.resolve(e):Promise.reject(new Error("Failed to get local session description"))}setLocalSessionDescription(e){return this.logger.debug("SessionDescriptionHandler.setLocalSessionDescription"),void 0===this._peerConnection?Promise.reject(new Error("Peer connection closed.")):this._peerConnection.setLocalDescription(e)}setRemoteSessionDescription(e){if(this.logger.debug("SessionDescriptionHandler.setRemoteSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));const t=e.sdp;let r;switch(this._peerConnection.signalingState){case"stable":r="offer";break;case"have-local-offer":r="answer";break;default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}return t?this._peerConnection.setRemoteDescription({sdp:t,type:r}):(this.logger.error("SessionDescriptionHandler.setRemoteSessionDescription failed - cannot set null sdp"),Promise.reject(new Error("SDP is undefined")))}setRemoteTrack(e){this.logger.debug("SessionDescriptionHandler.setRemoteTrack");const t=this._remoteMediaStream;t.getTrackById(e.id)?this.logger.debug(`SessionDescriptionHandler.setRemoteTrack - have remote ${e.kind} track`):"audio"===e.kind?(this.logger.debug(`SessionDescriptionHandler.setRemoteTrack - adding remote ${e.kind} track`),t.getAudioTracks().forEach((e=>{e.stop(),t.removeTrack(e),we.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),we.dispatchAddTrackEvent(t,e)):"video"===e.kind&&(this.logger.debug(`SessionDescriptionHandler.setRemoteTrack - adding remote ${e.kind} track`),t.getVideoTracks().forEach((e=>{e.stop(),t.removeTrack(e),we.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),we.dispatchAddTrackEvent(t,e))}iceGatheringComplete(){this.logger.debug("SessionDescriptionHandler.iceGatheringComplete"),void 0!==this.iceGatheringCompleteTimeoutId&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - clearing timeout"),clearTimeout(this.iceGatheringCompleteTimeoutId),this.iceGatheringCompleteTimeoutId=void 0),void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - resolving promise"),this.iceGatheringCompleteResolve&&this.iceGatheringCompleteResolve(),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0)}waitForIceGatheringComplete(e=!1,t=0){return this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete"),void 0===this._peerConnection?Promise.reject("Peer connection closed."):e||"complete"!==this._peerConnection.iceGatheringState?(void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - rejecting prior waiting promise"),this.iceGatheringCompleteReject&&this.iceGatheringCompleteReject(new Error("Promise superseded.")),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0),this.iceGatheringCompletePromise=new Promise(((e,r)=>{this.iceGatheringCompleteResolve=e,this.iceGatheringCompleteReject=r,t>0&&(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - timeout in "+t),this.iceGatheringCompleteTimeoutId=setTimeout((()=>{this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - timeout"),this.iceGatheringComplete()}),t))})),this.iceGatheringCompletePromise):(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - already complete"),Promise.resolve())}initPeerConnectionEventHandlers(){if(this.logger.debug("SessionDescriptionHandler.initPeerConnectionEventHandlers"),!this._peerConnection)throw new Error("Peer connection undefined.");const e=this._peerConnection;e.onconnectionstatechange=t=>{var r;const n=e.connectionState;this.logger.debug(`SessionDescriptionHandler.onconnectionstatechange ${n}`),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.onconnectionstatechange)&&this._peerConnectionDelegate.onconnectionstatechange(t)},e.ondatachannel=e=>{var t;this.logger.debug("SessionDescriptionHandler.ondatachannel"),this._dataChannel=e.channel,this.onDataChannel&&this.onDataChannel(this._dataChannel),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.ondatachannel)&&this._peerConnectionDelegate.ondatachannel(e)},e.onicecandidate=e=>{var t;this.logger.debug("SessionDescriptionHandler.onicecandidate"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onicecandidate)&&this._peerConnectionDelegate.onicecandidate(e)},e.onicecandidateerror=e=>{var t;this.logger.debug("SessionDescriptionHandler.onicecandidateerror"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onicecandidateerror)&&this._peerConnectionDelegate.onicecandidateerror(e)},e.oniceconnectionstatechange=t=>{var r;const n=e.iceConnectionState;this.logger.debug(`SessionDescriptionHandler.oniceconnectionstatechange ${n}`),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.oniceconnectionstatechange)&&this._peerConnectionDelegate.oniceconnectionstatechange(t)},e.onicegatheringstatechange=t=>{var r;const n=e.iceGatheringState;this.logger.debug(`SessionDescriptionHandler.onicegatheringstatechange ${n}`),"complete"===n&&this.iceGatheringComplete(),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.onicegatheringstatechange)&&this._peerConnectionDelegate.onicegatheringstatechange(t)},e.onnegotiationneeded=e=>{var t;this.logger.debug("SessionDescriptionHandler.onnegotiationneeded"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onnegotiationneeded)&&this._peerConnectionDelegate.onnegotiationneeded(e)},e.onsignalingstatechange=t=>{var r;const n=e.signalingState;this.logger.debug(`SessionDescriptionHandler.onsignalingstatechange ${n}`),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.onsignalingstatechange)&&this._peerConnectionDelegate.onsignalingstatechange(t)},e.onstatsended=e=>{var t;this.logger.debug("SessionDescriptionHandler.onstatsended"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onstatsended)&&this._peerConnectionDelegate.onstatsended(e)},e.ontrack=e=>{var t;const r=e.track.kind,n=e.track.enabled?"enabled":"disabled";this.logger.debug(`SessionDescriptionHandler.ontrack ${r} ${n}`),this.setRemoteTrack(e.track),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.ontrack)&&this._peerConnectionDelegate.ontrack(e)}}}class be{constructor(){this.listeners=new Array}addListener(e,t){const r=t=>{this.removeListener(r),e(t)};!0===(null==t?void 0:t.once)?this.listeners.push(r):this.listeners.push(e)}emit(e){this.listeners.slice().forEach((t=>t(e)))}removeAllListeners(){this.listeners=[]}removeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}on(e){return this.addListener(e)}off(e){return this.removeListener(e)}once(e){return this.addListener(e,{once:!0})}}class Ce extends O{constructor(e){super(e||"An error occurred during state transition.")}}!function(e){e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Disconnected="Disconnected"}(Te||(Te={}));class Oe{constructor(e,t){if(this._state=Te.Disconnected,this.transitioningState=!1,this._stateEventEmitter=new be,this.logger=e,t){const e=t,r=null==e?void 0:e.wsServers,n=null==e?void 0:e.maxReconnectionAttempts;if(void 0!==r){const e='The transport option "wsServers" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}if(void 0!==n){const e='The transport option "maxReconnectionAttempts" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}r&&!t.server&&("string"==typeof r&&(t.server=r),r instanceof Array&&(t.server=r[0]))}this.configuration=Object.assign(Object.assign({},Oe.defaultOptions),t);const r=this.configuration.server,n=o.parse(r,"absoluteURI");if(-1===n)throw this.logger.error(`Invalid WebSocket Server URL "${r}"`),new Error("Invalid WebSocket Server URL");if(!["wss","ws","udp"].includes(n.scheme))throw this.logger.error(`Invalid scheme in WebSocket Server URL "${r}"`),new Error("Invalid scheme in WebSocket Server URL");this._protocol=n.scheme.toUpperCase()}dispose(){return this.disconnect()}get protocol(){return this._protocol}get server(){return this.configuration.server}get state(){return this._state}get stateChange(){return this._stateEventEmitter}get ws(){return this._ws}connect(){return this._connect()}disconnect(){return this._disconnect()}isConnected(){return this.state===Te.Connected}send(e){return this._send(e)}_connect(){switch(this.logger.log(`Connecting ${this.server}`),this.state){case Te.Connecting:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Connecting));if(!this.connectPromise)throw new Error("Connect promise must be defined.");return this.connectPromise;case Te.Connected:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Connecting));if(this.connectPromise)throw new Error("Connect promise must not be defined.");return Promise.resolve();case Te.Disconnecting:if(this.connectPromise)throw new Error("Connect promise must not be defined.");try{this.transitionState(Te.Connecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;case Te.Disconnected:if(this.connectPromise)throw new Error("Connect promise must not be defined.");try{this.transitionState(Te.Connecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;default:throw new Error("Unknown state")}let e;try{e=new WebSocket(this.server,"sip"),e.binaryType="arraybuffer",e.addEventListener("close",(t=>this.onWebSocketClose(t,e))),e.addEventListener("error",(t=>this.onWebSocketError(t,e))),e.addEventListener("open",(t=>this.onWebSocketOpen(t,e))),e.addEventListener("message",(t=>this.onWebSocketMessage(t,e))),this._ws=e}catch(e){return this._ws=void 0,this.logger.error("WebSocket construction failed."),this.logger.error(e),new Promise(((t,r)=>{this.connectResolve=t,this.connectReject=r,this.transitionState(Te.Disconnected,e)}))}return this.connectPromise=new Promise(((t,r)=>{this.connectResolve=t,this.connectReject=r,this.connectTimeout=setTimeout((()=>{this.logger.warn("Connect timed out. Exceeded time set in configuration.connectionTimeout: "+this.configuration.connectionTimeout+"s."),e.close(1e3)}),1e3*this.configuration.connectionTimeout)})),this.connectPromise}_disconnect(){switch(this.logger.log(`Disconnecting ${this.server}`),this.state){case Te.Connecting:if(this.disconnectPromise)throw new Error("Disconnect promise must not be defined.");try{this.transitionState(Te.Disconnecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;case Te.Connected:if(this.disconnectPromise)throw new Error("Disconnect promise must not be defined.");try{this.transitionState(Te.Disconnecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;case Te.Disconnecting:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Disconnecting));if(!this.disconnectPromise)throw new Error("Disconnect promise must be defined.");return this.disconnectPromise;case Te.Disconnected:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Disconnecting));if(this.disconnectPromise)throw new Error("Disconnect promise must not be defined.");return Promise.resolve();default:throw new Error("Unknown state")}if(!this._ws)throw new Error("WebSocket must be defined.");const e=this._ws;return this.disconnectPromise=new Promise(((t,r)=>{this.disconnectResolve=t,this.disconnectReject=r;try{e.close(1e3)}catch(e){throw this.logger.error("WebSocket close failed."),this.logger.error(e),e}})),this.disconnectPromise}_send(e){if(!0===this.configuration.traceSip&&this.logger.log("Sending WebSocket message:\n\n"+e+"\n"),this._state!==Te.Connected)return Promise.reject(new Error("Not connected."));if(!this._ws)throw new Error("WebSocket undefined.");try{this._ws.send(e)}catch(e){return e instanceof Error?Promise.reject(e):Promise.reject(new Error("WebSocket send failed."))}return Promise.resolve()}onWebSocketClose(e,t){if(t!==this._ws)return;const r=`WebSocket closed ${this.server} (code: ${e.code})`,n=this.disconnectPromise?void 0:new Error(r);n&&this.logger.warn("WebSocket closed unexpectedly"),this.logger.log(r),this._ws=void 0,this.transitionState(Te.Disconnected,n)}onWebSocketError(e,t){t===this._ws&&this.logger.error("WebSocket error occurred.")}onWebSocketMessage(e,t){if(t!==this._ws)return;const r=e.data;let n;if(/^(\r\n)+$/.test(r))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("Received WebSocket message with CRLF Keep Alive response"));if(r){if("string"!=typeof r){try{n=(new TextDecoder).decode(new Uint8Array(r))}catch(e){return this.logger.error(e),void this.logger.error("Received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("Received WebSocket binary message:\n\n"+n+"\n")}else n=r,!0===this.configuration.traceSip&&this.logger.log("Received WebSocket text message:\n\n"+n+"\n");if(this.state===Te.Connected){if(this.onMessage)try{this.onMessage(n)}catch(e){throw this.logger.error(e),this.logger.error("Exception thrown by onMessage callback"),e}}else this.logger.warn("Received message while not connected, discarding...")}else this.logger.warn("Received empty message, discarding...")}onWebSocketOpen(e,t){t===this._ws&&this._state===Te.Connecting&&(this.logger.log(`WebSocket opened ${this.server}`),this.transitionState(Te.Connected))}transitionLoopDetectedError(e){let t="A state transition loop has been detected.";return t+=` An attempt to transition from ${this._state} to ${e} before the prior transition completed.`,t+=" Perhaps you are synchronously calling connect() or disconnect() from a callback or state change handler?",this.logger.error(t),new Ce("Loop detected.")}transitionState(e,t){const r=()=>{throw new Error(`Invalid state transition from ${this._state} to ${e}`)};if(this.transitioningState)throw this.transitionLoopDetectedError(e);switch(this.transitioningState=!0,this._state){case Te.Connecting:e!==Te.Connected&&e!==Te.Disconnecting&&e!==Te.Disconnected&&r();break;case Te.Connected:e!==Te.Disconnecting&&e!==Te.Disconnected&&r();break;case Te.Disconnecting:e!==Te.Connecting&&e!==Te.Disconnected&&r();break;case Te.Disconnected:e!==Te.Connecting&&r();break;default:throw new Error("Unknown state.")}const n=this._state;this._state=e;const i=this.connectResolve,o=this.connectReject;n===Te.Connecting&&(this.connectPromise=void 0,this.connectResolve=void 0,this.connectReject=void 0);const s=this.disconnectResolve,a=this.disconnectReject;if(n===Te.Disconnecting&&(this.disconnectPromise=void 0,this.disconnectResolve=void 0,this.disconnectReject=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.logger.log(`Transitioned from ${n} to ${this._state}`),this._stateEventEmitter.emit(this._state),e===Te.Connected&&(this.startSendingKeepAlives(),this.onConnect))try{this.onConnect()}catch(e){throw this.logger.error(e),this.logger.error("Exception thrown by onConnect callback"),e}if(n===Te.Connected&&(this.stopSendingKeepAlives(),this.onDisconnect))try{t?this.onDisconnect(t):this.onDisconnect()}catch(e){throw this.logger.error(e),this.logger.error("Exception thrown by onDisconnect callback"),e}if(n===Te.Connecting){if(!i)throw new Error("Connect resolve undefined.");if(!o)throw new Error("Connect reject undefined.");e===Te.Connected?i():o(t||new Error("Connect aborted."))}if(n===Te.Disconnecting){if(!s)throw new Error("Disconnect resolve undefined.");if(!a)throw new Error("Disconnect reject undefined.");e===Te.Disconnected?s():a(t||new Error("Disconnect aborted."))}this.transitioningState=!1}clearKeepAliveTimeout(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0}sendKeepAlive(){return this.keepAliveDebounceTimeout?Promise.resolve():(this.keepAliveDebounceTimeout=setTimeout((()=>{this.clearKeepAliveTimeout()}),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n"))}startSendingKeepAlives(){this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval((()=>{this.sendKeepAlive(),this.startSendingKeepAlives()}),(e=>{const t=.8*e;return 1e3*(Math.random()*(e-t)+t)})(this.configuration.keepAliveInterval)))}stopSendingKeepAlives(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0}}Oe.defaultOptions={server:"",connectionTimeout:5,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!0};class Ie extends O{constructor(e){super(e||"Unsupported content type.")}}class Pe extends O{constructor(e){super(e||"Unspecified session description handler error.")}}class Ne extends O{constructor(){super("The session has terminated.")}}class De{constructor(e){this.incomingByeRequest=e}get request(){return this.incomingByeRequest.message}accept(e){return this.incomingByeRequest.accept(e),Promise.resolve()}reject(e){return this.incomingByeRequest.reject(e),Promise.resolve()}}class Le extends O{constructor(e){super(e||"Request pending.")}}class Me{constructor(e){this.incomingInfoRequest=e}get request(){return this.incomingInfoRequest.message}accept(e){return this.incomingInfoRequest.accept(e),Promise.resolve()}reject(e){return this.incomingInfoRequest.reject(e),Promise.resolve()}}class ke{constructor(e){this.incomingMessageRequest=e}get request(){return this.incomingMessageRequest.message}accept(e){return this.incomingMessageRequest.accept(e),Promise.resolve()}reject(e){return this.incomingMessageRequest.reject(e),Promise.resolve()}}class xe{constructor(e){this.incomingNotifyRequest=e}get request(){return this.incomingNotifyRequest.message}accept(e){return this.incomingNotifyRequest.accept(e),Promise.resolve()}reject(e){return this.incomingNotifyRequest.reject(e),Promise.resolve()}}class Ue{constructor(e,t){this.incomingReferRequest=e,this.session=t}get referTo(){const e=this.incomingReferRequest.message.parseHeader("refer-to");if(!(e instanceof d))throw new Error("Failed to parse Refer-To header.");return e}get referredBy(){return this.incomingReferRequest.message.getHeader("referred-by")}get replaces(){return this.referTo.uri.getHeader("replaces")}get request(){return this.incomingReferRequest.message}accept(e={statusCode:202}){return this.incomingReferRequest.accept(e),Promise.resolve()}reject(e){return this.incomingReferRequest.reject(e),Promise.resolve()}makeInviter(e){if(this.inviter)return this.inviter;const t=this.referTo.uri.clone();t.clearHeaders();const r=((e=e||{}).extraHeaders||[]).slice(),n=this.replaces;n&&r.push("Replaces: "+decodeURIComponent(n));const i=this.referredBy;return i&&r.push("Referred-By: "+i),e.extraHeaders=r,this.inviter=this.session.userAgent._makeInviter(t,e),this.inviter._referred=this.session,this.session._referral=this.inviter,this.inviter}}!function(e){e.Initial="Initial",e.Establishing="Establishing",e.Established="Established",e.Terminating="Terminating",e.Terminated="Terminated"}(Re||(Re={}));class Ve{constructor(e,t={}){this.pendingReinvite=!1,this.pendingReinviteAck=!1,this._state=Re.Initial,this.delegate=t.delegate,this._stateEventEmitter=new be,this._userAgent=e}dispose(){switch(this.logger.log(`Session ${this.id} in state ${this._state} is being disposed`),delete this.userAgent._sessions[this.id],this._sessionDescriptionHandler&&this._sessionDescriptionHandler.close(),this.state){case Re.Initial:case Re.Establishing:break;case Re.Established:return new Promise((e=>{this._bye({onAccept:()=>e(),onRedirect:()=>e(),onReject:()=>e()})}));case Re.Terminating:case Re.Terminated:break;default:throw new Error("Unknown state.")}return Promise.resolve()}get assertedIdentity(){return this._assertedIdentity}get dialog(){return this._dialog}get id(){return this._id}get replacee(){return this._replacee}get sessionDescriptionHandler(){return this._sessionDescriptionHandler}get sessionDescriptionHandlerFactory(){return this.userAgent.configuration.sessionDescriptionHandlerFactory}get sessionDescriptionHandlerModifiers(){return this._sessionDescriptionHandlerModifiers||[]}set sessionDescriptionHandlerModifiers(e){this._sessionDescriptionHandlerModifiers=e.slice()}get sessionDescriptionHandlerOptions(){return this._sessionDescriptionHandlerOptions||{}}set sessionDescriptionHandlerOptions(e){this._sessionDescriptionHandlerOptions=Object.assign({},e)}get sessionDescriptionHandlerModifiersReInvite(){return this._sessionDescriptionHandlerModifiersReInvite||[]}set sessionDescriptionHandlerModifiersReInvite(e){this._sessionDescriptionHandlerModifiersReInvite=e.slice()}get sessionDescriptionHandlerOptionsReInvite(){return this._sessionDescriptionHandlerOptionsReInvite||{}}set sessionDescriptionHandlerOptionsReInvite(e){this._sessionDescriptionHandlerOptionsReInvite=Object.assign({},e)}get state(){return this._state}get stateChange(){return this._stateEventEmitter}get userAgent(){return this._userAgent}bye(e={}){let t="Session.bye() may only be called if established session.";switch(this.state){case Re.Initial:"function"==typeof this.cancel?(t+=" However Inviter.invite() has not yet been called.",t+=" Perhaps you should have called Inviter.cancel()?"):"function"==typeof this.reject&&(t+=" However Invitation.accept() has not yet been called.",t+=" Perhaps you should have called Invitation.reject()?");break;case Re.Establishing:"function"==typeof this.cancel?(t+=" However a dialog does not yet exist.",t+=" Perhaps you should have called Inviter.cancel()?"):"function"==typeof this.reject&&(t+=" However Invitation.accept() has not yet been called (or not yet resolved).",t+=" Perhaps you should have called Invitation.reject()?");break;case Re.Established:{const t=e.requestDelegate,r=this.copyRequestOptions(e.requestOptions);return this._bye(t,r)}case Re.Terminating:t+=" However this session is already terminating.","function"==typeof this.cancel?t+=" Perhaps you have already called Inviter.cancel()?":"function"==typeof this.reject&&(t+=" Perhaps you have already called Session.bye()?");break;case Re.Terminated:t+=" However this session is already terminated.";break;default:throw new Error("Unknown state")}return this.logger.error(t),Promise.reject(new Error(`Invalid session state ${this.state}`))}info(e={}){if(this.state!==Re.Established){const e="Session.info() may only be called if established session.";return this.logger.error(e),Promise.reject(new Error(`Invalid session state ${this.state}`))}const t=e.requestDelegate,r=this.copyRequestOptions(e.requestOptions);return this._info(t,r)}invite(e={}){if(this.logger.log("Session.invite"),this.state!==Re.Established)return Promise.reject(new Error(`Invalid session state ${this.state}`));if(this.pendingReinvite)return Promise.reject(new Le("Reinvite in progress. Please wait until complete, then try again."));this.pendingReinvite=!0,e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiersReInvite=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptionsReInvite=e.sessionDescriptionHandlerOptions);const t={onAccept:t=>{const r=B(t.message);if(!r)return this.logger.error("Received 2xx response to re-INVITE without a session description"),this.ackAndBye(t,400,"Missing session description"),this.stateTransition(Re.Terminated),void(this.pendingReinvite=!1);if(e.withoutSdp){const n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};this.setOfferAndGetAnswer(r,n).then((e=>{t.ack({body:e})})).catch((e=>{this.logger.error("Failed to handle offer in 2xx response to re-INVITE"),this.logger.error(e.message),this.state===Re.Terminated?t.ack():(this.ackAndBye(t,488,"Bad Media Description"),this.stateTransition(Re.Terminated))})).then((()=>{this.pendingReinvite=!1,e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(t)}))}else{const n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};this.setAnswer(r,n).then((()=>{t.ack()})).catch((e=>{this.logger.error("Failed to handle answer in 2xx response to re-INVITE"),this.logger.error(e.message),this.state!==Re.Terminated?(this.ackAndBye(t,488,"Bad Media Description"),this.stateTransition(Re.Terminated)):t.ack()})).then((()=>{this.pendingReinvite=!1,e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(t)}))}},onProgress:e=>{},onRedirect:e=>{},onReject:t=>{this.logger.warn("Received a non-2xx response to re-INVITE"),this.pendingReinvite=!1,e.withoutSdp?e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(t):this.rollbackOffer().catch((e=>{if(this.logger.error("Failed to rollback offer on non-2xx response to re-INVITE"),this.logger.error(e.message),this.state!==Re.Terminated){if(!this.dialog)throw new Error("Dialog undefined.");const e=[];e.push("Reason: "+this.getReasonHeaderValue(500,"Internal Server Error")),this.dialog.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated)}})).then((()=>{e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(t)}))},onTrying:e=>{}},r=e.requestOptions||{};if(r.extraHeaders=(r.extraHeaders||[]).slice(),r.extraHeaders.push("Allow: "+he.toString()),r.extraHeaders.push("Contact: "+this._contact),e.withoutSdp){if(!this.dialog)throw this.pendingReinvite=!1,new Error("Dialog undefined.");return Promise.resolve(this.dialog.invite(t,r))}const n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};return this.getOffer(n).then((e=>{if(!this.dialog)throw this.pendingReinvite=!1,new Error("Dialog undefined.");return r.body=e,this.dialog.invite(t,r)})).catch((e=>{throw this.logger.error(e.message),this.logger.error("Failed to send re-INVITE"),this.pendingReinvite=!1,e}))}message(e={}){if(this.state!==Re.Established){const e="Session.message() may only be called if established session.";return this.logger.error(e),Promise.reject(new Error(`Invalid session state ${this.state}`))}const t=e.requestDelegate,r=this.copyRequestOptions(e.requestOptions);return this._message(t,r)}refer(e,t={}){if(this.state!==Re.Established){const e="Session.refer() may only be called if established session.";return this.logger.error(e),Promise.reject(new Error(`Invalid session state ${this.state}`))}const r=t.requestDelegate,n=this.copyRequestOptions(t.requestOptions);return n.extraHeaders=n.extraHeaders?n.extraHeaders.concat(this.referExtraHeaders(this.referToString(e))):this.referExtraHeaders(this.referToString(e)),this._refer(t.onNotify,r,n)}_bye(e,t){if(!this.dialog)return Promise.reject(new Error("Session dialog undefined."));const r=this.dialog;switch(r.sessionState){case R.Initial:case R.Early:throw new Error(`Invalid dialog state ${r.sessionState}`);case R.AckWait:return this.stateTransition(Re.Terminating),new Promise((n=>{r.delegate={onAck:()=>{const i=r.bye(e,t);return this.stateTransition(Re.Terminated),n(i),Promise.resolve()},onAckTimeout:()=>{const i=r.bye(e,t);this.stateTransition(Re.Terminated),n(i)}}}));case R.Confirmed:{const n=r.bye(e,t);return this.stateTransition(Re.Terminated),Promise.resolve(n)}case R.Terminated:throw new Error(`Invalid dialog state ${r.sessionState}`);default:throw new Error("Unrecognized state.")}}_info(e,t){return this.dialog?Promise.resolve(this.dialog.info(e,t)):Promise.reject(new Error("Session dialog undefined."))}_message(e,t){return this.dialog?Promise.resolve(this.dialog.message(e,t)):Promise.reject(new Error("Session dialog undefined."))}_refer(e,t,r){return this.dialog?(this.onNotify=e,Promise.resolve(this.dialog.refer(t,r))):Promise.reject(new Error("Session dialog undefined."))}ackAndBye(e,t,r){e.ack();const n=[];t&&n.push("Reason: "+this.getReasonHeaderValue(t,r)),e.session.bye(void 0,{extraHeaders:n})}onAckRequest(e){if(this.logger.log("Session.onAckRequest"),this.state!==Re.Established&&this.state!==Re.Terminating)return this.logger.error(`ACK received while in state ${this.state}, dropping request`),Promise.resolve();const t=this.dialog;if(!t)throw new Error("Dialog undefined.");const r={sessionDescriptionHandlerOptions:this.pendingReinviteAck?this.sessionDescriptionHandlerOptionsReInvite:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.pendingReinviteAck?this._sessionDescriptionHandlerModifiersReInvite:this._sessionDescriptionHandlerModifiers};switch(this.pendingReinviteAck=!1,t.signalingState){case A.Initial:{this.logger.error(`Invalid signaling state ${t.signalingState}.`);const e=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return t.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated),Promise.resolve()}case A.Stable:{const n=B(e.message);return n?"render"===n.contentDisposition?(this._renderbody=n.content,this._rendertype=n.contentType,Promise.resolve()):"session"!==n.contentDisposition?Promise.resolve():this.setAnswer(n,r).catch((e=>{this.logger.error(e.message);const r=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];t.bye(void 0,{extraHeaders:r}),this.stateTransition(Re.Terminated)})):Promise.resolve()}case A.HaveLocalOffer:{this.logger.error(`Invalid signaling state ${t.signalingState}.`);const e=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return t.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated),Promise.resolve()}case A.HaveRemoteOffer:{this.logger.error(`Invalid signaling state ${t.signalingState}.`);const e=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return t.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated),Promise.resolve()}case A.Closed:default:throw new Error(`Invalid signaling state ${t.signalingState}.`)}}onByeRequest(e){if(this.logger.log("Session.onByeRequest"),this.state===Re.Established){if(this.delegate&&this.delegate.onBye){const t=new De(e);this.delegate.onBye(t)}else e.accept();this.stateTransition(Re.Terminated)}else this.logger.error(`BYE received while in state ${this.state}, dropping request`)}onInfoRequest(e){if(this.logger.log("Session.onInfoRequest"),this.state===Re.Established)if(this.delegate&&this.delegate.onInfo){const t=new Me(e);this.delegate.onInfo(t)}else e.accept();else this.logger.error(`INFO received while in state ${this.state}, dropping request`)}onInviteRequest(e){if(this.logger.log("Session.onInviteRequest"),this.state!==Re.Established)return void this.logger.error(`INVITE received while in state ${this.state}, dropping request`);this.pendingReinviteAck=!0;const t=["Contact: "+this._contact];if(e.message.hasHeader("P-Asserted-Identity")){const t=e.message.getHeader("P-Asserted-Identity");if(!t)throw new Error("Header undefined.");this._assertedIdentity=o.nameAddrHeaderParse(t)}const r={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};this.generateResponseOfferAnswerInDialog(r).then((r=>{const n=e.accept({statusCode:200,extraHeaders:t,body:r});this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,n.message,200)})).catch((r=>{if(this.logger.error(r.message),this.logger.error("Failed to handle to re-INVITE request"),!this.dialog)throw new Error("Dialog undefined.");if(this.logger.error(this.dialog.signalingState),this.dialog.signalingState!==A.Stable)this.rollbackOffer().then((()=>{const t=e.reject({statusCode:488});this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,t.message,488)})).catch((r=>{this.logger.error(r.message),this.logger.error("Failed to rollback offer on re-INVITE request");const n=e.reject({statusCode:488});if(this.state!==Re.Terminated){if(!this.dialog)throw new Error("Dialog undefined.");[].push("Reason: "+this.getReasonHeaderValue(500,"Internal Server Error")),this.dialog.bye(void 0,{extraHeaders:t}),this.stateTransition(Re.Terminated)}this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,n.message,488)}));else{const t=e.reject({statusCode:488});this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,t.message,488)}}))}onMessageRequest(e){if(this.logger.log("Session.onMessageRequest"),this.state===Re.Established)if(this.delegate&&this.delegate.onMessage){const t=new ke(e);this.delegate.onMessage(t)}else e.accept();else this.logger.error(`MESSAGE received while in state ${this.state}, dropping request`)}onNotifyRequest(e){if(this.logger.log("Session.onNotifyRequest"),this.state===Re.Established)if(this.onNotify){const t=new xe(e);this.onNotify(t)}else if(this.delegate&&this.delegate.onNotify){const t=new xe(e);this.delegate.onNotify(t)}else e.accept();else this.logger.error(`NOTIFY received while in state ${this.state}, dropping request`)}onPrackRequest(e){if(this.logger.log("Session.onPrackRequest"),this.state===Re.Established)throw new Error("Unimplemented.");this.logger.error(`PRACK received while in state ${this.state}, dropping request`)}onReferRequest(e){if(this.logger.log("Session.onReferRequest"),this.state!==Re.Established)return void this.logger.error(`REFER received while in state ${this.state}, dropping request`);if(!e.message.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting."),void e.reject();const t=new Ue(e,this);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(t):(this.logger.log("No delegate available to handle REFER, automatically accepting and following."),t.accept().then((()=>t.makeInviter(this._referralInviterOptions).invite())).catch((e=>{this.logger.error(e.message)})))}generateResponseOfferAnswer(e,t){if(this.dialog)return this.generateResponseOfferAnswerInDialog(t);const r=B(e.message);return r&&"session"===r.contentDisposition?this.setOfferAndGetAnswer(r,t):this.getOffer(t)}generateResponseOfferAnswerInDialog(e){if(!this.dialog)throw new Error("Dialog undefined.");switch(this.dialog.signalingState){case A.Initial:return this.getOffer(e);case A.HaveLocalOffer:return Promise.resolve(void 0);case A.HaveRemoteOffer:if(!this.dialog.offer)throw new Error(`Session offer undefined in signaling state ${this.dialog.signalingState}.`);return this.setOfferAndGetAnswer(this.dialog.offer,e);case A.Stable:return this.state!==Re.Established?Promise.resolve(void 0):this.getOffer(e);case A.Closed:default:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`)}}getOffer(e){const t=this.setupSessionDescriptionHandler(),r=e.sessionDescriptionHandlerOptions,n=e.sessionDescriptionHandlerModifiers;try{return t.getDescription(r,n).then((e=>j(e))).catch((e=>{this.logger.error("Session.getOffer: SDH getDescription rejected...");const t=e instanceof Error?e:new Error("Session.getOffer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.getOffer: SDH getDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}rollbackOffer(){const e=this.setupSessionDescriptionHandler();if(void 0===e.rollbackDescription)return Promise.resolve();try{return e.rollbackDescription().catch((e=>{this.logger.error("Session.rollbackOffer: SDH rollbackDescription rejected...");const t=e instanceof Error?e:new Error("Session.rollbackOffer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.rollbackOffer: SDH rollbackDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}setAnswer(e,t){const r=this.setupSessionDescriptionHandler(),n=t.sessionDescriptionHandlerOptions,i=t.sessionDescriptionHandlerModifiers;try{if(!r.hasDescription(e.contentType))return Promise.reject(new Ie)}catch(e){this.logger.error("Session.setAnswer: SDH hasDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}try{return r.setDescription(e.content,n,i).catch((e=>{this.logger.error("Session.setAnswer: SDH setDescription rejected...");const t=e instanceof Error?e:new Error("Session.setAnswer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.setAnswer: SDH setDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}setOfferAndGetAnswer(e,t){const r=this.setupSessionDescriptionHandler(),n=t.sessionDescriptionHandlerOptions,i=t.sessionDescriptionHandlerModifiers;try{if(!r.hasDescription(e.contentType))return Promise.reject(new Ie)}catch(e){this.logger.error("Session.setOfferAndGetAnswer: SDH hasDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}try{return r.setDescription(e.content,n,i).then((()=>r.getDescription(n,i))).then((e=>j(e))).catch((e=>{this.logger.error("Session.setOfferAndGetAnswer: SDH setDescription or getDescription rejected...");const t=e instanceof Error?e:new Error("Session.setOfferAndGetAnswer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.setOfferAndGetAnswer: SDH setDescription or getDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}setSessionDescriptionHandler(e){if(this._sessionDescriptionHandler)throw new Error("Session description handler defined.");this._sessionDescriptionHandler=e}setupSessionDescriptionHandler(){var e;return this._sessionDescriptionHandler||(this._sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.userAgent.configuration.sessionDescriptionHandlerFactoryOptions),(null===(e=this.delegate)||void 0===e?void 0:e.onSessionDescriptionHandler)&&this.delegate.onSessionDescriptionHandler(this._sessionDescriptionHandler,!1)),this._sessionDescriptionHandler}stateTransition(e){const t=()=>{throw new Error(`Invalid state transition from ${this._state} to ${e}`)};switch(this._state){case Re.Initial:e!==Re.Establishing&&e!==Re.Established&&e!==Re.Terminating&&e!==Re.Terminated&&t();break;case Re.Establishing:e!==Re.Established&&e!==Re.Terminating&&e!==Re.Terminated&&t();break;case Re.Established:e!==Re.Terminating&&e!==Re.Terminated&&t();break;case Re.Terminating:e!==Re.Terminated&&t();break;case Re.Terminated:t();break;default:throw new Error("Unrecognized state.")}this._state=e,this.logger.log(`Session ${this.id} transitioned to state ${this._state}`),this._stateEventEmitter.emit(this._state),e===Re.Terminated&&this.dispose()}copyRequestOptions(e={}){return{extraHeaders:e.extraHeaders?e.extraHeaders.slice():void 0,body:e.body?{contentDisposition:e.body.contentDisposition||"render",contentType:e.body.contentType||"text/plain",content:e.body.content||""}:void 0}}getReasonHeaderValue(e,t){const r=e;let n=g(e);return!n&&t&&(n=t),"SIP;cause="+r+';text="'+n+'"'}referExtraHeaders(e){const t=[];return t.push("Referred-By: <"+this.userAgent.configuration.uri+">"),t.push("Contact: "+this._contact),t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.push("Refer-To: "+e),t}referToString(e){let t;if(e instanceof a)t=e.toString();else{if(!e.dialog)throw new Error("Dialog undefined.");const r=e.remoteIdentity.friendlyName,n=e.dialog.remoteTarget.toString(),i=e.dialog.callId,o=e.dialog.remoteTag,s=e.dialog.localTag;t=`"${r}" <${n}?Replaces=${encodeURIComponent(`${i};to-tag=${o};from-tag=${s}`)}>`}return t}}!function(e){e.Required="Required",e.Supported="Supported",e.Unsupported="Unsupported"}(Ae||(Ae={}));const He={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0};class je extends Ve{constructor(e,t){super(e),this.incomingInviteRequest=t,this.disposed=!1,this.expiresTimer=void 0,this.isCanceled=!1,this.rel100="none",this.rseq=Math.floor(1e4*Math.random()),this.userNoAnswerTimer=void 0,this.waitingForPrack=!1,this.logger=e.getLogger("sip.Invitation");const r=this.incomingInviteRequest.message,n=r.getHeader("require");n&&n.toLowerCase().includes("100rel")&&(this.rel100="required");const i=r.getHeader("supported");if(i&&i.toLowerCase().includes("100rel")&&(this.rel100="supported"),r.toTag=t.toTag,"string"!=typeof r.toTag)throw new TypeError("toTag should have been a string.");if(this.userNoAnswerTimer=setTimeout((()=>{t.reject({statusCode:480}),this.stateTransition(Re.Terminated)}),this.userAgent.configuration.noAnswerTimeout?1e3*this.userAgent.configuration.noAnswerTimeout:6e4),r.hasHeader("expires")){const e=1e3*Number(r.getHeader("expires")||0);this.expiresTimer=setTimeout((()=>{this.state===Re.Initial&&(t.reject({statusCode:487}),this.stateTransition(Re.Terminated))}),e)}const s=this.request.getHeader("P-Asserted-Identity");s&&(this._assertedIdentity=o.nameAddrHeaderParse(s)),this._contact=this.userAgent.contact.toString();const a=r.parseHeader("Content-Disposition");a&&"render"===a.type&&(this._renderbody=r.body,this._rendertype=r.getHeader("Content-Type")),this._id=r.callId+r.fromTag,this.userAgent._sessions[this._id]=this}dispose(){if(this.disposed)return Promise.resolve();switch(this.disposed=!0,this.expiresTimer&&(clearTimeout(this.expiresTimer),this.expiresTimer=void 0),this.userNoAnswerTimer&&(clearTimeout(this.userNoAnswerTimer),this.userNoAnswerTimer=void 0),this.prackNeverArrived(),this.state){case Re.Initial:case Re.Establishing:return this.reject().then((()=>super.dispose()));case Re.Established:case Re.Terminating:case Re.Terminated:return super.dispose();default:throw new Error("Unknown state.")}}get autoSendAnInitialProvisionalResponse(){return"required"!==this.rel100}get body(){return this.incomingInviteRequest.message.body}get localIdentity(){return this.request.to}get remoteIdentity(){return this.request.from}get request(){return this.incomingInviteRequest.message}accept(e={}){if(this.logger.log("Invitation.accept"),this.state!==Re.Initial){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}return e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=e.sessionDescriptionHandlerOptions),this.stateTransition(Re.Establishing),this.sendAccept().then((({message:e,session:t})=>{t.delegate={onAck:e=>this.onAckRequest(e),onAckTimeout:()=>this.onAckTimeout(),onBye:e=>this.onByeRequest(e),onInfo:e=>this.onInfoRequest(e),onInvite:e=>this.onInviteRequest(e),onMessage:e=>this.onMessageRequest(e),onNotify:e=>this.onNotifyRequest(e),onPrack:e=>this.onPrackRequest(e),onRefer:e=>this.onReferRequest(e)},this._dialog=t,this.stateTransition(Re.Established),this._replacee&&this._replacee._bye()})).catch((e=>this.handleResponseError(e)))}progress(e={}){if(this.logger.log("Invitation.progress"),this.state!==Re.Initial){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}const t=e.statusCode||180;if(t<100||t>199)throw new TypeError("Invalid statusCode: "+t);return e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=e.sessionDescriptionHandlerOptions),this.waitingForPrack?(this.logger.warn("Unexpected call for progress while waiting for prack, ignoring"),Promise.resolve()):100===e.statusCode?this.sendProgressTrying().then((()=>{})).catch((e=>this.handleResponseError(e))):"required"===this.rel100||"supported"===this.rel100&&e.rel100||"supported"===this.rel100&&this.userAgent.configuration.sipExtension100rel===Ae.Required?this.sendProgressReliableWaitForPrack(e).then((()=>{})).catch((e=>this.handleResponseError(e))):this.sendProgress(e).then((()=>{})).catch((e=>this.handleResponseError(e)))}reject(e={}){if(this.logger.log("Invitation.reject"),this.state!==Re.Initial&&this.state!==Re.Establishing){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}const t=e.statusCode||480,r=e.reasonPhrase?e.reasonPhrase:g(t),n=e.extraHeaders||[];if(t<300||t>699)throw new TypeError("Invalid statusCode: "+t);const i=e.body?j(e.body):void 0;return t<400?this.incomingInviteRequest.redirect([],{statusCode:t,reasonPhrase:r,extraHeaders:n,body:i}):this.incomingInviteRequest.reject({statusCode:t,reasonPhrase:r,extraHeaders:n,body:i}),this.stateTransition(Re.Terminated),Promise.resolve()}_onCancel(e){this.logger.log("Invitation._onCancel"),this.state===Re.Initial||this.state===Re.Establishing?(this.isCanceled=!0,this.incomingInviteRequest.reject({statusCode:487}),this.stateTransition(Re.Terminated)):this.logger.error(`CANCEL received while in state ${this.state}, dropping request`)}handlePrackOfferAnswer(e){if(!this.dialog)throw new Error("Dialog undefined.");const t=B(e.message);if(!t||"session"!==t.contentDisposition)return Promise.resolve(void 0);const r={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers};switch(this.dialog.signalingState){case A.Initial:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`);case A.Stable:return this.setAnswer(t,r).then((()=>{}));case A.HaveLocalOffer:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`);case A.HaveRemoteOffer:return this.setOfferAndGetAnswer(t,r);case A.Closed:default:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`)}}handleResponseError(e){let t=480;if(e instanceof Error?this.logger.error(e.message):this.logger.error(e),e instanceof Ie?(this.logger.error("A session description handler occurred while sending response (content type unsupported"),t=415):e instanceof Pe?this.logger.error("A session description handler occurred while sending response"):e instanceof Ne?this.logger.error("Session ended before response could be formulated and sent (while waiting for PRACK)"):e instanceof G&&this.logger.error("Session changed state before response could be formulated and sent"),this.state===Re.Initial||this.state===Re.Establishing)try{this.incomingInviteRequest.reject({statusCode:t}),this.stateTransition(Re.Terminated)}catch(e){throw this.logger.error("An error occurred attempting to reject the request while handling another error"),e}if(!this.isCanceled)throw e;this.logger.warn("An error occurred while attempting to formulate and send a response to an incoming INVITE. However a CANCEL was received and processed while doing so which can (and often does) result in errors occurring as the session terminates in the meantime. Said error is being ignored.")}onAckTimeout(){if(this.logger.log("Invitation.onAckTimeout"),!this.dialog)throw new Error("Dialog undefined.");this.logger.log("No ACK received for an extended period of time, terminating session"),this.dialog.bye(),this.stateTransition(Re.Terminated)}sendAccept(){const e={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers};return this.waitingForPrack?this.waitForArrivalOfPrack().then((()=>clearTimeout(this.userNoAnswerTimer))).then((()=>this.generateResponseOfferAnswer(this.incomingInviteRequest,e))).then((e=>this.incomingInviteRequest.accept({statusCode:200,body:e}))):(clearTimeout(this.userNoAnswerTimer),this.generateResponseOfferAnswer(this.incomingInviteRequest,e).then((e=>this.incomingInviteRequest.accept({statusCode:200,body:e}))))}sendProgress(e={}){const t=e.statusCode||180,r=e.reasonPhrase,n=(e.extraHeaders||[]).slice(),i=e.body?j(e.body):void 0;if(183===t&&!i)return this.sendProgressWithSDP(e);try{const e=this.incomingInviteRequest.progress({statusCode:t,reasonPhrase:r,extraHeaders:n,body:i});return this._dialog=e.session,Promise.resolve(e)}catch(e){return Promise.reject(e)}}sendProgressWithSDP(e={}){const t={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers},r=e.statusCode||183,n=e.reasonPhrase,i=(e.extraHeaders||[]).slice();return this.generateResponseOfferAnswer(this.incomingInviteRequest,t).then((e=>this.incomingInviteRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:e}))).then((e=>(this._dialog=e.session,e)))}sendProgressReliable(e={}){return e.extraHeaders=(e.extraHeaders||[]).slice(),e.extraHeaders.push("Require: 100rel"),e.extraHeaders.push("RSeq: "+Math.floor(1e4*Math.random())),this.sendProgressWithSDP(e)}sendProgressReliableWaitForPrack(e={}){const t={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers},r=e.statusCode||183,n=e.reasonPhrase,i=(e.extraHeaders||[]).slice();let o;return i.push("Require: 100rel"),i.push("RSeq: "+this.rseq++),new Promise(((e,s)=>{this.waitingForPrack=!0,this.generateResponseOfferAnswer(this.incomingInviteRequest,t).then((e=>(o=e,this.incomingInviteRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:o})))).then((t=>{let a,c;this._dialog=t.session,t.session.delegate={onPrack:r=>{a=r,clearTimeout(u),clearTimeout(h),this.waitingForPrack&&(this.waitingForPrack=!1,this.handlePrackOfferAnswer(a).then((r=>{try{c=a.accept({statusCode:200,body:r}),this.prackArrived(),e({prackRequest:a,prackResponse:c,progressResponse:t})}catch(e){s(e)}})).catch((e=>s(e))))}};const u=setTimeout((()=>{this.waitingForPrack&&(this.waitingForPrack=!1,this.logger.warn("No PRACK received, rejecting INVITE."),clearTimeout(h),this.reject({statusCode:504}).then((()=>s(new Ne))).catch((e=>s(e))))}),32e3),d=()=>{try{this.incomingInviteRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:o})}catch(e){return this.waitingForPrack=!1,void s(e)}h=setTimeout(d,l*=2)};let l=500,h=setTimeout(d,l)})).catch((e=>{this.waitingForPrack=!1,s(e)}))}))}sendProgressTrying(){try{const e=this.incomingInviteRequest.trying();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}waitForArrivalOfPrack(){if(this.waitingForPrackPromise)throw new Error("Already waiting for PRACK");return this.waitingForPrackPromise=new Promise(((e,t)=>{this.waitingForPrackResolve=e,this.waitingForPrackReject=t})),this.waitingForPrackPromise}prackArrived(){this.waitingForPrackResolve&&this.waitingForPrackResolve(),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0}prackNeverArrived(){this.waitingForPrackReject&&this.waitingForPrackReject(new Ne),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0}}class $e extends Ve{constructor(e,t,r={}){super(e,r),this.disposed=!1,this.earlyMedia=!1,this.earlyMediaSessionDescriptionHandlers=new Map,this.isCanceled=!1,this.inviteWithoutSdp=!1,this.logger=e.getLogger("sip.Inviter"),this.earlyMedia=void 0!==r.earlyMedia?r.earlyMedia:this.earlyMedia,this.fromTag=v(),this.inviteWithoutSdp=void 0!==r.inviteWithoutSdp?r.inviteWithoutSdp:this.inviteWithoutSdp;const n=Object.assign({},r);n.params=Object.assign({},r.params);const i=r.anonymous||!1,s=e.contact.toString({anonymous:i,outbound:i?!e.contact.tempGruu:!e.contact.pubGruu});i&&e.configuration.uri&&(n.params.fromDisplayName="Anonymous",n.params.fromUri="sip:anonymous@anonymous.invalid");let a=e.userAgentCore.configuration.aor;if(n.params.fromUri&&(a="string"==typeof n.params.fromUri?o.URIParse(n.params.fromUri):n.params.fromUri),!a)throw new TypeError("Invalid from URI: "+n.params.fromUri);let c=t;if(n.params.toUri&&(c="string"==typeof n.params.toUri?o.URIParse(n.params.toUri):n.params.toUri),!c)throw new TypeError("Invalid to URI: "+n.params.toUri);const u=Object.assign({},n.params);u.fromTag=this.fromTag;const d=(n.extraHeaders||[]).slice();i&&e.configuration.uri&&(d.push("P-Preferred-Identity: "+e.configuration.uri.toString()),d.push("Privacy: id")),d.push("Contact: "+s),d.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),e.configuration.sipExtension100rel===Ae.Required&&d.push("Require: 100rel"),e.configuration.sipExtensionReplaces===Ae.Required&&d.push("Require: replaces"),n.extraHeaders=d,this.outgoingRequestMessage=e.userAgentCore.makeOutgoingRequestMessage(y.INVITE,t,a,c,u,d,void 0),this._contact=s,this._referralInviterOptions=n,this._renderbody=r.renderbody,this._rendertype=r.rendertype,r.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=r.sessionDescriptionHandlerModifiers),r.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=r.sessionDescriptionHandlerOptions),r.sessionDescriptionHandlerModifiersReInvite&&(this.sessionDescriptionHandlerModifiersReInvite=r.sessionDescriptionHandlerModifiersReInvite),r.sessionDescriptionHandlerOptionsReInvite&&(this.sessionDescriptionHandlerOptionsReInvite=r.sessionDescriptionHandlerOptionsReInvite),this._id=this.outgoingRequestMessage.callId+this.fromTag,this.userAgent._sessions[this._id]=this}dispose(){if(this.disposed)return Promise.resolve();switch(this.disposed=!0,this.disposeEarlyMedia(),this.state){case Re.Initial:case Re.Establishing:return this.cancel().then((()=>super.dispose()));case Re.Established:case Re.Terminating:case Re.Terminated:return super.dispose();default:throw new Error("Unknown state.")}}get body(){return this.outgoingRequestMessage.body}get localIdentity(){return this.outgoingRequestMessage.from}get remoteIdentity(){return this.outgoingRequestMessage.to}get request(){return this.outgoingRequestMessage}cancel(e={}){if(this.logger.log("Inviter.cancel"),this.state!==Re.Initial&&this.state!==Re.Establishing){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}if(this.isCanceled=!0,this.stateTransition(Re.Terminating),this.outgoingInviteRequest){let t;e.statusCode&&e.reasonPhrase&&(t=function(e,t){if(e&&e<200||e>699)throw new TypeError("Invalid statusCode: "+e);if(e)return"SIP;cause="+e+';text="'+(g(e)||t)+'"'}(e.statusCode,e.reasonPhrase)),this.outgoingInviteRequest.cancel(t,e)}else this.logger.warn("Canceled session before INVITE was sent"),this.stateTransition(Re.Terminated);return Promise.resolve()}invite(e={}){if(this.logger.log("Inviter.invite"),this.state!==Re.Initial)return super.invite(e);if(e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=e.sessionDescriptionHandlerOptions),e.withoutSdp||this.inviteWithoutSdp)return this._renderbody&&this._rendertype&&(this.outgoingRequestMessage.body={contentType:this._rendertype,body:this._renderbody}),this.stateTransition(Re.Establishing),Promise.resolve(this.sendInvite(e));const t={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.getOffer(t).then((t=>(this.outgoingRequestMessage.body={body:t.content,contentType:t.contentType},this.stateTransition(Re.Establishing),this.sendInvite(e)))).catch((e=>{throw this.logger.log(e.message),this.stateTransition(Re.Terminated),e}))}sendInvite(e={}){return this.outgoingInviteRequest=this.userAgent.userAgentCore.invite(this.outgoingRequestMessage,{onAccept:t=>this.dialog?(this.logger.log("Additional confirmed dialog, sending ACK and BYE"),void this.ackAndBye(t)):this.isCanceled?(this.logger.log("Canceled session accepted, sending ACK and BYE"),this.ackAndBye(t),void this.stateTransition(Re.Terminated)):(this.notifyReferer(t),void this.onAccept(t).then((()=>{this.disposeEarlyMedia()})).catch((()=>{this.disposeEarlyMedia()})).then((()=>{e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(t)}))),onProgress:t=>{this.isCanceled||(this.notifyReferer(t),this.onProgress(t).catch((()=>{this.disposeEarlyMedia()})).then((()=>{e.requestDelegate&&e.requestDelegate.onProgress&&e.requestDelegate.onProgress(t)})))},onRedirect:t=>{this.notifyReferer(t),this.onRedirect(t),e.requestDelegate&&e.requestDelegate.onRedirect&&e.requestDelegate.onRedirect(t)},onReject:t=>{this.notifyReferer(t),this.onReject(t),e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(t)},onTrying:t=>{this.notifyReferer(t),this.onTrying(t),e.requestDelegate&&e.requestDelegate.onTrying&&e.requestDelegate.onTrying(t)}}),this.outgoingInviteRequest}disposeEarlyMedia(){this.earlyMediaSessionDescriptionHandlers.forEach((e=>{e.close()})),this.earlyMediaSessionDescriptionHandlers.clear()}notifyReferer(e){if(!this._referred)return;if(!(this._referred instanceof Ve))throw new Error("Referred session not instance of session");if(!this._referred.dialog)return;if(!e.message.statusCode)throw new Error("Status code undefined.");if(!e.message.reasonPhrase)throw new Error("Reason phrase undefined.");const t=`SIP/2.0 ${e.message.statusCode} ${e.message.reasonPhrase}`.trim();this._referred.dialog.notify(void 0,{extraHeaders:["Event: refer","Subscription-State: terminated"],body:{contentDisposition:"render",contentType:"message/sipfrag",content:t}}).delegate={onReject:()=>{this._referred=void 0}}}onAccept(e){if(this.logger.log("Inviter.onAccept"),this.state!==Re.Establishing)return this.logger.error(`Accept received while in state ${this.state}, dropping response`),Promise.reject(new Error(`Invalid session state ${this.state}`));const t=e.message,r=e.session;switch(t.hasHeader("P-Asserted-Identity")&&(this._assertedIdentity=o.nameAddrHeaderParse(t.getHeader("P-Asserted-Identity"))),r.delegate={onAck:e=>this.onAckRequest(e),onBye:e=>this.onByeRequest(e),onInfo:e=>this.onInfoRequest(e),onInvite:e=>this.onInviteRequest(e),onMessage:e=>this.onMessageRequest(e),onNotify:e=>this.onNotifyRequest(e),onPrack:e=>this.onPrackRequest(e),onRefer:e=>this.onReferRequest(e)},this._dialog=r,r.signalingState){case A.Initial:case A.HaveLocalOffer:return this.logger.error("Received 2xx response to INVITE without a session description"),this.ackAndBye(e,400,"Missing session description"),this.stateTransition(Re.Terminated),Promise.reject(new Error("Bad Media Description"));case A.HaveRemoteOffer:{if(!this._dialog.offer)throw new Error(`Session offer undefined in signaling state ${this._dialog.signalingState}.`);const t={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.setOfferAndGetAnswer(this._dialog.offer,t).then((t=>{e.ack({body:t}),this.stateTransition(Re.Established)})).catch((t=>{throw this.ackAndBye(e,488,"Invalid session description"),this.stateTransition(Re.Terminated),t}))}case A.Stable:{if(this.earlyMediaSessionDescriptionHandlers.size>0){const t=this.earlyMediaSessionDescriptionHandlers.get(r.id);if(!t)throw new Error("Session description handler undefined.");return this.setSessionDescriptionHandler(t),this.earlyMediaSessionDescriptionHandlers.delete(r.id),e.ack(),this.stateTransition(Re.Established),Promise.resolve()}if(this.earlyMediaDialog){if(this.earlyMediaDialog!==r){if(this.earlyMedia){const e="You have set the 'earlyMedia' option to 'true' which requires that your INVITE requests do not fork and yet this INVITE request did in fact fork. Consequentially and not surprisingly the end point which accepted the INVITE (confirmed dialog) does not match the end point with which early media has been setup (early dialog) and thus this session is unable to proceed. In accordance with the SIP specifications, the SIP servers your end point is connected to determine if an INVITE forks and the forking behavior of those servers cannot be controlled by this library. If you wish to use early media with this library you must configure those servers accordingly. Alternatively you may set the 'earlyMedia' to 'false' which will allow this library to function with any INVITE requests which do fork.";this.logger.error(e)}const t=new Error("Early media dialog does not equal confirmed dialog, terminating session");return this.logger.error(t.message),this.ackAndBye(e,488,"Not Acceptable Here"),this.stateTransition(Re.Terminated),Promise.reject(t)}return e.ack(),this.stateTransition(Re.Established),Promise.resolve()}const t=r.answer;if(!t)throw new Error("Answer is undefined.");const n={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.setAnswer(t,n).then((()=>{let t;this._renderbody&&this._rendertype&&(t={body:{contentDisposition:"render",contentType:this._rendertype,content:this._renderbody}}),e.ack(t),this.stateTransition(Re.Established)})).catch((t=>{throw this.logger.error(t.message),this.ackAndBye(e,488,"Not Acceptable Here"),this.stateTransition(Re.Terminated),t}))}case A.Closed:return Promise.reject(new Error("Terminated."));default:throw new Error("Unknown session signaling state.")}}onProgress(e){var t;if(this.logger.log("Inviter.onProgress"),this.state!==Re.Establishing)return this.logger.error(`Progress received while in state ${this.state}, dropping response`),Promise.reject(new Error(`Invalid session state ${this.state}`));if(!this.outgoingInviteRequest)throw new Error("Outgoing INVITE request undefined.");const r=e.message,n=e.session;r.hasHeader("P-Asserted-Identity")&&(this._assertedIdentity=o.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity")));const i=r.getHeader("require"),s=r.getHeader("rseq"),a=!!(i&&i.includes("100rel")&&s?Number(s):void 0),c=[];switch(a&&c.push("RAck: "+r.getHeader("rseq")+" "+r.getHeader("cseq")),n.signalingState){case A.Initial:return a&&(this.logger.warn("First reliable provisional response received MUST contain an offer when INVITE does not contain an offer."),e.prack({extraHeaders:c})),Promise.resolve();case A.HaveLocalOffer:return a&&e.prack({extraHeaders:c}),Promise.resolve();case A.HaveRemoteOffer:if(!a)return this.logger.warn("Non-reliable provisional response MUST NOT contain an initial offer, discarding response."),Promise.resolve();{const i=this.sessionDescriptionHandlerFactory(this,this.userAgent.configuration.sessionDescriptionHandlerFactoryOptions||{});return(null===(t=this.delegate)||void 0===t?void 0:t.onSessionDescriptionHandler)&&this.delegate.onSessionDescriptionHandler(i,!0),this.earlyMediaSessionDescriptionHandlers.set(n.id,i),i.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.sessionDescriptionHandlerModifiers).then((()=>i.getDescription(this.sessionDescriptionHandlerOptions,this.sessionDescriptionHandlerModifiers))).then((t=>{const r={contentDisposition:"session",contentType:t.contentType,content:t.body};e.prack({extraHeaders:c,body:r})})).catch((e=>{throw this.stateTransition(Re.Terminated),e}))}case A.Stable:if(a&&e.prack({extraHeaders:c}),this.earlyMedia&&!this.earlyMediaDialog){this.earlyMediaDialog=n;const e=n.answer;if(!e)throw new Error("Answer is undefined.");const t={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.setAnswer(e,t).catch((e=>{throw this.stateTransition(Re.Terminated),e}))}return Promise.resolve();case A.Closed:return Promise.reject(new Error("Terminated."));default:throw new Error("Unknown session signaling state.")}}onRedirect(e){this.logger.log("Inviter.onRedirect"),this.state===Re.Establishing||this.state===Re.Terminating?this.stateTransition(Re.Terminated):this.logger.error(`Redirect received while in state ${this.state}, dropping response`)}onReject(e){this.logger.log("Inviter.onReject"),this.state===Re.Establishing||this.state===Re.Terminating?this.stateTransition(Re.Terminated):this.logger.error(`Reject received while in state ${this.state}, dropping response`)}onTrying(e){this.logger.log("Inviter.onTrying"),this.state===Re.Establishing||this.logger.error(`Trying received while in state ${this.state}, dropping response`)}}var Be;!function(e){e.Started="Started",e.Stopped="Stopped"}(Be||(Be={}));class Fe{constructor(e={}){if(this._publishers={},this._registerers={},this._sessions={},this._subscriptions={},this._state=Be.Stopped,this.unloadListener=()=>{this.stop()},this._stateEventEmitter=new be,this.delegate=e.delegate,this.options=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Fe.defaultOptions()),{sipjsId:f(5)}),{uri:new a("sip","anonymous."+f(6),"anonymous.invalid")}),{viaHost:f(12)+".invalid"}),Fe.stripUndefinedProperties(e)),this.options.hackIpInContact)if("boolean"==typeof this.options.hackIpInContact&&this.options.hackIpInContact){const e=1,t=254,r=Math.floor(Math.random()*(t-e+1)+e);this.options.viaHost="192.0.2."+r}else this.options.hackIpInContact&&(this.options.viaHost=this.options.hackIpInContact);switch(this.loggerFactory=new u,this.logger=this.loggerFactory.getLogger("sip.UserAgent"),this.loggerFactory.builtinEnabled=this.options.logBuiltinEnabled,this.loggerFactory.connector=this.options.logConnector,this.options.logLevel){case"error":this.loggerFactory.level=i.error;break;case"warn":this.loggerFactory.level=i.warn;break;case"log":this.loggerFactory.level=i.log;break;case"debug":this.loggerFactory.level=i.debug}if(this.options.logConfiguration&&(this.logger.log("Configuration:"),Object.keys(this.options).forEach((e=>{const t=this.options[e];switch(e){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("· "+e+": "+t);break;case"authorizationPassword":this.logger.log("· "+e+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+e+": "+t.name);break;default:this.logger.log("· "+e+": "+JSON.stringify(t))}}))),this.options.transportOptions){const t=this.options.transportOptions,r=t.maxReconnectionAttempts,n=t.reconnectionTimeout;if(void 0!==r){const e='The transport option "maxReconnectionAttempts" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}if(void 0!==n){const e='The transport option "reconnectionTimeout" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}void 0===e.reconnectionDelay&&void 0!==n&&(this.options.reconnectionDelay=n),void 0===e.reconnectionAttempts&&void 0!==r&&(this.options.reconnectionAttempts=r)}if(void 0!==e.reconnectionDelay){const e='The user agent option "reconnectionDelay" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}if(void 0!==e.reconnectionAttempts){const e='The user agent option "reconnectionAttempts" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}this._transport=new this.options.transportConstructor(this.getLogger("sip.Transport"),this.options.transportOptions),this.initTransportCallbacks(),this._contact=this.initContact(),this._userAgentCore=this.initCore(),this.options.autoStart&&this.start()}static makeURI(e){return o.URIParse(e)}static defaultOptions(){return{allowLegacyNotifications:!1,authorizationHa1:"",authorizationPassword:"",authorizationUsername:"",autoStart:!1,autoStop:!0,delegate:{},displayName:"",forceRport:!1,hackAllowUnregisteredOptionTags:!1,hackIpInContact:!1,hackViaTcp:!1,hackWssInTransport:!1,logBuiltinEnabled:!0,logConfiguration:!0,logConnector:()=>{},logLevel:"log",noAnswerTimeout:60,preloadedRouteSet:[],reconnectionAttempts:0,reconnectionDelay:4,sessionDescriptionHandlerFactory:(t,r)=>{void 0===e&&(e=e=>e.audio||e.video?void 0===navigator.mediaDevices?Promise.reject(new Error("Media devices not available in insecure contexts.")):navigator.mediaDevices.getUserMedia.call(navigator.mediaDevices,e):Promise.resolve(new MediaStream));const n={iceGatheringTimeout:void 0!==(null==r?void 0:r.iceGatheringTimeout)?null==r?void 0:r.iceGatheringTimeout:5e3,peerConnectionConfiguration:Object.assign(Object.assign({},{bundlePolicy:"balanced",certificates:void 0,iceCandidatePoolSize:0,iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceTransportPolicy:"all",peerIdentity:void 0,rtcpMuxPolicy:"require"}),null==r?void 0:r.peerConnectionConfiguration)},i=t.userAgent.getLogger("sip.SessionDescriptionHandler");return new we(i,e,n)},sessionDescriptionHandlerFactoryOptions:{},sipExtension100rel:Ae.Unsupported,sipExtensionReplaces:Ae.Unsupported,sipExtensionExtraSupported:[],sipjsId:"",transportConstructor:Oe,transportOptions:{},uri:new a("sip","anonymous","anonymous.invalid"),userAgentString:"SIP.js/0.17.1",viaHost:""};var e}static stripUndefinedProperties(e){return Object.keys(e).reduce(((t,r)=>(void 0!==e[r]&&(t[r]=e[r]),t)),{})}get configuration(){return this.options}get contact(){return this._contact}get state(){return this._state}get stateChange(){return this._stateEventEmitter}get transport(){return this._transport}get userAgentCore(){return this._userAgentCore}getLogger(e,t){return this.loggerFactory.getLogger(e,t)}getLoggerFactory(){return this.loggerFactory}isConnected(){return this.transport.isConnected()}reconnect(){return this.state===Be.Stopped?Promise.reject(new Error("User agent stopped.")):Promise.resolve().then((()=>this.transport.connect()))}start(){if(this.state===Be.Started)return this.logger.warn("User agent already started"),Promise.resolve();if(this.logger.log(`Starting ${this.configuration.uri}`),this.transitionState(Be.Started),this.options.autoStop){const e=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"==typeof window||"function"!=typeof window.addEventListener||e||window.addEventListener("unload",this.unloadListener)}return this.transport.connect()}async stop(){if(this.state===Be.Stopped)return this.logger.warn("User agent already stopped"),Promise.resolve();if(this.logger.log(`Stopping ${this.configuration.uri}`),this.transitionState(Be.Stopped),this.options.autoStop){const e=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"!=typeof window&&window.removeEventListener&&!e&&window.removeEventListener("unload",this.unloadListener)}const e=Object.assign({},this._publishers),t=Object.assign({},this._registerers),r=Object.assign({},this._sessions),n=Object.assign({},this._subscriptions),i=this.transport,o=this.userAgentCore;this.logger.log("Dispose of registerers");for(const e in t)t[e]&&await t[e].dispose().catch((t=>{throw this.logger.error(t.message),delete this._registerers[e],t}));this.logger.log("Dispose of sessions");for(const e in r)r[e]&&await r[e].dispose().catch((t=>{throw this.logger.error(t.message),delete this._sessions[e],t}));this.logger.log("Dispose of subscriptions");for(const e in n)n[e]&&await n[e].dispose().catch((t=>{throw this.logger.error(t.message),delete this._subscriptions[e],t}));this.logger.log("Dispose of publishers");for(const t in e)e[t]&&await e[t].dispose().catch((e=>{throw this.logger.error(e.message),delete this._publishers[t],e}));this.logger.log("Dispose of transport"),await i.dispose().catch((e=>{throw this.logger.error(e.message),e})),this.logger.log("Dispose of core"),o.dispose()}_makeInviter(e,t){return new $e(this,e,t)}attemptReconnection(e=1){const t=this.options.reconnectionAttempts,r=this.options.reconnectionDelay;e>t?this.logger.log("Maximum reconnection attempts reached"):(this.logger.log(`Reconnection attempt ${e} of ${t} - trying`),setTimeout((()=>{this.reconnect().then((()=>{this.logger.log(`Reconnection attempt ${e} of ${t} - succeeded`)})).catch((r=>{this.logger.error(r.message),this.logger.log(`Reconnection attempt ${e} of ${t} - failed`),this.attemptReconnection(++e)}))}),1===e?0:1e3*r))}initContact(){const e=f(8),t=this.options.hackWssInTransport?"wss":"ws";return{pubGruu:void 0,tempGruu:void 0,uri:new a("sip",e,this.options.viaHost,void 0,{transport:t}),toString:(e={})=>{const r=e.anonymous||!1,n=e.outbound||!1;let i="<";return i+=r?this.contact.tempGruu||`sip:anonymous@anonymous.invalid;transport=${t}`:this.contact.pubGruu||this.contact.uri,n&&(i+=";ob"),i+=">",i}}}initCore(){let e=[];e.push("outbound"),this.options.sipExtension100rel===Ae.Supported&&e.push("100rel"),this.options.sipExtensionReplaces===Ae.Supported&&e.push("replaces"),this.options.sipExtensionExtraSupported&&e.push(...this.options.sipExtensionExtraSupported),this.options.hackAllowUnregisteredOptionTags||(e=e.filter((e=>He[e]))),e=Array.from(new Set(e));const t=e.slice();(this.contact.pubGruu||this.contact.tempGruu)&&t.push("gruu");const r={aor:this.options.uri,contact:this.contact,displayName:this.options.displayName,loggerFactory:this.loggerFactory,hackViaTcp:this.options.hackViaTcp,routeSet:this.options.preloadedRouteSet,supportedOptionTags:e,supportedOptionTagsResponse:t,sipjsId:this.options.sipjsId,userAgentHeaderFieldValue:this.options.userAgentString,viaForceRport:this.options.forceRport,viaHost:this.options.viaHost,authenticationFactory:()=>{const e=this.options.authorizationUsername?this.options.authorizationUsername:this.options.uri.user,t=this.options.authorizationPassword?this.options.authorizationPassword:void 0,r=this.options.authorizationHa1?this.options.authorizationHa1:void 0;return new _(this.getLoggerFactory(),r,e,t)},transportAccessor:()=>this.transport};return new _e(r,{onInvite:e=>{var t;const r=new je(this,e);if(e.delegate={onCancel:e=>{r._onCancel(e)},onTransportError:e=>{this.logger.error("A transport error has occurred while handling an incoming INVITE request.")}},e.trying(),this.options.sipExtensionReplaces!==Ae.Unsupported){const t=e.message.parseHeader("replaces");if(t){const e=t.call_id;if("string"!=typeof e)throw new Error("Type of call id is not string");const n=t.replaces_to_tag;if("string"!=typeof n)throw new Error("Type of to tag is not string");const i=t.replaces_from_tag;if("string"!=typeof i)throw new Error("type of from tag is not string");const o=e+n+i,s=this.userAgentCore.dialogs.get(o);if(!s)return void r.reject({statusCode:481});if(!s.early&&!0===t.early_only)return void r.reject({statusCode:486});const a=this._sessions[e+i]||this._sessions[e+n]||void 0;if(!a)throw new Error("Session does not exist.");r._replacee=a}}if(null===(t=this.delegate)||void 0===t?void 0:t.onInvite)return r.autoSendAnInitialProvisionalResponse?void r.progress().then((()=>{var e;if(void 0===(null===(e=this.delegate)||void 0===e?void 0:e.onInvite))throw new Error("onInvite undefined.");this.delegate.onInvite(r)})):void this.delegate.onInvite(r);r.reject({statusCode:486})},onMessage:e=>{if(this.delegate&&this.delegate.onMessage){const t=new ke(e);this.delegate.onMessage(t)}else e.accept()},onNotify:e=>{if(this.delegate&&this.delegate.onNotify){const t=new xe(e);this.delegate.onNotify(t)}else this.options.allowLegacyNotifications?e.accept():e.reject({statusCode:481})},onRefer:e=>{this.logger.warn("Received an out of dialog REFER request"),this.delegate&&this.delegate.onReferRequest?this.delegate.onReferRequest(e):e.reject({statusCode:405})},onRegister:e=>{this.logger.warn("Received an out of dialog REGISTER request"),this.delegate&&this.delegate.onRegisterRequest?this.delegate.onRegisterRequest(e):e.reject({statusCode:405})},onSubscribe:e=>{this.logger.warn("Received an out of dialog SUBSCRIBE request"),this.delegate&&this.delegate.onSubscribeRequest?this.delegate.onSubscribeRequest(e):e.reject({statusCode:405})}})}initTransportCallbacks(){this.transport.onConnect=()=>this.onTransportConnect(),this.transport.onDisconnect=e=>this.onTransportDisconnect(e),this.transport.onMessage=e=>this.onTransportMessage(e)}onTransportConnect(){this.state!==Be.Stopped&&this.delegate&&this.delegate.onConnect&&this.delegate.onConnect()}onTransportDisconnect(e){this.state!==Be.Stopped&&(this.delegate&&this.delegate.onDisconnect&&this.delegate.onDisconnect(e),e&&this.options.reconnectionAttempts>0&&this.attemptReconnection())}onTransportMessage(e){const t=ye.parseMessage(e,this.getLogger("sip.Parser"));if(!t)return void this.logger.warn("Failed to parse incoming message. Dropping.");if(this.state===Be.Stopped&&t instanceof U)return void this.logger.warn(`Received ${t.method} request while stopped. Dropping.`);const r=()=>{const e=["from","to","call_id","cseq","via"];for(const r of e)if(!t.hasHeader(r))return this.logger.warn(`Missing mandatory header field : ${r}.`),!1;return!0};if(t instanceof U){if(!r())return void this.logger.warn("Request missing mandatory header field. Dropping.");if(!t.toTag&&t.callId.substr(0,5)===this.options.sipjsId)return void this.userAgentCore.replyStateless(t,{statusCode:482});const e=S(t.body),n=t.getHeader("content-length");if(n&&e<Number(n))return void this.userAgentCore.replyStateless(t,{statusCode:400})}if(t instanceof V){if(!r())return void this.logger.warn("Response missing mandatory header field. Dropping.");if(t.getHeaders("via").length>1)return void this.logger.warn("More than one Via header field present in the response. Dropping.");if(t.via.host!==this.options.viaHost||void 0!==t.via.port)return void this.logger.warn("Via sent-by in the response does not match UA Via host value. Dropping.");const e=S(t.body),n=t.getHeader("content-length");if(n&&e<Number(n))return void this.logger.warn("Message body length is lower than the value in Content-Length header field. Dropping.")}if(t instanceof U)this.userAgentCore.receiveIncomingRequestFromTransport(t);else{if(!(t instanceof V))throw new Error("Invalid message type.");this.userAgentCore.receiveIncomingResponseFromTransport(t)}}transitionState(e,t){const r=()=>{throw new Error(`Invalid state transition from ${this._state} to ${e}`)};switch(this._state){case Be.Started:e!==Be.Stopped&&r();break;case Be.Stopped:e!==Be.Started&&r();break;default:throw new Error("Unknown state.")}this.logger.log(`Transitioned from ${this._state} to ${e}`),this._state=e,this._stateEventEmitter.emit(this._state)}}var qe=r(7187);new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const Ke=new Error("request for lock canceled");var We=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};class Ge{constructor(e,t=Ke){if(this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}acquire(){const e=this.isLocked(),t=new Promise(((e,t)=>this._queue.push({resolve:e,reject:t})));return e||this._dispatch(),t}runExclusive(e){return We(this,void 0,void 0,(function*(){const[t,r]=yield this.acquire();try{return yield e(t)}finally{r()}}))}waitForUnlock(){return We(this,void 0,void 0,(function*(){return this.isLocked()?new Promise((e=>this._waiters.push({resolve:e}))):Promise.resolve()}))}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){const e=this._currentReleaser;this._currentReleaser=void 0,e()}}cancel(){this._queue.forEach((e=>e.reject(this._cancelError))),this._queue=[]}_dispatch(){const e=this._queue.shift();if(!e)return;let t=!1;this._currentReleaser=()=>{t||(t=!0,this._value++,this._resolveWaiters(),this._dispatch())},e.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach((e=>e.resolve())),this._waiters=[]}}class Ye{constructor(e){this._semaphore=new Ge(1,e)}acquire(){return e=this,r=function*(){const[,e]=yield this._semaphore.acquire();return e},new((t=void 0)||(t=Promise))((function(n,i){function o(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(o,s)}a((r=r.apply(e,[])).next())}));var e,t,r}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}}function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Xe(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function Je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function et(e,t){return et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e){return tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},tt(e)}r(5212),r(7327),r(5003),r(9337),r(3321);var rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&et(e,t)}(u,e);var t,r,n,i,o,s,a,c=(s=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=tt(s);if(a){var r=tt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ze(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=c.call(this)).logger=e,n.mediaStreamFactory=t,n.sessionDescriptionHandlerConfiguration=r,n._localMediaStream=new MediaStream,n._remoteMediaStream=new MediaStream,n._peerConnection=new RTCPeerConnection(null==r?void 0:r.peerConnectionConfiguration),n._peerConnectionDelegate=void 0,n.initPeerConnectionEventHandlers(),n.isConference=void 0,n}return t=u,r=[{key:"localMediaStream",get:function(){return this._localMediaStream},set:function(e){this._localMediaStream=e}},{key:"remoteMediaStream",get:function(){return this._remoteMediaStream}},{key:"peerConnection",get:function(){return this._peerConnection}},{key:"peerConnectionDelegate",get:function(){return this._peerConnectionDelegate},set:function(e){this._peerConnectionDelegate=e}},{key:"addTransceiverVideoTrack",value:function(e,t,r){this.logger.debug("SessionDescriptionHandler.addTransceiverVideoTrack"),this.logger.debug(r.getConfigs()),this.logger.debug(t),this._peerConnection.addTransceiver(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(r),!0).forEach((function(t){Ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({streams:[e]},r.getConfigs()))}},{key:"close",value:function(){this.logger.debug("SessionDescriptionHandler.close"),void 0!==this._peerConnection&&(this._peerConnection.getReceivers().forEach((function(e){e.track&&e.track.stop()})),this._peerConnection.getSenders().forEach((function(e){e.track&&e.track.stop()})),this._peerConnection.close(),this._peerConnection=void 0)}},{key:"getDescription",value:function(e,t){var r=this;if(this.logger.debug("getDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));var n=void 0,i=void 0;return e&&(e.isConference&&(this.isConference=e.isConference),e.offerOptions&&(i=e.offerOptions.iceRestart),e.iceGatheringTimeout?n=e.iceGatheringTimeout:e.sessionDescriptionHandlerConfiguration&&e.sessionDescriptionHandlerConfiguration.iceGatheringTimeout&&(n=e.sessionDescriptionHandlerConfiguration.iceGatheringTimeout)),this.getLocalMediaStream(e).then((function(){return r.createLocalOfferOrAnswer(e)})).then((function(e){return r.applyModifiers(e,t)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return r.waitForIceGatheringComplete(i,n)})).then((function(){return r.getLocalSessionDescription()})).then((function(t){return e.initMediaHandler&&(r.localMediaStream=e.initMediaHandler.localMediaStream),{body:t.sdp,contentType:"application/sdp"}})).catch((function(t){if(r.logger.error("getDescription failed - ".concat(t.name," ").concat(t.message)),"OverconstrainedError"===t.name&&r.logger.error("OverconstrainedError cause=".concat(t.constraint,", Constraints=").concat(JSON.stringify(e.constraints))),!(t instanceof Error)){var n=new Error(t.message);n.name=t.name,t=n}throw t}))}},{key:"hasDescription",value:function(e){return this.logger.debug("SessionDescriptionHandler.hasDescription"),"application/sdp"===e}},{key:"setDescription",value:function(e,t,r){var n=this;if(this.logger.debug("SessionDescriptionHandler.setDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));this.onDataChannel=null==t?void 0:t.onDataChannel;var i="have-local-offer"===this._peerConnection.signalingState?"answer":"offer";return this.getLocalMediaStream(t).then((function(){return n.applyModifiers({sdp:e,type:i},r)})).then((function(e){return n.setRemoteSessionDescription(e)})).catch((function(e){throw n.logger.error("SessionDescriptionHandler.setDescription failed - "+e),e}))}},{key:"applyModifiers",value:function(e,t){var r=this;return this.logger.debug("SessionDescriptionHandler.applyModifiers"),t&&0!==t.length?t.reduce((function(e,t){return e.then(t)}),Promise.resolve(e)).then((function(e){if(r.logger.debug("SessionDescriptionHandler.applyModifiers - modified sdp"),!e.sdp||!e.type)throw new Error("Invalid SDP.");return{sdp:e.sdp,type:e.type}})):Promise.resolve(e)}},{key:"createLocalOfferOrAnswer",value:function(e){if(void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));switch(this._peerConnection.signalingState){case"stable":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP offer"),this._peerConnection.createOffer(null==e?void 0:e.offerOptions);case"have-remote-offer":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP answer"),this._peerConnection.createAnswer(null==e?void 0:e.answerOptions);default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}}},{key:"getLocalMediaStream",value:(i=regeneratorRuntime.mark((function e(t){var r,n,i,o,s,a,c,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("getLocalMediaStream"),void 0!==this._peerConnection){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Peer connection closed.")));case 3:if(null==t&&(t={}),r=Object.assign({},void 0===t.constraints?void 0:t.constraints),!this.localMediaStreamConstraints){e.next=12;break}if(r.audio=r.audio||this.localMediaStreamConstraints.audio,r.video=r.video||this.localMediaStreamConstraints.video,JSON.stringify(this.localMediaStreamConstraints.audio)!==JSON.stringify(r.audio)||JSON.stringify(this.localMediaStreamConstraints.video)!==JSON.stringify(r.video)){e.next=10;break}return e.abrupt("return",Promise.resolve());case 10:e.next=13;break;case 12:void 0===r.audio&&void 0===r.video&&(r={audio:!0});case 13:if(this.localMediaStreamConstraints=r,!t.initMediaHandler){e.next=19;break}return n=t.initMediaHandler.getInitMediaStream(),!1!==t.cameraOn&&!1!==r.video&&0!==n.getVideoTracks().length||((i=t.initMediaHandler.localMediaStream.getVideoTracks()[0])&&(i.stop(),n.removeTrack(i)),o=this._getDummyVideoTrack(),n=new MediaStream(n.getAudioTracks().concat(o))),this.logger.debug("Set localMediaStream by initMediaStream"),e.abrupt("return",this.setLocalMediaStream(n,t.simulcastHandler));case 19:return s=Object.assign({},r),void 0!==t.hasDummyVideo&&t.hasDummyVideo,a=void 0!==t.hasDummyAudio&&t.hasDummyAudio,e.next=24,navigator.mediaDevices.enumerateDevices().then((function(e){s.video&&(e.some((function(e){return"videoinput"==e.kind}))||(s.video=!1)),s.audio&&(e.some((function(e){return"audioinput"==e.kind}))||(a=!0,s.audio=!1))}));case 24:return!1===t.cameraOn&&(s.video=!1),c=this,e.abrupt("return",this.mediaStreamFactory(s,this).catch((function(e){return t.ignoreDeviceError?(s.audio=!1,s.video=!1,u.emit("failToGetMedia",e),Promise.resolve(new MediaStream)):Promise.reject(e)})).then((function(e){if(!s.audio&&!s.video||a){c.logger.debug("dummyAudio will be set");var r=window.AudioContext||window.webkitAudioContext||!1;if(!r)return Promise.reject(new Error("Browser not support audio context"));var n=new r,i=n.createOscillator(),o=n.createGain();i.connect(o),o.gain.value=0;var d=o.connect(n.createMediaStreamDestination());i.start(),e=new MediaStream(e.getVideoTracks().concat(d.stream.getAudioTracks()[0])),c.logger.debug("Add dummy audio track")}if(!1===s.video&&!t.noVideo){c.logger.debug("Add dummy video track");var l=c._getDummyVideoTrack();e=new MediaStream(e.getAudioTracks().concat(l))}e.getAudioTracks()[0].enabled=t.micOn,u.setLocalMediaStream(e,t.simulcastHandler)})));case 27:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function s(e){Xe(o,r,n,s,a,"next",e)}function a(e){Xe(o,r,n,s,a,"throw",e)}s(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"setLocalMediaStream",value:function(e,t){var r=this;if(this.logger.debug("SessionDescriptionHandler.setLocalMediaStream"),!this._peerConnection)throw new Error("Peer connection undefined.");var n=this._peerConnection,i=this._localMediaStream,o=[],s=function(e){var s=e.kind;if("audio"!==s&&"video"!==s)throw new Error("Unknown new track kind ".concat(s,"."));var a=n.getSenders().find((function(e){return e.track&&e.track.kind===s}));a?o.push(new Promise((function(e){r.logger.debug("SessionDescriptionHandler.setLocalMediaStream - replacing sender ".concat(s," track")),e()})).then((function(){return a.replaceTrack(e).then((function(){var t=i.getTracks().find((function(e){return e.kind===s}));t&&(t.stop(),i.removeTrack(t),u.dispatchRemoveTrackEvent(i,t)),i.addTrack(e),u.dispatchAddTrackEvent(i,e)})).catch((function(e){throw r.logger.error("SessionDescriptionHandler.setLocalMediaStream - failed to replace sender ".concat(s," track")),e}))}))):o.push(new Promise((function(e){r.logger.debug("SessionDescriptionHandler.setLocalMediaStream - adding sender ".concat(s," track")),e()})).then((function(){try{"video"===s&&void 0!==t?(t.updateTrack(e),r.addTransceiverVideoTrack(i,e,t)):n.addTrack(e,i)}catch(e){throw r.logger.error("SessionDescriptionHandler.setLocalMediaStream - failed to add sender ".concat(s," track")),e}i.addTrack(e),u.dispatchAddTrackEvent(i,e)})))},a=e.getAudioTracks();a.length&&s(a[0]);var c=e.getVideoTracks();return c.length&&s(c[0]),o.reduce((function(e,t){return e.then((function(){return t}))}),Promise.resolve())}},{key:"getLocalSessionDescription",value:function(){if(this.logger.debug("SessionDescriptionHandler.getLocalSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));var e=this._peerConnection.localDescription;return e?Promise.resolve(e):Promise.reject(new Error("Failed to get local session description"))}},{key:"setLocalSessionDescription",value:function(e){return this.logger.debug("SessionDescriptionHandler.setLocalSessionDescription"),void 0===this._peerConnection?Promise.reject(new Error("Peer connection closed.")):this._peerConnection.setLocalDescription(e)}},{key:"rollbackLocalSessionDescription",value:function(){return this.logger.debug("SessionDescriptionHandler.rollbackLocalSessionDescription"),void 0===this._peerConnection?Promise.reject(new Error("Peer connection closed.")):this._peerConnection.setLocalDescription({type:"rollback"})}},{key:"setRemoteSessionDescription",value:function(e){if(this.logger.debug("SessionDescriptionHandler.setRemoteSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));var t,r=e.sdp;switch(this._peerConnection.signalingState){case"stable":t="offer";break;case"have-local-offer":t="answer";break;default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}return r?this._peerConnection.setRemoteDescription({sdp:r,type:t}):(this.logger.error("SessionDescriptionHandler.setRemoteSessionDescription failed - cannot set null sdp"),Promise.reject(new Error("SDP is undefined")))}},{key:"setRemoteTrack",value:function(e){this.logger.debug("setRemoteTrack");var t=this._remoteMediaStream;t.getTrackById(e.id)?this.logger.debug("SessionDescriptionHandler.setRemoteTrack - have remote ".concat(e.kind," track")):"audio"===e.kind?(this.logger.debug("SessionDescriptionHandler.setRemoteTrack - adding remote ".concat(e.kind," track")),t.getAudioTracks().forEach((function(e){e.stop(),t.removeTrack(e),u.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),u.dispatchAddTrackEvent(t,e)):"video"!==e.kind||this.isConference||(this.logger.debug("SessionDescriptionHandler.setRemoteTrack - adding remote ".concat(e.kind," track")),t.getVideoTracks().forEach((function(e){e.stop(),t.removeTrack(e),u.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),u.dispatchAddTrackEvent(t,e))}},{key:"iceGatheringComplete",value:function(){this.logger.debug("SessionDescriptionHandler.iceGatheringComplete"),void 0!==this.iceGatheringCompleteTimeoutId&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - clearing timeout"),clearTimeout(this.iceGatheringCompleteTimeoutId),this.iceGatheringCompleteTimeoutId=void 0),void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - resolving promise"),this.iceGatheringCompleteResolve&&this.iceGatheringCompleteResolve(),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0)}},{key:"waitForIceGatheringComplete",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete"),void 0===this._peerConnection?Promise.reject("Peer connection closed."):t||"complete"!==this._peerConnection.iceGatheringState?(void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - rejecting prior waiting promise"),this.iceGatheringCompleteReject&&this.iceGatheringCompleteReject(new Error("Promise superseded.")),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0),this.iceGatheringCompletePromise=new Promise((function(t,n){e.iceGatheringCompleteResolve=t,e.iceGatheringCompleteReject=n,r>0&&(e.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - timeout in "+r),e.iceGatheringCompleteTimeoutId=setTimeout((function(){e.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - timeout"),e.iceGatheringComplete()}),r))})),this.iceGatheringCompletePromise):(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - already complete"),Promise.resolve())}},{key:"initPeerConnectionEventHandlers",value:function(){var e=this;if(this.logger.debug("initPeerConnectionEventHandlers"),!this._peerConnection)throw new Error("Peer connection undefined.");var t=this._peerConnection;t.onconnectionstatechange=function(r){var n=e._peerConnectionDelegate,i=t.connectionState;e.logger.debug("onconnectionstatechange ".concat(i)),"disconnected"!==i&&"connected"!==i&&"failed"!==i||e.emit("sdhconnection-".concat(i)),n&&n.onconnectionstatechange&&(e.logger.debug("in onconnectionstatechange == "),e._peerConnectionDelegate.onconnectionstatechange(r))},t.onicecandidate=function(t){var r,n=e._peerConnectionDelegate;e.logger.debug(null===(r=t.candidate)||void 0===r?void 0:r.candidate),n&&n.onicecandidate&&e._peerConnectionDelegate.onicecandidate(t)},t.onicecandidateerror=function(t){var r=e._peerConnectionDelegate;e.logger.debug("SessionDescriptionHandler.onicecandidateerror"),r&&r.onicecandidateerror&&e._peerConnectionDelegate.onicecandidateerror(t)},t.oniceconnectionstatechange=function(r){var n=e._peerConnectionDelegate,i=t.iceConnectionState;e.logger.debug("SessionDescriptionHandler.oniceconnectionstatechange ".concat(i)),n&&n.oniceconnectionstatechange&&e._peerConnectionDelegate.oniceconnectionstatechange(r)},t.onicegatheringstatechange=function(r){var n=e._peerConnectionDelegate,i=t.iceGatheringState;e.logger.debug("SessionDescriptionHandler.onicegatheringstatechange ".concat(i)),"complete"===i&&e.iceGatheringComplete(),n&&n.onicegatheringstatechange&&e._peerConnectionDelegate.onicegatheringstatechange(r)},t.onnegotiationneeded=function(t){var r=e._peerConnectionDelegate;e.logger.debug("SessionDescriptionHandler.onnegotiationneeded"),r&&r.onnegotiationneeded&&e._peerConnectionDelegate.onnegotiationneeded(t)},t.onsignalingstatechange=function(r){var n=e._peerConnectionDelegate,i=t.signalingState;e.logger.debug("SessionDescriptionHandler.onsignalingstatechange ".concat(i)),n&&n.onsignalingstatechange&&e._peerConnectionDelegate.onsignalingstatechange(r)},t.onstatsended=function(t){var r=e._peerConnectionDelegate;e.logger.debug("SessionDescriptionHandler.onstatsended"),r&&r.onstatsended&&e._peerConnectionDelegate.onstatsended(t)},t.ontrack=function(t){var r=e._peerConnectionDelegate,n=t.track.kind,i=t.track.enabled?"enabled":"disabled";e.logger.debug("SessionDescriptionHandler.ontrack ".concat(n," ").concat(i)),e.logger.debug(t),t.transceiver.mid.startsWith("pss")||e.setRemoteTrack(t.track),r&&r.onTrack&&e._peerConnectionDelegate.onTrack(t)}}},{key:"clearDummyVideo",value:function(){this.logger.debug("wtpSessionDescriptionHandler clearDummyVideo"),this.dummyVideo&&(clearInterval(this.dummyVideo),this.dummyVideo=void 0)}},{key:"release",value:function(){this.logger.debug("Release wtpSessionDescriptionHandler"),this.changeIntervalOfDummyVideo&&(clearTimeout(this.changeIntervalOfDummyVideo),this.changeIntervalOfDummyVideo=void 0),this.clearDummyVideo()}},{key:"_getDummyVideoTrack",value:function(){var e=this,t=Object.assign(document.createElement("canvas"),{width:640,height:480}),r=function(){t.getContext("2d").fillRect(0,0,640,480)};return r(),this.dummyVideo=setInterval(r,50),this.changeIntervalOfDummyVideo=setTimeout((function(){e.clearDummyVideo(),e.dummyVideo=setInterval(r,3e3)}),2e4),t.captureStream().getVideoTracks()[0]}}],n=[{key:"dispatchAddTrackEvent",value:function(e,t){e.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:t}))}},{key:"dispatchRemoveTrackEvent",value:function(e,t){e.dispatchEvent(new MediaStreamTrackEvent("removetrack",{track:t}))}}],r&&Qe(t.prototype,r),n&&Qe(t,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(qe);function nt(){return function(e){return void 0===navigator.mediaDevices?Promise.reject(new Error("Media devices not available in insecure contexts.")):e.audio||e.video?navigator.mediaDevices.getUserMedia.call(navigator.mediaDevices,e):Promise.resolve(new MediaStream)}}function it(e,t){if(e){if("string"==typeof e)return ot(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ot(e,t):void 0}}function ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function st(){return!!function(){if(window.chrome)return!0;var e,t=at();if("Safari"===t.browser){var r=function(e){if(Array.isArray(e))return e}(e=t.version.split("."))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),2!==o.length);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}}(e)||it(e,2)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=r[0],i=r[1];return n=parseInt(n),i=parseInt(i),n>14||14===n&&i>=5}return!1}()&&!("undefined"==typeof RTCPeerConnection||!(new RTCPeerConnection).connectionState)}function at(){if(navigator.userAgentData){var e,t,r=/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+/,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=it(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}(navigator.userAgentData.brands);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!/chromium/i.test(i.brand)&&!r.test(i.brand)){e=i;break}}}catch(e){n.e(e)}finally{n.f()}return e?{browser:e.brand.includes("Chrome")?"Chrome":e.brand.includes("Edge")?"Edge":e.brand.includes("Opera")?"Opera":e.brand.includes("Whale")?"Whale":"others",version:e.version}:{browser:"",version:""}}var o,s=navigator.userAgent,a=s.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d+.]+)/i)||[];return"Trident"===a[1]?{browser:"IE",version:(o=/\brv[ :]+([\d+.]+)/g.exec(s)||[])[1]||""}:"Chrome"===a[1]&&null!=(o=s.match(/(OPR|Edge)\/([\d+.]+)/))?{browser:"OPR"===o[0]?"Opera":"Edge",version:o[1]}:(a=void 0!==a[2]?[a[1],a[2]]:["","",""],null!=(o=s.match(/version\/([\d+.]+)/i))&&a.splice(1,1,o[1]),{browser:a[0],version:a[1]})}function ct(){var e=document.createElement("video"),t=!1;return e.canPlayType&&(t=""!==e.canPlayType('video/mp4; codecs="avc1.42E01E"')),t}function ut(e){if(void 0!==e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}}function dt(e){for(var t=new Uint8Array(e),r=t.byteLength,n="",i=0;i<r;i++)n+=String.fromCharCode(t[i]);return window.btoa(n)}r(6699),r(2023),r(561);var lt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"isSupported",value:function(){return st()}},{key:"createMediaStream",value:function(e,t){var r=this,n=Object.assign({audio:!0},null==e?void 0:e);return this.mediaStreamFactory=nt(),this.mediaStreamFactory(n).then((function(e){if(t&&e.getVideoTracks().length){t.srcObject=e,t.muted=!0;var n=t.play();void 0!==n&&n.then((function(){})).catch((function(e){r.logger.warn("catch error at playCustomVideo: ".concat(e))}))}return Promise.resolve(e)}))}},{key:"cleanupMediaStream",value:function(e){e&&e.getTracks().forEach((function(e){e.stop()}))}},{key:"setVideoMirror",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;Array.isArray(t)||(t=[t]),t.forEach((function(t){t&&(t.style.transform=e?"rotateY(180deg)":"",t.style.webkitTransform=e?"rotateY(180deg)":"",t.style.mozTransform=e?"rotateY(180deg)":"")}))}},{key:"isChromium",value:function(){for(var e in navigator.userAgentData.brands)if("Chromium"==e.brand)return!0;return!1}},{key:"getBrowserInfo",value:function(){return at()}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ht=(r(3371),Object.freeze({LINE:"line",PLANET_KIT:"planetkit"})),pt=Object.freeze({STATE_INIT:"STATE_INIT",STATE_READY:"STATE_READY",STATE_CONNECTING:"STATE_CONNECTING",STATE_VERIFIED:"STATE_VERIFIED",STATE_ANSWERED:"STATE_ANSWERED",STATE_CONNECTED:"STATE_CONNECTED",STATE_DISCONNECTED:"STATE_DISCONNECTED",STATE_RELEASED:"STATE_RELEASED"}),ft=Object.freeze({INITIATOR:"initiator",RESPONDER:"responder",CONFERENCE:"conference"}),gt=Object.freeze({AUDIO:"A",VIDEO:"V",AUDIO_TO_VIDEO:"AV",VIDEO_TO_AUDIO:"VA"}),vt=Object.freeze({INIT:-1,AUDIO:0,VIDEO_TO_AUDIO:1,AUDIO_TO_VIDEO:2,VIDEO:3}),mt=Object.freeze({AUDIO:"audio",VIDEO:"video"}),St=Object.freeze({DISABLED:"disabled",ENABLED:"enabled",PAUSED:"paused"}),Et=Object.freeze({THIS:"THIS",PEER:"PEER",OTHERS:"OTHERS"}),_t=Object.freeze({NORMAL:0,PAUSED:1,BLOCKED:2,PAUSED_BLOCKED:3}),yt=Object.freeze({BY_USER:0,BY_INTERRUPT:1,UNDEFINED:2,INTERNAL:3,ENABLE_VIDEO_RESPONSE:4,CAMERA_INACTIVE:5,HOLD:6});function Tt(e){return Object.keys(yt).find((function(t){return yt[t]===e}))}var Rt=Object.freeze({NORMAL:0,PAUSED:1,BLOCKED:2,PAUSED_BLOCKED:3,ENABLE_VIDEO_RESPONSE:4,CAMERA_INACTIVE:5}),At=Object.freeze({STREAM_CTRL:"application/stream-ctrl+json",USER_INFO:"application/user-info+json",REQUEST_USER_INFO:"application/request-user-info+json",REQUEST_USER_VIEW:"application/request-user-view+json",NOTIFY_USER_STATUS:"application/notify-user-status+json",FEATURE_SHARE:"application/feature-share+json",FEATURE_SHARE_RESULT:"application/feature-share-result+json",FEATURE_QUERY:"application/feature-query+json",USER_MESSAGE:"application/user-message+json",DATA_INFO:"application/data-info+json",DATA_CTRL:"application/data-ctrl+json",APPLICATION_CONTROL:"application/application-control+json",RECORDING_STATUS:"application/recording-status+json"}),wt=Object.freeze({MIC_STATUS:0,CAMERA_STATUS:1,HOLD_STATUS:2,SHARED_CONTENTS:3,EXCLUSIVELY_SHARED_CONTENTS:4,ROOM_SHARED_CONTENTS:5}),bt=Object.freeze({UNSET:0,SET:1}),Ct=Object.freeze({OK:0,NOK:1}),Ot=Object.freeze({INIT:0,START:1,STOP:2,RESTART:3,FAILED:4});function It(e){return Object.keys(Ot).find((function(t){return Ot[t]===e}))}Object.freeze({UNDEFINED:0,USER:1,WND_MINIMIZED:2,EXCEPTION:101});var Pt=Object.freeze({WIDTH:1280,HEIGHT:720}),Nt=Object.freeze({FALSE:0,TRUE:1}),Dt=Object.freeze({DEBUG:3,LOG:2,WARN:1,ERROR:0}),Lt=Object.freeze({NONE:0,ANDROID:1,IOS:2,LINUX:3,MAC:4,WINDOWS:5,WEB:6,SIP_TERMINAL:100});function Mt(e){var t;return null===(t=Object.keys(Lt).find((function(t){return Lt[t]===e})))||void 0===t?void 0:t.toLowerCase()}var kt=Object.freeze({CALL_TX:2700,GROUPCALL_TX:3200,RX:6e3}),xt=Object.freeze({INTERNAL:"internal",ACTIVATION_FAILED:"activation_failed"}),Ut="4.2.1",Vt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.devPlatform=t,this.lastPauseReason=Rt.NORMAL}var t,r;return t=e,r=[{key:"getVideoPauseReason",value:function(e){switch(e){case Rt.NORMAL:return this.selectValueAsPlatform(_t.NORMAL,void 0);case Rt.PAUSED:return this.selectValueAsPlatform(_t.PAUSED,yt.BY_USER);case Rt.BLOCKED:return this.selectValueAsPlatform(_t.BLOCKED,yt.INTERNAL);case Rt.PAUSED_BLOCKED:return this.selectValueAsPlatform(_t.PAUSED_BLOCKED,yt.PAUSED);case Rt.ENABLE_VIDEO_RESPONSE:return this.selectValueAsPlatform(_t.PAUSED,yt.ENABLE_VIDEO_RESPONSE);case Rt.CAMERA_INACTIVE:return this.selectValueAsPlatform(_t.PAUSED,yt.CAMERA_INACTIVE)}}},{key:"selectValueAsPlatform",value:function(){switch(this.devPlatform){case ht.LINE:return arguments.length<=0?void 0:arguments[0];case ht.PLANET_KIT:return arguments.length<=1?void 0:arguments[1];default:return arguments.length<=0?void 0:arguments[0]}}},{key:"needSendVideoReason",value:function(e){return this.devPlatform===ht.LINE||this.devPlatform!==ht.PLANET_KIT||(e===Rt.NORMAL?(this.lastPauseReason=Rt.NORMAL,!0):e!==Rt.NORMAL&&this.lastPauseReason===Rt.NORMAL&&(this.lastPauseReason=e,!0))}},{key:"initLastPauseReason",value:function(){this.lastPauseReason=Rt.NORMAL}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Ht=function(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.log=new u,this.log.level=r,this.logger=this.log.getLogger(t)}));function jt(e){switch(e){case Dt.DEBUG:return"debug";case Dt.LOG:return"log";case Dt.WARN:return"warn";case Dt.ERROR:return"error";default:return"log"}}function $t(){return"hidden"in document?"hidden":(["ms","webkit","moz","o"].forEach((function(e){if(void 0!==document[e+"Hidden"])return e+"Hidden"})),null)}var Bt=Object.freeze({AMP_TERM_CALL_THIS:1,AMP_TERM_CALL_THIS_IP_CHANGED:2,AMP_TERM_CALL_THIS_NO_ANSWER:3,AMP_TERM_CALL_THIS_DESTROY:4,AMP_TERM_CALL_THIS_PHONECALL_EVT:7,AMP_TERM_CALL_THIS_FCALL:8,AMP_TERM_CALL_THIS_CALL_BEFORE_AUTH:9,AMP_TERM_CALL_THIS_BY_SYSTEM:10,AMP_TERM_CALL_THIS_DEPRECATED:11,AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL:12,AMP_TERM_CALL_THIS_BY_SLEEP:13,AMP_TERM_CALL_THIS_BY_LOGOFF:14,AMP_TERM_CALL_PEER:51,AMP_TERM_CALL_PEER_DECLINED:52,AMP_TERM_CALL_PEER_NO_RESPONSE:53,AMP_TERM_CALL_PEER_DESTROY:54,AMP_TERM_CALL_PEER_PHONECALL_EVT:55,AMP_TERM_CALL_PEER_NO_MEDIA_PACKET_FROM_PEER:56,AMP_TERM_CALL_PEER_ACCEPT_FAIL:57,AMP_TERM_CALL_PEER_AUDIO_DEV_FAIL:58,AMP_TERM_CALL_PEER_IPCHANGE:59,AMP_TERM_CALL_PEER_SERVICE_SIG_FAIL:60,AMP_TERM_CALL_PEER_SERVICE_MED_FAIL:61,AMP_TERM_CALL_PEER_FCALL_NO_RESPONSE:62,AMP_TERM_CALL_PEER_SERVICE_MED_FAIL_CALLING:63,AMP_TERM_CALL_PEER_BY_SYSTEM:64,AMP_TERM_CALL_PEER_NO_AUDIO_SOURCE:65,AMP_TERM_CALL_PEER_NO_AUDIO_TX_STREAM:66,AMP_TERM_CALL_PEER_DEPRECATED:67,AMP_TERM_CALL_PEER_ACC_NET_UNAVAIL:68,AMP_TERM_CALL_PEER_BY_SLEEP:69,AMP_TERM_CALL_PEER_BY_LOGOFF:70,AMP_TERM_CALL_ERROR_NO_RESPONSE:101,AMP_TERM_CALL_ERROR_NO_MEDIA_PACKET_FROM_PEER:102,AMP_TERM_CALL_ERROR_ACCEPT_FAIL:103,AMP_TERM_CALL_ERROR_AUDIO_DEV_FAIL:104,AMP_TERM_CALL_ERROR_PASSWD:105,AMP_TERM_CALL_ERROR_NEWCALL:106,AMP_TERM_CALL_ERROR_IPCHANGE:108,AMP_TERM_CALL_ERROR_SOMEONE_CALLING_THIS:109,AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL:110,AMP_TERM_CALL_ERROR_SERVICE_MED_FAIL:111,AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA:116,AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE:117,AMP_TERM_CALL_ERROR_SERVICE_MED_FAIL_CALLING:118,AMP_TERM_CALL_ERROR_NO_AUDIO_SOURCE:119,AMP_TERM_CALL_ERROR_NO_AUDIO_TX_STREAM:120,AMP_TERM_CALL_ERROR_HANDLE_INVITE:121,AMP_TERM_CALL_ERROR_TCP_TUNNELLING_FAIL:122,AMP_TERM_CALL_ERROR_TCP_TUNNELLING_DOWN:123,AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE:124,AMP_TERM_CALL_CLI_ABORT:200,AMP_TERM_CALL_CLI_NOT_ALLOWED:201,AMP_TERM_CALL_CLI_NOT_FOUND:202,AMP_TERM_CALL_CLI_NOT_READABLE:203,AMP_TERM_CALL_CLI_OVERCONSTRAINED:204,AMP_TERM_CALL_CLI_SECURITY_ERROR:205,AMP_TERM_CALL_CLI_TYPE_ERROR:206,AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER:207,AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT:208,AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED:209,AMP_TERM_CALL_SERV_TIMEOUT:300,AMP_TERM_CALL_SERV_INTERNAL_SERVER_ERROR:301,AMP_TERM_CALL_SERV_RESOURCE_LIMIT:302,AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLER_DOMAIN:303,AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLED_DOMAIN:304,AMP_TERM_CALL_SERV_ALREADY_GOT_A_CALL:305,AMP_TERM_CALL_SERV_SESSION_REMAIN:306,AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE:307,AMP_TERM_CALL_SERV_DB_ERROR:308,AMP_TERM_CALL_SERV_CALLEE_BUSY:309,AMP_TERM_CALL_SERV_UNKNOWN_CALLEE:310,AMP_TERM_CALL_SERV_LINE_SERVER_ERROR:311,AMP_TERM_CALL_SERV_PUSH_ERROR:312,AMP_TERM_CALL_SERV_UNAUTHORIZED:313,AMP_TERM_CALL_SERV_RELAY_ERROR:314,AMP_TERM_CALL_SERV_CALL_STATE_MISMATCHED:315,AMP_TERM_CALL_SERV_MANDATORY_MISSING:316,AMP_TERM_CALL_SERV_CALL_KEY_MISMATCHED:317,AMP_TERM_CALL_SERV_CALL_DOES_NOT_EXIST:318,AMP_TERM_CALL_SERV_INVALID_SIP_MSG:319,AMP_TERM_CALL_SERV_HB_ERROR:320,AMP_TERM_CALL_SERV_INVITE_ERROR_RSP:321,AMP_TERM_CALL_SERV_INVALID_CALL_KEY:322,AMP_TERM_CALL_SERV_UNKNOWN_SERVICE:330,AMP_TERM_CALL_SERV_UNKNOWN_SERVICE_NODE:331,AMP_TERM_CALL_SERV_PROTOCOL_ERROR:332,AMP_TERM_CALL_SERV_BOT_SERVER_ERROR:340,AMP_TERM_CALL_SERV_RTM_SERVER_ERROR:341,AMP_TERM_CALL_SERV_RTS_SERVER_ERROR:342,AMP_TERM_CALL_SERV_MEDIA_TIMEOUT:343,AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT:400,AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT:401,AMP_TERM_CALL_SERV_MULTIDEV_MAX_EXCEEDED:402,AMP_TERM_CALL_SERV_TURN_OVERLOAD:410,AMP_TERM_CALL_SERV_MIXER_ONE_KICKOUT:411,AMP_TERM_CALL_SERV_MIXERCSCF_CONGESTION:412,AMP_TERM_CALL_SERV_CASTER_NOT_EXIST:413,AMP_TERM_CALL_SERV_CALL_END_BY_FORCE:500,AMP_TERM_CALL_SERV_SVC_NODE_FAILOVER:501,AMP_TERM_CALL_SERV_USER_KICKOUT:502,AMP_TERM_CALL_ERROR_UNKNOWN:600});function Ft(e,t){var r={};switch(t){case 1:case 2:r=qt(e,"AMP_TERM_CALL_THIS","AMP_TERM_CALL_PEER","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 3:r=qt(e,"AMP_TERM_CALL_THIS","AMP_TERM_CALL_PEER_DECLINED","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 4:r=qt(e,"AMP_TERM_CALL_SERV_CALLEE_BUSY","AMP_TERM_CALL_SERV_CALLEE_BUSY","AMP_TERM_CALL_SERV_CALLEE_BUSY");break;case 5:case 214:r=qt(e,"AMP_TERM_CALL_THIS_NO_ANSWER","AMP_TERM_CALL_PEER_NO_RESPONSE","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 6:r=qt(e,"AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE","AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE","AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE");break;case 7:r=qt(e,"AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT");break;case 8:r=qt(e,"AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT");break;case 100:r=qt(e,"AMP_TERM_CALL_SERV_MANDATORY_MISSING","AMP_TERM_CALL_SERV_MANDATORY_MISSING","AMP_TERM_CALL_SERV_MANDATORY_MISSING");break;case 101:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_CALL_STATE_MISMATCHED");break;case 102:case 200:case 213:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_INTERNAL_SERVER_ERROR");break;case 103:case 413:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_PROTOCOL_ERROR");break;case 104:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLER_DOMAIN");break;case 105:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLED_DOMAIN");break;case 106:case 107:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 109:case 209:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_DB_ERROR");break;case 115:r=qt(e,"AMP_TERM_CALL_ERROR_NO_RESPONSE","AMP_TERM_CALL_ERROR_NO_RESPONSE","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 201:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_RELAY_ERROR");break;case 202:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_UNAUTHORIZED");break;case 203:case 204:case 206:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_LINE_SERVER_ERROR");break;case 205:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_PUSH_ERROR");break;case 207:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_UNKNOWN_CALLEE");break;case 210:case 211:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_CALL_DOES_NOT_EXIST");break;case 212:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_CALL_END_BY_FORCE");break;case 215:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_ALREADY_GOT_A_CALL");break;case 216:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_RESOURCE_LIMIT");break;case 217:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_TIMEOUT");break;case 218:r=qt(e,"AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL","AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL","AMP_TERM_CALL_SERV_HB_ERROR");break;case 230:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_PEER_ACC_NET_UNAVAIL");break;case 235:r=qt(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_MULTIDEV_MAX_EXCEEDED");break;case 500:r=qt(e,"AMP_TERM_CALL_ERROR_NO_MEDIA_PACKET_FROM_PEER","AMP_TERM_CALL_PEER_NO_MEDIA_PACKET_FROM_PEER","AMP_TERM_CALL_PEER_NO_MEDIA_PACKET_FROM_PEER");break;case 501:r=qt(e,"AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE","AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE","AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE");break;case 502:r=qt(e,"AMP_TERM_CALL_ERROR_NO_AUDIO_SOURCE","AMP_TERM_CALL_PEER_NO_AUDIO_SOURCE","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 503:r=qt(e,"AMP_TERM_CALL_ERROR_NO_AUDIO_TX_STREAM","AMP_TERM_CALL_PEER_NO_AUDIO_TX_STREAM","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 504:r=qt(e,"AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL","AMP_TERM_CALL_PEER_SERVICE_SIG_FAIL","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 505:r=qt(e,"AMP_TERM_CALL_THIS_PHONECALL_EVT","AMP_TERM_CALL_PEER_PHONECALL_EVT","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 506:r=qt(e,"AMP_TERM_CALL_THIS_DESTROY","AMP_TERM_CALL_PEER_DESTROY","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 507:r=qt(e,"AMP_TERM_CALL_THIS_BY_SYSTEM","AMP_TERM_CALL_PEER_BY_SYSTEM","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 508:r=qt(e,"AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA","AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA","AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA");break;case 509:r=qt(e,"AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE","AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE","AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE");break;case 510:r=qt(e,"AMP_TERM_CALL_ERROR_AUDIO_DEV_FAIL","AMP_TERM_CALL_PEER_AUDIO_DEV_FAIL","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 512:r=qt(e,"AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL","AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL","AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL");break;case 522:r=qt(e,"AMP_TERM_CALL_THIS_BY_SLEEP","AMP_TERM_CALL_PEER_BY_SLEEP","AMP_TERM_CALL_THIS_BY_SLEEP");break;case 523:r=qt(e,"AMP_TERM_CALL_THIS_BY_LOGOFF","AMP_TERM_CALL_PEER_BY_LOGOFF","AMP_TERM_CALL_THIS_BY_LOGOFF");break;case 600:r=qt(e,"AMP_TERM_CALL_CLI_ABORT","AMP_TERM_CALL_CLI_ABORT","AMP_TERM_CALL_CLI_ABORT");break;case 601:r=qt(e,"AMP_TERM_CALL_CLI_NOT_ALLOWED","AMP_TERM_CALL_CLI_NOT_ALLOWED","AMP_TERM_CALL_CLI_NOT_ALLOWED");break;case 602:r=qt(e,"AMP_TERM_CALL_CLI_NOT_FOUND","AMP_TERM_CALL_CLI_NOT_FOUND","AMP_TERM_CALL_CLI_NOT_FOUND");break;case 603:r=qt(e,"AMP_TERM_CALL_CLI_NOT_READABLE","AMP_TERM_CALL_CLI_NOT_READABLE","AMP_TERM_CALL_CLI_NOT_READABLE");break;case 604:r=qt(e,"AMP_TERM_CALL_CLI_OVERCONSTRAINED","AMP_TERM_CALL_CLI_OVERCONSTRAINED","AMP_TERM_CALL_CLI_OVERCONSTRAINED");break;case 605:r=qt(e,"AMP_TERM_CALL_CLI_SECURITY_ERROR","AMP_TERM_CALL_CLI_SECURITY_ERROR","AMP_TERM_CALL_CLI_SECURITY_ERROR");break;case 606:r=qt(e,"AMP_TERM_CALL_CLI_TYPE_ERROR","AMP_TERM_CALL_CLI_TYPE_ERROR","AMP_TERM_CALL_CLI_TYPE_ERROR");break;case 607:r=qt(e,"AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER");break;case 608:r=qt(e,"AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT");break;case 609:r=qt(e,"AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED","AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED","AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED");break;default:r={code:void 0,strCode:"UNDEFINED"}}return r}function qt(e,t,r,n){var i={};switch(e){case Et.THIS:i={code:Bt[t],strCode:t};break;case Et.PEER:i={code:Bt[r],strCode:r};break;case Et.OTHERS:i={code:Bt[n],strCode:n};break;default:i={code:void 0,strCode:"UNDEFINED"}}return i}var Kt=Object.freeze({UNDEFINED:0,NORMAL:1,CANCEL:2,REJECT:3,USER_BUSY:4,NO_ANSWER:5,MULTI_DEV_OTHER_DEV_IN_USE:6,MULTI_DEV_OTHER_DEV_ANSWER:7,MULTI_DEV_OTHER_DEV_REJECT:8,MANDATORY_INFO_MISSING:100,INVALID_STATE:101,MEM_FAIL:102,PROTOCOL_ERR:103,INVALID_I_ZONE:104,INVALID_R_ZONE:105,RETRY_AFTER:106,OBJ_CREATE_FAIL:107,SESS_NOT_FOUND:108,SCHAN_NOT_FOUND:109,MCHAN_NOT_FOUND:110,COMM_NOT_FOUND:111,INVALID_MSG:112,TRPT_ERR:113,TRPT_DISCONNECTED:114,REQ_TIMEOUT:115,STALE_EVENT:116,INVALID_FEATURE_SET:117,INVALID_FEATURE_QUERY:118,FEATURE_NOT_FOUND:119,INVALID_SVC_ID:120,INVALID_TGT_SVC_ID:121,MAX_CALL_TIME_EXCEED:122,INTERNAL_ERROR:200,RELAY_ERROR:201,AUTH_ERROR:202,PUSH_REQ_FAIL:203,TOKEN_REQ_FAIL:204,PUSH_ERROR:205,TOKEN_ERROR:206,USER_NOT_FOUND_PUSH:207,USER_NOT_FOUND_TOKEN:208,DB_ERROR:209,DB_COMM_NOT_FOUND:210,DB_CHAN_NOT_FOUND:211,REMAIN_COMM_CLEAN:212,HUNTING_ERROR:213,ANSWER_TIMEOUT_BY_SVR:214,ALREADY_GOT_A_CALL:215,NO_RESOURCE:216,IF_TIMEOUT:217,SESS_KEEPALIVE_TIMEOUT:218,SESS_ACTIVE_TIMEOUT:219,MEDIA_FACILITY_ERROR:220,MEDIA_BRIDGING_ERROR:221,SWITCH_OVER_ERROR:222,HAND_OVER_ERROR:223,SESS_NOT_SELECTED:224,B_SESS_ACTIVE_TIMEOUT:225,INVALID_TOKEN_RSP:226,B_SESS_KEEPALIVE_TIMEOUT:227,DB_STATUS_NOT_FOUND:228,MAX_CFG_LEN_EXCEEDED:229,UE_UNREACHABLE:230,INVALID_PUSH_RSP:231,MAX_CPS_EXCEEDED:232,RELEASE_BY_SO:233,RELEASE_BY_GDOWN:234,MAX_MULTI_DEV_EXCEEDED:235,SERVER_NO_RESPOND:236,RELEASE_BY_GC:300,ROOM_AUTH_ERROR:400,ROOM_IS_FULL:401,ROOM_NOT_FOUND:402,USER_ATTR_ERROR:403,ALONE_KICK_OUT:405,MAX_GCALL_TIME_EXCEEDED:406,NOT_JOINED:410,NOT_USER_INFO:411,CASTER_NOT_EXIST:412,ROOM_ATTRS_ERROR:413,ROOM_DESTROY:415,ROOM_DESTROY_BY_USER:416,ROOM_FORCE_CLOSE:417,ROOM_FORCE_CLOSE_BY_USER:418,ROOM_CHAN_CREATE_FAIL:450,ROOM_CHAN_ATTRS_ERROR:451,ROOM_CHAN_NOT_FOUND:452,NO_MEDIA_PACKETS:500,NETWORK_UNREACHABLE:501,NO_MEDIA_SRC:502,NO_MEDIA_SENT:503,SESSION_FAIL:504,CELLULAR_CALL:505,UE_DESTROY:506,UE_SYSTEM:507,HUY_NEGO_FAIL:508,SVR_CONFIG_LOAD_FAIL:509,AUDIO_DEV_FAIL:510,CONN_REQ_FAIL:511,NETWORK_UNAVAILABLE:512,USR_INTERNAL_ERR:513,APP_DEFINED_ERR:514,CHAN_UNSUBS_FAIL_ACTIVE_AUDIO:515,CHAN_UNSUBS_FAIL_ACTIVE_VIDEO:516,CHAN_UNSUBS_FAIL_NOT_IN_CHAN:517,CHAN_UNSUBS_FAIL_ACTIVE_PRESENTATION:518,CHAN_UNSUBS_FAIL_ACTIVE_DATA:519,ANOTHER_INSTANCE_TRY_TO_CONNECT:520,KIT_DEFINED_ERR:521,UE_SLEEP:522,UE_LOGOFF:523,MTU_EXCEEDED:524,ABORT:600,NOT_ALLOWED:601,NOT_FOUND:602,NOT_READABLE:603,OVERCONSTRAINED:604,SECURITY_ERROR:605,TYPE_ERROR:606,CALL_CONNECT_FAIL_BY_SERVER:607,CALL_CONNECT_FAIL_BY_CLIENT:608,WEB_SIGNALING_UNEXPECTED_DISCONNECTED:609,UNKNOWN_ERROR:1e3});function Wt(e){return{code:e,strCode:Gt(e)}}function Gt(e){return Object.keys(Kt).find((function(t){return Kt[t]===e}))}function Yt(e,t){return"true"===t.opusStereo?e=Xt(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=Jt(e,"opus/48000","stereo")),"true"===t.opusFec?e=Xt(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=Jt(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=Xt(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=Jt(e,"opus/48000","usedtx")),null!==t.opusMinptime&&(e=Xt(e,"opus/48000","minptime",t.opusMinptime)),t.opusMaxPbr&&(e=Xt(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e}function zt(e,t){return null!==t.imageattr&&(e=function(e,t){var r=e.split("\r\n"),n=tr(r,"a=rtpmap","vp8/90000");if(null===n)return e;var i="a=imageattr:"+rr(r[n])+" send * recv *";return r.splice(n+1,0,i),r.join("\r\n")}(e)),e}function Xt(e,t,r,n){var i=e.split("\r\n"),o=er(i,t),s={};if(null===o){var a=tr(i,"a=rtpmap",t);if(null===a)return e;var c=rr(i[a]);s.pt=c.toString(),s.params={},s.params[r]=n,i.splice(a+1,0,Qt(s))}else(s=Zt(i[o])).params[r]=n,i[o]=Qt(s);return i.join("\r\n")}function Jt(e,t,r){var n=e.split("\r\n"),i=er(n,t);if(null===i)return e;var o=Zt(n[i]);delete o.params[r];var s=Qt(o);return null===s?n.splice(i,1):n[i]=s,n.join("\r\n")}function Zt(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split(";"),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var s={},a=0;a<n.length;++a){var c=n[a].split("=");2===c.length&&(s[c[0]]=c[1])}return t.params=s,t}function Qt(e){if(!Object.prototype.hasOwnProperty.call(e,"pt")||!Object.prototype.hasOwnProperty.call(e,"params"))return null;var t=e.pt,r=e.params,n=[],i=0;for(var o in r)n[i]=o+"="+r[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+n.join(";")}function er(e,t){var r=function(e,t){var r=tr(e,"a=rtpmap",t);return r?rr(e[r]):null}(e,t);return r?tr(e,"a=fmtp:"+r.toString()):null}function tr(e,t,r){return function(e,t,r,n,i,o){if(void 0===o&&(o="asc"),"asc"===(o=o||"asc")){for(var s=e.length,a=0;a<s;++a)if(0===e[a].indexOf(n)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a}else for(var c=0;c>=0;--c)if(0===e[c].indexOf(n)&&(!i||-1!==e[c].toLowerCase().indexOf(i.toLowerCase())))return c;return null}(e,0,0,t,r)}function rr(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null}r(2772);var nr=Object.freeze({THUMBNAIL:0,QVGA:1,VGA:2,HD:3}),ir=Object.freeze({INIT:0,READY:1,PLAY:2,STOP:3,CLEAN:4,FAILED:5}),or=Object.freeze({INIT:0,FEATURE_AHEAD:1,JOIN:2,JOIN_COMPLETE:3,VIDEO_STOP:4,VIDEO_START:5,REJOIN:6,LEAVE:7}),sr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sdpMid=void 0,this.dSsrc=123456789,this.videoView=void 0,this.transceiver=void 0,this.mediaStream=new MediaStream,this.state=Ot.INIT}var t,r;return t=e,(r=[{key:"setVideoView",value:function(e){this.videoView=e}},{key:"setState",value:function(e){this.state=e}},{key:"setTransceiver",value:function(e){this.transceiver=e}},{key:"setupMedia",value:function(e,t){e&&(this.stopOldTrack("video",e.id),this.mediaStream.addTrack(e)),this.playVideo(t)}},{key:"playVideo",value:function(e){this.videoView&&(this.videoView.srcObject=this.mediaStream,this.videoView.muted=!0,this.videoView.play().then((function(){e&&e.delegate&&e.delegate.onPlayed()})).catch((function(e){})))}},{key:"replaceSenderTrack",value:function(e){this.transceiver.sender.replaceTrack(e)}},{key:"stopOldTrack",value:function(e,t){var r=this;this.mediaStream.getTracks().filter((function(t){return t.kind===e})).forEach((function(e){e.id!==t&&(e.stop(),r.mediaStream.removeTrack(e))}))}},{key:"setAudioTrack",value:function(e){this.stopOldTrack("audio"),this.mediaStream.addTrack(e)}},{key:"changeVideoView",value:function(e,t){return t&&this.videoView&&(this.videoView.srcObject=null,this.videoView.pause()),e.srcObject=this.mediaStream,e.muted=!0,this.videoView=e,this.videoView.play()}},{key:"inactiveTransceiver",value:function(){this.transceiver&&(this.transceiver.direction="inactive")}},{key:"cleanupView",value:function(){this.state=Ot.STOP,this.videoView&&(this.videoView=void 0)}},{key:"cleanupVideo",value:function(){this.cleanupView(),this.stopOldTrack("audio"),this.stopOldTrack("video")}},{key:"failedSetupVideo",value:function(){this.cleanupVideo(),this.hadFailed=!0,this.state=Ot.FAILED}},{key:"isPlayed",value:function(){return this.state===Ot.START||this.state===Ot.RESTART}},{key:"isFailed",value:function(){return this.state===Ot.FAILED}},{key:"hasAudioTrack",value:function(){return this.mediaStream.getAudioTracks().length>0}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ar=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._localMediaStream=t.mediaStream?t.mediaStream:void 0,this._videoModifierStream=t.videoModifierStream?t.videoModifierStream:void 0,this._videoModified=!!this._videoModifierStream,this.initMediaStream=void 0}var t,r;return t=e,(r=[{key:"getInitMediaStream",value:function(){var e=[],t=this.localMediaStream.getAudioTracks();if(t.length)e=e.concat(t);else{var r=new AudioContext,n=r.createOscillator(),i=r.createGain();n.connect(i),i.gain.value=0;var o=i.connect(r.createMediaStreamDestination());n.start(),e=e.concat(o.stream.getAudioTracks()[0])}return e=this.videoModified?e.concat(this.videoModifierStream.getVideoTracks()[0]):e.concat(this.localMediaStream.getVideoTracks()[0]),this.initMediaStream=new MediaStream(e),this.initMediaStream}},{key:"localMediaStream",get:function(){return this._localMediaStream},set:function(e){this._localMediaStream=e}},{key:"videoModifierStream",get:function(){return this._videoModifierStream},set:function(e){this._videoModifierStream=e}},{key:"hasInitStream",get:function(){return this._hasInitStream}},{key:"videoModified",get:function(){return this._videoModified},set:function(e){this._videoModified=e}},{key:"release",value:function(){[this.localMediaStream,this.videoModifierStream,this.initMediaStream].forEach((function(e){e&&(e.getTracks().forEach((function(e){e.stop()})),e=void 0)}))}},{key:"setVideoModifier",value:function(e){}},{key:"resetVideoModifier",value:function(){}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),cr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=void 0,this.spareTransceiverPool=[]}var t,r;return t=e,r=[{key:"setSession",value:function(e){this.session=e}},{key:"addSpareTransceiver",value:function(e){e&&this.spareTransceiverPool.push(e)}},{key:"getTransceiver",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sendrecv",n=arguments.length>2?arguments[2]:void 0;return this.spareTransceiverPool.length?(t=this.spareTransceiverPool.pop()).direction=r:t=this.session.sessionDescriptionHandler.peerConnection.addTransceiver(e,{direction:r}),n&&(t.streams=n),t}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ur=(r(4812),Object.freeze({CANDIDATE_PAIR:"candidate-pair",OUTBOUND_RTP:"outbound-rtp",INBOUND_RTP:"inbound-rtp"}));function dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var lr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t}var t,r;return t=e,(r=[{key:"parseStats",value:function(e){var t=this;return new Promise((function(r,n){t.session&&t.session.sessionDescriptionHandler&&t.session.sessionDescriptionHandler.peerConnection||n(new Error("invalid-session")),t.session.sessionDescriptionHandler.peerConnection.getStats().then((function(t){var n,i={timestamp:Date.now(),"outbound-rtp":[],"inbound-rtp":[]},o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return dr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?dr(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}(t);try{for(o.s();!(n=o.n()).done;){var s=n.value[1],a=s.type;if(void 0===e||e.includes(a)){var c={timestamp:i.timestamp};switch(a){case ur.CANDIDATE_PAIR:!i[ur.CANDIDATE_PAIR]&&s.availableOutgoingBitrate&&(c.availableOutgoingBitrate=s.availableOutgoingBitrate,c.availableIncomingBitrate=s.availableIncomingBitrate?s.availableIncomingBitrate:void 0,c.currentRoundTripTime=s.currentRoundTripTime,i[ur.CANDIDATE_PAIR]=c);break;case ur.OUTBOUND_RTP:c.ssrc=s.ssrc,c.kind=s.kind,c.packetsSent=s.packetsSent,c.bytesSent=s.bytesSent,"video"===s.kind&&(c.firCount=s.firCount,c.pliCount=s.pliCount,c.nackCount=s.nackCount,c.qpSum=s.qpSum,c.frameWidth=s.frameWidth,c.frameHeight=s.frameHeight,c.framesSent=s.framesSent,c.framesPerSecond=s.framesPerSecond,s.contentType&&(c.contentType=s.contentType),s.rid&&(c.rid=s.rid),s.targetBitrate&&(c.targetBitrate=s.targetBitrate)),i[ur.OUTBOUND_RTP].push(c);break;case ur.INBOUND_RTP:c.ssrc=s.ssrc,c.kind=s.kind,c.packetsReceived=s.packetsReceived,c.bytesReceived=s.bytesReceived,c.packetsLost=s.packetsLost,c.jitter=s.jitter,"video"===s.kind&&(c.firCount=s.firCount,c.pliCount=s.pliCount,c.nackCount=s.nackCount,c.qpSum=s.qpSum,c.frameWidth=s.frameWidth,c.frameHeight=s.frameHeight,c.framesReceived=s.framesReceived,c.framesPerSecond=s.framesPerSecond,c.framesDecoded=s.framesDecoded,c.framesDropped=s.framesDropped,s.codecId&&s.codecId.includes("pss")&&(c.contentType="screenshare")),i[ur.INBOUND_RTP].push(c)}}}}catch(e){o.e(e)}finally{o.f()}r(i)}))}))}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),hr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.total=0,this.count=0}var t,r;return t=e,(r=[{key:"addPoint",value:function(e){this.total+=e,this.count++}},{key:"getAverage",value:function(){return 0===this.count?0:this.total/this.count}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function fr(e,t){return fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},fr(e,t)}function gr(e){return gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},gr(e)}var vr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fr(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=gr(n);if(i){var r=gr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).interval=100,t.targetStatTypeList=[ur.CANDIDATE_PAIR],t.outgoingBandwidth=new hr,t.incomingBandwidth=new hr,t}return t=s,(r=[{key:"start",value:function(){this.statGathering=!0,this.gatherStats()}},{key:"end",value:function(){this.statGathering=!1}},{key:"gatherStats",value:function(){var e=this;this.parseStats(this.targetStatTypeList).then((function(t){t&&(e.outgoingBandwidth.addPoint(t[ur.CANDIDATE_PAIR].availableOutgoingBitrate),t[ur.CANDIDATE_PAIR].availableIncomingBitrate&&e.incomingBandwidth.addPoint(t[ur.CANDIDATE_PAIR].availableIncomingBitrate),setTimeout(e.gatherStats.bind(e),e.interval))})).catch((function(e){}))}},{key:"getStats",value:function(){return{outgoingBandwidth:this.outgoingBandwidth.getAverage()/1e3+"kbps",incomingBandwidth:this.incomingBandwidth.getAverage()/1e3+"kbps"}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(lr);function mr(e){return mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mr(e)}function Sr(e,t){return Sr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Sr(e,t)}function Er(e){return Er=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Er(e)}var _r=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Sr(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Er(n);if(i){var r=Er(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===mr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,e)}return t=s,(r=[{key:"getStats",value:function(e){var t=this;return new Promise((function(r,n){t.parseStats(e).then((function(e){r(e)})).catch((function(e){return n(e)}))}))}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(lr),yr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaState=null,this.active=!1,this.standby=!1,this.standbyMediaState=null}var t,r;return t=e,(r=[{key:"setMediaState",value:function(e){var t=this;return new Promise((function(r,n){setTimeout((function(){t.mediaState=e,r()}),0)}))}},{key:"init",value:function(){this.mediaState.initCallback(this.mediaState)}},{key:"activate",value:function(){var e=this;return this.active=!0,new Promise((function(t,r){e.mediaState.activateCallback(e.mediaState,(function(){e.active=!1,e.releseStandbyMediaState(),t()}),(function(t){e.active=!1,e.releseStandbyMediaState(),r(t)}))}))}},{key:"getState",value:function(){return this.mediaState.getState()}},{key:"isActivate",value:function(){return this.active}},{key:"setStandby",value:function(){this.standby=!0}},{key:"isStandby",value:function(){return this.standby}},{key:"releseStandbyMediaState",value:function(){this.standby=!1,this.standbyMediaState=null}},{key:"setStandbyMediaState",value:function(e){this.standbyMediaState=e}},{key:"getStandbyMediaState",value:function(){return this.standbyMediaState}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Tr=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t,this.initCallback=r,this.activateCallback=n}var t,r;return t=e,(r=[{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Rr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isSetExclusivelySharedContents=!1,this._peerIdSetExclusivelySharedContents=void 0,this._isProcessingUpdateExclusivelySharedContents=!1,this._isProcessingUpdateRoomSharedContents=!1}var t,r;return t=e,(r=[{key:"setExclusivelySharedContents",value:function(e){this._isSetExclusivelySharedContents=!0,this._peerIdSetExclusivelySharedContents=e}},{key:"unsetExclusivelySharedContents",value:function(){this._isSetExclusivelySharedContents=!1,this._peerIdSetExclusivelySharedContents=void 0}},{key:"canChangeExclusivelySharedContents",value:function(e){return!0!==this._isSetExclusivelySharedContents||this._peerIdSetExclusivelySharedContents===e}},{key:"isProcessingUpdateExclusivelySharedContents",value:function(){return this._isProcessingUpdateExclusivelySharedContents}},{key:"waitResultUpdateExclusivelySharedContents",value:function(){this._isProcessingUpdateExclusivelySharedContents=!0}},{key:"completeUpdateExclusivelySharedContents",value:function(){this._isProcessingUpdateExclusivelySharedContents=!1}},{key:"isProcessingUpdateRoomSharedContents",value:function(){return this._isProcessingUpdateRoomSharedContents}},{key:"waitResultUpdateRoomSharedContents",value:function(){this._isProcessingUpdateRoomSharedContents=!0}},{key:"completeUpdateRoomSharedContents",value:function(){this._isProcessingUpdateRoomSharedContents=!1}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ar(e){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(e)}function wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function br(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function Cr(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){br(o,n,i,s,a,"next",e)}function a(e){br(o,n,i,s,a,"throw",e)}s(void 0)}))}}function Or(e,t){return Or=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Or(e,t)}function Ir(e){return Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ir(e)}var Pr=pt,Nr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Or(e,t)}(l,e);var t,r,n,i,o,s,a,c,u,d=(c=l,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ir(c);if(u){var r=Ir(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ar(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=d.call(this)).service=e,t}return t=l,r=[{key:"wtpInit",value:function(e){var t=new Map(Object.entries(e));this.wtpConfig={wtpGwUri:t.has("wtpGwUri")?t.get("wtpGwUri"):null,logLevel:t.has("logLevel")?t.get("logLevel"):Dt.LOG,traceSip:!!t.has("traceSip")&&t.get("traceSip"),builtinEnabled:!!t.has("builtinEnabled")&&t.get("builtinEnabled"),devPlatform:t.has("devPlatform")?t.get("devPlatform"):"line"},this.callParams={},this.state=Pr.STATE_INIT,this.plnRelCode=Kt.UNDEFINED,this.releaser=void 0,this.callDir="",this.callTerminate=!1,this.localVideoSsrc=[],this.remoteVideoSsrc=[],this.bundleLine="1",this.myScreenShare=new sr,this.wtpLogger=new Ht("wtp-lib",this.wtpConfig.logLevel),this.logger=this.wtpLogger.logger,this.platformAdapter=new Vt(this.wtpConfig.devPlatform),this.browserInfo=void 0,this.initMediaHandler,this.transceiverHandler=new cr,this.sdpMutex=new Ye,this.videoMutedManager=new yr,this.audioMutedManager=new yr,this.sharedContentsManager=new Rr,"conference"!==this.service&&(this.peerScreenShare=new sr),this.logger.debug("wtpConfig"),this.logger.debug(this.wtpConfig)}},{key:"wtpEnableVideo",value:function(e){var t=this,r=Object.assign({cameraOn:!0,videoInputDeviceId:void 0},e);return new Promise((function(e,n){return t.logger.debug("[wtpEnableVideo] Start"),t.state!==Pr.STATE_CONNECTED?n(t.createErrorObject("NotConnected","Call should be CONNECTED to enable video")):t.isVideoCall()?n(t.createErrorObject("AlreadyVideoCall","This call is already video call")):(t.callParams.callType=gt.VIDEO,t.callParams.svckey="call"===t.service?"freecall.video":"groupcall.video",t.videoEnabled=!0,r.videoInputDeviceId&&"null"!==r.videoInputDeviceId.toLowerCase()?(i=r.videoInputDeviceId,t.inputVideoDeviceId=r.videoInputDeviceId):t.inputVideoDeviceId&&(i=t.inputVideoDeviceId),r.initMedia&&r.initMedia.mediaStream&&(t.initMediaHandler=new ar(r.initMedia),t.inputVideoDeviceId=r.initMedia.mediaStream.getVideoTracks()[0].getCapabilities().deviceId,i=t.inputVideoDeviceId,r.initMedia.videoModifierStream&&(t.videoFiltered=!0,t.filteredVideoStream=r.initMedia.videoModifierStream),!1===r.cameraOn&&r.initMedia.mediaStream.getVideoTracks().forEach((function(e){e.stop()}))),!1===r.cameraOn?r.skipReplaceVideoTrack=!0:r.needCheckSimulcastResolution=!0,t.logger.debug("[wtpEnableVideo] deviceId=".concat(i)),void t._replaceVideoTrack(r).then((function(){var n={content:[{kind:"video",ctrl:"start"}],contentType:"application/stream-ctrl+json",delegate:{onAccept:function(){!0===r.cameraOn&&!0===t.videoMutedManager.getState()?t.wtpResumeMyVideo({skipReplaceVideoTrack:!0}):!1===r.cameraOn&&(r&&r.onAcceptVideoToggle?r.onAcceptVideoToggle():t.wtpPauseMyVideo())}}};t.sendInfo(n).then((function(){r&&r.onAccept&&r.onAccept(),t.callTypeState=vt.AUDIO_TO_VIDEO,t.setupLocalMedia(),t.setupRemoteMedia(),t.setMediaSsrc(),i&&(t.inputVideoDeviceId=i),e()}))})).catch((function(e){n(e)})));var i}))}},{key:"wtpDisableVideo",value:function(){var e=this;return this.logger.debug("[wtpDisableVideo] Start"),this.state!==Pr.STATE_CONNECTED?Promise.reject(this.createErrorObject("NotConnected","Call should be CONNECTED to disable video")):this.isVideoCall()?new Promise((function(t,r){e._waitForMutedComplete(e.videoMutedManager,(function(){e.callParams.callType=gt.AUDIO,e.videoEnabled=!1;var r=e._getDummyVideoStream().getVideoTracks()[0],n=e.session.sessionDescriptionHandler.localMediaStream,i=e.session.sessionDescriptionHandler.peerConnection.getSenders()[1],o=n.getVideoTracks()[0];if(o&&"video"===o.kind){var s=e.session.sessionDescriptionHandler.localMediaStream;s.removeTrack(o),s.addTrack(r),o.stop(),i.replaceTrack(r)}if(!0===e.videoMutedManager.getState()){var a={"cam-off":!0,"off-reason":Tt(yt.BY_USER),"vid-disabled":!0};e.sendFeatureShare(wt.CAMERA_STATUS,bt.SET,a)}e.sendInfo({content:[{kind:"video",ctrl:"stop"}],contentType:"application/stream-ctrl+json"}).then((function(){e.callTypeState=vt.VIDEO_TO_AUDIO,e.videoFiltered=!1,e.platformAdapter.initLastPauseReason(),e.logger.debug("[wtpDisableVideo] Done send info"),"conference"===e.service&&e.wtpConferenceRemovePeerVideo(e.room.getPeersUserId()),t()}))}))})):Promise.reject(this.createErrorObject("AlreadyAudioCall","This call is already audio call"))}},{key:"wtpMuteMyAudio",value:function(){var e=this;if(!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToMuteMyAudio","MuteMyAudio failed because current call state is not valid"));var t=new Tr(this.audioMutedManager.getState(),(function(e){}),(function(t,r,n){e.logger.debug("wtpMuteMyAudio | Start"),t.state=!0,e.toggleMute(mt.AUDIO,!1),e.state===Pr.STATE_CONNECTED&&e.sendFeatureShare(wt.MIC_STATUS,bt.SET,{"mic-st":!0}),r()}));return this._changeMediaMuteState(this.audioMutedManager,t)}},{key:"wtpUnmuteMyAudio",value:function(){var e=this;if(!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToUnmuteMyAudio","UnmuteMyAudio failed because current call state is not valid"));this.logger.debug("wtpUnmuteMyAudio | Start");var t=new Tr(this.audioMutedManager.getState(),(function(e){}),(function(t,r,n){t.state=!1,e.toggleMute(mt.AUDIO,!0),e.state===Pr.STATE_CONNECTED&&e.sendFeatureShare(wt.MIC_STATUS,bt.UNSET),r()}));return this._changeMediaMuteState(this.audioMutedManager,t)}},{key:"wtpPauseMyVideo",value:function(e){var t=this;if(this.callParams.callType!==gt.VIDEO||!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToPauseMyVideo","PauseMyVideo failed because current call state is not valid"));this.logger.debug("wtpPauseMyVideo | Start");var r=new Tr(this.videoMutedManager.getState(),(function(e){}),(function(r,n,i){var o=Object.assign({reasonCode:Rt.PAUSED,plnVideoPauseReason:yt.BY_USER,isUser:!0},e);o.isUser&&(r.state=!0),t.toggleMute(mt.VIDEO,!1,o.reasonCode),t._replaceVideoTrack({initMedia:{mediaStream:t._getDummyVideoStream()}}).then((function(){if("conference"===t.service&&null!==o.plnVideoPauseReason){var e={"cam-off":!0,"off-reason":Tt(o.plnVideoPauseReason)};t.sendFeatureShare(wt.CAMERA_STATUS,bt.SET,e)}n()})).catch((function(e){i(e)}))}));return this._changeMediaMuteState(this.videoMutedManager,r)}},{key:"wtpResumeMyVideo",value:function(e){var t=this;if(this.callParams.callType!==gt.VIDEO||!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToResumeMyVideo","ResumeMyVideo failed because current call state is not valid"));this.logger.debug("wtpResumeMyVideo | Start");var r=new Tr(this.videoMutedManager.getState(),(function(e){}),(function(r,n,i){r.state=!1;var o=Object.assign({cameraOn:!0,videoInputDeviceId:void 0},e);t._replaceVideoTrack(o).then((function(){t.sendStreamCtrlInfo(mt.VIDEO,!0,Rt.NORMAL),"conference"===t.service&&t.sendFeatureShare(wt.CAMERA_STATUS,bt.UNSET),n()})).catch((function(e){i(e)}))}));return this._changeMediaMuteState(this.videoMutedManager,r)}},{key:"wtpChangeInputAudioDevice",value:(a=Cr(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getValidDeviceId(t,"audioinput");case 2:return r=e.sent,e.abrupt("return",this.changeInputDevice("audio",r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"wtpChangeInputVideoDevice",value:function(e){return this.callParams.callType===gt.VIDEO?(this.initMediaHandler&&(this.initMediaHandler=void 0),this.changeInputDevice("video",e)):Promise.reject(this.createErrorObject("InvalidCallType","Fail to changeInputVideoDevice because call type is not video"))}},{key:"wtpChangeOutputAudioDevice",value:(s=Cr(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getValidDeviceId(t,"audiooutput");case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,t){void 0!==n.callParams.media.local.video.sinkId?("conference"===n.service||n.callParams.callType===gt.AUDIO?n.callParams.media.remote.audio:n.callParams.media.remote.video).setSinkId(r).then((function(){n.logger.debug("Success, audio output device attached: ".concat(r)),e()})).catch((function(e){var r=e;"SecurityError"===e.name&&(r=n.createErrorObject("SecurityError","You need to use HTTPS for selecting audio output device: ".concat(e))),t(r)})):t(n.createErrorObject("NotSupported","Browser does not support changing audio-output device"))})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"wtpRequestPeerMute",value:function(e,t){var r=this,n=[];e.forEach((function(e){n.push({mid:e,svc_id:r.callParams.toSvcId})}));var i={content:{body_type:".jfs-mic-ctrl",body:{"mic-ct":t},target_ue:n,source:this.callParams.myId,source_svc_id:this.callParams.fromSvcId},contentType:At.USER_MESSAGE};this.sendInfo(i)}},{key:"wtpStartMyScreenShare",value:function(e,t){var r=this;if(this.logger.debug("[wtpStartMyScreenShare] start"),!navigator.mediaDevices.getDisplayMedia)return Promise.reject(this.createErrorObject("NotSupportScreenShare","This browser not support screen share"));var n=this.session.sessionDescriptionHandler,i=n.peerConnection,o=this.myScreenShare;return t=this._getConstraints(t),navigator.mediaDevices.getDisplayMedia(t).then(function(){var e=Cr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.sdpMutex.acquire();case 2:return e.abrupt("return",Promise.resolve(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var t=Cr(regeneratorRuntime.mark((function t(n){var s,a,c,u,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.isCompleteStartMyScreenShare=!1,void 0!==(s=n.getVideoTracks()[0])){t.next=4;break}return t.abrupt("return",Promise.reject(r.createErrorObject("NoVideoTrack","This device unavaliable to get screenShare track")));case 4:if("safari"!==r.browserInfo.browser.toLowerCase()){t.next=17;break}if("window"!==(a=s.getCapabilities()).displaySurface){t.next=17;break}if(r.logger.debug("Safari window screen share capabilities - ".concat(JSON.stringify(a))),c=a.width.max,u=a.height.max,d=[{width:1920,height:1080},{width:1280,height:720},{width:960,height:640},{width:640,height:480},{width:480,height:320}].find((function(e){return e.width<=c&&e.height<=u}))){t.next=14;break}return t.abrupt("return",Promise.reject(r.createErrorObject("OverconstrainedError","The selected screen resolution is too small for screen sharing.")));case 14:return r.logger.debug("Safari screen share adjust resolution - ".concat(JSON.stringify(d))),t.next=17,s.applyConstraints({width:{max:d.width},height:{max:d.height}});case 17:o.videoView=e,r.logger.debug("screenshare state : ".concat(o.state)),t.t0=o.state,t.next=t.t0===Ot.INIT||t.t0===Ot.FAILED?22:t.t0===Ot.STOP?27:30;break;case 22:return l=r.transceiverHandler.getTransceiver(s,"sendonly",[n]),o.transceiver=l,o.sdpMid="mss",o.setState(Ot.START),t.abrupt("break",31);case 27:return o.setState(Ot.RESTART),o.replaceSenderTrack(s),t.abrupt("break",31);case 30:return t.abrupt("return",Promise.reject(r.createErrorObject("NotValidScreenShareState","ScreenShare state is not vaild to start (currentState=".concat(It(o.state),")"))));case 31:return o.setupMedia(s),o.mediaStream.getVideoTracks()[0].onended=function(){r.wtpStopMyScreenShare().then((function(){return r.emit("screenShareStoppedOnBrowser")})).catch((function(e){"ScreenShareStartNotCompleted"===e.name?r.postponeEventScreenShareStoppedOnBrowser=!0:r.emit("screenShareStoppedOnBrowser")}))},n.getAudioTracks()[0]&&o.setAudioTrack(n.getAudioTracks()[0]),r.logger.debug("[wtpStartMyScreenShare] peerConnection signaling state = ".concat(i.signalingState)),t.abrupt("return",Promise.resolve());case 36:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(){return r._getScreenShareChain(n,o.state)})).then((function(){var e;r.sdpMutex.release();var t={content:{event:1,d_ssrc:r.myScreenShare.dSsrc},contentType:At.DATA_CTRL};if(r.sendInfo(t).then((function(){})),o.hadFailed&&(o.mediaStream.getVideoTracks().length&&o.replaceSenderTrack(o.mediaStream.getVideoTracks()[0]),o.hadFailed=!1),o.hasAudioTrack()){var n=r._getMixAudioTrack(o.mediaStream);r._replaceSenderAudioTrack(n)}return null===(e=r.txBitrateManager)||void 0===e||e.activeScreenShare(),r._completeStartMyScreenShare(),Promise.resolve()})).catch((function(e){return r.logger.debug("Fail to wtpStartMyScreenShare"),r._completeStartMyScreenShare(),r.sdpMutex&&r.sdpMutex.release(),Promise.reject(e)}))}},{key:"wtpStopMyScreenShare",value:function(){var e=this;return new Promise((function(t,r){e.startMyScreenShareCompleteReject&&e.startMyScreenShareCompleteReject(e.createErrorObject("ReplacePromise","Replace promise of stopMyScreenShare")),e.startMyScreenShareCompleteResolve=t,e.startMyScreenShareCompleteReject=r,e.isCompleteStartMyScreenShare?t():e.startMyScreenShareCompleteTimeout=setTimeout((function(){e.timeoutStopMyScreenShare=!0,e.logger.debug("Fail to stop my screen share because setting of startMyScreenShare is not completed"),r(e.createErrorObject("ScreenShareStartNotCompleted","Not available to stop screen share right now"))}),3e3)})).then((function(){return e.sdpMutex.acquire().then((function(){return e._activeHD(!0)})).then((function(t){return e.logger.debug("wtpStopMyScreenShare, needUpdate: ".concat(t)),!0===t?e._updateSimulcast().then((function(){var t=e.session.sessionDescriptionHandler,r=t.peerConnection;return t.createLocalOfferOrAnswer().then((function(t){return e.mungeOfferSdp(t)})).then((function(e){return t.setLocalSessionDescription(e)})).then((function(){return e.simulcastHandler.replaceRecvMungeSdp(r.currentRemoteDescription)})).then((function(e){return r.setRemoteDescription(e)})).catch((function(t){return e.logger.debug("Error while set myScreenShare sessionDescription. pc state is ".concat(r.signalingState)),e.logger.debug(t),Promise.reject(e.createErrorObject("SessionDescriptionFail","Fail to set myScreenShare session description"))}))})):Promise.resolve()})).then((function(){return e.sdpMutex.release(),Promise.resolve()}))})).then((function(){var t;e._cleanPromiseStartMyScreenShare(),null===(t=e.txBitrateManager)||void 0===t||t.inactiveScreenShare();var r={content:{event:0,d_ssrc:e.myScreenShare.dSsrc},contentType:At.DATA_CTRL};return e.sendInfo(r).then((function(){e.logger.debug("[wtpStopMyScreenShare] start");var t=e.myScreenShare;if(!t.isPlayed())return Promise.reject(e.createErrorObject("ScreenShareNotPlaying","My Screen share is not playing"));var r=e.session.sessionDescriptionHandler;return e.logger.debug("[wtpStopMyScreenShare] peerConnection signaling state = ".concat(r.peerConnection.signalingState)),t.cleanupVideo(),e._replaceSenderAudioTrack(r.localMediaStream.getAudioTracks()[0]),e.postponeEventScreenShareStoppedOnBrowser&&(e.postponeEventScreenShareStoppedOnBrowser=void 0,e.emit("screenShareStoppedOnBrowser")),Promise.resolve()}))})).catch((function(t){return e._cleanPromiseStartMyScreenShare(),e.logger.debug("[wtpStopMyScreenShare] fail to stop myScreenShare because of ".concat(t.name)),e.sdpMutex&&e.sdpMutex.release(),Promise.reject(t)}))}},{key:"wtpMuteMyScreenShareAudio",value:function(e){this.logger.debug("wtpMuteMyScreenShareAudio ".concat(e));var t=this.myScreenShare;t.hasAudioTrack()&&t.mediaStream.getAudioTracks().forEach((function(t){t.enabled=e}))}},{key:"wtpChangeMyScreenShareView",value:function(e,t){var r=this;return new Promise((function(n,i){var o=r.myScreenShare;o.isPlayed()?o.changeVideoView(e,t).then((function(){r.logger.debug("My screen share view is changed"),n()})).catch((function(e){r.logger.warn("Fail to change My ScreenShare view"),i(e)})):i(r.createErrorObject("ScreenShareNotPlaying","Change my screen share is failed because not playing"))}))}},{key:"wtpGetPreview",value:function(){var e,t=this.session.sessionDescriptionHandler.peerConnection;return t.getSenders&&(e=new MediaStream,t.getSenders().forEach((function(t){var r=t.track;r&&"video"===r.kind&&e.addTrack(r)}))),e}},{key:"wtpRelease",value:function(){var e=this;this.wtpReleasePromise?this.logger.warn("Wtp Release is already in progress"):this.wtpReleasePromise=new Promise((function(t,r){e.session=void 0,e.logger.debug("release transport"),e.ua&&e.ua.transport&&e.plnRelCode!==Kt.WEB_SIGNALING_UNEXPECTED_DISCONNECTED?e.ua.transport.disconnect().then(t()):t()})).then((function(){return e.logger.debug("release ua"),e.ua&&e.ua.userAgentCore&&e.ua.userAgentCore.dispose(),Promise.resolve()})).then((function(){e.logger.debug("release settings"),e.ua=void 0,e.plnRelCode=Kt.UNDEFINED,e.releaser=void 0,e.callDir="",e.audioMutedManager=null,e.videoMutedManager=null,e.callTerminate=!1,e.localVideoSsrc=[],e.remoteVideoSsrc=[],e.callParams={},e.wtpReleasePromise=void 0,e.changeState(Pr.STATE_RELEASED)}))}},{key:"wtpSetVideoModifier",value:function(e){if(this.logger.debug("Start wtpSetVideoModifier"),!e.captureStream)return Promise.reject(this.createErrorObject("NotSupportVideoModifier","This browser not support video modifier"));var t=e.captureStream(30);return this.videoFiltered=!0,this.filteredVideoStream=t,this._replaceSenderVideoTrack(t)}},{key:"wtpResetVideoModifier",value:function(){if(this.logger.debug("Start wtpResetVideoModifier"),void 0!==this.session&&void 0!==this.session.sessionDescriptionHandler){var e=this.session.sessionDescriptionHandler;return this.videoFiltered=!1,this.filteredVideoStream=void 0,this.setupLocalMedia(),this._replaceSenderVideoTrack(e.localMediaStream)}this.logger.warn("Invalid session")}},{key:"wtpGetVersion",value:function(){return Ut}},{key:"wtpGetStats",value:function(){if(void 0===this.pointStatistic){if(!this.session)return this.logger.error("GetStats fail because of no session"),new Promise.reject("no-session");this.pointStatistic=new _r(this.session)}return this.pointStatistic.getStats()}},{key:"wtpStartMeasureStats",value:function(){if(void 0===this.rangeStatistic){if(!this.session)return;this.rangeStatistic=new vr(this.session)}this.rangeStatistic.start()}},{key:"wtpEndMeasureStats",value:function(){this.rangeStatistic&&this.rangeStatistic.end()}},{key:"wtpGetMeasureStats",value:function(){if(this.rangeStatistic)return this.rangeStatistic.getStats()}},{key:"wtpSendShortData",value:function(e){var t=this,r={content:e,contentType:At.USER_MESSAGE};return new Promise((function(e){t.sendInfo(r).then((function(){return e()}))}))}},{key:"wtpSetSharedContents",value:function(e){var t=this;return this.checkValiditySharedContentsData(e).then((function(){return t.sendFeatureShare(wt.SHARED_CONTENTS,bt.SET,dt(e))}))}},{key:"wtpUnsetSharedContents",value:function(){return this.sendFeatureShare(wt.SHARED_CONTENTS,bt.UNSET)}},{key:"wtpSetExclusivelySharedContents",value:function(e){var t=this;return this.sharedContentsManager.isProcessingUpdateExclusivelySharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateExclusivelySharedContents","Update exclusively shared contents process is in progress")):"call"!==this.service||this.sharedContentsManager.canChangeExclusivelySharedContents(this.callParams.myId)?new Promise((function(r,n){t.resolveExclusivelySharedContents=r,t.rejectExclusivelySharedContents=n,t.checkValiditySharedContentsData(e).then(Cr(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return"call"===t.service&&t.sharedContentsManager.setExclusivelySharedContents(t.callParams.myId),r.next=3,t.sendFeatureShare(wt.EXCLUSIVELY_SHARED_CONTENTS,bt.SET,dt(e));case 3:t.sharedContentsManager.waitResultUpdateExclusivelySharedContents();case 4:case"end":return r.stop()}}),r)})))).catch((function(e){n(e)}))})):Promise.reject(this.createErrorObject("AlreadySet","Exclusively shared contents is already set"))}},{key:"wtpUnsetExclusivelySharedContents",value:function(){var e=this;return this.sharedContentsManager.isProcessingUpdateExclusivelySharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateExclusivelySharedContents","Update exclusively shared contents process is in progress")):"call"!==this.service||this.sharedContentsManager.canChangeExclusivelySharedContents(this.callParams.myId)?new Promise((function(t,r){e.resolveExclusivelySharedContents=t,e.rejectExclusivelySharedContents=r,e.sendFeatureShare(wt.EXCLUSIVELY_SHARED_CONTENTS,bt.UNSET).then(Cr(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"call"===e.service&&e.sharedContentsManager.unsetExclusivelySharedContents(),t.next=3,e.sendFeatureShare(wt.EXCLUSIVELY_SHARED_CONTENTS,bt.UNSET);case 3:e.sharedContentsManager.waitResultUpdateExclusivelySharedContents();case 4:case"end":return t.stop()}}),t)})))).catch((function(e){r(e)}))})):Promise.reject(this.createErrorObject("AlreadySet","Peer set exclusively shared contents"))}},{key:"wtpSetVideoMirror",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===this.wtpUtil&&(this.wtpUtil=new lt),this.wtpUtil.setVideoMirror(e,void 0===t?this.callParams.media.local.video:t)}},{key:"changeState",value:function(e){this.logger.debug("[WTP_STATE_CHANGE] ".concat(this.state," -> ").concat(e)),this.state=e}},{key:"createErrorObject",value:function(e,t){var r=new Error(t);return r.name=e,r}},{key:"createInnerLogObject",value:function(e,t,r){return{type:e,name:t,message:r}}},{key:"setCallParam",value:function(e){if(void 0===e.myId||void 0===e.inviteHeaders)return!1;if("call"===this.service){if(void 0===e.peerId)return!1}else if(void 0===e.roomId)return!1;return this.callParams={myId:e.myId,fromSvcId:e.fromSvcId?e.fromSvcId:void 0,peerId:"call"===this.service?e.peerId:e.roomId,toSvcId:e.toSvcId?e.toSvcId:void 0,callType:e.callType?e.callType:gt.AUDIO,stid:e.stid?e.stid:void 0,cameraOn:void 0===e.cameraOn||e.cameraOn,micOn:void 0===e.micOn||e.micOn,svckey:e.svckey?e.svckey:void 0,pauseVideoByPageHidden:void 0===e.pauseVideoByPageHidden||e.pauseVideoByPageHidden,ignoreDeviceError:void 0!==e.ignoreDeviceError?e.ignoreDeviceError:void 0,enableTalkingStatusEvent:!0===e.enableTalkingStatusEvent,media:e.media?e.media:{},mediaId:e.mediaId?e.mediaId:{},inviteHeaders:e.inviteHeaders,initMedia:e.initMedia?e.initMedia:{},planetKitVersion:e.planetKitVersion?e.planetKitVersion:void 0,displayName:e.displayName?e.displayName:"",maxSendLinkBandwidth:"number"==typeof e.maxSendLinkBandwidth&&e.maxSendLinkBandwidth>0?e.maxSendLinkBandwidth:void 0,maxReceiveLinkBandwidth:"number"==typeof e.maxReceiveLinkBandwidth&&e.maxReceiveLinkBandwidth>0?e.maxReceiveLinkBandwidth:void 0,recordOnCloud:!0===e.recordOnCloud},this.callParams.mediaId.video&&(this.inputVideoDeviceId=this.callParams.mediaId.video),Object.keys(this.callParams.initMedia).length&&(this.initMediaHandler=new ar(this.callParams.initMedia),this.inputVideoDeviceId=this.initMediaHandler.localMediaStream.getVideoTracks()[0].getCapabilities().deviceId,this.initMediaHandler.videoModified&&(this.videoFiltered=!0,this.filteredVideoStream=this.initMediaHandler.videoModifierStream)),!0}},{key:"setPlnExtraInviteHeaders",value:function(e){var t=this.callParams.inviteHeaders,r=JSON.parse(t.commParam),n=[];n.push("X-callType: "+this.callParams.callType),n.push("X-fromZone: "+t.fromZone),n.push("X-voipUdpPort: "+t.voipUdpPort),n.push("X-voipTcpPort: "+t.voipTcpPort),n.push("X-ctm: "+r.ctm),n.push("X-ict: "+r.ict),n.push("X-mpkey: "+r.mpkey),void 0!==this.callParams.svckey&&n.push("X-svckey: "+this.callParams.svckey),void 0!==this.callParams.fromSvcId&&void 0!==this.callParams.toSvcId&&(n.push("X-fromSvcId: "+this.callParams.fromSvcId),n.push("X-toSvcId: "+this.callParams.toSvcId)),this.callParams.allowVerifyOnMultipleWindow||n.push("X-deviceId: "+this._getDeviceId()),e===ft.CONFERENCE?(n.push("X-callDir: "+ft.INITIATOR),n.push("X-toZone: "+t.polarisZone),n.push("X-orion_ip: "+t.orionAddress),n.push("X-mix_ip: "+t.polarisAddress),n.push("X-mix_port: "+t.polarisUdpPort)):(n.push("X-toZone: "+t.toZone),n.push("X-callDir: "+e)),e===ft.INITIATOR||e===ft.CONFERENCE?(n.push("X-voipAddress: "+t.voipAddress),n.push("X-stid: "+(this.callParams.stid?this.callParams.stid:t.stid)),e===ft.INITIATOR?(n.push("X-fromToken: "+t.fromToken),n.push("X-req_rec: "+this.callParams.recordOnCloud)):n.push("X-fromToken: "+t.token)):(n.push("X-sid: "+t.sid),n.push("X-toToken: "+t.callToken),n.push("X-voipAddress: "+t.voipSrv)),null!=t.fakeCall&&n.push("X-fc: "+(t.fakeCall?Nt.TRUE:Nt.FALSE));var i=document.createElement("video"),o=!1;i.canPlayType&&(this.logger.debug(i.canPlayType('video/mp4; codecs="avc1.42E01E"')),o=""!==i.canPlayType('video/mp4; codecs="avc1.42E01E"')),n.push("X-h264_support: "+o),this.browserInfo=at();var s=[this.browserInfo.browser,this.browserInfo.version,"","",this.callParams.planetKitVersion?"web_"+this.callParams.planetKitVersion:"","wtp_"+Ut,"",""];n.push("X-userAgent: "+s.join(";"));var a=[Lt.WEB,this.callParams.displayName,"",""];n.push("X-userExtraInfo: "+a.join(";"));var c=this.callParams.maxReceiveLinkBandwidth<=kt.RX?this.callParams.maxReceiveLinkBandwidth:kt.RX;return n.push("X-rx_link_bw: "+c),n}},{key:"createUa",value:function(e){var t=this,r=Fe.makeURI("sip:"+e+"@"+this.wtpConfig.wtpGwUri);r||this.logger.error("Failed to create URI");var n,i=(n=void 0,function(e,t){void 0===n&&(n=nt());var r={iceGatheringTimeout:void 0!==(null==t?void 0:t.iceGatheringTimeout)?null==t?void 0:t.iceGatheringTimeout:5e3,peerConnectionConfiguration:t.peerConnectionConfiguration},i=e.userAgent.getLogger("wtp-SessionDescriptionHandler");return new rt(i,n,r)}),o={uri:r,transportOptions:{traceSip:this.wtpConfig.traceSip,wsServers:"wss://"+this.wtpConfig.wtpGwUri,server:"wss://"+this.wtpConfig.wtpGwUri,keepAliveInterval:60},sessionDescriptionHandlerFactory:i,sessionDescriptionHandlerFactoryOptions:{peerConnectionConfiguration:{rtcConfiguration:{iceServers:[]}}},userAgentString:"wtp.js/"+this.wtpGetVersion(),logBuiltinEnabled:this.wtpConfig.builtinEnabled,logLevel:jt(this.wtpConfig.logLevel),register:!1,delegate:{onDisconnect:function(e){void 0!==e&&(t.logger.debug("ua delegate onDisconnect"),t.onTransportError(e))}}};this.ua=new Fe(o)}},{key:"createInviteSession",value:function(e,t){var r=this;this.logger.debug("Start createInviteSession");var n=Fe.makeURI("sip:"+(this.callDir===ft.RESPONDER?this.callParams.myId:this.callParams.peerId)+"@"+this.wtpConfig.wtpGwUri),i={extraHeaders:e};this.session=new $e(this.ua,n,i),this.session.stateChange.addListener((function(e){switch(r.logger.debug("session state change : ".concat(e)),e){case Re.Initial:case Re.Establishing:case Re.Established:break;case Re.Terminated:r.callTerminate&&(r.callTerminate=!1,r.onEnded())}})),this.session.delegate={onAck:function(e){r.logger.debug("wtp SessionDelegate onAck"),r.logger.debug(e)},onInfo:function(e){r.logger.debug("wtp SessionDelegate onInfo");var n=e.incomingInfoRequest,i={message:n.message,delegate:t&&t.delegate?t.delegate:void 0};n.accept(),r.onDialogInfo(i)},onBye:function(e){r.logger.debug("wtp session delegate bye"),r.onBye(e.incomingByeRequest.message)},onSessionDescriptionHandler:function(e,n){r.logger.debug("onSessionDescriptionHandler"),t&&t.peerConnectionDelegate&&(r.session.sessionDescriptionHandler.peerConnectionDelegate=t.peerConnectionDelegate),e.on("sdhconnection-disconnected",(function(){(r.state!==Pr.STATE_CONNECTED||r.callTypeState<vt.VIDEO_TO_AUDIO)&&void 0===r.sdhconnectionTimer&&(r.sdhconnectionTimer=setTimeout((function(){r.logger.debug("wtp SessionDescriptionHandler disconnected - timeout"),r.releaser=Et.THIS,r.plnRelCode=Kt.CALL_CONNECT_FAIL_BY_CLIENT,r.endBeforeBye=!0,e.close(),r.onFailed()}),3e4))})),e.on("sdhconnection-connected",(function(){void 0!==r.sdhconnectionTimer&&(clearTimeout(r.sdhconnectionTimer),r.sdhconnectionTimer=void 0),r._isTestCall()&&void 0===r.testCallResult.timestamp.connected&&(r.logger.debug("set TestCall init stats"),r.testCallResult.timestamp.connected=Date.now(),r.wtpGetStats().then((function(e){return r.startStats=e})))})),e.on("sdhconnection-failed",(function(){r.logger.debug("sdhconnection state is changed to failed"),r.releaser=Et.THIS,r.plnRelCode=!1===navigator.onLine?Kt.NETWORK_UNREACHABLE:Kt.UNKNOWN_ERROR,r.endBeforeBye=!0,e.close(),r.onFailed()})),e.on("failToGetMedia",(function(e){r.emit("innerLog",r.createInnerLogObject("error",e.name,"Fail to getUserMedia by ".concat(e.name)))}))}}}},{key:"sendInvite",value:function(e){var t=this;if(!this.session)throw new Error("No session to sendInvtie");this.logger.debug("Start sendInvite");var r={onAccept:function(e){t.logger.debug("wtp iniviteDelegate: onAccept"),t.onAccepted()},onProgress:function(e){t.logger.debug("wtp iniviteDelegate: onProgress"),t.onProgress(e)},onRedirect:function(e){t.logger.debug("wtp iniviteDelegate: onRedirect")},onReject:function(e){t.logger.debug("wtp iniviteDelegate: onReject"),t.onRejected(e.message)},onTrying:function(e){}};e.inviteDelegate&&Object.assign(r,e.inviteDelegate);var n={requestDelegate:r,requestOptions:e.requestOptions?e.requestOptions:{},sessionDescriptionHandlerOptions:e.sdhOptions?e.sdhOptions:{constraints:this.getConstraints()},sessionDescriptionHandlerModifiers:e.sdpModifier?e.sdpModifier:[]};return this.session.invite(n).then((function(){t.logger.debug("Succesfully INVITE is sent")})).catch((function(e){if(t.logger.debug("Failed INVITE"),t.videoEnabled)throw e;t.onSdhInviteError(e)}))}},{key:"sendInfo",value:function(e){var t={requestDelegate:{onAccept:function(t){e.delegate&&e.delegate.onAccept&&e.delegate.onAccept()},onProgress:function(e){}},requestOptions:{body:{contentDisposition:"render",contentType:e.contentType,content:JSON.stringify(e.content)}}};return this.session.info(t)}},{key:"sendStreamCtrlInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e===mt.VIDEO&&this.platformAdapter.needSendVideoReason(r)&&this.state===Pr.STATE_CONNECTED){var n=[],i=this.platformAdapter.getVideoPauseReason(r);this.localVideoSsrc.forEach((function(r){n.push({kind:e,ssrc:parseInt(r).toString(16),ctrl:t?"resume":"pause",reason:i})}));var o={content:n,contentType:"application/stream-ctrl+json"};this.sendInfo(o)}}},{key:"getConstraints",value:function(){var e={audio:!this.callParams.mediaId.audio||{deviceId:{exact:this.callParams.mediaId.audio}},video:this.callParams.callType!=gt.AUDIO&&(this.callParams.mediaId.video?{deviceId:{exact:this.callParams.mediaId.video},width:Pt.WIDTH,height:Pt.HEIGHT}:{width:Pt.WIDTH,height:Pt.HEIGHT})};return this.logger.debug("Constraints = "+JSON.stringify(e)),e}},{key:"setupLocalMedia",value:function(){var e=this;if(this.logger.debug("Start setupLocalMedia"),this.session){if(this.callParams.callType===gt.VIDEO&&this.callParams.media.local&&this.callParams.media.local.video){var t=this.session.sessionDescriptionHandler.localMediaStream;this.callParams.media.local.video.srcObject=t,this.callParams.media.local.video.muted=!0;var r=this.callParams.media.local.video.play();void 0!==r&&r.then((function(){})).catch((function(t){e.logger.warn("catch error localVideoPromise : ".concat(t))}))}}else this.logger.warn("No ession to set local media on")}},{key:"setupRemoteMedia",value:function(){var e=this;if(this.logger.debug("Start setupRemoteMedia"),this.session){var t=this.session.sessionDescriptionHandler.remoteMediaStream,r=function(r){r&&(r.srcObject=t,r.play().then((function(){e.logger.log("play media")})).catch((function(t){e.logger.debug("Fail to play : ".concat(t.message))})),r.onaddtrack=function(t){e.logger.debug("Stream onaddtrack handler"),r.play().then((function(){e.logger.log("play media")})).catch((function(t){e.logger.debug("Fail to play : ".concat(t.message))}))})};"conference"===this.service||this.callParams.callType===gt.VIDEO&&r(this.callParams.media.remote.video),r(this.callParams.media.remote.audio)}else this.logger.warn("No session to set remote media on")}},{key:"toggleMute",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.session){this.sendStreamCtrlInfo(e,t,r);var n,i,o=this.session.sessionDescriptionHandler.localMediaStream,s=this.session.sessionDescriptionHandler.peerConnection.getSenders();o&&(e===mt.AUDIO?(n=o.getAudioTracks()[0],this.myScreenShare.hasAudioTrack()||(i=s[0].track)):(n=o.getVideoTracks()[0],i=s[1].track),n&&(e===mt.AUDIO?n.enabled=t:n.stop()),i&&(i.enabled=t))}else this.logger.warn("Fail to toggle mute because no session")}},{key:"changeInputDevice",value:function(e,t){var r,n=this;if(!t||"null"===t.toLowerCase())return Promise.reject(this.createErrorObject("InvalidDeviceId","Fail to changeInputDevice because invalid deviceid - ".concat(t)));if(this.callParams.pauseVideoByPageHidden&&document[$t()])return"video"===e&&(this.inputVideoDeviceId=t),Promise.resolve();var i=this.session.sessionDescriptionHandler.peerConnection;return i.getSenders?new Promise((function(r,i){if("empty"===t)if("audio"===e){var o=new AudioContext,s=o.createOscillator(),a=o.createGain();s.connect(a),a.gain.value=0;var c=a.connect(o.createMediaStreamDestination());s.start(),r(new MediaStream(c.stream.getAudioTracks()))}else r(n._getDummyVideoStream());else r("audio"===e?navigator.mediaDevices.getUserMedia({audio:{deviceId:t?{exact:t}:void 0},video:void 0}):n.videoMutedManager.getState()?n._getDummyVideoStream():navigator.mediaDevices.getUserMedia({audio:void 0,video:{width:Pt.WIDTH,height:Pt.HEIGHT,deviceId:t?{exact:t}:void 0}}))})).then((function(o){var s;if(r=o,"audio"===e?(s=o.getAudioTracks()[0],n.audioMutedManager.getState()&&(s.enabled=!1)):"video"===e&&(n.inputVideoDeviceId=t,s=o.getVideoTracks()[0]),s){var a,c,u=n.session.sessionDescriptionHandler.localMediaStream;if("audio"===e?(a=i.getSenders()[0],c=u.getAudioTracks()[0]):(a=i.getSenders()[1],c=u.getVideoTracks()[0],"conference"===n.service&&(n.logger.debug("changeInputDevice - change video resolution"),n.logger.debug(JSON.stringify(s.getSettings())),n._changeSimulcastResolution(s).catch((function(e){return n.logger.debug("changeInputDevice - fail to change simulcast resolution because ".concat(e.message))})))),u.addTrack(s),("audio"===e||"video"===e&&!0!==n.videoFiltered)&&a.replaceTrack(s),u.removeTrack(c),c.stop(),"audio"===e){var d;if(n.myScreenShare.hasAudioTrack()){var l=n._getMixAudioTrack(n.myScreenShare.mediaStream);n._replaceSenderAudioTrack(l)}null===(d=n.myTalkingStatusManager)||void 0===d||d.restart()}}})).catch((function(e){return r&&r.getTracks().forEach((function(e){return e.stop()})),Promise.reject(e)})):Promise.reject(this.createErrorObject("FailToChangeInputDevice","Fail to changeInputDevice"))}},{key:"cleanupMedia",value:function(){if(this.session){var e=this.session.sessionDescriptionHandler.localMediaStream;e&&e.getTracks().forEach((function(e){e.stop()}))}this.callParams.media&&(this.callParams.callType==gt.VIDEO?(this.callParams.media.remote&&this.callParams.media.remote.video&&(this.callParams.media.remote.video.srcObject=null,this.callParams.media.remote.video.pause()),this.callParams.media.local&&this.callParams.media.local.video&&(this.callParams.media.local.video.srcObject=null,this.callParams.media.local.video.pause())):this.callParams.media.remote&&this.callParams.media.remote.audio&&(void 0!==this.callParams.media.remote.audio.sinkId&&this.callParams.media.remote.audio.setSinkId(""),this.callParams.media.remote.audio.srcObject=null,this.callParams.media.remote.audio.pause())),this._clearDummyVideoStream(),this.myScreenShare.isPlayed()&&this.myScreenShare.cleanupVideo(),this._cleanupInitMediaHandler()}},{key:"_cleanupInitMediaHandler",value:function(){this.initMediaHandler&&(this.initMediaHandler.release(),this.initMediaHandler=void 0)}},{key:"cleanupWtp",value:function(){var e,t,r,n;null===(e=this.myTalkingStatusManager)||void 0===e||e.stop(),null===(t=this.peerTalkingStatusManager)||void 0===t||t.stop(),null===(r=this.peersTalkingStatusManager)||void 0===r||r.stop(),null===(n=this.txBitrateManager)||void 0===n||n.stop(),this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.release(),void 0!==this.sdhconnectionTimer&&(clearTimeout(this.sdhconnectionTimer),this.sdhconnectionTimer=void 0)}},{key:"setMediaSsrc",value:function(){if(this.session){var e=this.session.sessionDescriptionHandler.peerConnection.currentLocalDescription.sdp.split("m=video")[1];e&&(this.localVideoSsrc=function(e){var t=new RegExp("^a=ssrc-group:.[a-zA-Z]+ (.*$)","m"),r=e.match(t);if(!r)return[0];if(2===r.length&&r[1])return r[1].split(" ");t=new RegExp("^a=ssrc:\\d+ cname.*$","gm"),r=e.match(t);var n=[];return r.forEach((function(e){n.push(e.match("^a=ssrc:(\\d+)")[1])})),n}(e))}else this.logger.error("setMediaSsrc - No session")}},{key:"sendFeatureShare",value:function(e,t,r){var n={content:{feature_id:e,info:[{src_mid:this.callParams.myId,src_svc_id:this.callParams.fromSvcId,set:t}]},contentType:At.FEATURE_SHARE};return t===bt.SET&&(n.content.info[0].data=r),this.sendInfo(n)}},{key:"sendFeatureQuery",value:function(e,t){var r={content:{feature_id:e,info:[{src_mid:t,src_svc_id:this.callParams.toSvcId}]},contentType:At.FEATURE_QUERY};this.sendInfo(r)}},{key:"checkPermission",value:(o=Cr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia(t);case 3:return e.sent.stop(),e.abrupt("return",{permission:!0});case 8:if(e.prev=8,e.t0=e.catch(0),"NotAllowedError"!==e.t0.name){e.next=14;break}return e.abrupt("return",{permission:!1,reason:"NotAllowedError"});case 14:if("NotFoundError"!==e.t0.name){e.next=18;break}return e.abrupt("return",{permission:!1,reason:"NotFoundError"});case 18:return e.abrupt("return",{permission:!1,reason:"others"});case 19:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(e){return o.apply(this,arguments)})},{key:"mungeOfferSdp",value:function(e,t){this.logger.debug("[mungeOfferSdp] start");var r="";e.sdp.split(/(^m=video.*$)/m).forEach((function(e,t){t<=2?r+=e:e.startsWith("m=video")?r+=e.replace(/m=video \d*/,"m=video 9"):r+=e.replace(/c=IN IP4 \d*.\d*.\d*.\d*/,"c=IN IP4 0.0.0.0")}));var n,i=new RegExp("a=group:BUNDLE 0","m");if(r=r.replace(i,"a=group:BUNDLE"),t)switch(t.type){case"screenshare":this.logger.debug("[mungeOfferSdp] screen share"),i=new RegExp("(a=group:BUNDLE[ \\w\\d]*) ([\\w\\d]*)","m");var o=r.match(i)[2].trim();if(r=r.replace(i,"$1 "+t.sdpMid),this.bundleLine+=" "+t.sdpMid,i=new RegExp("a=mid:"+o,"m"),r=r.replace(i,"a=mid:".concat(t.sdpMid)),t.ssrc){i=new RegExp("(a=mid:".concat(t.sdpMid,")"),"m");var s=(n=r.split(i))[2].match(/a=ssrc-group:FID (\d*)/)[1],a=parseInt(t.ssrc,16);i=new RegExp("a=ssrc:".concat(s),"gm"),n[2]=n[2].replace(/a=ssrc-group:FID (\d*)/,"a=ssrc-group:FID "+a),n[2]=n[2].replace(i,"a=ssrc:".concat(a)),r=n.join("")}break;case"inactive":this.logger.debug("[mungeOfferSdp] direction inactive"),i=new RegExp("(a=mid:".concat(t.sdpMid,")"),"m"),(n=r.split(i))[2]=n[2].replace("a=".concat(t.direction),"a=inactive"),r=n.join("");break;case"active":this.logger.debug("[mungeOfferSdp] direction active"),i=new RegExp("(a=mid:".concat(t.sdpMid,")"),"m"),(n=r.split(i))[2]=n[2].replace("a=inactive","a=".concat(t.direction)),r=n.join("")}return this.logger.debug("Munge Offer SDP"),this.logger.debug(r),Promise.resolve({sdp:r,type:e.type})}},{key:"addVideoMungeAnswerSdp",value:function(e){this.logger.debug("[addVideoMungeAnswerSdp] start");var t=this.session.sessionDescriptionHandler.peerConnection.currentRemoteDescription.sdp,r=t.split("m=video")[1],n=t.split(/^a=group:BUNDLE.*$/m);t=n[0]+"a=group:BUNDLE "+this.bundleLine+n[1];var i=new RegExp("^a=msid-semantic: WMS (.*)","m"),o=t.match(i)[1];i=new RegExp("^a=ssrc:\\d+ cname:(.*)","m");var s=t.match(i)[1];i=new RegExp("^a=ice-ufrag:.*$","m");var a=r.match(i)[0]+"\n";i=new RegExp("^a=ice-pwd:.*$","m");var c=r.match(i)[0]+"\n";i=new RegExp("^a=fingerprint:sha-256 .*$","m");var u=r.match(i)[0]+"\n";i=new RegExp("^a=extmap:.*$","gm");var d="";r.match(i).forEach((function(e){d+=e+"\n"})),i=new RegExp("a=rtpmap:(\\d+) VP8");var l,h=r.match(i)[1],p="",f=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return wr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wr(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}(e);try{for(f.s();!(l=f.n()).done;){var g=l.value;p+="m=video 9 UDP/TLS/RTP/SAVPF ".concat(h,"\n"),p+="c=IN IP4 0.0.0.0\n",void 0!==g.bandwidth&&(p+="b=AS:".concat(g.bandwidth,"\n")),p+="a=rtcp:9 IN IP4 0.0.0.0\n",p+=a,p+=c,p+=u,p+="a=setup:active\n",p+="a=mid:".concat(g.sdpMid,"\n"),p+=d,p+="a=".concat(g.direction,"\n"),p+="a=rtcp-mux\n",p+="a=rtcp-rsize\n",p+="a=rtpmap:".concat(h," VP8/90000\n"),p+="a=rtcp-fb:".concat(h," nack\n"),p+="a=rtcp-fb:".concat(h," nack pli\n"),p+="a=ssrc:"+parseInt(g.ssrc,16)+" cname:"+s+"\n",p+="a=ssrc:"+parseInt(g.ssrc,16)+" msid:"+o+" v".concat(g.sdpMid,"\n"),p+="a=ssrc:"+parseInt(g.ssrc,16)+" mslabel:"+o+"\n",p+="a=ssrc:"+parseInt(g.ssrc,16)+" label:"+" v".concat(g.sdpMid,"\n")}}catch(e){f.e(e)}finally{f.f()}return this.logger.debug("[addVideoMungeAnswerSdp] Answer munging result"),this.logger.debug(t+p),Promise.resolve({sdp:t+p,type:"answer"})}},{key:"changeVideoDirectionMungeAnswerSdp",value:function(e,t,r){this.logger.debug("[changeVideoDirectionMungeAnswerSdp] start ".concat(t," -> ").concat(r));var n=this.session.sessionDescriptionHandler.peerConnection.currentRemoteDescription.sdp,i=new RegExp("(a=mid:".concat(e,")"),"m"),o=n.split(i);return o[2]=o[2].replace("a=".concat(t),"a=".concat(r)),n=o.join(""),this.logger.debug(n),Promise.resolve({sdp:n,type:"answer"})}},{key:"checkValiditySharedContentsData",value:function(e){var t=this;return new Promise((function(r,n){e instanceof Uint8Array||n(t.createErrorObject("WrongDataType","data type should be Uint8Array")),e.length>1e3&&n(t.createErrorObject("ExceedMaxSizeData","Data size must not exceed 1 kilobyte")),r()}))}},{key:"isVideoCall",value:function(){return this.callTypeState>1}},{key:"onProgress",value:function(e){this.logger.debug("Start onProgress"),this.changeState(Pr.STATE_CONNECTING),this.callDir==ft.INITIATOR&&this.emit("connecting",this.session)}},{key:"onAccepted",value:function(){var e=this;if(this.logger.debug("Start onAccepted"),this.callDir===ft.RESPONDER&&this.state===Pr.STATE_CONNECTING)this.changeState(Pr.STATE_VERIFIED),this.emit("ringing",this.callParams);else if(this.state===Pr.STATE_CONNECTED);else{var t,r;this.changeState(Pr.STATE_CONNECTED),this.setupLocalMedia(),this.setupRemoteMedia(),this.setMediaSsrc(),this.callParams.pauseVideoByPageHidden&&this._webVisibilityChangeEvent(),this._webBeforeUnloadEvent(),null===(t=this.myTalkingStatusManager)||void 0===t||t.start({target:"my",callback:function(t){e.emit("myTalkingStatusUpdated",t)}}),null===(r=this.txBitrateManager)||void 0===r||r.start(),this.emit("connected",this.session)}}},{key:"onRejected",value:function(e){this.logger.debug("Start onRejected"),this.plnRelCode!==Kt.CANCEL&&this._parsePReason(e),this.onEnded("Unsuccessful final message")}},{key:"onBye",value:function(e){this.logger.debug("Start onBye"),this.endBeforeBye||(this.changeState(Pr.STATE_DISCONNECTED),e.extraHeaders||this._parsePReason(e),this.onEnded("End call by 'BYE'"))}},{key:"onUaStartFailed",value:function(e){this.logger.error("UserAgent start failed"),this.logger.debug(e),this.releaser=Et.THIS,this.plnRelCode=Kt.CALL_CONNECT_FAIL_BY_SERVER,this.onFailed()}},{key:"onFailed",value:function(){this.logger.debug("Start onFailed"),this.callDir==ft.INITIATOR&&this.state===Pr.STATE_CONNECTING&&this.session.cancel(),this.emit("failed"),this.onEnded("Ended by fail")}},{key:"onEnded",value:(i=Cr(regeneratorRuntime.mark((function e(){var t,r,n,i=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>0&&void 0!==o[0]?o[0]:null,this.logger.debug("Start onEnded - ".concat(r)),this.wtpConfig.logLevel!==Dt.DEBUG||!this.session){e.next=5;break}return e.next=5,this.wtpGetStats().then((function(e){return i.logger.debug("end statistics - ".concat(JSON.stringify(e)))})).catch((function(e){return i.logger.debug("end statistics fail because ".concat(e.message))}));case 5:if("testcall"!==this.service||void 0!==this.testCallDuration){e.next=8;break}return e.next=8,this._makeTestCallResult();case 8:this.cleanupMedia(),this.cleanupWtp(),this.changeState(Pr.STATE_RELEASED),n=Ft(this.releaser,this.plnRelCode),this.callParams&&null!==(t=this.callParams.inviteHeaders)&&void 0!==t&&t.fakeCall&&("AMP_TERM_CALL_THIS"===n.strCode?n={code:Bt.AMP_TERM_CALL_THIS_FCALL,strCode:"AMP_TERM_CALL_THIS_FCALL"}:"AMP_TERM_CALL_PEER_NO_RESPONSE"===n.strCode&&(n={code:Bt.AMP_TERM_CALL_PEER_FCALL_NO_RESPONSE,strCode:"AMP_TERM_CALL_PEER_FCALL_NO_RESPONSE"})),"testcall"!==this.service?this.emit("ended",{ampTermCode:n,plnRelCode:Wt(this.plnRelCode),releaser:this.releaser}):(this.testCallResult.ampTermCode=n,this.testCallResult.plnRelCode=Wt(this.plnRelCode),this.emit("ended",this.testCallResult));case 14:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"onDialogInfo",value:function(e){var t,r,n,i=this;e.message.headers&&e.message.headers["Content-Type"]&&e.message.headers["Content-Type"][0]&&e.message.headers["Content-Type"][0].parsed&&(n=e.message.headers["Content-Type"][0].parsed);var o=JSON.parse(e.message.body);switch(n){case At.STREAM_CTRL:o.forEach((function(e){"video"===e.kind&&("pause"==e.ctrl?i.emit("peerVideoPause",e.reason):"resume"==e.ctrl?i.emit("peerVideoResume",e.reason):"video"==e.kind&&"start"==e.ctrl?i.videoEnabled||i.emit("switchAudioToVideo"):"video"==e.kind&&"stop"==e.ctrl&&(i.wtpDisableVideo(),i.emit("switchVideoToAudio")))}));break;case At.USER_INFO:e.delegate.onUserInfo(o);break;case At.NOTIFY_USER_STATUS:e.delegate.onNotifyUserStatus(o);break;case At.REQUEST_USER_VIEW:o.forEach((function(t){t.mid===i.callParams.myId&&e.delegate.onRequestUserView(t)}));break;case At.FEATURE_SHARE:e.delegate&&e.delegate.onFeatureShare&&e.delegate.onFeatureShare(o);break;case At.FEATURE_SHARE_RESULT:e.delegate&&e.delegate.onFeatureShareResult&&e.delegate.onFeatureShareResult(o);break;case At.USER_MESSAGE:if(o.body_type&&".jfs-mic-ctrl"===o.body_type)if("call"===this.service)this.emit("muteRequested",o.body["mic-ct"]);else{var s=this.room.getPeer(o.source);void 0!==s&&this.emit("muteRequested",s.getPeerInfo(),o.body["mic-ct"])}else"call"===this.service?this.emit("shortDataReceived",o.body_type,ut(o.body)):this.emit("shortDataReceived",o.source,o.body_type,ut(o.body));break;case At.DATA_INFO:var a;this.myScreenShare.dSsrc=o.d_ssrc,o.rx_link_bw&&(null===(a=this.txBitrateManager)||void 0===a||a.resetMaxSendLinkBandwidth(o.rx_link_bw)),this.audioMutedManager.init(),this.videoMutedManager.init();break;case At.DATA_CTRL:e.delegate&&e.delegate.onDataCtrl&&e.delegate.onDataCtrl(o);break;case At.APPLICATION_CONTROL:null!==(t=e.delegate)&&void 0!==t&&t.onApplicationControl&&e.delegate.onApplicationControl(o);break;case At.RECORDING_STATUS:null!==(r=e.delegate)&&void 0!==r&&r.onRecordingStatus&&e.delegate.onRecordingStatus(o);break;default:this.logger.warn("Invalid Content-Type of INFO : ".concat(n))}}},{key:"onSdhInviteError",value:function(e){switch(this.logger.debug("onSdhInviteError"),this.releaser=Et.THIS,this.endBeforeBye=!0,e.name){case"AbortError":this.plnRelCode=Kt.ABORT;break;case"NotAllowedError":this.plnRelCode=Kt.NOT_ALLOWED;break;case"NotFoundError":this.plnRelCode=Kt.NOT_FOUND;break;case"NotReadableError":this.plnRelCode=Kt.NOT_READABLE;break;case"OverconstrainedError":this.plnRelCode=Kt.OVERCONSTRAINED;break;case"SecurityError":this.plnRelCode=Kt.SECURITY_ERROR;break;case"TypeError":this.plnRelCode=Kt.TYPE_ERROR;break;default:this.plnRelCode=Kt.UNKNOWN_ERROR}this.changeState(Pr.STATE_DISCONNECTED),this.onEnded("INVITE Fail")}},{key:"onTransportError",value:function(e){this.logger.debug("onTransportError"),this.logger.error(e),this.state===Pr.STATE_CONNECTED&&(this.releaser=Et.THIS,this.plnRelCode=Kt.WEB_SIGNALING_UNEXPECTED_DISCONNECTED,this.endBeforeBye=!0,this.changeState(Pr.STATE_DISCONNECTED),this.onEnded("Transport error"))}},{key:"setInitMediaState",value:function(e){this.logger.debug("setInitMediaState, cameraOn: ".concat(this.callParams.cameraOn,", micOn: ").concat(this.callParams.micOn)),this.videoMutedManager.setMediaState(new Tr(this.callParams.cameraOn,e.videoMuteCallback,(function(e){}))),this.audioMutedManager.setMediaState(new Tr(this.callParams.micOn,e.audioMuteCallback,(function(e){})))}},{key:"_waitForMutedComplete",value:function(e,t){var r=this;void 0!==t&&setTimeout((function(){0==e.isActivate()?t():r._waitForMutedComplete(e,t)}),200)}},{key:"_changeMediaMuteState",value:function(e,t){var r=this;return e.setMediaState(t).then((function(){var t=null;if(0==e.isActivate())t=e.activate();else{var n=e.getStandbyMediaState();null!==n&&e.releseStandbyMediaState(),e.setStandby(),n=new Promise((function(t,n){!function i(){setTimeout((function(){1==e.isStandby()?i():0==e.isActivate()?e.activate().then((function(){t()})).catch((function(e){n(e)})):n(r.createErrorObject("PreviousVideoMuteNotComplete","The previous operation of video mute is not completed"))}),10)}()})),e.setStandbyMediaState(n),t=n}return t}))}},{key:"_getScreenShareChain",value:function(e,t){var r=this,n=e.peerConnection,i=this.myScreenShare,o=Promise.resolve();return t!==Ot.START&&t!==Ot.RESTART||(o=this._activeHD(!1).then((function(e){return 1==e?r._updateSimulcast():Promise.resolve()})).then((function(){return e.createLocalOfferOrAnswer().then((function(e){var n=void 0;return t===Ot.START&&((n={sdpMid:i.sdpMid}).type="screenshare",n.ssrc=i.dSsrc),r.mungeOfferSdp(e,n)})).then((function(t){return e.setLocalSessionDescription(t)})).then((function(){return t===Ot.START?r.addVideoMungeAnswerSdp([{direction:"recvonly",ssrc:i.dSsrc,sdpMid:i.sdpMid,bandwidth:1200}]):Promise.resolve(n.currentRemoteDescription)})).then((function(e){return void 0!==r.simulcastHandler?r.simulcastHandler.replaceRecvMungeSdp(e):Promise.resolve(e)})).then((function(e){return n.setRemoteDescription(e)})).catch(function(){var t=Cr(regeneratorRuntime.mark((function t(o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.logger.debug("Error while set myScreenShare sessionDescription. pc state is ".concat(n.signalingState)),r.logger.debug(o),"have-local-offer"!==n.signalingState){t.next=8;break}return r.transceiverHandler.addSpareTransceiver(i.transceiver),r.bundleLine=r.bundleLine.replace(" mss",""),i.failedSetupVideo(),t.next=8,e.rollbackLocalSessionDescription();case 8:return t.abrupt("return",Promise.reject(r.createErrorObject("SessionDescriptionFail","Fail to set myScreenShare session description")));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))),o}},{key:"_activeHD",value:function(e){var t=this;return new Promise((function(r,n){var i=t.session.sessionDescriptionHandler.localMediaStream;if(void 0!==t.simulcastHandler&&null!=i){var o=null;i.getVideoTracks().length>0&&null!=(o=i.getVideoTracks()[0])&&t.simulcastHandler.updateTrack(o),t.simulcastHandler.activeHD=e,r(t.simulcastHandler.isHDSupported)}else r(!1)}))}},{key:"_updateSimulcast",value:function(){var e=this;return new Promise((function(t,r){var n=e.session.sessionDescriptionHandler.peerConnection;if(null!=n){var i=n.getSenders()[1];if(null!=i){var o=i.getParameters();o.encodings.forEach((function(t){e.simulcastHandler.updateSenderEncoding(t)})),i.setParameters(o),t()}else r()}else r()}))}},{key:"_parsePReason",value:function(e){this.logger.debug(e);var t=e.headers["P-Reason"];if(t&&t[0]){var r=t[0].raw.split(";");this.plnRelCode=Number(r[0]),this.releaser=this._getAmpReleaser(r[2])}else this.logger.log("P-Reason is not exist in message"),this.plnRelCode=Kt.UNDEFINED,this.releaser=void 0}},{key:"_getAmpReleaser",value:function(e){switch(e){case"initiator":return this.callDir==ft.INITIATOR?Et.THIS:Et.PEER;case"responder":return this.callDir==ft.INITIATOR?Et.PEER:Et.THIS;default:return Et.OTHERS}}},{key:"_isTestCall",value:function(){return"testcall"===this.service}},{key:"_isValidStateToMute",value:function(){if(this.callDir===ft.INITIATOR){if(this.state===Pr.STATE_INIT||this.state===Pr.STATE_READY)return this.logger.warn("Mute fail because STATE is not valid"),!1}else if(this.state!==Pr.STATE_CONNECTED)return this.logger.warn("Mute fail because STATE is not valid"),!1;return!0}},{key:"_replaceVideoTrack",value:function(e){var t=this;if(!0===e.skipReplaceVideoTrack)return Promise.resolve();var r=function(){var r=Cr(regeneratorRuntime.mark((function r(){var n,i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.initMedia){r.next=2;break}return r.abrupt("return");case 2:return e.videoInputDeviceId?n=e.videoInputDeviceId:t.inputVideoDeviceId&&(n=t.inputVideoDeviceId),r.next=5,navigator.mediaDevices.enumerateDevices();case 5:return i=r.sent,o=i.find((function(e){return e.deviceId===n})),n=void 0!==o?o.deviceId:void 0,t.inputVideoDeviceId=n,r.abrupt("return",n);case 10:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return r().then((function(r){return n=r,new Promise((function(r,i){e.initMedia&&e.initMedia.mediaStream?r(e.initMedia.mediaStream):navigator.mediaDevices.getUserMedia({video:n?{deviceId:{exact:n},width:Pt.WIDTH,height:Pt.HEIGHT}:{width:Pt.WIDTH,height:Pt.HEIGHT}}).then((function(e){return r(e)})).catch((function(e){if("OverconstrainedError"===e.name){var r=t.createErrorObject("OverconstrainedError","Constraints of replaceVideoTrack is not acceptable - deviceId=".concat(n," / width=").concat(Pt.WIDTH," / height=").concat(Pt.HEIGHT));r.constraint=e.constraint,i(r)}else i(e)}))}));var n})).then((function(e){return r=e,new Promise((function(e,n){try{t.logger.debug("[_replaceVideoTrack] Start replaceLocalVideoTrack");var i=t.session.sessionDescriptionHandler.localMediaStream,o=r.getVideoTracks()[0];if(o){var s=i.getVideoTracks()[0];s&&"video"===s.kind&&(i.removeTrack(s),i.addTrack(o),s.stop(),e(r))}}catch(e){r&&r.getTracks().forEach((function(e){return e.stop()})),n(t.createErrorObject("ReplaceLocalTrackFail","Fail to replace local video track while replaceVideoTrack"))}}));var r})).then((function(r){var n,i;return t.videoFiltered&&t.filteredVideoStream?n=t.filteredVideoStream:(n=r,t.videoFiltered=!1),i=n,new Promise((function(r,n){try{t.logger.debug("[_replaceVideoTrack] Start replaceSenderTrack");var o=i.getVideoTracks()[0];o&&(o.enabled=e.cameraOn,t.session.sessionDescriptionHandler.peerConnection.getSenders()[1].replaceTrack(o).then((function(){"conference"===t.service&&(!1!==t.videoMutedManager.getState()&&!0!==e.needCheckSimulcastResolution||t._changeSimulcastResolution(o).catch((function(e){return t.logger.debug("replaceSenderTrack - fail to change simulcast resolution because ".concat(e.message))}))),r()})))}catch(e){i&&i.getTracks().forEach((function(e){return e.stop()})),n(t.createErrorObject("ReplaceSenderTrackFail","Fail to replace sender video track while replaceVideoTrack"))}}))})).catch((function(e){if(t.logger.warn("Fail to set video track. ".concat(e.message,". (Error=").concat(JSON.stringify(e),")")),"ReplaceLocalTrackFail"===e.name||"ReplaceSenderTrackFail"===e.name)throw e}))}},{key:"_replaceSenderVideoTrack",value:function(e){var t=this,r=e.getVideoTracks()[0];if(!r)return Promise.reject(this.createErrorObject("NoVideoTrack","Fail to replace video track of sender because stream has no video track"));var n=this.session.sessionDescriptionHandler.peerConnection.getSenders()[1],i=[];return"conference"===this.service&&i.push((function(){return t._changeSimulcastResolution(r)})),i.push((function(){return new Promise((function(e,t){var i=n.track;i&&"video"===i.kind&&n.replaceTrack(r).then((function(){e()})).catch((function(e){t(e)}))}))})),i.reduce((function(e,t){return e.then(t)}),Promise.resolve())}},{key:"_replaceSenderAudioTrack",value:function(e){var t=this.session.sessionDescriptionHandler.peerConnection;return this.session.sessionDescriptionHandler.localMediaStream,new Promise((function(r,n){t.getSenders()[0].replaceTrack(e).then((function(){r()}))}))}},{key:"_getMixAudioTrack",value:function(e){this.logger.debug("start _getMixAudioTrack");var t=new AudioContext,r=t.createMediaStreamDestination(),n=this.session.sessionDescriptionHandler.localMediaStream;return t.createMediaStreamSource(e).connect(r),t.createMediaStreamSource(n).connect(r),r.stream.getTracks()[0]}},{key:"_changeSimulcastResolution",value:function(e){var t=this,r=this.session.sessionDescriptionHandler,n=this.session.sessionDescriptionHandler.peerConnection,i=this.myScreenShare;return this.logger.debug("_changeSimulcastResolution start"),this.logger.debug("_changeSimulcastResolution check, screenShare.state: "+i.state),this.logger.debug("_changeSimulcastResolution check, simulcastHandler.activeHD: "+this.simulcastHandler.activeHD),this.simulcastHandler.updateTrack(e),new Promise((function(e,i){t.sdpMutex.acquire().then((function(){if(t.logger.debug("_changeSimulcastResolution acquire"),t.simulcastHandler.needUpdateSdp()){t.logger.debug("_changeSimulcastResolution updateTrack - HD=".concat(t.simulcastHandler.isHDSupported," / isResolutionChanged=").concat(t.simulcastHandler.isResolutionChanged));var i=Promise.resolve();return 1==t.simulcastHandler.isResolutionChanged&&(i=t._updateSimulcast()),i.then((function(){var i=t.simulcastHandler.isHDSupported;return r.createLocalOfferOrAnswer().then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return t.simulcastHandler.replaceRecvMungeSdp(n.currentRemoteDescription)})).then((function(e){return t.simulcastHandler.isCurrentSdpHD=i,n.setRemoteDescription({sdp:e.sdp,type:"answer"})})).then((function(){t.sdpMutex.release(),e()})).catch(function(){var e=Cr(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("have-local-offer"!==n.signalingState){e.next=3;break}return e.next=3,r.rollbackLocalSessionDescription();case 3:return t.logger.debug("Catch to _changeSimulcastResolution sdp munging"),e.abrupt("return",Promise.reject(i));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}t.logger.debug("_changeSimulcastResolution skip because sdpUpdate is not needed"),t.sdpMutex.release(),e()})).catch((function(e){t.logger.debug("_changeSimulcastResolution outer exception"),t.sdpMutex.release(),i(e)}))}))}},{key:"_completeStartMyScreenShare",value:function(){void 0!==this.startMyScreenShareCompleteTimeout&&(clearTimeout(this.startMyScreenShareCompleteTimeout),this.startMyScreenShareCompleteTimeout=void 0),this.startMyScreenShareCompleteResolve&&this.startMyScreenShareCompleteResolve(),this.isCompleteStartMyScreenShare=!0,this._cleanPromiseStartMyScreenShare(),this.timeoutStopMyScreenShare&&(this.timeoutStopMyScreenShare=void 0,this.wtpStopMyScreenShare())}},{key:"_cleanPromiseStartMyScreenShare",value:function(){this.startMyScreenShareCompleteResolve=void 0,this.startMyScreenShareCompleteReject=void 0}},{key:"_webVisibilityChangeEvent",value:function(){var e,t,r=this;e=function(){if(r.callParams.callType===gt.VIDEO){var e=$t();if(document[e]){r.logger.debug("Web document hidden.");var t={reasonCode:r.videoMutedManager.getState()?Rt.PAUSED_BLOCKED:Rt.BLOCKED,plnVideoPauseReason:yt.BY_INTERRUPT,isUser:!1};r.wtpPauseMyVideo(t)}else r.logger.debug("Web document visible."),r.videoMutedManager.getState()?r.wtpPauseMyVideo({reasonCode:Rt.PAUSED,plnVideoPauseReason:null,isUser:!1}):r.wtpResumeMyVideo()}},void 0!==document.hidden?t="visibilitychange":["ms","webkit","moz","o"].forEach((function(e){void 0!==document[e+"Hidden"]&&(t=e+"visibilitychange")})),t&&document.addEventListener(t,e,!1)}},{key:"_webBeforeUnloadEvent",value:function(){var e=this;window.addEventListener("beforeunload",(function(t){var r=[];r.push("P-Reason: "+Kt.UE_DESTROY+";UE_DESTROY;"+e.callDir),e.session.bye({requestOptions:{extraHeaders:r}})}))}},{key:"_getDummyVideoStream",value:function(){this._clearDummyVideoStream();var e=Object.assign(document.createElement("canvas"),{width:640,height:480}),t=function(){e.getContext("2d").fillRect(0,0,640,480)};return t(),this.dummyVideo=setInterval(t,3e3),e.captureStream()}},{key:"_clearDummyVideoStream",value:function(){this.dummyVideo&&(clearInterval(this.dummyVideo),this.dummyVideo=void 0)}},{key:"_getConstraints",value:function(e){try{if(Object.is(e,void 0))throw"undefined";if(Object.is(e,null))throw"null";if(Object.is(e,NaN))throw"NaN"}catch(t){e=this._getDefaultConstraints()}return e}},{key:"_getDefaultConstraints",value:function(){return{video:{width:{max:1920},height:{max:1080},frameRate:{max:10}},audio:!0}}},{key:"_getDeviceId",value:function(){var e=localStorage.getItem("deviceId");if(null==e||""===e){var t=window.crypto.getRandomValues(new Uint8Array(8));e="",t.forEach((function(t){e+=t.toString(16).padStart(2,"0")})),this.logger.debug("Set init deviceId: ".concat(e)),localStorage.setItem("deviceId",e)}return e}},{key:"_getValidDeviceId",value:(n=Cr(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"default"!==t&&"communications"!==t){e.next=6;break}return e.next=4,navigator.mediaDevices.enumerateDevices().then((function(e){var n=e.find((function(e){return e.deviceId===t&&e.kind===r}));i=e.find((function(e){return e.groupId===n.groupId&&e.kind===r&&"default"!==e.deviceId&&"communications"!==e.deviceId}))}));case 4:n=i?i.deviceId:t,this.logger.debug("Change deviceId from ".concat(t," to ").concat(n));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getStats",value:function(){var e=this;this.session.sessionDescriptionHandler.peerConnection.getStats().then((function(t){e.logger.log(t),t.forEach((function(t){e.logger.log("===================================================================================================================================="),e.logger.log("".concat(t.type," / ").concat(t.id," / ").concat(t.timestamp)),Object.keys(t).forEach((function(r){"id"!==r&&"timestamp"!==r&&"type"!==r&&e.logger.debug("".concat(r," : ").concat(t[r]))}))}))}))}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(qe);function Dr(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}r(285),r(1637);var Lr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t;var r=window.AudioContext||window.webkitAudioContext||!1;this.audioContext=new r,this.audioWorkletNode=void 0,this.mediaStreamSource=void 0,this.target=void 0}var t,r,n,i;return t=e,r=[{key:"loadProcessor",value:(n=regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Blob(["\nconst audioLevelPower = [\n    0.0, 0.000000001, 0.000000004, 0.000000008, 0.000000015, 0.000000023, 0.000000034, 0.000000046, 0.00000006, 0.000000075, 0.000000093, 0.000000113, 0.000000134, 0.000000183, 0.00000021, 0.000000269, 0.000000336, 0.000000411, 0.000000536, 0.000000679, 0.000000838, 0.000001014, 0.000001275, 0.000001643, 0.000002057, 0.000002518, 0.000003242, 0.000004057, 0.0000051, 0.000006416, 0.000008055,\n    0.000010073, 0.000012749, 0.000015982, 0.000020125, 0.000025355, 0.000031875, 0.000039906, 0.000050128, 0.000063443, 0.000079953, 0.000100195, 0.000126123, 0.000158855, 0.000199647, 0.00025183, 0.000316546, 0.000398342, 0.000501756, 0.000632346, 0.000795141, 0.001001515, 0.001259678, 0.001586066, 0.0019961, 0.002514058, 0.003163376, 0.003982916, 0.005012751, 0.006310278, 0.007946269,\n    0.010001221, 0.012591788, 0.01585472, 0.019956045, 0.025124881, 0.03162206, 0.039809797, 0.05012089, 0.063096508, 0.079428054, 0.099997073, 0.125902832, 0.158485055, 0.199528202, 0.251191616, 0.316234618, 0.398099065, 0.501188636, 0.630930781, 0.794300437\n];\nconst audioLevelDB = [\n    -127, -90, -84, -80, -78, -76, -74, -73, -72, -71, -70, -69, -68, -67, -66, -65, -64, -63, -62, -61, -60, -59, -58, -57, -56, -55, -54, -53, -52, -51, -50, -49, -48, -47, -46, -45, -44, -43, -42, -41, -40, -39, -38, -37, -36, -35, -34, -33, -32, -31, -30, -29, -28, -27, -26, -25, -24, -23, -22, -21, -20, -19, -18, -17, -16, -15, -14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0\n];\nconst AVERAGE_LEVEL_COEFFICIENT = 0.95;\nconst kCutThreshold = 80;\nconst kCutRatio = 6;\nconst kBottom = 40;\nconst kDbMax = 127;\nconst kNormalizedMax = 100;\n\nclass AudioLevelCalculateProcessor extends AudioWorkletProcessor {\n    constructor(options) {\n        super();\n        // this.interval = options.processorOptions.interval;\n        this.accumulatedLevel = 0;\n    }\n\n    process(inputs, outputs) {\n        const currentTime = Date.now();\n\n        const audioChannel = inputs[0][0]; // first input channel\n        if (!audioChannel) return false;\n        let sum = 0;\n        let rms = 0;\n\n        for (let i = 0; i < audioChannel.length; ++i) {\n            sum += audioChannel[i] * audioChannel[i];\n        }\n\n        rms = Math.sqrt(sum / audioChannel.length); // RMS(root mean square)\n        const micAudioLevel = 20 * Math.log10(rms); // change rms to dBFS\n\n        this.accumulatedLevel = this.getMovingAverageDB(micAudioLevel);\n        const accumlatedLevelDB = this.getDB(this.accumulatedLevel);\n\n        let ret = accumlatedLevelDB + kDbMax;\n        if (ret < kCutThreshold) {\n            ret = ret > kBottom ? ret - kBottom : 0;\n            ret = ret / kCutRatio;\n        } else {\n            const factor = kNormalizedMax - kCutThreshold / kCutRatio;\n            const dividor = kDbMax - kCutThreshold;\n            const sub = (kDbMax * factor) / dividor - kNormalizedMax;\n            ret = (ret * factor) / dividor - sub;\n        }\n\n        this.port.postMessage({\n            type: 'normalizedAudioLevel',\n            value: ret\n        });\n        return true;\n    }\n\n    getIndex(array, target) {\n        let mid = 0;\n        let left = 0;\n        let right = array.length - 1;\n        while (left <= right) {\n            mid = Math.floor((left + right) / 2);\n            if (array[mid] === target) return mid;\n            else if (array[mid] < target) left = mid + 1;\n            else right = mid - 1;\n        }\n\n        if (right < 0) return 0;\n        else return right;\n    }\n\n    getDB(power) {\n        return audioLevelDB[this.getIndexOfPower(power)];\n    }\n    getPower(dB) {\n        return audioLevelPower[this.getIndexOfDB(dB)];\n    }\n\n    getIndexOfPower(target) {\n        return this.getIndex(audioLevelPower, target);\n    }\n\n    getIndexOfDB(target) {\n        return this.getIndex(audioLevelDB, target);\n    }\n\n    getMovingAverageDB(newDB) {\n        return AVERAGE_LEVEL_COEFFICIENT * this.accumulatedLevel + (1 - AVERAGE_LEVEL_COEFFICIENT) * this.getPower(newDB);\n    }\n}\n\nregisterProcessor('audio-level-calculate-processor', AudioLevelCalculateProcessor);\n\n"],{type:"text/javascript"}),n=URL.createObjectURL(r),this.target=t.target,this.mediaStreamSource=this.audioContext.createMediaStreamSource("my"===this.target?this.session.sessionDescriptionHandler.localMediaStream:this.session.sessionDescriptionHandler.remoteMediaStream),e.next=7,this.audioContext.audioWorklet.addModule(n);case 7:URL.revokeObjectURL(n),"suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioWorkletNode=new AudioWorkletNode(this.audioContext,"audio-level-calculate-processor"),this.mediaStreamSource.connect(this.audioWorkletNode),this.audioWorkletNode.connect(this.audioContext.destination),this.audioWorkletNode.port.onmessage=function(e){"normalizedAudioLevel"===e.data.type&&t.callback(e.data.value)},e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])})),i=function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function s(e){Dr(o,r,i,s,a,"next",e)}function a(e){Dr(o,r,i,s,a,"throw",e)}s(void 0)}))},function(e){return i.apply(this,arguments)})},{key:"refreshProcessor",value:function(){var e,t;null===(e=this.mediaStreamSource)||void 0===e||e.disconnect(),null===(t=this.audioWorkletNode)||void 0===t||t.disconnect(),this.mediaStreamSource=this.audioContext.createMediaStreamSource("my"===this.target?this.session.sessionDescriptionHandler.localMediaStream:this.session.sessionDescriptionHandler.remoteMediaStream),this.mediaStreamSource.connect(this.audioWorkletNode),this.audioWorkletNode.connect(this.audioContext.destination)}},{key:"unloadProcessor",value:function(){var e,t,r;null===(e=this.mediaStreamSource)||void 0===e||e.disconnect(),null===(t=this.audioWorkletNode)||void 0===t||t.disconnect(),null===(r=this.audioContext)||void 0===r||r.close()}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Mr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.audioWorkletManager=new Lr(t),this.prevIsActive=void 0,this.curIsActive=!1}var t,r;return t=e,(r=[{key:"start",value:function(e){var t=this;this.audioWorkletManager.loadProcessor({callback:function(r){t.curIsActive=r>=20,t.prevIsActive!==t.curIsActive&&(t.prevIsActive=t.curIsActive,e.callback(t.curIsActive))},target:e.target})}},{key:"stop",value:function(){this.audioWorkletManager.unloadProcessor()}},{key:"restart",value:function(){this.audioWorkletManager.refreshProcessor()}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function kr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return xr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function xr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ur=1500,Vr=300,Hr=100,jr=600,$r=1200,Br=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t.session,this.service=t.service,this.videoSsrc=void 0,this.maxSendLinkBandwidth=void 0===t.maxSendLinkBandwidth?void 0:t.maxSendLinkBandwidth,this.maxSendLinkBandwidthConfig={video:void 0,screenShare:void 0},this.wtpTargetBitrate=void 0,this.wtpScreenShareTargetBitrate=void 0,this.isActiveScreenShare=!1,this.prevPacketsLost=0,this.videoSentBitrate=0,this.sumVideoSentBitate=0,this.prevBytesSent=0,this.txBitrateSamples=[],this.targetBitrateUpdated=!1,this.isMaxSendLinkBandwidthAdjusted=!1,this.logger=t.logger}var t,r;return t=e,(r=[{key:"start",value:function(){var e=this;this.updateMaxSendLinkBandwidthConfig();var t=this.session.sessionDescriptionHandler.peerConnection,r=t.getSenders()[1];this.setVideoSsrc(),this.intervalId=setInterval((function(){e.session.sessionDescriptionHandler.peerConnection.getStats().then((function(n){var i,o=kr(n);try{for(o.s();!(i=o.n()).done;){var s=i.value[1];if("outbound-rtp"===s.type){if("call"===e.service){if("video"===s.kind&&"screenshare"!==s.contentType){var a=s.targetBitrate||e.wtpTargetBitrate;if(void 0===a||a>1e3*e.maxSendLinkBandwidthConfig.video||e.targetBitrateUpdated){e.wtpTargetBitrate=1e3*e.maxSendLinkBandwidthConfig.video;var c=r.getParameters();c.encodings[0].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video,r.setParameters(c),e.logger.debug("Adjusting video txBitrate to ".concat(e.maxSendLinkBandwidthConfig.video," kbps")),e.targetBitrateUpdated=!1}e.calcVideoSentBitrate(s.bytesSent)}}else if("vga"===s.rid){var u=s.targetBitrate||e.wtpTargetBitrate;if(void 0===u||u>1e3*e.maxSendLinkBandwidthConfig.video.sum||e.targetBitrateUpdated){e.wtpTargetBitrate=1e3*e.maxSendLinkBandwidthConfig.video.sum;var d=r.getParameters();d.encodings[0].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video.qvga,d.encodings[1].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video.vga,0!==e.maxSendLinkBandwidthConfig.video.hd?d.encodings[2].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video.hd:d.encodings[2].active=!1,r.setParameters(d),e.logger.debug("Adjusting video txBitrate to qvga ".concat(e.maxSendLinkBandwidthConfig.video.qvga," kbps, vga ").concat(e.maxSendLinkBandwidthConfig.video.vga," kbps, hd ").concat(e.maxSendLinkBandwidthConfig.video.hd," kbps")),e.targetBitrateUpdated=!1}e.calcVideoSentBitrate(s.bytesSent)}if(e.isActiveScreenShare&&"screenshare"===s.contentType&&(s.targetBitrate||e.wtpScreenShareTargetBitrate)>1e3*e.maxSendLinkBandwidthConfig.screenShare){e.wtpScreenShareTargetBitrate=1e3*e.maxSendLinkBandwidthConfig.screenShare;var l=t.getSenders().slice(2).find((function(e){return e.track})),h=l.getParameters();h.encodings[0].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.screenShare,l.setParameters(h),e.logger.debug("Adjusting screenShare txBitrate to ".concat(e.maxSendLinkBandwidthConfig.screenShare," kbps"))}}else if(!e.isMaxSendLinkBandwidthAdjusted&&"remote-inbound-rtp"===s.type&&s.ssrc===e.videoSsrc){var p=s.packetsLost;(p-e.prevPacketsLost)/p>.02&&(e.logger.debug("video packetLost is detected: ".concat(p-e.prevPacketsLost)),e.adjustMaxSendLinkBandwidthForLowBitrate()),e.prevPacketsLost=p}}}catch(e){o.e(e)}finally{o.f()}}))}),1e3)}},{key:"stop",value:function(){clearInterval(this.intervalId)}},{key:"activeScreenShare",value:function(){this.isActiveScreenShare=!0,this.updateMaxSendLinkBandwidthConfig()}},{key:"inactiveScreenShare",value:function(){this.isActiveScreenShare=!1,this.updateMaxSendLinkBandwidthConfig()}},{key:"resetMaxSendLinkBandwidth",value:function(e){this.maxSendLinkBandwidth>e&&(this.maxSendLinkBandwidth=e,this.logger.debug("Reset maxSendLinkBandwidth to ".concat(this.maxSendLinkBandwidth)),this.targetBitrateUpdated=!0,this.updateMaxSendLinkBandwidthConfig())}},{key:"adjustMaxSendLinkBandwidthForLowBitrate",value:function(){var e="call"===this.service?this.maxSendLinkBandwidthConfig.video:this.maxSendLinkBandwidthConfig.video.vga;this.logger.debug("Compare currentMaxSendLinkBandwidth(".concat(1e3*e,") with currentBitrate(").concat(this.videoSentBitrate,")")),.8*e*1e3>this.videoSentBitrate&&(this.logger.debug("Adjust maxSendLinkBandwidth because of lower network bandwidth"),this.resetMaxSendLinkBandwidth(.6*this.maxSendLinkBandwidth),this.isMaxSendLinkBandwidthAdjusted=!0)}},{key:"updateMaxSendLinkBandwidthConfig",value:function(){if(this.isActiveScreenShare)this.maxSendLinkBandwidth<1500?(this.maxSendLinkBandwidthConfig.video="call"===this.service?Vr:{qvga:100,vga:200,hd:0,sum:300},this.maxSendLinkBandwidth<1100?this.maxSendLinkBandwidthConfig.screenShare=800:this.maxSendLinkBandwidthConfig.screenShare=this.maxSendLinkBandwidth-Vr):(this.maxSendLinkBandwidthConfig.screenShare=$r,"call"===this.service?this.maxSendLinkBandwidthConfig.video=this.maxSendLinkBandwidth-$r<Ur?this.maxSendLinkBandwidth-$r:Ur:this.maxSendLinkBandwidthConfig.video={qvga:Hr,vga:this.maxSendLinkBandwidth-$r-Hr<jr?this.maxSendLinkBandwidth-$r-Hr:jr,hd:0,sum:this.maxSendLinkBandwidth-$r});else{var e="call"===this.service?kt.CALL_TX:kt.GROUPCALL_TX;this.maxSendLinkBandwidth>e?"call"===this.service?this.maxSendLinkBandwidthConfig.video=Ur:this.maxSendLinkBandwidthConfig.video={qvga:Hr,vga:jr,hd:2500,sum:3200}:this.maxSendLinkBandwidth<Vr?"call"===this.service?this.maxSendLinkBandwidthConfig.video=Vr:this.maxSendLinkBandwidthConfig.video={qvga:100,vga:200,hd:0,sum:300}:"call"===this.service?this.maxSendLinkBandwidthConfig.video=this.maxSendLinkBandwidth<Ur?this.maxSendLinkBandwidth:Ur:(this.maxSendLinkBandwidthConfig.video={},this.maxSendLinkBandwidthConfig.video.qvga=Hr,this.maxSendLinkBandwidth-Hr<=jr?(this.maxSendLinkBandwidthConfig.video.vga=this.maxSendLinkBandwidth-Hr,this.maxSendLinkBandwidthConfig.video.hd=0):(this.maxSendLinkBandwidthConfig.video.vga=jr,this.maxSendLinkBandwidthConfig.video.hd=this.maxSendLinkBandwidth-700>=1200?this.maxSendLinkBandwidth-700:0),this.maxSendLinkBandwidthConfig.video.sum=Hr+this.maxSendLinkBandwidthConfig.video.vga+this.maxSendLinkBandwidthConfig.video.hd)}var t="call"===this.service?1e3*this.maxSendLinkBandwidthConfig.video:1e3*this.maxSendLinkBandwidthConfig.video.sum;this.wtpTargetBitrate<t&&(this.targetBitrateUpdated=!0),this.logger.debug("Update maxSendLinkBandwidth config - ".concat(JSON.stringify(this.maxSendLinkBandwidthConfig)))}},{key:"setVideoSsrc",value:function(){var e=this;void 0===this.videoSsrc&&(this.session.sessionDescriptionHandler.peerConnection.getStats().then((function(t){var r,n=kr(t);try{for(n.s();!(r=n.n()).done;){var i=r.value[1];if("outbound-rtp"===i.type)if("call"===e.service){if("video"===i.kind&&"screenshare"!==i.contentType)return void(e.videoSsrc=i.ssrc)}else if("vga"===i.rid)return void(e.videoSsrc=i.ssrc)}}catch(e){n.e(e)}finally{n.f()}})),void 0===this.videoSsrc&&setTimeout((function(){return e.setVideoSsrc()}),500))}},{key:"calcVideoSentBitrate",value:function(e){if(0!==e){var t=8*(e-this.prevBytesSent);if(!(t<0)){this.sumVideoSentBitate+=t,this.txBitrateSamples.push(t),this.txBitrateSamples.length>5&&(this.sumVideoSentBitate-=this.txBitrateSamples.shift());var r=this.sumVideoSentBitate/this.txBitrateSamples.length;this.prevBytesSent=e,this.videoSentBitrate=r}}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Fr(e){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fr(e)}function qr(e,t){return qr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},qr(e,t)}function Kr(e){return Kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Kr(e)}var Wr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qr(e,t)}(a,e);var r,n,i,o,s=(i=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Kr(i);if(o){var r=Kr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Fr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this,"call")}return r=a,n=[{key:"wtpCallMake",value:function(e){var r=this;if(!st())throw this.createErrorObject("BrowserNotSupported","This browser is not supported");if(!this.setCallParam(e))throw new Error("Mandatory field in call param is mssing");this.logger.debug("Start wtpCallMake"),this.logger.debug(this.callParams),this.changeState(Pr.STATE_READY),this.callDir=ft.INITIATOR,this.callTypeState=this.callParams.callType===gt.AUDIO?vt.AUDIO:vt.VIDEO,this.setInitMediaState({videoMuteCallback:function(e){e.setState(!r.callParams.cameraOn),r.callParams.cameraOn||r.callTypeState!==vt.VIDEO||r.wtpPauseMyVideo()},audioMuteCallback:function(e){e.setState(!r.callParams.micOn),0==r.callParams.micOn&&r.wtpMuteMyAudio()}}),this.createUa(this.callParams.myId),this.ua.start().then((function(){r.logger.debug("Start UserAgent"),r.changeState(Pr.STATE_CONNECTING);var e=r.setPlnExtraInviteHeaders(ft.INITIATOR);r.createInviteSession(e,{delegate:{onDataCtrl:function(e){return r.onDataCtrl(e)},onFeatureShare:function(e){return r.onFeatureShare(e)},onFeatureShareResult:function(e){return r.onFeatureShareResult(e)},onRecordingStatus:function(e){return r.onRecordingStatus(e)}},peerConnectionDelegate:{onTrack:function(e){return r.onTrackAdditional(e)}}})})).then((function(){r.transceiverHandler.setSession(r.session),r.callParams.enableTalkingStatusEvent&&(r.myTalkingStatusManager=new Mr(r.session),r.peerTalkingStatusManager=new Mr(r.session)),r.txBitrateManager=new Br({session:r.session,service:r.service,maxSendLinkBandwidth:void 0!==r.callParams.maxSendLinkBandwidth?r.callParams.maxSendLinkBandwidth:kt.CALL_TX,logger:r.logger});var e={sdpModifier:[function(e){var t=Yt(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=zt(t,{imageattr:"true"}),e.sdp=t,Promise.resolve(e)},t],sdhOptions:{cameraOn:r.callParams.cameraOn,micOn:r.callParams.micOn,initMediaHandler:r.initMediaHandler,constraints:r.getConstraints(),ignoreDeviceError:r.callParams.ignoreDeviceError},inviteDelegate:{onAccept:function(){var e;r.onCallInviteAccept(),null===(e=r.peerTalkingStatusManager)||void 0===e||e.start({target:"peer",callback:function(e){r.emit("peerTalkingStatusUpdated",e)}})}}};r.sendInvite(e)})).catch((function(e){return r.onUaStartFailed(e)}))}},{key:"wtpCallVerify",value:function(e){var r=this;if(!st())throw this.createErrorObject("BrowserNotSupported","This browser is not supported");if(!this.setCallParam(e))throw new Error("Mandatory field in call param is mssing");void 0!==e.allowVerifyOnMultipleWindow&&!0!==e.allowVerifyOnMultipleWindow||(this.callParams.allowVerifyOnMultipleWindow=!0),this.logger.debug("Start wtpCallVerify"),this.logger.debug(this.callParams),this.changeState(Pr.STATE_READY),this.callDir=ft.RESPONDER,this.callTypeState=this.callParams.callType===gt.AUDIO?vt.AUDIO:vt.VIDEO,this.setInitMediaState({videoMuteCallback:function(e){e.setState(!r.callParams.cameraOn),r.callParams.cameraOn||r.callTypeState!==vt.VIDEO||r.wtpPauseMyVideo()},audioMuteCallback:function(e){e.setState(!r.callParams.micOn),0==r.callParams.micOn&&r.wtpMuteMyAudio()}}),this.createUa(this.callParams.peerId),this.ua.start().then((function(){r.logger.debug("Start UserAgent"),r.changeState(Pr.STATE_CONNECTING);var e=r.setPlnExtraInviteHeaders(ft.RESPONDER);r.createInviteSession(e,{delegate:{onDataCtrl:function(e){return r.onDataCtrl(e)},onFeatureShare:function(e){return r.onFeatureShare(e)},onFeatureShareResult:function(e){return r.onFeatureShareResult(e)},onRecordingStatus:function(e){return r.onRecordingStatus(e)}},peerConnectionDelegate:{onTrack:function(e){return r.onTrackAdditional(e)}}})})).then((function(){r.transceiverHandler.setSession(r.session),r.callParams.enableTalkingStatusEvent&&(r.myTalkingStatusManager=new Mr(r.session),r.peerTalkingStatusManager=new Mr(r.session)),r.txBitrateManager=new Br({session:r.session,service:r.service,maxSendLinkBandwidth:void 0!==r.callParams.maxSendLinkBandwidth?r.callParams.maxSendLinkBandwidth:kt.CALL_TX,logger:r.logger});var e={sdpModifier:[function(e){var t=Yt(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=zt(t,{imageattr:"true"}),e.sdp=t,e.sdp=e.sdp.replace(/^a=sendrecv/gim,"a=recvonly"),Promise.resolve(e)},t],sdhOptions:{noVideo:!0,constraints:{audio:!1,video:!1}}};r.sendInvite(e)})).catch((function(e){return r.onUaStartFailed(e)}))}},{key:"wtpCallAnswer",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state===Pr.STATE_VERIFIED){if(!this.session)throw new Error("No Session to Answer");var n={sdpModifier:[function(e){var t=Yt(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=zt(t,{imageattr:"true"}),e.sdp=t,Promise.resolve(e)},t],sdhOptions:{cameraOn:this.callParams.cameraOn,micOn:this.callParams.micOn,initMediaHandler:this.initMediaHandler,constraints:this.getConstraints(),ignoreDeviceError:this.callParams.ignoreDeviceError,offerOptions:{iceRestart:!0}},inviteDelegate:{onAccept:function(){var t;e.onCallInviteAccept(),null===(t=e.peerTalkingStatusManager)||void 0===t||t.start({target:"peer",callback:function(t){e.emit("peerTalkingStatusUpdated",t)}})}},requestOptions:{extraHeaders:["X-req_rec: "+r]}};this.sendInvite(n),this.changeState(Pr.STATE_ANSWERED)}else this.logger.warn("Answer fail - Call should be VERIFIED ahead")}},{key:"wtpCallEnd",value:function(){if(this.state===Pr.STATE_CONNECTED||this.state===Pr.STATE_CONNECTING||this.state===Pr.STATE_VERIFIED||this.state===Pr.STATE_ANSWERED){if(this.releaser=Et.THIS,this.state===Pr.STATE_CONNECTING)return this.plnRelCode=Kt.CANCEL,this.session.cancel();if(this.session){this.callTerminate=!0;var e,t=[];if(this.callDir===ft.INITIATOR)this.state===Pr.STATE_CONNECTED?(this.plnRelCode=Kt.NORMAL,e="NORMAL"):(this.plnRelCode=Kt.UNDEFINED,e="UNDEFINED");else switch(this.state){case Pr.STATE_CONNECTED:this.plnRelCode=Kt.NORMAL,e="NORMAL";break;case Pr.STATE_VERIFIED:this.plnRelCode=Kt.REJECT,e="REJECT";break;default:this.plnRelCode=Kt.UNDEFINED,e="UNDEFINED"}return t.push("P-Reason: "+this.plnRelCode+";"+e+";"+this.callDir),this.session.bye({requestOptions:{extraHeaders:t}})}}else this.logger.warn("No active call to hang up on")}},{key:"wtpCallEnableVideo",value:function(e){return this.wtpEnableVideo(e)}},{key:"wtpCallDisableVideo",value:function(){return this.wtpDisableVideo()}},{key:"wtpCallEnableVideoWithPauseResponse",value:function(){var e=this,t={cameraOn:!1,videoInputDeviceId:void 0,onAcceptVideoToggle:function(){e.wtpPauseMyVideo({reasonCode:Rt.ENABLE_VIDEO_RESPONSE,isUser:!0})}};return this.wtpCallEnableVideo(t)}},{key:"wtpCallRequestPeerMute",value:function(e){this.wtpRequestPeerMute([this.callParams.peerId],e)}},{key:"wtpCallAddPeerScreenShareView",value:function(e){var t=this;this.logger.debug("[wtpCallAddPeerScreenShareView] start");var r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=this.peerScreenShare;return this.sdpMutex.acquire().then((function(){switch(i.videoView=e,i.state){case Ot.INIT:var r=n.addTransceiver("video",{direction:"recvonly"});return i.transceiver=r,i.sdpMid="pss",i.state=Ot.START,Promise.resolve("NEW");case Ot.STOP:return i.transceiver.direction="recvonly",i.state=Ot.RESTART,Promise.resolve("RESTART");default:return Promise.reject(t.createErrorObject("NotValidScreenShareState","Peer screenShare state is not vaild to start (currentState=".concat(i.state,")")))}})).then((function(e){return"NEW"===e?r.createLocalOfferOrAnswer().then((function(e){var r={sdpMid:i.sdpMid};return i.state===Ot.START?r.type="screenshare":(r.type="active",r.direction="recvonly"),t.mungeOfferSdp(e,r)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return t.addVideoMungeAnswerSdp([{direction:"sendonly",ssrc:i.dSsrc,sdpMid:i.sdpMid}])})).then((function(e){return n.setRemoteDescription(e)})).then((function(){return t.logger.debug("wtpCallAddPeerScreenShareView done"),t.sdpMutex.release()})).catch((function(e){return t.sdpMutex.release(),t.logger.debug("Fail to add peer screenshare - ".concat(e.message)),Promise.reject(e)})):(t.logger.debug("Restart peer screenshare"),i.playVideo(),t.sdpMutex.release(),Promise.resolve())})).catch((function(e){return t.logger.debug("wtpCallAddPeerScreenShareView fail - ".concat(e.message)),t.logger.debug(e),Promise.reject(e)}))}},{key:"wtpCallRemovePeerScreenShareView",value:function(){this.logger.debug("[wtpCallRemovePeerScreenShareView] start");var e=this.peerScreenShare;return e.state===Ot.START||e.state===Ot.RESTART?(e.cleanupView(),Promise.resolve()):Promise.reject(this.createErrorObject("NotValidScreenShareState","Peer screenShare state is not valid to remove (currentState=".concat(e.state,")")))}},{key:"wtpCallChangePeerScreenShareView",value:function(e,t){var r=this;return new Promise((function(n,i){var o=r.peerScreenShare;o.state===Ot.START?o.changeVideoView(e,t).then((function(){r.logger.debug("peer screen share view is changed"),n()})).catch((function(e){return r.logger.debug("catch error : ".concat(e))})):i(r.createErrorObject("ScreenShareNotPlaying","Peer screenShare is not playing"))}))}},{key:"wtpCallSendShortData",value:function(e,t){if(!(t instanceof Uint8Array))return Promise.reject(this.createErrorObject("WrongDataType","data type should be Uint8Array"));if(e.length>100)return Promise.reject(this.createErrorObject("ExceedMaxSizeType","Type must not exceed 100 bytes"));if(t.length>800)return Promise.reject(this.createErrorObject("ExceedMaxSizeData","Data must not exceed 900 bytes"));var r={body_type:e,body:dt(t),source:this.callParams.myId,source_svc_id:this.callDir===ft.INITIATOR?this.callParams.fromSvcId:this.callParams.toSvcId};return this.wtpSendShortData(r)}},{key:"wtpCallIsRecordOnCloudActivated",value:function(){return this.isRecordOnCloudActivated}},{key:"onDataCtrl",value:function(e){if(this.logger.debug("start onDataCtrl"),void 0!==e.event)switch(e.event){case 0:this.emit("peerScreenShareStopped");break;case 1:this.peerScreenShare.dSsrc=e.d_ssrc,this.emit("peerScreenShareStarted")}}},{key:"onFeatureShare",value:function(e){var t=this;this.logger.debug("start onFeatureShare - ".concat(JSON.stringify(e)));var r=e.feature_id,n=e.info;switch(r){case wt.MIC_STATUS:n.forEach((function(e){e.set===bt.UNSET?t.emit("peerMicUnmuted"):t.emit("peerMicMuted")}));break;case wt.SHARED_CONTENTS:case wt.EXCLUSIVELY_SHARED_CONTENTS:var i=n[0];i.set===bt.SET?this.emit(r===wt.SHARED_CONTENTS?"peerSharedContentsSet":"peerExclusivelySharedContentsSet",ut(i.data),void 0!==i.elapsed?i.elapsed:0):this.emit(r===wt.SHARED_CONTENTS?"peerSharedContentsUnset":"peerExclusivelySharedContentsUnset"),r===wt.EXCLUSIVELY_SHARED_CONTENTS&&(i.set===bt.SET?this.sharedContentsManager.setExclusivelySharedContents(this.callParams.peerId):this.sharedContentsManager.unsetExclusivelySharedContents());break;default:this.logger.debug("onFeatureShare default case")}}},{key:"onFeatureShareResult",value:function(e){this.logger.debug("start onFeatureShareResult - ".concat(JSON.stringify(e)));var t=e.feature_id,r=e.result;t===wt.EXCLUSIVELY_SHARED_CONTENTS&&(r===Ct.OK?this.resolveExclusivelySharedContents():this.rejectExclusivelySharedContents(this.createErrorObject("FailSetExclusivelySharedContents",e.rel_phrase)),this.sharedContentsManager.completeUpdateExclusivelySharedContents())}},{key:"onRecordingStatus",value:function(e){this.logger.debug("start onRecordingStatus - ".concat(JSON.stringify(e)));var t,r=e.body;switch(this.isRecordOnCloudActivated="activated"===r["recording-status"],r["fail-reason"]){case"recording-activation-failed":case"recording-activation-failed-so":t=xt.ACTIVATION_FAILED;break;default:t=xt.INTERNAL}this.emit("recordOnCloudUpdated",this.isRecordOnCloudActivated,t)}},{key:"onTrackAdditional",value:function(e){this.logger.debug("call onTrackAdditional"),this.logger.debug(JSON.stringify(e)),e.transceiver.mid.startsWith("pss")&&(this.logger.debug("peerScreenShare ontrack start"),this.peerScreenShare.setupMedia(e.track))}},{key:"onCallInviteAccept",value:function(){this.onAccepted()}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),a}(Nr),Gr=(r(7727),r(2479),Object.freeze({DISCONNECT:0,CONNECT:1})),Yr=Object.freeze({STOP:0,PAUSE:1,RESUME:2}),zr=Object.freeze({STOP:0,START:1}),Xr=Object.freeze({UPDATE_RESOLUTION:0,NEW_STREAM:1}),Jr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userId=t.mid,this.aSsrc=t.a_ssrc,this.vSsrc=t.v_ssrc,this.dSsrc=t.d_ssrc,this.infoState=or.INIT,this.videoState=void 0===t.v_ssrc?St.DISABLED:St.ENABLED,this.screenShare=void 0,this.isSendingScreenShare=!1,this.videoView=void 0,this.transceiver=void 0,this.mediaStream=new MediaStream,this.videoStreamState=ir.INIT,this.videoRequested=!1,this.micMuted=!1,this.isSetDefaultSharedContents=!1,this.userEquipmentType=Mt(t.ue_type),this.displayName=t.display_name,this.sipLocalIP=t.local_ip,this.sipDeviceInfo=t.device_info}var t,r;return t=e,(r=[{key:"getPeerInfo",value:function(){return{userId:this.userId,videoState:this.videoState,isSendingScreenShare:this.isSendingScreenShare,isPlayingScreenShare:this.isScreenSharePlayed(),videoRequested:this.videoRequested,micMuted:this.micMuted,userEquipmentType:this.userEquipmentType,displayName:this.displayName,sipLocalIP:this.sipLocalIP,sipDeviceInfo:this.sipDeviceInfo,vSsrc:parseInt(this.vSsrc,16),dSsrc:parseInt(this.dSsrc,16)}}},{key:"getPeerVideoStatus",value:function(e){return{peer:this.getPeerInfo(),videoStatus:{state:this.videoState,pauseReason:void 0!==e?e:yt.UNDEFINED}}}},{key:"getId",value:function(){return this.userId}},{key:"getInfoState",value:function(){return this.infoState}},{key:"setInfoState",value:function(e){this.infoState=e}},{key:"getVideoView",value:function(){this.videoView}},{key:"setVideoView",value:function(e){this.videoView=e}},{key:"getTransceiver",value:function(){return this.transceiver}},{key:"setTransceiver",value:function(e){this.transceiver=e}},{key:"getVideoState",value:function(){return this.videoState}},{key:"setVideoState",value:function(e){this.videoState=e}},{key:"getVideoRequested",value:function(){return this.videoRequested}},{key:"setVideoRequested",value:function(e){this.videoRequested=e}},{key:"getVideoStreamState",value:function(){return this.videoStreamState}},{key:"setVideoStreamState",value:function(e){this.videoStreamState=e}},{key:"setMicMute",value:function(){this.micMuted=!0}},{key:"setMicUnmute",value:function(){this.micMuted=!1}},{key:"setScreenShareSsrc",value:function(e){void 0===this.screenShare&&(this.screenShare=new sr),this.screenShare.dSsrc=e}},{key:"setSendingScreenShare",value:function(e){this.isSendingScreenShare=e}},{key:"inactiveTransceiver",value:function(){this.transceiver&&(this.transceiver.direction="inactive")}},{key:"hasVideoSsrc",value:function(){return void 0!==this.vSsrc}},{key:"isSendingVideo",value:function(){return this.videoState!==St.DISABLED}},{key:"isScreenSharePlayed",value:function(){return!!this.screenShare&&this.screenShare.isPlayed()}},{key:"setupMedia",value:function(e){var t=this;this.videoStreamState=ir.PLAY,"video"===e.kind&&this.mediaStream.getVideoTracks().forEach((function(r){e.id!==r.id&&(r.stop(),t.mediaStream.removeTrack(r))})),this.mediaStream.addTrack(e),this.mediaStream.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:e})),this.playVideo()}},{key:"playVideo",value:function(){var e=this;this.videoView&&(this.videoView.srcObject=this.mediaStream,this.videoView.play().then((function(){})).catch((function(e){})),this.videoView.onaddtrack=function(t){e.videoView.play().then((function(){})).catch((function(e){}))})}},{key:"failedSetupVideo",value:function(){this.videoStreamState=ir.FAILED,this.videoRequested=!1,this.transceiver=void 0}},{key:"changeCallType",value:function(e){e===gt.AUDIO?(this.infoState=or.VIDEO_STOP,this.videoState=St.DISABLED):(this.infoState=or.VIDEO_START,this.videoState=St.ENABLED)}},{key:"cleanupVideo",value:function(){this.videoStreamState=ir.CLEAN,this.videoView&&(this.videoView.srcObject=null,this.videoView.pause(),this.videoView=void 0)}},{key:"release",value:function(){this.vSsrc&&(this.transceiver=void 0,this.mediaStream=void 0),this.infoState=or.LEAVE,this.aSsrc=void 0,this.vSsrc=void 0,this.dSsrc=void 0}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Zr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.roomId=void 0,this.roomServiceId=void 0,this.peersMap=new Map,this.assrc10PeerIdMap={},this.vssrcPeerIdMap={},this.dssrcPeerIdMap={},this.sdpMidPeerIdMap={}}var t,r;return t=e,(r=[{key:"getPeer",value:function(e){return this.peersMap.get(e)}},{key:"removePeer",value:function(e){this.peersMap.delete(e)}},{key:"getPeersUserId",value:function(){return Array.from(this.peersMap.keys())}},{key:"getPeerInfo",value:function(e){var t=this.peersMap.get(e);if(t)return t.getPeerInfo()}},{key:"getPeerBySdpMid",value:function(e){var t=this.sdpMidPeerIdMap[e];if(t)return this.peersMap.get(t)}},{key:"getPeerByVssrc",value:function(e){var t=this.vssrcPeerIdMap[e];if(t)return this.peersMap.get(t)}},{key:"getPeerByDssrc",value:function(e){var t=this.dssrcPeerIdMap[e];if(t)return this.peersMap.get(t)}},{key:"updatePeer",value:function(e){if(e.connect===Gr.DISCONNECT){if(this.isPeer(e.mid)){var t=this.peersMap.get(e.mid);if(t.transceiver){var r=t.transceiver.mid;this.sdpMidPeerIdMap[r]=void 0}t.aSsrc&&delete this.assrc10PeerIdMap[parseInt(t.aSsrc,16)],t.vSsrc&&(this.vssrcPeerIdMap[t.vSsrc]=void 0),t.dSsrc&&(this.dssrcPeerIdMap[t.dSsrc]=void 0),t.release(),this.logger.debug("Room | ".concat(t.userId," leave the room"))}}else if(this.isPeer(e.mid)){var n=this.peersMap.get(e.mid);if(n.getInfoState()!==or.FEATURE_AHEAD)if(e.v_ssrc)n.vSsrc&&n.vSsrc!==e.v_ssrc||n.aSsrc&&n.aSsrc!==e.a_ssrc?this.rejoinPeer(n,e):(n.changeCallType(gt.VIDEO),n.vSsrc=e.v_ssrc,this.vssrcPeerIdMap[n.vSsrc]=n.userId);else if(n.aSsrc!==e.a_ssrc)this.rejoinPeer(n,e);else{if(n.videoState===St.DISABLED)return!1;n.changeCallType(gt.AUDIO)}else void 0!==n.aSsrc?(this.logger.debug("Room | feature_ahead user ".concat(n.userId," re-join the room")),this.rejoinPeer(n,e)):(n.aSsrc=e.a_ssrc,n.vSsrc=e.v_ssrc,n.dSsrc=e.d_ssrc,n.infoState=or.JOIN,n.videoStreamState=ir.INIT,n.userEquipmentType=Mt(e.ue_type),n.displayName=e.display_name,n.sipLocalIP=e.local_ip,n.sipDeviceInfo=e.device_info,this.assrc10PeerIdMap[parseInt(e.a_ssrc,16)]=n.userId,e.v_ssrc&&(this.vssrcPeerIdMap[e.v_ssrc]=n.userId,n.videoState===St.DISABLED&&n.setVideoState(St.ENABLED)),e.d_ssrc&&(this.dssrcPeerIdMap[e.d_ssrc]=n.userId),this.logger.debug("Room | ".concat(n.userId," join the room after feature share")))}else this.addPeerToRoom(e,or.JOIN);return!0}},{key:"addPeerToRoom",value:function(e,t){var r=new Jr(e),n=e.mid;r.setInfoState(t),this.peersMap.set(n,r),e.a_ssrc&&(this.assrc10PeerIdMap[parseInt(e.a_ssrc,16)]=n),e.v_ssrc&&(this.vssrcPeerIdMap[e.v_ssrc]=n),e.d_ssrc&&(this.dssrcPeerIdMap[e.d_ssrc]=n),this.logger.debug("Room | Add peer to room - ".concat(n))}},{key:"addPeerToRoomByFeatureAhead",value:function(e,t){var r,n=t.src_mid;this.isPeer(n)?r=this.peersMap.get(n):(r=new Jr({mid:n}),this.logger.debug("add new peer by feature ahead- ".concat(n))),r.infoState=or.FEATURE_AHEAD,e===wt.CAMERA_STATUS?t.set===bt.UNSET?r.setVideoState(St.ENABLED):r.setVideoState(St.PAUSED):t.set===bt.UNSET?r.setMicUnmute():r.setMicMute(),this.peersMap.set(n,r)}},{key:"rejoinPeer",value:function(e,t){this.logger.debug("".concat(e.userId," re-join the room")),e.userId&&this.peersMap.delete(e.userId),e.aSsrc&&delete this.assrc10PeerIdMap[parseInt(e.aSsrc,16)],e.vSsrc&&(this.vssrcPeerIdMap[e.vSsrc]=void 0),e.dSsrc&&(this.dssrcPeerIdMap[e.dSsrc]=void 0),e.transceiver&&(this.sdpMidPeerIdMap[e.transceiver.mid]=void 0),e.cleanupVideo(),e.release(),this.addPeerToRoom(t,or.REJOIN)}},{key:"cleanRoom",value:function(){this.peersMap.forEach((function(e){e.release()}))}},{key:"isPeer",value:function(e){return this.peersMap.has(e)}},{key:"getNumberOfPeer",value:function(){return this.peersMap.size+1}},{key:"setLogger",value:function(e){this.logger=e}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Qr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function en(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qr(Object(r),!0).forEach((function(t){tn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var rn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isHDSupported=void 0,this._isResolutionChanged=void 0,this._isCurrentSdpHD=void 0,this.defaultConfigs={direction:"sendonly"},this._activeHD=!0}var t,r;return t=e,(r=[{key:"updateTrack",value:function(e){var t=e.getSettings(),r=t.width*t.height>=518400;void 0===this._isHDSupported||(this._isResolutionChanged=r!==this._isHDSupported),this._isHDSupported=r}},{key:"updateSenderEncoding",value:function(e){switch(e.rid){case"qvga":e.scaleResolutionDownBy=this.isHDSupported?4:2;break;case"vga":e.scaleResolutionDownBy=this.isHDSupported?2:1;break;case"hd":e.active=this.isHDSupported&&this._activeHD}}},{key:"getConfigs",value:function(){var e=this.isHDSupported;return en(en({},this.defaultConfigs),{},{sendEncodings:[{rid:"qvga",active:!0,scaleResolutionDownBy:e?4:2,maxBitrate:15e4,priority:"high"},{rid:"vga",active:!0,scaleResolutionDownBy:e?2:1,priority:"low"},{rid:"hd",active:e&&this._activeHD},{rid:"thumb",active:!1,scaleResolutionDownBy:8}]})}},{key:"needUpdateSdp",value:function(){return this.isCurrentSdpHD!=this.isHDSupported}},{key:"replaceRecvMungeSdp",value:function(e){if(null!=e){var t=e.sdp,r=new RegExp("a=simulcast:recv [\\w~;]*","m");return t=!0===this._activeHD&&!0===this._isHDSupported?t.replace(r,"a=simulcast:recv qvga;vga;hd"):t.replace(r,"a=simulcast:recv qvga;vga;~hd"),Promise.resolve({sdp:t,type:e.type})}return Promise.reject()}},{key:"isHDSupported",get:function(){return this._isHDSupported}},{key:"isResolutionChanged",get:function(){return this._isResolutionChanged}},{key:"isCurrentSdpHD",get:function(){return this._isCurrentSdpHD},set:function(e){this._isCurrentSdpHD=e}},{key:"activeHD",get:function(){return this._activeHD},set:function(e){this._activeHD=e}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),nn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.extensionIdMap={},this.currentMaxExtmapId=-1}var t,r;return t=e,(r=[{key:"init",value:function(e){for(var t,r=/a=extmap:(\d+)/g,n=-1;null!==(t=r.exec(e));)n=n>parseInt(t[1])?n:parseInt(t[1]);this.currentMaxExtmapId=n}},{key:"getExtensionAddedSdp",value:function(e,t){if(this.hasRegistered(t))return e;var r=RegExp("(a=extmap:\\d+)","g"),n=e.split(r);return n[0]=n[0]+"a=extmap:".concat(++this.currentMaxExtmapId," ").concat(t,"\n"),this.extensionIdMap[t]=this.currentMaxExtmapId,n.join("")}},{key:"registerExtension",value:function(e,t){this.extensionIdMap[e]=t}},{key:"hasRegistered",value:function(e){return Object.keys(this.extensionIdMap).some((function(t){return t===e}))}},{key:"getExtensionId",value:function(e){return this.extensionIdMap[e]}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function on(e,t){if(e){if("string"==typeof e)return sn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?sn(e,t):void 0}}function sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r(189);var an=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.previousTalkers=new Set,this.timestampDiff=void 0}var t,r;return t=e,(r=[{key:"start",value:function(e){var t=this,r=e.room.assrc10PeerIdMap;this.intervalId=setInterval((function(){if(t.session){var n,i=[],o=[],s=[],a=t.session.sessionDescriptionHandler.peerConnection.getReceivers()[0],c=Date.now(),u=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=on(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}(a.getContributingSources());try{for(u.s();!(n=u.n()).done;){var d=n.value;void 0===t.timestampDiff&&(t.timestampDiff=c-d.timestamp);var l=r[d.source];void 0!==l&&(t.previousTalkers.has(l)?(c-t.timestampDiff-d.timestamp>500?o.push(l):s.push(l),t.previousTalkers.delete(l)):c-t.timestampDiff-d.timestamp<=500&&(i.push(l),s.push(l)))}}catch(e){u.e(e)}finally{u.f()}o.push.apply(o,function(e){if(Array.isArray(e))return sn(e)}(h=t.previousTalkers)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(h)||on(h)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),t.previousTalkers=new Set(s),(i.length||o.length)&&e.callback({active:i,inactive:o})}var h}),500)}},{key:"stop",value:function(){clearInterval(this.intervalId)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function cn(e){return cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(e)}function un(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function dn(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){un(o,n,i,s,a,"next",e)}function a(e){un(o,n,i,s,a,"throw",e)}s(void 0)}))}}function ln(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return hn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?hn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pn(e,t){return pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},pn(e,t)}function fn(e){return fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fn(e)}var gn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pn(e,t)}(a,e);var r,n,i,o,s=(i=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fn(i);if(o){var r=fn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===cn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this,"conference")}return r=a,n=[{key:"wtpConferenceInit",value:function(){this.room=new Zr,this.room.setLogger(this.logger),this.userInfoMutex=new Ye,this.simulcastHandler=new rn,this.sdpManager=new nn}},{key:"wtpConferenceJoin",value:function(e){var r=this;if(!st())throw this.createErrorObject("BrowserNotSupported","This browser is not supported");if(!this.setCallParam(e))throw new Error("Mandatory field in call param is mssing");this.logger.debug("wtpConferenceJoin | Start"),this.logger.debug(this.callParams),this.changeState(Pr.STATE_READY),this.wtpConferenceInit(),this.callDir=ft.CONFERENCE,this.callTypeState=this.callParams.callType===gt.AUDIO?vt.AUDIO:vt.VIDEO,this.setInitMediaState({videoMuteCallback:function(e){e.setState(!r.callParams.cameraOn),r.callParams.cameraOn||r.callTypeState!==vt.VIDEO||r.wtpPauseMyVideo()},audioMuteCallback:function(e){e.setState(!r.callParams.micOn),0==r.callParams.micOn&&r.wtpMuteMyAudio()}}),this.createUa(this.callParams.myId);var n=this.room;this.ua.start().then((function(){r.logger.debug("wtpConferenceJoin | Start UserAgent"),r.changeState(Pr.STATE_CONNECTING);var e=r.setPlnExtraInviteHeaders(ft.CONFERENCE);r.createInviteSession(e,{delegate:{onUserInfo:function(e){var t,i=Date.now(),o=e.member_count,s=[],a=[],c=[],u=[],d=[],l=[],h=[],p=ln(e.info);try{for(p.s();!(t=p.n()).done;){var f=t.value;if(r.logger.debug("onUserInfo | ".concat(i," | Start ").concat(JSON.stringify(f))),n.updatePeer(f)){var g=r.room.getPeer(f.mid);if(void 0!==g){var v;if(f.connect===Gr.DISCONNECT)null!==(v=g.screenShare)&&void 0!==v&&v.isPlayed()&&l.push({peerId:g.getId(),screenShare:g.screenShare}),g.isSendingVideo()&&(g.getVideoStreamState()!==ir.STOP&&r.wtpConferenceRemovePeerVideo(g.getId()),g.getVideoStreamState()!==ir.PLAY&&g.getVideoStreamState()!==ir.STOP||(g.setVideoStreamState(ir.CLEAN),h.push({peerId:g.getId(),videoView:g.getVideoView(),transceiver:g.getTransceiver()})));else if(g.infoState===or.REJOIN){var m=Object.assign(g.getPeerInfo(),{state:or.LEAVE});c.push(m),r.logger.debug("Send feature-query for rejoin user ".concat(g.getId())),r.sendFeatureQuery(wt.MIC_STATUS,g.getId()),r.sendFeatureQuery(wt.CAMERA_STATUS,g.getId()),g.infoState=or.JOIN}switch(g.infoState){case or.LEAVE:var S=g.getPeerInfo();!0===g.isSetDefaultSharedContents&&u.push(S.userId),a.push(S),r.room.removePeer(S.userId);break;case or.JOIN:s.push(g),g.isSendingVideo()&&d.push(g);break;case or.VIDEO_START:case or.VIDEO_STOP:d.push(g)}}}}}catch(e){p.e(e)}finally{p.f()}r.sdpMutex.acquire().then((function(){c.length&&(r.logger.debug("onUserInfo | ".concat(i," | peersRemoved before rejoin")),c.forEach((function(e){r.sendFeatureQuery(wt.SHARED_CONTENTS,e.userId)})),r.emit("confPeerListUpdated",{addedPeers:[],removedPeers:c,totalPeersCount:o-1})),l.forEach((function(e){r.cleanupScreenShare(e)})),h.forEach((function(e){r.cleanupPeerVideo(e)})),u.length&&r.emit("peersSharedContentsUnset",u);var e=[];if(s.length||a.length){s.forEach((function(t){void 0!==t&&t.getInfoState()===or.JOIN&&(t.setInfoState(or.JOIN_COMPLETE),e.push(t.getPeerInfo()))}));var t={addedPeers:e,removedPeers:a,totalPeersCount:o};r.logger.debug("onUserInfo | ".concat(i," | PeerListUpdated event param = ").concat(JSON.stringify(t))),r.emit("confPeerListUpdated",t)}if(r.isVideoCall()&&d.length){var n=[];d.forEach((function(e){void 0!==e&&n.push(e.getPeerVideoStatus())})),r.logger.debug("onUserInfo | ".concat(i," | PeerVideoUpdated event param = ").concat(JSON.stringify(n))),r.emit("confPeersVideoUpdated",n)}})).finally((function(){return r.sdpMutex.release()}))},onNotifyUserStatus:function(e){for(var t=[],n=function(n){var i=void 0,o=e[n];o.s===Yr.STOP?(o.ssrc?i=r.room.getPeerByVssrc(o.ssrc):r.logger.warn("Not found peer by notify-user-status"),void 0!==i?(r.logger.debug("onNotifyUserStatus STOP - ".concat(i.getId())),i.getVideoState()!==St.DISABLED&&(i.changeCallType(gt.AUDIO),t.push(i.getPeerVideoStatus())),r.isVideoCall()&&r.wtpConferenceRemovePeerVideo(i.getId()).catch((function(e){r.logger.warn(e)})).finally((function(){n===e.length-1&&t.length&&r.emit("confPeersVideoUpdated",t)}))):r.logger.debug("Skip notifyUserStatus becuase peer is undefined - userId=".concat(o.mid,"/ssrc=").concat(o.ssrc))):r.logger.warn("onNotifyUserStatus invalid status - ".concat(o.s))},i=0;i<e.length;i++)n(i)},onRequestUserView:function(e){},onFeatureShare:function(e){var t=e.feature_id,n=e.info;switch(t){case wt.CAMERA_STATUS:r.logger.debug("onFeatureShare Camera status - ".concat(JSON.stringify(n)));var i=[],o=[];n.forEach((function(e){var t=r.room.getPeer(e.src_mid);void 0!==t&&t.getInfoState()!==or.FEATURE_AHEAD?e.set===bt.UNSET?t.getVideoState()===St.PAUSED&&(t.setVideoState(St.ENABLED),t.getInfoState()>=or.JOIN_COMPLETE&&o.push(t.getPeerInfo())):t.getVideoState()===St.ENABLED&&!0!==e.data["vid-disabled"]&&(t.setVideoState(St.PAUSED),t.getInfoState()>=or.JOIN_COMPLETE&&i.push({peer:t.getPeerInfo(),pauseReason:e.data["off-reason"]})):(r.logger.debug("Add ahead video paused peer - ".concat(e.src_mid)),r.room.addPeerToRoomByFeatureAhead(wt.CAMERA_STATUS,e))})),r.isVideoCall()&&(i.length&&r.emit("confPeersVideoPaused",i),o.length&&r.emit("confPeersVideoResumed",o));break;case wt.MIC_STATUS:r.logger.debug("onFeatureShare Mic status - ".concat(JSON.stringify(n)));var s=[],a=[];n.forEach((function(e){var t=r.room.getPeer(e.src_mid);void 0!==t&&t.getInfoState()!==or.FEATURE_AHEAD?e.set===bt.UNSET?(t.setMicUnmute(),t.getInfoState()>=or.JOIN_COMPLETE&&a.push(t.getPeerInfo())):(t.setMicMute(),t.getInfoState()>=or.JOIN_COMPLETE&&s.push(t.getPeerInfo())):(r.logger.debug("Add ahead mic muted peer - ".concat(e.src_mid)),r.room.addPeerToRoomByFeatureAhead(wt.MIC_STATUS,e))})),s.length&&r.emit("confPeersMicMuted",s),a.length&&r.emit("confPeersMicUnmuted",a);break;case wt.SHARED_CONTENTS:var c=[],u=[];n.forEach((function(e){var t=r.room.getPeer(e.src_mid);t&&(e.set===bt.SET?(t.isSetDefaultSharedContents=!0,c.push({userId:e.src_mid,data:ut(e.data),elapsedTimeAfterSetMs:void 0!==e.elapsed?e.elapsed:0})):(t.isSetDefaultSharedContents=!1,u.push(e.src_mid)))})),c.length&&r.emit("peersSharedContentsSet",c),u.length&&r.emit("peersSharedContentsUnset",u);break;case wt.EXCLUSIVELY_SHARED_CONTENTS:case wt.ROOM_SHARED_CONTENTS:var d=n[0];d.set===bt.SET?r.emit(t===wt.EXCLUSIVELY_SHARED_CONTENTS?"peerExclusivelySharedContentsSet":"peerRoomSharedContentsSet",d.src_mid,ut(d.data),void 0!==d.elapsed?d.elapsed:0):r.emit(t===wt.EXCLUSIVELY_SHARED_CONTENTS?"peerExclusivelySharedContentsUnset":"peerRoomSharedContentsUnset",d.src_mid);break;default:r.logger.debug("onFeatureShare default case")}},onFeatureShareResult:function(e){var t=e.feature_id,n=e.result;switch(t){case wt.EXCLUSIVELY_SHARED_CONTENTS:n===Ct.OK?r.resolveExclusivelySharedContents():r.rejectExclusivelySharedContents(r.createErrorObject("FailSetExclusivelySharedContents",e.rel_phrase)),r.sharedContentsManager.completeUpdateExclusivelySharedContents();break;case wt.ROOM_SHARED_CONTENTS:n===Ct.OK?r.resolveRoomSharedContents():r.rejectRoomSharedContents(r.createErrorObject("FailSetRoomSharedContents",e.rel_phrase)),r.sharedContentsManager.completeUpdateRoomSharedContents()}},onDataCtrl:function(e){r.logger.debug("onDataCtrl message - ".concat(JSON.stringify(e))),void 0!==e.event&&(e.d_ssrc?function e(t){var n,i=null===(n=r.room)||void 0===n?void 0:n.getPeerByDssrc(t.d_ssrc);if(void 0!==i)switch(void 0!==r.onDataCtrlTimer&&(clearTimeout(r.onDataCtrlTimer),r.onDataCtrlTimer=void 0),r.logger.debug("start onDataCtrl - ".concat(JSON.stringify(i.getPeerInfo()))),t.event){case 0:i.setSendingScreenShare(!1),r.emit("peerScreenShareStopped",i.getId());break;case 1:i.setSendingScreenShare(!0),i.setScreenShareSsrc(i.dSsrc),r.emit("peerScreenShareStarted",i.getId())}else r.logger.debug("DataCtrl couldn't find dssrc ".concat(t.d_ssrc)),r.onDataCtrlTimer=setTimeout((function(){e(t)}),1e3)}(e):r.logger.warn("d_ssrc is not exist in the info body"))},onApplicationControl:function(e){r.logger.debug("onApplicationControl message"),null!=e&&e.data&&r.emit("appControlMessageReceived",ut(null==e?void 0:e.data))}},peerConnectionDelegate:{onTrack:function(e){r.logger.debug("Conference | peerConnectionDelegate.onTrack");var t,i=e.transceiver.mid;if(i.match(/^\d/))0!=i&&1!=i&&void 0!==(t=n.getPeerBySdpMid(e.transceiver.mid))&&(r.logger.debug("Conference | Add track - userId=".concat(t.getId(),"/sdp=").concat(i)),t.setupMedia(e.track));else{var o=i.slice(3);(t=n.getPeerByDssrc(o)).screenShare.setupMedia(e.track),r.logger.debug("Conference | Add screen share track - userId=".concat(t.getId(),"/dSsrc=").concat(o))}}}})})).then((function(){r.transceiverHandler.setSession(r.session),r.callParams.enableTalkingStatusEvent&&(r.myTalkingStatusManager=new Mr(r.session),r.peersTalkingStatusManager=new an(r.session)),r.callParams.maxSendLinkBandwidth&&(r.txBitrateManager=new Br({session:r.session,service:r.service,maxSendLinkBandwidth:r.callParams.maxSendLinkBandwidth,logger:r.logger}));var e={sdpModifier:[function(e){var t=Yt(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});t=zt(t,{imageattr:"true"});var n=new RegExp("a=group:BUNDLE 0","m");return e.sdp=t,e.sdp=e.sdp.replace(n,"a=group:BUNDLE"),"offer"===e.type&&(r.sdpManager.init(e.sdp),e.sdp=r.sdpManager.getExtensionAddedSdp(e.sdp,"urn:ietf:params:rtp-hdrext:csrc-audio-level")),Promise.resolve(e)},t],sdhOptions:{isConference:!0,cameraOn:r.callParams.cameraOn,micOn:r.callParams.micOn,constraints:r.getConstraints(),initMediaHandler:r.initMediaHandler,simulcastHandler:r.simulcastHandler,ignoreDeviceError:r.callParams.ignoreDeviceError},inviteDelegate:{onAccept:function(e){var t;r.onAccepted(),null===(t=r.peersTalkingStatusManager)||void 0===t||t.start({room:r.room,callback:function(e){r.emit("confPeersTalkingStatusUpdated",e)}})}}};r.sendInvite(e)})).catch((function(e){return r.onUaStartFailed(e)}))}},{key:"wtpConferenceLeave",value:function(){if(this.state===Pr.STATE_CONNECTED){if(this.room.cleanRoom(),this.room=void 0,this.releaser=Et.THIS,this.session){this.callTerminate=!0;var e,t=[];return this.state===Pr.STATE_CONNECTED?(this.plnRelCode=Kt.NORMAL,e="NORMAL"):(this.plnRelCode=Kt.UNDEFINED,e="UNDEFINED"),t.push("P-Reason: "+this.plnRelCode+";"+e+";"+ft.INITIATOR),this.session.bye({requestOptions:{extraHeaders:t}})}}else this.logger.warn("No active conference to leave")}},{key:"wtpConferenceRequestPeerVideo",value:function(e){var t=this;if(!this.isVideoCall())return Promise.reject(this.createErrorObject("WrongMediaType","Media type should be video to request peer video"));Array.isArray(e)||(e=[e]);var r,n=this.room,i=[],o=ln(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(void 0!==s.userId&&void 0!==s.resolution&&void 0!==s.videoViewElement){var a=this._changeToValidResolutionValue(s.resolution);if(null!==a){var c=s.userId;if(n.isPeer(c)){var u=n.getPeer(c);u.hasVideoSsrc()?u.videoRequested?this.logger.warn("".concat(c," has already requested video")):(u.setVideoRequested(!0),u.setVideoView(s.videoViewElement),i.push({mid:c,ssrc:u.vSsrc,rq:zr.START,layerid:a,start_op:Xr.NEW_STREAM})):this.logger.warn("".concat(c," has no video ssrc"))}else this.logger.warn("".concat(c," is not peer of room"))}else this.logger.warn("RequestVideo fail - Wrong resolution settings ".concat(s.resolution))}else this.logger.error("RequestVideo fail - Mandatory field in param is mssing"),this.logger.warn(s)}}catch(e){o.e(e)}finally{o.f()}return 0===i.length?Promise.resolve():(this.logger.debug("wtpConferenceRequestPeerVideo | Start"),this.setupPeerVideo(i).then((function(){var e={content:i,contentType:At.REQUEST_USER_VIEW};return t.sendInfo(e).then((function(){return t.logger.debug("wtpConferenceRequestPeerVideo | sendInfo done"),Promise.resolve()}))})).catch((function(e){return Promise.reject(e)})))}},{key:"wtpConferenceRemovePeerVideo",value:function(e){var t=this;Array.isArray(e)||(e=[e]);var r,n=this.room,i=[],o=ln(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(n.isPeer(s)){var a=n.getPeer(s);a.hasVideoSsrc()?a.videoRequested?(a.setVideoStreamState(ir.STOP),a.setVideoRequested(!1),i.push({mid:s,ssrc:a.vSsrc,rq:zr.STOP,start_op:Xr.UPDATE_RESOLUTION})):this.logger.debug("".concat(s," has already removed video")):this.logger.debug("".concat(s," has no video ssrc"))}else this.logger.debug("".concat(s," is not peer of room"))}}catch(e){o.e(e)}finally{o.f()}if(0===i.length)return Promise.resolve();var c={content:i,contentType:At.REQUEST_USER_VIEW};return this.sendInfo(c).then((function(){var e;return t.logger.debug("wtpConferenceRemovePeerVideo | sendInfo done"),i.forEach((function(t){(e=n.getPeer(t.mid)).videoView.srcObject=null,e.videoView.pause()})),Promise.resolve()}))}},{key:"wtpConferenceRequestPeerMute",value:function(e,t){this.wtpRequestPeerMute([e],t)}},{key:"wtpConferenceRequestPeersMute",value:function(e){this.wtpRequestPeerMute(this.wtpConferenceGetPeersUserId(),e)}},{key:"wtpConferenceUpdatePeerVideo",value:function(e,t){var r=this._changeToValidResolutionValue(t);if(null===r)return this.logger.warn("UpdatePeerVideo fail - Wrong resolution settings ".concat(t)),Promise.reject(this.createErrorObject("NotValidResolution","Wrong resolution settings '".concat(r,"'")));Array.isArray(e)||(e=[e]),this.logger.debug("wtpConferenceUpdatePeerVideo | start");var n,i=[],o=ln(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(this.room.isPeer(s)){var a=this.room.getPeer(s);a.hasVideoSsrc()?a.videoRequested?i.push({mid:s,ssrc:a.vSsrc,rq:zr.START,layerid:r,start_op:Xr.UPDATE_RESOLUTION}):this.logger.warn("".concat(s," video was removed")):this.logger.warn("".concat(s," has no video ssrc"))}else this.logger.warn("".concat(s," is not in the room"))}}catch(e){o.e(e)}finally{o.f()}if(this.logger.debug("wtpConferenceUpdatePeerVideo | info - ".concat(e.join()," / resolution=").concat(r)),0===i.length)return Promise.resolve();var c={content:i,contentType:At.REQUEST_USER_VIEW};return this.sendInfo(c)}},{key:"wtpConferenceRequestAllUserInfo",value:function(){var e={content:{contents_type:1,info:[]},contentType:At.REQUEST_USER_INFO};this.sendInfo(e)}},{key:"wtpConferenceEnableVideo",value:function(e){return this.wtpEnableVideo(Object.assign({onAccept:function(){}},e))}},{key:"wtpConferenceDisableVideo",value:function(){return this.wtpDisableVideo()}},{key:"wtpConferenceGetPeersInfo",value:function(){var e,t=[],r=ln(this.room.peersMap.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;void 0!==n&&n.getInfoState()!==or.FEATURE_AHEAD&&t.push(n.getPeerInfo())}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"wtpConferenceGetPeerInfo",value:function(e){return this.room.getPeerInfo(e)}},{key:"wtpConferenceGetPeersUserId",value:function(){return this.room.getPeersUserId()}},{key:"wtpConferenceIsPeer",value:function(e){return this.room.isPeer(e)}},{key:"wtpConferenceAddPeerScreenShareView",value:function(e,t){var r,n,i=this,o=this.session.sessionDescriptionHandler,s=o.peerConnection;return this.sdpMutex.acquire().then((function(){if(!i.room.isPeer(e))return i.logger.debug("wtpConferenceAddPeerScreenShareView | ".concat(e," is not in the room")),Promise.reject(i.createErrorObject("NotPeer","Fail to add peer screenShare because ".concat(e," is not in the room")));if(!(r=i.room.getPeer(e)).screenShare)return Promise.reject(i.createErrorObject("NotValidScreenShare","".concat(e," can't set screen share because ssrc is not set")));switch((n=r.screenShare).setVideoView(t),i.logger.debug("wtpConferenceAddPeerScreenShareView | Start - userId=".concat(e,"/state=").concat(n.state)),n.state){case Ot.INIT:case Ot.FAILED:var o=i.transceiverHandler.getTransceiver("video","recvonly");return n.setTransceiver(o),n.sdpMid="pss".concat(r.dSsrc),n.setState(Ot.START),i.logger.debug("wtpConferenceAddPeerScreenShareView | peerConnection signaling state = ".concat(s.signalingState)),Promise.resolve("NEW");case Ot.START:case Ot.RESTART:return Promise.resolve("START");case Ot.STOP:return n.setState(Ot.RESTART),Promise.resolve("RESTART");default:return Promise.reject(i.createErrorObject("NotValidScreenShareState","Peer screenShare state is not vliad to start (currentState=".concat(It(n.state),")")))}})).then((function(t){return"NEW"===t?o.createLocalOfferOrAnswer().then((function(e){return i.mungeOfferSdp(e,{sdpMid:n.sdpMid,type:"screenshare"})})).then((function(e){return o.setLocalSessionDescription(e)})).then((function(){return i.addVideoMungeAnswerSdp([{direction:"sendonly",ssrc:n.dSsrc,sdpMid:n.sdpMid}])})).then((function(e){return s.setRemoteDescription(e)})).then((function(){return i.logger.debug("wtpConferenceAddPeerScreenShareView | Add done - userId=".concat(e,"/sdpMid=").concat(n.sdpMid)),i.sdpMutex.release()})).catch(function(){var t=dn(regeneratorRuntime.mark((function t(r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.logger.debug("Error while set peerScreenShare sessionDescription. pc state is ".concat(s.signalingState)),i.logger.debug(r),"have-local-offer"!==s.signalingState){t.next=9;break}return i.transceiverHandler.addSpareTransceiver(n.transceiver),a=new RegExp(" ".concat(n.sdpMid,"\\b")),i.bundleLine=i.bundleLine.replace(a,""),n.failedSetupVideo(),t.next=9,o.rollbackLocalSessionDescription();case 9:return t.abrupt("return",Promise.reject(i.createErrorObject("SessionDescriptionFail","Fail to set ".concat(e," screenShare session description"))));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):"RESTART"===t?(i.logger.debug("wtpConferenceAddPeerScreenShareView | Restart peer screenShare - userId=".concat(e,"/dSsrc=").concat(n.dSsrc)),n.playVideo(),i.sdpMutex.release(),Promise.resolve()):(i.sdpMutex.release(),Promise.resolve())})).catch((function(t){return i.logger.debug("wtpConferenceAddPeerScreenShareView | Fail - userId=".concat(e)),i.sdpMutex.release(),Promise.reject(t)}))}},{key:"wtpConferenceRemovePeerScreenShareView",value:function(e){if(this.logger.debug("wtpConferenceRemovePeerScreenShareView | Start - userId=".concat(e)),!this.room.isPeer(e))return this.logger.debug("wtpConferenceRemovePeerScreenShareView | ".concat(e," is not in the room")),Promise.reject(this.createErrorObject("NotPeer","Fail to remove peer screenShare because ".concat(e," is not in the room")));var t=this.room.getPeer(e).screenShare;return t.state!==Ot.FAILED&&t.cleanupView(),Promise.resolve()}},{key:"wtpConferenceChangeMyView",value:function(e,t){var r=this;return this.logger.debug("wtpConferenceChangeMyView | Start"),new Promise((function(n,i){if(r.callParams.media.local&&r.callParams.media.local.video){var o=r.session.sessionDescriptionHandler.localMediaStream,s=t?r.callParams.media.local.video:void 0;e.srcObject=o,e.muted=!0,r.callParams.media.local.video=e;var a=r.callParams.media.local.video.play();void 0!==a&&a.then((function(){s&&(s.srcObject=null,s.pause()),n()})).catch((function(e){r.logger.warn("Catch exception localVideoPromise : ".concat(e.message))}))}}))}},{key:"wtpConferenceChangePeerView",value:function(e,t,r){var n=this;return this.logger.debug("wtpConferenceChangePeerView | Start - userId=".concat(e)),new Promise((function(i){if(!n.room.isPeer(e))return n.logger.debug("wtpConferenceChangePeerView | ".concat(e," is not in the room")),Promise.reject(n.createErrorObject("NotPeer","Fail to change peer view because ".concat(e," is not in the room")));var o=n.room.getPeer(e),s=r&&o.videoView?o.videoView:void 0;t.srcObject=o.mediaStream,t.muted=!0,o.setVideoView(t),o.videoView.play().then((function(){s&&(s.videoView.srcObject=null,s.videoView.pause()),n.logger.debug("wtpConferenceChangePeerView | Conference peer view is changed - userId=".concat(e)),i()})).catch((function(e){return n.logger.warn("wtpConferenceChangePeerView | Fail to play of changed peer view - ".concat(e.message))}))}))}},{key:"wtpConferenceChangePeerScreenShareView",value:function(e,t,r){var n=this;return new Promise((function(i,o){if(!n.room.isPeer(e))return n.logger.debug("wtpConferenceChangePeerScreenShareView | ".concat(e," is not in the room")),void o(n.createErrorObject("NotPeer","Fail to change a peer screenShare view because ".concat(e," is not in the room")));var s=n.room.getPeer(e);!s.screenShare||s.screenShare.state!==Ot.START&&s.screenShare.state!==Ot.RESTART?o(n.createErrorObject("ScreenShareNotPlaying","Peer Screen share is not playing")):s.screenShare.changeVideoView(t,r).then((function(){n.logger.debug("wtpConferenceChangePeerScreenShareView | Conference peer screen share view is changed - userId=".concat(e)),i()})).catch((function(e){return n.logger.debug("wtpConferenceChangePeerScreenShareView | Catch exception : ".concat(e))}))}))}},{key:"wtpConferenceSendShortData",value:function(e,t,r){if(!(t instanceof Uint8Array))return Promise.reject(this.createErrorObject("WrongDataType","data type should be Uint8Array"));if(e.length>100)return Promise.reject(this.createErrorObject("ExceedMaxSizeType","Type must not exceed 100 bytes"));if(t.length>800)return Promise.reject(this.createErrorObject("ExceedMaxSizeData","Data must not exceed 800 bytes"));var n={body_type:e,body:dt(t),target:void 0!==r?r:this.wtpConferenceGetPeersUserId(),source:this.callParams.myId,source_svc_id:this.callParams.fromSvcId};return this.wtpSendShortData(n)}},{key:"wtpConferenceSetRoomSharedContents",value:function(e){var t=this;return this.sharedContentsManager.isProcessingUpdateRoomSharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateRoomSharedContents","Update room shared contents process is in progress")):new Promise((function(r,n){t.resolveRoomSharedContents=r,t.rejectRoomSharedContents=n,t.checkValiditySharedContentsData(e).then(dn(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.sendFeatureShare(wt.ROOM_SHARED_CONTENTS,bt.SET,dt(e));case 2:t.sharedContentsManager.waitResultUpdateRoomSharedContents();case 3:case"end":return r.stop()}}),r)})))).catch((function(e){n(e)}))}))}},{key:"wtpConferenceRoomUnsetRoomSharedContents",value:function(){var e=this;return this.sharedContentsManager.isProcessingUpdateRoomSharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateRoomSharedContents","Update room shared contents process is in progress")):new Promise((function(t,r){e.resolveRoomSharedContents=t,e.rejectRoomSharedContents=r,e.sendFeatureShare(wt.ROOM_SHARED_CONTENTS,bt.UNSET).then((function(){e.sharedContentsManager.waitResultUpdateRoomSharedContents()})).catch((function(e){r(e)}))}))}},{key:"setupPeerVideo",value:function(e){var t=this;this.logger.debug("setupPeerVideo | Start"),this.logger.debug(JSON.stringify(e));var r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=new Map;return e.forEach((function(e){i.set(e.mid,{vSsrc:e.ssrc,transceiver:void 0})})),this.sdpMutex.acquire().then((function(){var r,o,s=!1,a=ln(e);try{var c=function(){var e=o.value;if(!t.room.isPeer(e.mid))return i.delete(e.mid),t.logger.debug("setupPeerVideo | ".concat(e.mid," is not in the room")),"continue";if(r=t.room.getPeer(e.mid),t.logger.debug("setupPeerVideo | ".concat(r.getId()," video state is ").concat(r.getVideoStreamState())),r.getVideoStreamState()===ir.STOP||r.getVideoStreamState()===ir.PLAY)i.delete(r.getId()),r.setVideoStreamState(ir.PLAY),r.videoView.srcObject=r.mediaStream,r.videoView.play().then((function(){return t.logger.debug("".concat(e.mid," replay video"))})).catch((function(r){return t.logger.warn("Fail to replay ".concat(e.mid," video - ").concat(r.message))}));else{var n=i.get(r.getId());if(n.vSsrc!==r.vSsrc)return t.logger.debug("Skip setupPeerVideo because peer is renew instance - userId=".concat(r.getId())),i.delete(r.getId()),"continue";var a=t.transceiverHandler.getTransceiver("video","recvonly");r.setTransceiver(a),n.transceiver=a,r.setVideoStreamState(ir.READY),s=!0}};for(a.s();!(o=a.n()).done;)c()}catch(e){a.e(e)}finally{a.f()}return t.logger.debug("setupPeerVideo | peerConnection signaling state = ".concat(n.signalingState)),Promise.resolve(s)})).then((function(e){return e?r.createLocalOfferOrAnswer().then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){i.forEach((function(e,r){var n=t.room.getPeer(r),i=e.transceiver;e.vSsrc===(null==n?void 0:n.vSsrc)&&(t.room.sdpMidPeerIdMap[i.mid]=r),t.bundleLine+=" "+i.mid}))})).then((function(){return t._conferencePeerJoinMungeAnswerSdp(i)})).then((function(e){return n.setRemoteDescription(e)})).then((function(){return t.sdpMutex.release()})).catch(function(){var e=dn(regeneratorRuntime.mark((function e(o){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("have-local-offer"!==n.signalingState){e.next=4;break}return i.forEach((function(e,r){t.transceiverHandler.addSpareTransceiver(e.transceiver),t.room.sdpMidPeerIdMap[e.transceiver.mid]=void 0,s=new RegExp(" ".concat(e.transceiver.mid,"\\b")),t.bundleLine=t.bundleLine.replace(s,"");var n=t.room.getPeer(r);e.vSsrc===n.vSsrc&&n.failedSetupVideo()})),e.next=4,r.rollbackLocalSessionDescription();case 4:return t.sdpMutex.release(),e.abrupt("return",Promise.reject(t.createErrorObject("SessionDescriptionFail","Fail to setup peer video session description")));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):(t.sdpMutex.release(),Promise.resolve())})).catch((function(e){return t.logger.warn("Fail to setupPeerVideo"),t.sdpMutex.release(),Promise.reject(e)}))}},{key:"cleanupPeerVideo",value:function(e){var t=this;if(this.logger.debug("cleanupPeerVideo | Start - userId=".concat(e.peerId)),void 0!==e.transceiver){var r=e.transceiver;r.direction="inactive";var n=this.session.sessionDescriptionHandler,i=n.peerConnection;return this.logger.debug("cleanupPeerVideo | peerConnection signaling state = ".concat(i.signalingState)),this.sdpMutex.acquire().then((function(){return n.createLocalOfferOrAnswer()})).then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return n.setLocalSessionDescription(e)})).then((function(){return t.changeVideoDirectionMungeAnswerSdp(r.mid,"sendonly","inactive")})).then((function(e){return i.setRemoteDescription(e)})).then((function(){return e.videoView&&(e.videoView.srcObject=null,e.videoView.pause()),t.sdpMutex.release()})).catch((function(r){return t.logger.error("Fail to clean ".concat(e.peerId," video - ").concat(r.message)),t.sdpMutex.release(),Promise.reject()}))}this.logger.debug("Skip cleanupPeerVideo ".concat(e.peerId," no transceiver"))}},{key:"cleanupScreenShare",value:function(e){var t=this,r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=e.screenShare;return this.sdpMutex.acquire().then((function(){return t.logger.debug("cleanupScreenShare | Start userId=".concat(e.peerId)),i.inactiveTransceiver(),t.logger.debug("cleanupScreenShare | peerConnection signaling state=".concat(n.signalingState)),Promise.resolve()})).then((function(){return r.createLocalOfferOrAnswer()})).then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return t.changeVideoDirectionMungeAnswerSdp(i.transceiver.mid,"sendonly","inactive")})).then((function(e){return n.setRemoteDescription(e)})).then((function(){return i.cleanupVideo()})).catch((function(r){return t.logger.error("cleanupScreenShare | Fail to clean screenShare ".concat(e.peerId," video - ").concat(r.message))})).finally((function(){return t.sdpMutex.release()}))}},{key:"changeOutputVideoResolution",value:function(e){var t=this;if(this.callParams.callType===gt.VIDEO){this.logger.debug("changeOutputVideoResolution | Start");var r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=n.getSenders()[1];if(1===e.rq){var o=e.ly-3,s=i.getParameters();s.encodings.forEach((function(e,t){e.active=!(o+t<0)})),this.sdpMutex.acquire().then((function(){return Promise.resolve(i.setParameters(s))})).then((function(){return r.createLocalOfferOrAnswer()})).then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){var e=n.currentRemoteDescription.sdp;return n.setRemoteDescription({sdp:e,type:"answer"})})).then((function(){return t.sdpMutex.release()}))}}}},{key:"_conferencePeerJoinMungeAnswerSdp",value:function(e){var t=this;this.logger.debug("_conferencePeerJoinMungeAnswerSdp | start");var r=[];return e.forEach((function(e,n){t.logger.debug("_conferencePeerJoinMungeAnswerSdp | userId=".concat(n," / ssrc=").concat(e.vSsrc," / parseSsrc=").concat(parseInt(e.vSsrc,16))),r.push({direction:"sendonly",sdpMid:e.transceiver.mid,ssrc:e.vSsrc})})),this.addVideoMungeAnswerSdp(r)}},{key:"_changeToValidResolutionValue",value:function(e){if(!["thumbnail","qvga","vga","hd"].includes(e))return Object.values(nr).includes(e)?e:null;switch(e){case"qvga":return nr.QVGA;case"vga":return nr.VGA;case"hd":return nr.HD;case"thumbnail":return nr.THUMBNAIL}}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),a}(Nr);function vn(e){return vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(e)}function mn(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function Sn(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){mn(o,n,i,s,a,"next",e)}function a(e){mn(o,n,i,s,a,"throw",e)}s(void 0)}))}}function En(e,t){return En=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},En(e,t)}function _n(e){return _n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_n(e)}var yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&En(e,t)}(f,e);var r,n,i,o,s,a,c,u,d,l,h,p=(l=f,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_n(l);if(h){var r=_n(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===vn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=p.call(this,"testcall")).startStats=void 0,e.startMyScreenShareStats=void 0,e.endMyScreenShareStats=void 0,e.startPeerScreenShareStats=void 0,e.endPeerScreenShareStats=void 0,e}return r=f,n=[{key:"wtpTestCallMakeAudio",value:function(e){this._makeTestCall(gt.AUDIO,e)}},{key:"wtpTestCallMakeVideo",value:function(e){this._makeTestCall(gt.VIDEO,e)}},{key:"wtpTestCallEnd",value:function(){var e=this;if(this.state===Pr.STATE_CONNECTED||this.state===Pr.STATE_CONNECTING){if(this.releaser=Et.THIS,this.state===Pr.STATE_CONNECTING)return this.plnRelCode=Kt.CANCEL,this.session.cancel();if(this.session){this.callTerminate=!0;var t,r=[];return this.state===Pr.STATE_CONNECTED?(this.plnRelCode=Kt.NORMAL,t="NORMAL"):(this.plnRelCode=Kt.UNDEFINED,t="UNDEFINED"),r.push("P-Reason: "+this.plnRelCode+";"+t+";"+this.callDir),this._makeTestCallResult().then((function(){return e.session.bye({requestOptions:{extraHeaders:r}})}))}}else this.logger.warn("No active call to hang up on")}},{key:"wtpTestCallStartScreenShare",value:function(e,t,r){var n=this;return this.callParams.callType===gt.AUDIO?Promise.reject(this.createErrorObject("ScreenShareNotSupported","ScreenShare is not possible in audio test call")):(void 0!==this.startMyScreenShareStats&&this.logger.warn("Only the result of first screenShare will be included in test call results"),this.logger.debug("[wtpTestCallStartScreenShare] start"),this.peerScreenShare.videoView=t,this.wtpStartMyScreenShare(e,r).then((function(){void 0===n.startMyScreenShareStats&&(Object.assign(n.testCallResult,{screenShareOutbound:{timestamp:{start:void 0,end:void 0}},screenShareInbound:{timestamp:{start:void 0,startPacketReceived:void 0,end:void 0}}}),n._setTimestampAsNow(n.testCallResult.screenShareOutbound.timestamp,"start"),n._getScreenShareStats(ur.OUTBOUND_RTP).then((function(e){return n.startMyScreenShareStats=e})),n.on("screenShareStoppedOnBrowser",(function(){n._setEndScreenShareStats()})))})).catch((function(e){return n.logger.debug("Fail to wtpTestCallStartScreenShare"),Promise.reject(e)})))}},{key:"wtpTestCallStopScreenShare",value:function(){var e=this;return this.myScreenShare.isPlayed()?(this.logger.debug("[wtpTestCallStopScreenShare] start"),this.wtpStopMyScreenShare().then((function(){return e._setEndScreenShareStats()})).catch((function(t){return e.logger.debug("Fail to wtpTestCallStopScreenShare"),Promise.reject(t)}))):Promise.reject(this.createErrorObject("ScreenShareNotPlaying","My screen share is not played"))}},{key:"_checkAudioInputDevice",value:(d=Sn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._checkMediaDevice({audio:!t||!t.deviceId||{deviceId:{exact:t.deviceId}},video:!1});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_checkVideoInputDevice",value:(u=Sn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._checkMediaDevice({audio:!1,video:t&&t.deviceId?{deviceId:{exact:t.deviceId},width:Pt.WIDTH,height:Pt.HEIGHT}:{width:Pt.WIDTH,height:Pt.HEIGHT}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_checkMediaDevice",value:(c=Sn(regeneratorRuntime.mark((function e(t){var r,n,i,o,s,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={check:"pass",fail:void 0},void 0!==navigator.mediaDevices){e.next=6;break}return n={name:"NotCompatibleBrowser",message:"MediaDevices not available in this browser"},r.check="fail",r.fail=n,e.abrupt("return",r);case 6:return i=t.audio?"audio":"video",e.next=9,navigator.mediaDevices.enumerateDevices().then((function(e){if(!e.some((function(e){return e.kind==i+"input"})))return r.check="fail",r.fail={name:"NoMediaDevice",message:"There is no ".concat(i," device")},r}));case 9:return r.deviceId=t[i]&&t[i].deviceId?t[i].deviceId.exact:"default",e.prev=10,e.next=13,navigator.mediaDevices.getUserMedia(t);case 13:return o=e.sent,t.video?(o.getVideoTracks().length&&(s=o.getVideoTracks()[0],a=s.getSettings(),r.hdSupport=a.width*a.height>=518400),r.vp8Support=MediaRecorder.isTypeSupported("video/webm;codecs=vp8"),r.h264Support=ct()):t.audio&&(r.opusSupport=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")),o.getTracks().forEach((function(e){return e.stop()})),e.abrupt("return",r);case 19:e.prev=19,e.t0=e.catch(10),r.check="fail",c="",e.t1=e.t0.name,e.next="AbortError"===e.t1?26:"NotAllowedError"===e.t1?28:"NotFoundError"===e.t1?30:"NotReadableError"===e.t1?32:"OverconstrainedError"===e.t1?34:"SecurityError"===e.t1?36:38;break;case 26:return c="Some problem occurred which prevented the device from being used",e.abrupt("break",39);case 28:return c="This error occurred when the user blocks the access permission or reject the device permission request through browser settings",e.abrupt("break",39);case 30:return c="There are no media tracks of the type specified were found that satisfy the given constraints",e.abrupt("break",39);case 32:return c="A hardware error occurred at the operating system, browser, or Web page level which prevented access to the device",e.abrupt("break",39);case 34:return c="The specified constraints resulted in no candidate devices which met the criteria requested",e.abrupt("break",39);case 36:return c="User media support is disabled on the Document on which getUserMedia() was called",e.abrupt("break",39);case 38:return e.abrupt("break",39);case 39:return r.fail={name:e.t0.name,message:c},e.abrupt("return",r);case 41:case"end":return e.stop()}}),e,null,[[10,19]])}))),function(e){return c.apply(this,arguments)})},{key:"onDataCtrl",value:function(e){var t=this;if(this.logger.debug("start onDataCtrl"),void 0!==e.event)switch(e.event){case 0:this._removePeerScreenShareView(),this.emit("peerScreenShareStopped");break;case 1:this.peerScreenShare.dSsrc=e.d_ssrc,this._setTimestampAsNow(this.testCallResult.screenShareInbound.timestamp,"start"),this._addPeerScreenShareView().catch((function(e){return t.logger.debug(e)})),this.emit("peerScreenShareStarted")}}},{key:"onTrackAdditional",value:function(e){var t=this;if(this.logger.debug("call onTrackAdditional"),this.logger.debug(JSON.stringify(e)),e.transceiver.mid.startsWith("pss")){this.logger.debug("Testcall peerScreenShare ontrack start");var r=void 0;void 0===this.startPeerScreenShareStats&&(r={delegate:{onPlayed:function(){t._setTimestampAsNow(t.testCallResult.screenShareInbound.timestamp,"startPacketReceived"),t._getScreenShareStats(ur.INBOUND_RTP).then((function(e){t.startPeerScreenShareStats=e}))}}}),this.peerScreenShare.setupMedia(e.track,r)}else this.callParams.callType===gt.AUDIO&&void 0===this.testCallResult.timestamp.connected&&(this.logger.debug("set TestCall init stats"),this.testCallResult.timestamp.connected=Date.now(),this.wtpGetStats().then((function(e){return t.startStats=e})))}},{key:"onCallInviteAccept",value:function(){this.onAccepted()}},{key:"_makeTestCall",value:(a=Sn(regeneratorRuntime.mark((function e(r,n){var i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initTestCallResult(),n.callType=r,n.svckey=r===gt.AUDIO?"testcall.audio":"testcall.video",n.peerId="11112222",this.callDir=ft.INITIATOR,this.setCallParam(n)){e.next=7;break}throw new Error("Mandatory field in call param is mssing");case 7:if(this.changeState(Pr.STATE_READY),r!==gt.AUDIO){e.next=14;break}return e.next=11,this._checkAudioInputDevice(this.callParams.mediaId.audio?{deviceId:this.callParams.mediaId.audio}:void 0);case 11:this.testCallResult.audio=e.sent,e.next=17;break;case 14:return e.next=16,this._checkVideoInputDevice(this.callParams.mediaId.video?{deviceId:this.callParams.mediaId.video}:void 0);case 16:this.testCallResult.video=e.sent;case 17:this.createUa(this.callParams.myId),this.ua.start().then((function(){i.logger.debug("Start UserAgent"),i.changeState(Pr.STATE_CONNECTING);var e=i._setTestCallExtraInviteHeaders();i.createInviteSession(e,{delegate:{onDataCtrl:function(e){return i.onDataCtrl(e)}},peerConnectionDelegate:{onTrack:function(e){return i.onTrackAdditional(e)}}})})).then((function(){i.transceiverHandler.setSession(i.session),i.pointStatistic=new _r(i.session);var e={sdpModifier:[function(e){var t=Yt(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=zt(t,{imageattr:"true"}),e.sdp=t,Promise.resolve(e)},t],sdhOptions:{constraints:r===gt.AUDIO?Object.assign(i.getConstraints(),{video:!1}):Object.assign(i.getConstraints(),{audio:!1}),hasDummyAudio:r!==gt.AUDIO,hasDummyVideo:r!==gt.VIDEO},inviteDelegate:{onAccept:function(){return i.onCallInviteAccept()}}};i.sendInvite(e)})).catch((function(e){return i.onUaStartFailed(e)}));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_makeTestCallResult",value:(s=Sn(regeneratorRuntime.mark((function e(){var t,r,n,i,o,s,a,c,u,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.session){e.next=3;break}return e.abrupt("return",this.testCallResult);case 3:if(!this.testCallResult.screenShareOutbound){e.next=6;break}return e.next=6,this._setEndScreenShareStats();case 6:return e.next=8,this.wtpGetStats();case 8:if(t=e.sent,this.logger.debug("Make testCallResult"),this.logger.debug(this.startStats),this.logger.debug(t),this.testCallDuration=(t.timestamp-this.startStats.timestamp)/1e3,!(this.testCallDuration<=0)){e.next=15;break}return e.abrupt("return",this.testCallResult);case 15:this.callParams.callType===gt.AUDIO?(r=this.startStats[ur.OUTBOUND_RTP][0],n=t[ur.OUTBOUND_RTP][0],i=this.startStats[ur.INBOUND_RTP][0],o=t[ur.INBOUND_RTP][0],this.testCallResult.outbound.audio=this._analyzeDataRateStats("outbound",r,n),this.testCallResult.inbound.audio=this._analyzeDataRateStats("inbound",i,o),Object.assign(this.testCallResult.inbound.audio,this._analyzePacketLoss(i,o))):(s=this.startStats[ur.INBOUND_RTP][1],a=t[ur.INBOUND_RTP].find((function(e){return"video"===e.kind&&333!==e.ssrc&&"screenshare"!==e.contentType})),c=this.startStats[ur.OUTBOUND_RTP][1],u=t[ur.OUTBOUND_RTP].find((function(e){return"video"===e.kind&&333!==e.ssrc})),this.testCallResult.outbound.video=this._analyzeDataRateStats("outbound",c,u),this.testCallResult.inbound.video=this._analyzeDataRateStats("inbound",s,a),Object.assign(this.testCallResult.outbound.video,this._analyzeFrameStats(u)),Object.assign(this.testCallResult.inbound.video,this._analyzeFrameStats(a)),Object.assign(this.testCallResult.inbound.video,this._analyzePacketLoss(s,a)),this.startMyScreenShareStats&&(d=this._analyzeDataRateStats("outbound",this.startMyScreenShareStats,this.endMyScreenShareStats),Object.assign(d,this._analyzeFrameStats(this.endMyScreenShareStats)),Object.assign(this.testCallResult.screenShareOutbound,d)),this.startPeerScreenShareStats&&(l=this._analyzeDataRateStats("inbound",this.startPeerScreenShareStats,this.endPeerScreenShareStats),Object.assign(l,this._analyzePacketLoss(this.startPeerScreenShareStats,this.endPeerScreenShareStats)),Object.assign(l,this._analyzeFrameStats(this.endPeerScreenShareStats)),Object.assign(this.testCallResult.screenShareInbound,l))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.logger.warn("Fail to makeTetsCallResult because ".concat(e.t0));case 21:return e.abrupt("return",this.testCallResult);case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return s.apply(this,arguments)})},{key:"_initTestCallResult",value:function(){this.testCallResult={inbound:{},outbound:{},timestamp:{connected:void 0}}}},{key:"_analyzeDataRateStats",value:function(e,t,r){var n="outbound"===e?"Sent":"Received",i={},o=(r.timestamp-t.timestamp)/1e3;return i.duration=o,i.bps=8*(r["bytes".concat(n)]-t["bytes".concat(n)])/o,i.pps=(r["packets".concat(n)]-t["packets".concat(n)])/o,r["frames".concat(n)]&&(i.fps=(r["frames".concat(n)]-t["frames".concat(n)])/o),i}},{key:"_analyzePacketLoss",value:function(e,t){return{packetLoss:(t.packetsLost-e.packetsLost)/(t.packetsReceived-e.packetsReceived)*100}}},{key:"_analyzeFrameStats",value:function(e){return{frameHeight:e.frameHeight,frameWidth:e.frameWidth}}},{key:"_addPeerScreenShareView",value:function(){var e=this;this.logger.debug("[wtpTestCall addPeerScreenShareView] start");var t=this.session.sessionDescriptionHandler,r=t.peerConnection,n=this.peerScreenShare;return this.sdpMutex.acquire().then((function(){switch(n.state){case Ot.INIT:var e=r.addTransceiver("video",{direction:"recvonly"});return n.transceiver=e,n.sdpMid="pss",n.state=Ot.START,Promise.resolve("NEW");case Ot.STOP:return n.transceiver.direction="recvonly",n.state=Ot.RESTART,Promise.resolve("RESTART");default:return Promise.reject("ScreenShare start state is not vaild - ".concat(n.state))}})).then((function(i){return"NEW"===i?t.createLocalOfferOrAnswer().then((function(t){var r={sdpMid:n.sdpMid};return n.state===Ot.START?r.type="screenshare":(r.type="active",r.direction="recvonly"),e.mungeOfferSdp(t,r)})).then((function(e){return t.setLocalSessionDescription(e)})).then((function(){return t.waitForIceGatheringComplete(!0,3e3)})).then((function(){return e.addVideoMungeAnswerSdp([{direction:"sendonly",ssrc:n.dSsrc,sdpMid:n.sdpMid}])})).then((function(e){return r.setRemoteDescription(e)})).then((function(){return e.logger.debug("addPeerScreenShareView done"),e.sdpMutex.release()})).catch((function(t){return e.sdpMutex.release(),e.logger.debug("Fail to add peer screenshare - ".concat(t)),Promise.reject(t)})):(e.logger.debug("Restart peer screenshare"),n.playVideo(),e.sdpMutex.release(),Promise.resolve())})).catch((function(t){return e.logger.debug("addPeerScreenShareView fail - ".concat(t)),e.logger.debug(t),Promise.reject(t)}))}},{key:"_removePeerScreenShareView",value:function(){this.logger.debug("[wtpTestCall removePeerScreenShareView] start");var e=this.peerScreenShare;return e.state===Ot.START||e.state===Ot.RESTART?(e.cleanupView(),Promise.resolve()):Promise.reject("Fail to remove screenshare - ".concat(e.state))}},{key:"_setEndScreenShareStats",value:(o=Sn(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.endMyScreenShareStats){e.next=4;break}return this._setTimestampAsNow(this.testCallResult.screenShareOutbound.timestamp,"end"),e.next=4,this._getScreenShareStats(ur.OUTBOUND_RTP).then((function(e){return t.endMyScreenShareStats=e}));case 4:if(void 0!==this.endPeerScreenShareStats){e.next=8;break}return this._setTimestampAsNow(this.testCallResult.screenShareInbound.timestamp,"end"),e.next=8,this._getScreenShareStats(ur.INBOUND_RTP).then((function(e){return t.endPeerScreenShareStats=e}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_getScreenShareStats",value:(i=Sn(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pointStatistic.getStats([t]);case 2:return r=e.sent,e.abrupt("return",r[t].find((function(e){return e.contentType&&"screenshare"===e.contentType})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_setTestCallExtraInviteHeaders",value:function(){var e=this.callParams.inviteHeaders,t=[];t.push("X-callDir: "+ft.INITIATOR),t.push("X-callType: "+this.callParams.callType),t.push("X-fromZone: "+e.fromZone),t.push("X-toZone: "+e.fromZone),t.push("X-svckey: "+this.callParams.svckey),t.push("X-Locale: "+navigator.language),t.push("X-h264_support: "+ct());var r=at(),n=[r.browser,r.version,"","",this.callParams.planetKitVersion?"web_"+this.callParams.planetKitVersion:"","wtp_"+Ut,"",""];return t.push("X-userAgent: "+n.join(";")),t}},{key:"_setTimestampAsNow",value:function(e,t){void 0===e[t]&&(e[t]=Date.now())}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),f}(Nr),Tn=Wr})(),n})(),e.exports=t()}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{Call:()=>K,Conference:()=>X,KIT_DISCONNECT_REASON:()=>R,LOG_LEVEL:()=>P,MEDIA_TYPE:()=>g,RESOLUTION:()=>v,Util:()=>c,VIDEO_PAUSE_REASON:()=>E,VIDEO_STATE:()=>e.VIDEO_STATE,getStrVideoPauseReason:()=>_});var e=r(2968);function t(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function i(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}r(1539),r(8674),r(8304),r(489),r(2419),r(9070),r(8011),r(2526),r(1817),r(2165),r(6992),r(8783),r(3948),r(8478);var o=new WeakSet,s=new WeakSet,a=new WeakSet,c=function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t(this,a),t(this,s),t(this,o),this.util=new e.WtpUtil}var n,c;return n=r,(c=[{key:"isSupported",value:function(){return this.util.isSupported()}},{key:"createMediaStream",value:function(e,t){return this.util.createMediaStream(e,t)}},{key:"cleanupMediaStream",value:function(e){this.util.cleanupMediaStream(e)}},{key:"setVideoMirror",value:function(e,t){this.util.setVideoMirror(e,t)}},{key:"getScreenShareConstraints",value:function(e){var t=void 0;if(void 0!==e){var r=i(this,s,d).call(this,e),n=i(this,a,l).call(this,e);void 0!==r&&!1!==r&&((t={}).video=r,void 0!==n&&(t.audio=n))}return t}},{key:"getBrowserInfo",value:function(){return this.util.getBrowserInfo()}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,c),Object.defineProperty(n,"prototype",{writable:!1}),r}();function u(e){return"on"===e.toLowerCase()}function d(e){var t=void 0;if("string"==typeof e.videoState)if("custom"!==e.videoState.toLowerCase())t=i(this,o,u).call(this,e.videoState);else{var r=1920,n=1080,s=10;"number"==typeof e.width&&e.width>0&&(r=e.width),"number"==typeof e.height&&e.height>0&&(n=e.height),"number"==typeof e.frameRate&&(s=e.frameRate),t={width:{max:r},height:{max:n}},s>0&&(t.frameRate={max:s})}return t}function l(e){var t=void 0;return"string"==typeof e.audioState&&"custom"!==e.audioState.toLowerCase()&&(t=i(this,o,u).call(this,e.audioState)),t}r(3371);var h=Object.freeze({LOCAL:"LOCAL",TEST:"TEST",DEV:"DEV",BETA:"BETA",EVAL:"EVAL",PROD:"PROD"}),p=h.PROD,f="5.2.1",g=(r(9601),r(8309),r(2222),r(9826),r(7941),Object.freeze({AUDIO:"audio",VIDEO:"video"})),v=Object.freeze({QVGA:"qvga",VGA:"vga",HD:"hd"}),m=Object.freeze({PAUSE:0,SEND:1}),S=Object.freeze({INITIATOR:"initiator",RESPONDER:"responder",CONFERENCE:"conference"}),E=Object.freeze({PLANETKIT_VIDEO_PAUSE_REASON_BY_USER:0,PLANETKIT_VIDEO_PAUSE_REASON_BY_INTERRUPT:1,PLANETKIT_VIDEO_PAUSE_REASON_UNDEFINED:2,PLANETKIT_VIDEO_PAUSE_REASON_INTERNAL:3,PLANETKIT_VIDEO_PAUSE_REASON_ENABLE_VIDEO_RESPONSE:4,PLANETKIT_VIDEO_PAUSE_REASON_CAMERA_INACTIVE:5});function _(e){return Object.keys(E).find((function(t){return E[t]===e}))}var y=Object.freeze({UNDEFINED:"undefined",CALLEE:"callee",CALLER:"caller",PARTICIPANT:"participant",CLOUD_SERVER:"cloud_server",APP_SERVER:"app_server"}),T=Object.freeze({SATURN_APP_ERROR_AUTH_FAIL:"SA401",SATURN_APP_TOO_MANY_REQUESTS:"SA429",SATURN_APP_ERROR_EXCEED_LIMIT_OF_PARTICIPANTS:"SA431",SATURN_APP_ERROR_ROOM_NOT_FOUND:"SA432",SATURN_APP_ERROR_ROOM_FORBIDDEN:"SA433",SATURN_APP_ERROR_ROOM_TYPE_CONFLICT:"SA434",SATURN_APP_ERROR_INVALID_ID:"SA461",SATURN_APP_ERROR_INCOMPATIBLE_KIT_VERSION:"SA462",SATURN_APP_ERROR_INVALID_STATE:"SA463",SATURN_APP_ERROR_UNDER_MAINTENANCE:"SA520",SATURN_APP_ERROR_BUSY_EVERYWHERE:"SA531",SATURN_APP_ERROR_HTTP_ERROR:"SAhttperror",SATURN_APP_ERROR_NETWORK_UNAVAILABLE:"SAnetunavailable",SATURN_APP_ERROR_TIMEOUT:"SAtimeout"}),R=Object.freeze({PLANETKIT_DISCONNECT_REASON_NORMAL:1001,PLANETKIT_DISCONNECT_REASON_DECLINE:1002,PLANETKIT_DISCONNECT_REASON_CELL_CALL:1003,PLANETKIT_DISCONNECT_REASON_INTERNAL_ERROR:1109,PLANETKIT_DISCONNECT_REASON_USER_ERROR:1110,PLANETKIT_DISCONNECT_REASON_INTERNAL_KIT_ERROR:1111,PLANETKIT_DISCONNECT_REASON_AUDIO_TX_NO_SRC:1112,PLANETKIT_DISCONNECT_REASON_CANCEL:1201,PLANETKIT_DISCONNECT_REASON_BUSY:1202,PLANETKIT_DISCONNECT_REASON_NOANSWER:1203,PLANETKIT_DISCONNECT_REASON_ALREADY_GOT_A_CALL:1204,PLANETKIT_DISCONNECT_REASON_MULTIDEV_IN_USE:1205,PLANETKIT_DISCONNECT_REASON_MULTIDEV_ANSWER:1206,PLANETKIT_DISCONNECT_REASON_MULTIDEV_DECLINE:1207,PLANETKIT_DISCONNECT_REASON_MAX_CALL_TIME_EXCEEDED:1208,PLANETKIT_DISCONNECT_REASON_NETWORK_UNSTABLE:1301,PLANETKIT_DISCONNECT_REASON_PUSH_ERROR:1302,PLANETKIT_DISCONNECT_REASON_AUTH_ERROR:1303,PLANETKIT_DISCONNECT_REASON_RELEASED_CALL:1304,PLANETKIT_DISCONNECT_REASON_SERVER_INTERNAL_ERROR:1305,PLANETKIT_DISCONNECT_REASON_UNAVAILABLE_NETWORK:1308,PLANETKIT_DISCONNECT_REASON_APP_DESTROY:1309,PLANETKIT_DISCONNECT_REASON_SYSTEM_SLEEP:1310,PLANETKIT_DISCONNECT_REASON_SYSTEM_LOGOFF:1311,PLANETKIT_DISCONNECT_REASON_MTU_EXCEEDED:1312,PLANETKIT_DISCONNECT_REASON_ROOM_IS_FULL:1401,PLANETKIT_DISCONNECT_REASON_ALONE_KICK_OUT:1402,PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND:1404,PLANETKIT_DISCONNECT_REASON_SERVICE_ACCESS_TOKEN_ERROR:1501,PLANETKIT_DISCONNECT_REASON_SERVICE_INVALID_ID:1502,PLANETKIT_DISCONNECT_REASON_SERVICE_MAINTENANCE:1503,PLANETKIT_DISCONNECT_REASON_SERVICE_BUSY:1504,PLANETKIT_DISCONNECT_REASON_SERVICE_INTERNAL_ERROR:1505,PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_ERROR:1506,PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_CONNECTION_TIME_OUT:1507,PLANETKIT_DISCONNECT_REASON_SERVICE_INCOMPATIBLE_PLANETKIT_VER:1511,PLANETKIT_DISCONNECT_REASON_SERVICE_TOO_MANY_REQUESTS:1512,PLANETKIT_DISCONNECT_REASON_WEB_RTC_ABORT:1601,PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_ALLOWED:1602,PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_FOUND:1603,PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_READABLE:1604,PLANETKIT_DISCONNECT_REASON_WEB_RTC_OVERCONSTRAINED:1605,PLANETKIT_DISCONNECT_REASON_WEB_RTC_SECURITY_ERROR:1606,PLANETKIT_DISCONNECT_REASON_WEB_RTC_TYPE_ERROR:1607,PLANETKIT_DISCONNECT_REASON_WEB_NO_MEDIA_PACKET:1608,PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_SERVER:1609,PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_CLIENT:1610,PLANETKIT_DISCONNECT_REASON_WEB_SIGNALING_UNEXPECTED_DISCONNECTED:1611,PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED:1612});function A(t){var r=e.PLANET_REL_CODE;switch(t){case r.NORMAL:return w(R.PLANETKIT_DISCONNECT_REASON_NORMAL,"PLANETKIT_DISCONNECT_REASON_NORMAL");case r.REJECT:return w(R.PLANETKIT_DISCONNECT_REASON_DECLINE,"PLANETKIT_DISCONNECT_REASON_DECLINE");case r.CELLULAR_CALL:return w(R.PLANETKIT_DISCONNECT_REASON_CELL_CALL,"PLANETKIT_DISCONNECT_REASON_CELL_CALL");case r.NO_MEDIA_SRC:return w(R.PLANETKIT_DISCONNECT_REASON_AUDIO_TX_NO_SRC,"PLANETKIT_DISCONNECT_REASON_AUDIO_TX_NO_SRC");case r.APP_DEFINED_ERR:return w(R.PLANETKIT_DISCONNECT_REASON_USER_ERROR,"PLANETKIT_DISCONNECT_REASON_USER_ERROR");case r.KIT_DEFINED_ERR:return w(R.PLANETKIT_DISCONNECT_REASON_INTERNAL_KIT_ERROR,"PLANETKIT_DISCONNECT_REASON_INTERNAL_KIT_ERROR");case r.CANCEL:return w(R.PLANETKIT_DISCONNECT_REASON_CANCEL,"PLANETKIT_DISCONNECT_REASON_CANCEL");case r.USER_BUSY:return w(R.PLANETKIT_DISCONNECT_REASON_BUSY,"PLANETKIT_DISCONNECT_REASON_BUSY");case r.NO_ANSWER:return w(R.PLANETKIT_DISCONNECT_REASON_NOANSWER,"PLANETKIT_DISCONNECT_REASON_NOANSWER");case r.ALREADY_GOT_A_CALL:return w(R.PLANETKIT_DISCONNECT_REASON_ALREADY_GOT_A_CALL,"PLANETKIT_DISCONNECT_REASON_ALREADY_GOT_A_CALL");case r.MULTI_DEV_OTHER_DEV_IN_USE:return w(R.PLANETKIT_DISCONNECT_REASON_MULTIDEV_IN_USE,"PLANETKIT_DISCONNECT_REASON_MULTIDEV_IN_USE");case r.MULTI_DEV_OTHER_DEV_ANSWER:return w(R.PLANETKIT_DISCONNECT_REASON_MULTIDEV_ANSWER,"PLANETKIT_DISCONNECT_REASON_MULTIDEV_ANSWER");case r.MULTI_DEV_OTHER_DEV_REJECT:return w(R.PLANETKIT_DISCONNECT_REASON_MULTIDEV_DECLINE,"PLANETKIT_DISCONNECT_REASON_MULTIDEV_DECLINE");case r.MAX_CALL_TIME_EXCEED:return w(R.PLANETKIT_DISCONNECT_REASON_MAX_CALL_TIME_EXCEEDED,"PLANETKIT_DISCONNECT_REASON_MAX_CALL_TIME_EXCEEDED");case r.SESS_KEEPALIVE_TIMEOUT:case r.SESS_ACTIVE_TIMEOUT:case r.NETWORK_UNREACHABLE:case r.SESSION_FAIL:case r.UE_UNREACHABLE:case T.SATURN_APP_ERROR_NETWORK_UNAVAILABLE:return w(R.PLANETKIT_DISCONNECT_REASON_NETWORK_UNSTABLE,"PLANETKIT_DISCONNECT_REASON_NETWORK_UNSTABLE");case r.INVALID_PUSH_RSP:case r.PUSH_ERROR:case r.USER_NOT_FOUND_PUSH:case r.PUSH_REQ_FAIL:return w(R.PLANETKIT_DISCONNECT_REASON_PUSH_ERROR,"PLANETKIT_DISCONNECT_REASON_PUSH_ERROR");case r.AUTH_ERROR:case r.ROOM_AUTH_ERROR:return w(R.PLANETKIT_DISCONNECT_REASON_AUTH_ERROR,"PLANETKIT_DISCONNECT_REASON_AUTH_ERROR");case r.DB_COMM_NOT_FOUND:case r.DB_CHAN_NOT_FOUND:return w(R.PLANETKIT_DISCONNECT_REASON_RELEASED_CALL,"PLANETKIT_DISCONNECT_REASON_RELEASED_CALL");case r.NETWORK_UNAVAILABLE:return w(R.PLANETKIT_DISCONNECT_REASON_UNAVAILABLE_NETWORK,"PLANETKIT_DISCONNECT_REASON_UNAVAILABLE_NETWORK");case r.UE_DESTROY:case r.UE_SYSTEM:return w(R.PLANETKIT_DISCONNECT_REASON_APP_DESTROY,"PLANETKIT_DISCONNECT_REASON_APP_DESTROY");case r.UE_SLEEP:return w(R.PLANETKIT_DISCONNECT_REASON_SYSTEM_SLEEP,"PLANETKIT_DISCONNECT_REASON_SYSTEM_SLEEP");case r.UE_LOGOFF:return w(R.PLANETKIT_DISCONNECT_REASON_SYSTEM_LOGOFF,"PLANETKIT_DISCONNECT_REASON_SYSTEM_LOGOFF");case r.MTU_EXCEEDED:return w(R.PLANETKIT_DISCONNECT_REASON_MTU_EXCEEDED,"PLANETKIT_DISCONNECT_REASON_MTU_EXCEEDED");case r.ROOM_IS_FULL:return w(R.PLANETKIT_DISCONNECT_REASON_ROOM_IS_FULL,"PLANETKIT_DISCONNECT_REASON_ROOM_IS_FULL");case r.ALONE_KICK_OUT:return w(R.PLANETKIT_DISCONNECT_REASON_ALONE_KICK_OUT,"PLANETKIT_DISCONNECT_REASON_ALONE_KICK_OUT");case r.ROOM_NOT_FOUND:return w(R.PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND,"PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND");case r.NO_MEDIA_PACKETS:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_NO_MEDIA_PACKET,"PLANETKIT_DISCONNECT_REASON_WEB_NO_MEDIA_PACKET");case r.ABORT:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_ABORT,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_ABORT");case r.NOT_ALLOWED:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_ALLOWED,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_ALLOWED");case r.NOT_FOUND:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_FOUND,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_FOUND");case r.NOT_READABLE:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_READABLE,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_READABLE");case r.OVERCONSTRAINED:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_OVERCONSTRAINED,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_OVERCONSTRAINED");case r.SECURITY_ERROR:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_SECURITY_ERROR,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_SECURITY_ERROR");case r.TYPE_ERROR:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_RTC_TYPE_ERROR,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_TYPE_ERROR");case r.SVR_CONN_TIMEOUT:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_SERVER,"PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_SERVER");case r.CLI_CONN_TIMEOUT:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_CLIENT,"PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_CLIENT");case r.WEB_SOC_DISCONNECTED:return w(R.PLANETKIT_DISCONNECT_REASON_WEB_SIGNALING_UNEXPECTED_DISCONNECTED,"PLANETKIT_DISCONNECT_REASON_WEB_SIGNALING_UNEXPECTED_DISCONNECTED");case T.SATURN_APP_ERROR_AUTH_FAIL:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_ACCESS_TOKEN_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVICE_ACCESS_TOKEN_ERROR");case T.SATURN_APP_ERROR_ROOM_NOT_FOUND:return w(R.PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND,"PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND");case T.SATURN_APP_ERROR_INVALID_ID:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_INVALID_ID,"PLANETKIT_DISCONNECT_REASON_SERVICE_INVALID_ID");case T.SATURN_APP_ERROR_INCOMPATIBLE_KIT_VERSION:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_INCOMPATIBLE_PLANETKIT_VER,"PLANETKIT_DISCONNECT_REASON_SERVICE_INCOMPATIBLE_PLANETKIT_VER");case T.SATURN_APP_TOO_MANY_REQUESTS:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_TOO_MANY_REQUESTS,"PLANETKIT_DISCONNECT_REASON_SERVICE_TOO_MANY_REQUESTS");case T.SATURN_APP_ERROR_INVALID_STATE:case T.SATURN_APP_ERROR_EXCEED_LIMIT_OF_PARTICIPANTS:case T.SATURN_APP_ERROR_ROOM_FORBIDDEN:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_INTERNAL_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVICE_INTERNAL_ERROR");case T.SATURN_APP_ERROR_UNDER_MAINTENANCE:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_MAINTENANCE,"PLANETKIT_DISCONNECT_REASON_SERVICE_MAINTENANCE");case T.SATURN_APP_ERROR_BUSY_EVERYWHERE:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_BUSY,"PLANETKIT_DISCONNECT_REASON_SERVICE_BUSY");case T.SATURN_APP_ERROR_TIMEOUT:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_CONNECTION_TIME_OUT,"PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_CONNECTION_TIME_OUT");case T.SATURN_APP_ERROR_HTTP_ERROR:return w(R.PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_ERROR");default:return t>=r.INTERNAL_ERROR&&t<r.NO_MEDIA_PACKETS?w(R.PLANETKIT_DISCONNECT_REASON_SERVER_INTERNAL_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVER_INTERNAL_ERROR"):w(R.PLANETKIT_DISCONNECT_REASON_INTERNAL_ERROR,"PLANETKIT_DISCONNECT_REASON_INTERNAL_ERROR")}}function w(e,t){return{code:e,strCode:t}}r(9600),r(2564);var b=Object.freeze({LOCAL_INTERNAL_URL:"https://localhost:3000/pk_api",DEV_SERVICE_URL:"https://voipnx-saturn.line-apps-alpha.com",DEV_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps-alpha.com:20200:20200",BETA_SERVICE_URL:"https://voipnx-saturn.line-apps-beta.com",BETA_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps-beta.com:20200",EVAL_SERVICE_URL:"https://voipnx-saturn.line-apps-rc.com",EVAL_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps-rc.com:20200",PROD_SERVICE_URL:"https://voipnx-saturn.line-apps.com",PROD_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps.com:20200"});function C(e){if("string"!=typeof e)return!1;var t=e.split(":");if(2!=t.length)return!1;var r=t[0],n=t[1];return!isNaN(n)&&!!["line-apps.com","line-apps-rc.com","line-apps-beta.com","line-apps-alpha.com","line-apps-dev.com"].some((function(e){return r.endsWith(e)}))}function O(e){return null!=e}r(4916),r(3123),r(5212),r(7852);var I=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logger=r.getLogger("wpk-saturn-connector"),this.scInit()}var t,r;return t=e,(r=[{key:"scInit",value:function(){switch(p){case h.DEV:case h.TEST:this.planetBaseUrl=b.DEV_SERVICE_URL;break;case h.BETA:this.planetBaseUrl=b.BETA_SERVICE_URL;break;case h.EVAL:this.planetBaseUrl=b.EVAL_SERVICE_URL;break;case h.PROD:this.planetBaseUrl=b.PROD_SERVICE_URL;break;case h.LOCAL:this.planetBaseUrl=b.LOCAL_INTERNAL_URL}}},{key:"scAcquireCallRoute",value:function(e){var t,r=this;if(!O(e.myId)||!O(e.myServiceId)||!O(e.mediaType))return Promise.reject(new Error("Mandatory field is required to acquireCallRoute"));if(O(e.accessToken))t="v2";else{if(!O(e.apiKey))return Promise.reject(new Error("Mandatory field is required to acquireCallRoute"));t="v1"}var n={requestBody:{requestContext:{userId:e.myId,serviceId:e.myServiceId},stid:e.appServerData,callType:e.mediaType===g.VIDEO?"V":"A",to:{}},requestUrl:[this.planetBaseUrl,t,"call/acquire",e.peerServiceId,e.peerId].join("/")};return"v2"==t?n.accessToken=e.accessToken:n.requestBody.requestContext.slaKey=e.apiKey,O(e.myCountryCode)&&(n.requestBody.requestContext.countryCode=e.myCountryCode),O(e.peerCountryCode)&&(n.requestBody.to.peerCountryCode=e.peerCountryCode),new Promise((function(e,t){r._httpPostRequest(n).then((function(n){r.logger.debug(n),"success"===n.status?e(n.data):t(n)})).catch((function(e){return t(e)}))}))}},{key:"scAcquireGcallRoute",value:function(e){var t,r=this;if(!O(e.myId)||!O(e.myServiceId)||!O(e.mediaType))return Promise.reject(new Error("Mandatory field is required to acquireCallRoute"));if(O(e.accessToken))t="v2";else{if(!O(e.apiKey))return Promise.reject(new Error("Mandatory field is required to acquireCallRoute"));t="v1"}var n={requestBody:{requestContext:{userId:e.myId,serviceId:e.myServiceId},mediaType:e.mediaType===g.VIDEO?"V":"A"},requestUrl:[this.planetBaseUrl,t,"gcall",e.roomServiceId,e.roomId,"join"].join("/")};return"v2"==t?n.accessToken=e.accessToken:n.requestBody.requestContext.slaKey=e.apiKey,O(e.myCountryCode)&&(n.requestBody.requestContext.countryCode=e.myCountryCode),O(e.peerCountryCode)&&(n.requestBody.to.peerCountryCode=e.peerCountryCode),new Promise((function(e,t){r._httpPostRequest(n).then((function(n){r.logger.debug(n),"success"===n.status?e(n.data):t(n)})).catch((function(e){return t(e)}))}))}},{key:"convertToStandardSaturnErrorResponseCode",value:function(e){switch(e){case"401":return T.SATURN_APP_ERROR_AUTH_FAIL;case"429":return T.SATURN_APP_TOO_MANY_REQUESTS;case"431":return T.SATURN_APP_ERROR_EXCEED_LIMIT_OF_PARTICIPANTS;case"432":return T.SATURN_APP_ERROR_ROOM_NOT_FOUND;case"433":return T.SATURN_APP_ERROR_ROOM_FORBIDDEN;case"434":return T.SATURN_APP_ERROR_ROOM_TYPE_CONFLICT;case"461":return T.SATURN_APP_ERROR_INVALID_ID;case"462":return T.SATURN_APP_ERROR_INCOMPATIBLE_KIT_VERSION;case"463":return T.SATURN_APP_ERROR_INVALID_STATE;case"520":return T.SATURN_APP_ERROR_UNDER_MAINTENANCE;case"531":return T.SATURN_APP_ERROR_BUSY_EVERYWHERE;case"network_unavailable":return T.SATURN_APP_ERROR_NETWORK_UNAVAILABLE;case"saturn_timeout":return T.SATURN_APP_ERROR_TIMEOUT;default:return T.SATURN_APP_ERROR_HTTP_ERROR}}},{key:"_httpPostRequest",value:function(e){var t=this,r=new Headers;r.append("Accept","application/json"),r.append("Content-type","application/json");var n=(new c).getBrowserInfo();return r.append("X-PLN-INFO",["BROWSER",f,n.browser,n.version].join("\t")),e.accessToken&&r.append("Authorization","Bearer "+e.accessToken),Promise.race([fetch(e.requestUrl,{method:"POST",headers:r,body:JSON.stringify(e.requestBody)}).then((function(e){return e.json()})).catch((function(e){return t.logger.error(e),e})),new Promise((function(e){setTimeout((function(){!1===navigator.onLine?e({status:"error",code:"network_unavailable"}):e({status:"error",code:"saturn_timeout"})}),3e4)}))])}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),P=(r(3710),Object.freeze({DEBUG:"debug",LOG:"log",WARN:"warn",ERROR:"error"})),N=Object.freeze({DEBUG:0,LOG:1,WARN:2,ERROR:3});var D=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loggerFactory=t,this.name=r}var t,r;return t=e,(r=[{key:"debug",value:function(e){this.loggerFactory.printLog(N.DEBUG,this.name,e)}},{key:"log",value:function(e){this.loggerFactory.printLog(N.LOG,this.name,e)}},{key:"warn",value:function(e){this.loggerFactory.printLog(N.WARN,this.name,e)}},{key:"error",value:function(e){this.loggerFactory.printLog(N.ERROR,this.name,e)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loggers={},this.logger=this.getLogger("LoggerFactory"),this._level=1}var t,r;return t=e,(r=[{key:"level",get:function(){return this._level},set:function(e){if(e.toUpperCase&&Object.hasOwnProperty.call(P,e.toUpperCase()))switch(e){case P.DEBUG:this._level=0;break;case P.LOG:this._level=1;break;case P.WARN:this._level=2;break;case P.ERROR:this._level=3}else this.logger.warn("Invalid user log level(".concat(e,"), so log level will be set as default('log')"))}},{key:"getLogger",value:function(e){if(this.loggers[e])return this.loggers[e];var t=new D(this,e);return this.loggers[e]=t,t}},{key:"printLog",value:function(e,t,r){if(!(e>this.level))switch("string"==typeof r&&(r=[new Date,t,r].join(" | ")),e){case P.DEBUG:console.debug(r);break;case P.LOG:console.log(r);break;case P.WARN:console.warn(r);break;case P.ERROR:console.error(r)}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}var k=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.loggerFactory=new L,this.logger=this.loggerFactory.getLogger("wpk-"+e),this.saturnConnector=new I(this,this.loggerFactory),this.service=e,this.wtp=void 0}var r,n;return r=t,(n=[{key:"muteMyAudio",value:function(e){void 0!==this.wtp?e?this.wtp.wtpMuteMyAudio():this.wtp.wtpUnmuteMyAudio():this.logger.warn("Fail to mute my audio because there is no wtp")}},{key:"pauseMyVideo",value:function(){return void 0===this.wtp?(this.logger.warn("Fail to pause my video because there is no wtp"),Promise.reject()):this.wtp.wtpPauseMyVideo()}},{key:"resumeMyVideo",value:function(){return void 0===this.wtp?(this.logger.warn("Fail to resume my video because there is no wtp"),Promise.reject()):this.wtp.wtpResumeMyVideo()}},{key:"enableVideo",value:function(e){var t=this,r=Object.assign({cameraOn:!0,videoInputDeviceId:void 0},e);if(this.callParams.mediaType===g.AUDIO)return"call"===this.service?this.wtp.wtpCallEnableVideo(r).then((function(){return t.callParams.mediaType=g.VIDEO,Promise.resolve()})).catch((function(e){return Promise.reject(e)})):this.wtp.wtpConferenceEnableVideo(r).then((function(){return t.callParams.mediaType=g.VIDEO,Promise.resolve()})).catch((function(e){return Promise.reject(e)}));var n=new Error("This call is already video call");return n.name="AlreadyVideoCall",Promise.reject(n)}},{key:"disableVideo",value:function(){var e=this;return this.callParams.mediaType===g.VIDEO?"call"===this.service?this.wtp.wtpCallDisableVideo().then((function(){return e.callParams.mediaType=g.AUDIO,Promise.resolve()})):this.wtp.wtpConferenceDisableVideo().then((function(){return e.callParams.mediaType=g.AUDIO,Promise.resolve()})):Promise.reject("Call is already Audio")}},{key:"changeAudioInputDevice",value:function(e){return this.wtp.wtpChangeInputAudioDevice(e)}},{key:"changeAudioOutputDevice",value:function(e){return this.wtp.wtpChangeOutputAudioDevice(e)}},{key:"changeVideoInputDevice",value:function(e){return this.wtp.wtpChangeInputVideoDevice(e)}},{key:"startMyScreenShare",value:function(e,t){var r=(new c).getScreenShareConstraints(t);return this.wtp.wtpStartMyScreenShare(e,r)}},{key:"stopMyScreenShare",value:function(){return this.wtp.wtpStopMyScreenShare()}},{key:"muteMyScreenShareAudio",value:function(e){this.wtp.wtpMuteMyScreenShareAudio(e)}},{key:"changeMyScreenShareView",value:function(e,t){return this.wtp.wtpChangeMyScreenShareView(e,t)}},{key:"setVideoMirror",value:function(e,t){this.wtp.wtpSetVideoMirror(e,t)}},{key:"setVideoModifier",value:function(e){return this.wtp.wtpSetVideoModifier(e)}},{key:"resetVideoModifier",value:function(){return this.wtp.wtpResetVideoModifier()}},{key:"setSharedContents",value:function(e){return this.wtp.wtpSetSharedContents(e)}},{key:"unsetSharedContents",value:function(){return this.wtp.wtpUnsetSharedContents()}},{key:"setExclusivelySharedContents",value:function(e){return this.wtp.wtpSetExclusivelySharedContents(e)}},{key:"unsetExclusivelySharedContents",value:function(){return this.wtp.wtpUnsetExclusivelySharedContents()}},{key:"getVersion",value:function(){return f}},{key:"getCurrentStats",value:function(){return this.wtp.wtpGetStats()}},{key:"checkPermission",value:function(e){return this.wtp.checkPermission(e)}},{key:"getWtpInitConfig",value:function(e){var t,r,n,i;switch(p){case h.PRIVATE:case h.LOCAL:case h.TEST:t="wtp.line-apps-beta.com:7443",r=!0,n=!0,i=3;break;case h.DEV:case h.BETA:t=e,r=!0,n=!0,i=3;break;case h.EVAL:t=e,r=!0,n=!0,i=2;break;case h.PROD:t=e,r=!1,n=!1,i=2}return{wtpGwUri:t,builtinEnabled:r,traceSip:n,logLevel:i,devPlatform:"planetkit"}}},{key:"getDisconnectedParam",value:function(t,r){var n;return n="THIS"===r?"call"===this.service?y.CALLER:y.PARTICIPANT:"PEER"===r?y.CALLEE:y.CLOUD_SERVER,t===e.PLANET_REL_CODE.ROOM_DESTROY_BY_USER?n=y.PARTICIPANT:t!==e.PLANET_REL_CODE.ROOM_DESTROY&&t!==e.PLANET_REL_CODE.ROOM_FORCE_CLOSE&&t!==e.PLANET_REL_CODE.ROOM_FORCE_CLOSE_BY_USER||(n=y.APP_SERVER),{source:n,reason:A(t)}}},{key:"_checkParamType",value:function(e,t,r){void 0!==e&&M(e)!==r&&this.logger.warn("CallParam.".concat(t," should be '").concat(r,"' type"))}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}();function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){V(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e,t){var r=U(U({},{logLevel:P.LOG}),t);e.loggerFactory.level=r.logLevel,e.role=""}function j(e,t){var r=e.saturnConnector.convertToStandardSaturnErrorResponseCode(t.code),n=e.callParams.delegate;n.evtDisconnected&&n.evtDisconnected({source:y.APP_SERVER,reason:A(r)})}function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}r(7327),r(5003),r(9554),r(4747),r(9337),r(3321);var K=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&B(e,t)}(a,t);var r,n,i,o,s=(i=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(i);if(o){var r=q(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),H(F(t=s.call(this,"call")),e),t}return r=a,(n=[{key:"makeCall",value:function(e){var t=this;if(!(new c).isSupported()){var r;if(null!=e&&null!==(r=e.delegate)&&void 0!==r&&r.evtDisconnected)return void e.delegate.evtDisconnected({code:R.PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED,strCode:"PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED"});throw new Error("This browser is not supported")}if(this.role=S.INITIATOR,!this._setCallParams(e))throw new Error("Mandatory field should be required");if(this.callParams.appServerData&&new Blob([this.callParams.appServerData]).size>256)throw new Error("App server data is too long");if(O(e.accessToken))this.callParams.accessToken=e.accessToken;else{if(!O(e.apiKey))throw new Error("Mandatory field should be required");this.callParams.apiKey=e.apiKey}this.saturnConnector.scAcquireCallRoute(this.callParams).catch((function(e){throw j(t,e),e})).then((function(e){return t._getWtpCallParams(e)})).then((function(e){return t.initWtp(e),e})).then((function(e){t.logger.debug("wtp params"),t.logger.debug(e),t.wtp.wtpCallMake(e)})).catch((function(e){throw t.logger.error("planet kit call make error"),t.logger.debug(e),e}))}},{key:"verifyCall",value:function(e){var t,r=this;if(!(new c).isSupported()){var n;if(null!=e&&null!==(n=e.delegate)&&void 0!==n&&n.evtDisconnected)return void e.delegate.evtDisconnected({code:R.PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED,strCode:"PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED"});throw new Error("This browser is not supported")}this.role=S.RESPONDER;try{(t=JSON.parse(atob(e.ccParam))).voipSrv=t.voipAddress,e.peerId=t.fromUserId,e.peerServiceId=t.fromServiceId}catch(e){throw this.logger.error("Failed to parse ccParam"),e}if(!this._setCallParams(e))throw new Error("Mandatory field should be required");O(e.allowVerifyOnMultipleWindow)&&(this.callParams.allowVerifyOnMultipleWindow=e.allowVerifyOnMultipleWindow),this._getWtpCallParams(t).then((function(e){return r.initWtp(e),e})).then((function(e){r.logger.debug("wtp params"),r.logger.debug(e),r.wtp.wtpCallVerify(e)})).catch((function(e){throw r.logger.error("planet kit call verify error"),e}))}},{key:"acceptCall",value:function(e){this.wtp.wtpCallAnswer(e)}},{key:"endCall",value:function(){var t=this.wtp;t.state!=e.WTP_STATE.STATE_INIT&&t.state!=e.WTP_STATE.STATE_DISCONNECTED?t.wtpCallEnd():this.logger.warn("Call state is not valid to end call")}},{key:"requestPeerMute",value:function(e){this.wtp.wtpCallRequestPeerMute(e)}},{key:"addPeerScreenShareView",value:function(e){return this.wtp.wtpCallAddPeerScreenShareView(e)}},{key:"removePeerScreenShareView",value:function(){return this.wtp.wtpCallRemovePeerScreenShareView()}},{key:"changePeerScreenShareView",value:function(e,t){return this.wtp.wtpCallChangePeerScreenShareView(e,t)}},{key:"sendShortData",value:function(e,t){return this.wtp.wtpCallSendShortData(e,t)}},{key:"isRecordOnCloudActivated",value:function(){return this.wtp.wtpCallIsRecordOnCloudActivated()}},{key:"initWtp",value:function(t){var r=this;this.wtp=new e.WtpCall;var n=this.wtp,i=this.getWtpInitConfig(t.inviteHeaders.w2pGw),o=i.wtpGwUri;if(!C(o))throw new Error("Invalid w2pGw URI : ".concat(o));n.wtpInit(i);var s=this.callParams.delegate;n.on("connecting",(function(){s.evtWaitConnected&&s.evtWaitConnected()})),n.on("connected",(function(){s.evtConnected&&s.evtConnected()})),n.on("ringing",(function(e){if(s.evtVerified){var t={peerId:e.peerId,mediaType:"A"===e.callType?g.AUDIO:g.VIDEO};s.evtVerified(t)}})),n.on("switchAudioToVideo",(function(){var e;if(r.callParams.responseOnEnableVideo===m.PAUSE)r.logger.debug("switchAudioToVideo - PAUSE"),r.callParams.mediaType=g.VIDEO,e=function(){return n.wtpCallEnableVideoWithPauseResponse()};else{if(r.callParams.responseOnEnableVideo!==m.SEND)return void r.logger.error("Invalid responseOnEnableVideo values: ".concat(r.callParams.responseOnEnableVideo));r.callParams.mediaType=g.VIDEO,e=function(){return n.wtpCallEnableVideo()}}e().then((function(){s.evtVideoEnabledByPeer&&s.evtVideoEnabledByPeer()})).catch((function(){r.logger.error("Fail to switchAudioToVideo evt")}))})),n.on("switchVideoToAudio",(function(){r.callParams.mediaType=g.AUDIO,s.evtVideoDisabledByPeer&&s.evtVideoDisabledByPeer()})),n.on("peerVideoPause",(function(e){s.evtPeerVideoPaused&&s.evtPeerVideoPaused(e)})),n.on("peerVideoResume",(function(){s.evtPeerVideoResumed&&s.evtPeerVideoResumed()})),n.on("peerMicMuted",(function(){s.evtPeerMicMuted&&s.evtPeerMicMuted()})),n.on("peerMicUnmuted",(function(){s.evtPeerMicUnmuted&&s.evtPeerMicUnmuted()})),n.on("muteRequested",(function(e){s.evtMyMuteRequestedByPeer&&s.evtMyMuteRequestedByPeer(e)})),n.on("screenShareStoppedOnBrowser",(function(){s.evtMyScreenShareStoppedOnBrowser&&s.evtMyScreenShareStoppedOnBrowser()})),n.on("peerScreenShareStarted",(function(){s.evtPeerScreenShareStarted&&s.evtPeerScreenShareStarted()})),n.on("peerScreenShareStopped",(function(){s.evtPeerScreenShareStopped&&s.evtPeerScreenShareStopped()})),n.on("shortDataReceived",(function(e,t){s.evtShortDataReceived&&s.evtShortDataReceived(e,t)})),n.on("myTalkingStatusUpdated",(function(e){s.evtMyTalkingStatusUpdated&&s.evtMyTalkingStatusUpdated(e)})),n.on("peerTalkingStatusUpdated",(function(e){s.evtPeerTalkingStatusUpdated&&s.evtPeerTalkingStatusUpdated(e)})),n.on("peerSharedContentsSet",(function(e,t){s.evtPeerSharedContentsSet&&s.evtPeerSharedContentsSet(e,t)})),n.on("peerSharedContentsUnset",(function(){s.evtPeerSharedContentsUnset&&s.evtPeerSharedContentsUnset()})),n.on("peerExclusivelySharedContentsSet",(function(e,t){s.evtPeerExclusivelySharedContentsSet&&s.evtPeerExclusivelySharedContentsSet(e,t)})),n.on("peerExclusivelySharedContentsUnset",(function(){s.evtPeerExclusivelySharedContentsUnset&&s.evtPeerExclusivelySharedContentsUnset()})),n.on("recordOnCloudUpdated",(function(e,t){s.evtRecordOnCloudUpdated&&s.evtRecordOnCloudUpdated(e,t)})),n.on("innerLog",(function(e){s.evtInnerLog&&s.evtInnerLog(e)})),n.on("ended",(function(e){n.wtpRelease(),s.evtDisconnected&&s.evtDisconnected(r.getDisconnectedParam(e.plnRelCode.code,e.releaser))})),n.on("failed",(function(){s.evtFailed&&s.evtFailed()}))}},{key:"_setCallParams",value:function(e){return!(!(O(e.myId)&&O(e.myServiceId)&&O(e.peerId)&&O(e.peerServiceId)&&O(e.mediaType))||this.role===S.RESPONDER&&!O(e.ccParam)||(this._checkParamType(e.maxSendLinkBandwidth,"maxSendLinkBandwidth","number"),this._checkParamType(e.maxReceiveLinkBandwidth,"maxReceiveLinkBandwidth","number"),this.callParams={myId:e.myId,myServiceId:e.myServiceId,peerId:e.peerId,peerServiceId:e.peerServiceId,mediaType:e.mediaType,delegate:e.delegate?e.delegate:{},cameraOn:void 0===e.cameraOn||e.cameraOn,micOn:void 0===e.micOn||e.micOn,pauseVideoByPageHidden:void 0===e.pauseVideoByPageHidden||e.pauseVideoByPageHidden,ignoreDeviceError:void 0!==e.ignoreDeviceError&&e.ignoreDeviceError,enableTalkingStatusEvent:!0===e.enableTalkingStatusEvent,responseOnEnableVideo:e.responseOnEnableVideo?e.responseOnEnableVideo:m.PAUSE,maxSendLinkBandwidth:void 0!==e.maxSendLinkBandwidth?e.maxSendLinkBandwidth:void 0,maxReceiveLinkBandwidth:void 0!==e.maxReceiveLinkBandwidth?e.maxReceiveLinkBandwidth:void 0,mediaHtmlElement:e.mediaHtmlElement?e.mediaHtmlElement:{},mediaDeviceId:e.mediaDeviceId?e.mediaDeviceId:{},initMedia:e.initMedia?e.initMedia:{}},this.role===S.INITIATOR&&(this.callParams.appServerData=O(e.appServerData)?e.appServerData:void 0,this.callParams.recordOnCloud=!0===e.recordOnCloud),O(e.myCountryCode)&&(this.callParams.myCountryCode=e.myCountryCode),O(e.peerCountryCode)&&(this.callParams.peerCountryCode=e.peerCountryCode),0))}},{key:"_getWtpCallParams",value:function(e){var t={myId:this.callParams.myId,fromSvcId:this.role===S.INITIATOR?this.callParams.myServiceId:this.callParams.peerServiceId,peerId:this.callParams.peerId,toSvcId:this.role===S.INITIATOR?this.callParams.peerServiceId:this.callParams.myServiceId,stid:this.callParams.appServerData,cameraOn:this.callParams.cameraOn,micOn:this.callParams.micOn,callType:this.callParams.mediaType===g.VIDEO?"V":"A",svckey:this.callParams.mediaType===g.VIDEO?"freecall.video":"freecall.audio",pauseVideoByPageHidden:this.callParams.pauseVideoByPageHidden,ignoreDeviceError:this.callParams.ignoreDeviceError,enableTalkingStatusEvent:this.callParams.enableTalkingStatusEvent,maxSendLinkBandwidth:this.callParams.maxSendLinkBandwidth,maxReceiveLinkBandwidth:this.callParams.maxReceiveLinkBandwidth,initMedia:this.callParams.initMedia,recordOnCloud:this.callParams.recordOnCloud,inviteHeaders:e,planetKitVersion:f},r={},n=this.callParams.mediaHtmlElement;n.my&&n.my.video&&(r.local={video:n.my.video}),n.peer&&(r.remote={},n.peer.audio&&(r.remote.audio=n.peer.audio),n.peer.video&&(r.remote.video=n.peer.video)),t.media=r;var i={},o=this.callParams.mediaDeviceId;return o.inputAudio&&(i.audio=o.inputAudio),o.inputVideo&&(i.video=o.inputVideo),t.mediaId=i,Promise.resolve(t)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),a}(k);function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var X=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&G(e,t)}(a,t);var r,n,i,o,s=(i=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(i);if(o){var r=z(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Y(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),H(Y(t=s.call(this,"conference")),e),t}return r=a,n=[{key:"joinConference",value:function(e){var t=this;if(!(new c).isSupported()){var r;if(null!=e&&null!==(r=e.delegate)&&void 0!==r&&r.evtDisconnected)return void e.delegate.evtDisconnected({code:R.PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED,strCode:"PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED"});throw new Error("This browser is not supported")}if(!this._setCallParams(e))throw new Error("Mandatory field should be required");if(this.callParams.appServerData&&new Blob([this.callParams.appServerData]).size>256)throw new Error("App server data is too long");if(O(e.accessToken))this.callParams.accessToken=e.accessToken;else{if(!O(e.apiKey))throw new Error("Mandatory field should be required");this.callParams.apiKey=e.apiKey}this.role=S.CONFERENCE,this.saturnConnector.scAcquireGcallRoute(this.callParams).catch((function(e){throw j(t,e),e})).then((function(e){return t._getWtpGcallParams(e)})).then((function(e){return t.initWtp(e),e})).then((function(e){t.logger.debug("wtp params"),t.logger.debug(e),t.wtp.wtpConferenceJoin(e)})).catch((function(e){throw t.logger.error("planet kit call make error"),t.logger.debug(e),e}))}},{key:"leaveConference",value:function(){var t=this.wtp;t.state!=e.WTP_STATE.STATE_INIT&&t.state!=e.WTP_STATE.STATE_DISCONNECTED?t.wtpConferenceLeave():this.logger.warn("Call state is not valid to leave")}},{key:"requestPeerVideo",value:function(e){return this.wtp.wtpConferenceRequestPeerVideo(e)}},{key:"removePeerVideo",value:function(e){return this.wtp.wtpConferenceRemovePeerVideo(e)}},{key:"updatePeerVideo",value:function(e,t){return this.wtp.wtpConferenceUpdatePeerVideo(e,t)}},{key:"changeMyView",value:function(e,t){return this.wtp.wtpConferenceChangeMyView(e,t)}},{key:"changePeerView",value:function(e,t,r){return this.wtp.wtpConferenceChangePeerView(e,t,r)}},{key:"isPeer",value:function(e){return this.wtp.wtpConferenceIsPeer(e)}},{key:"getPeersUserId",value:function(){return this.wtp.wtpConferenceGetPeersUserId()}},{key:"getPeerInfo",value:function(e){return this.wtp.wtpConferenceGetPeerInfo(e)}},{key:"getPeersInfo",value:function(){return this.wtp.wtpConferenceGetPeersInfo()}},{key:"requestPeerMute",value:function(e,t){this.wtp.wtpConferenceRequestPeerMute(e,t)}},{key:"requestPeersMute",value:function(e){this.wtp.wtpConferenceRequestPeersMute(e)}},{key:"addPeerScreenShareView",value:function(e,t){return this.wtp.wtpConferenceAddPeerScreenShareView(e,t)}},{key:"removePeerScreenShareView",value:function(e){return this.wtp.wtpConferenceRemovePeerScreenShareView(e)}},{key:"changePeerScreenShareView",value:function(e,t,r){return this.wtp.wtpConferenceChangePeerScreenShareView(e,t,r)}},{key:"sendShortData",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.wtp.wtpConferenceSendShortData(e,t,r)}},{key:"setRoomSharedContents",value:function(e){return this.wtp.wtpConferenceSetRoomSharedContents(e)}},{key:"unsetRoomSharedContents",value:function(){return this.wtp.wtpConferenceRoomUnsetRoomSharedContents()}},{key:"isMember",value:function(e){return this.isPeer(e)}},{key:"getMemberMidList",value:function(){return this.getPeersUserId()}},{key:"getMemberInfo",value:function(e){return this.getPeerInfo(e)}},{key:"getAllMemberInfo",value:function(){return this.getPeersInfo()}},{key:"initWtp",value:function(t){var r=this;this.wtp=new e.WtpConference;var n=this.wtp,i=this.getWtpInitConfig(t.inviteHeaders.w2pGw),o=i.wtpGwUri;if(!C(o))throw new Error("Invalid w2pGw URI : ".concat(o));n.wtpInit(i);var s=this.callParams.delegate;n.on("connected",(function(){s.evtConnected&&s.evtConnected()})),n.on("confPeerListUpdated",(function(e){s.evtPeerListUpdated&&s.evtPeerListUpdated(e)})),n.on("confPeersVideoUpdated",(function(e){s.evtPeersVideoUpdated&&s.evtPeersVideoUpdated(e)})),n.on("confPeersVideoPaused",(function(e){s.evtPeersVideoPaused&&s.evtPeersVideoPaused(e)})),n.on("confPeersVideoResumed",(function(e){s.evtPeersVideoResumed&&s.evtPeersVideoResumed(e)})),n.on("confPeersMicMuted",(function(e){s.evtPeersMicMuted&&s.evtPeersMicMuted(e)})),n.on("confPeersMicUnmuted",(function(e){s.evtPeersMicUnmuted&&s.evtPeersMicUnmuted(e)})),n.on("muteRequested",(function(e,t){s.evtMyMuteRequestedByPeer&&s.evtMyMuteRequestedByPeer(e,t)})),n.on("screenShareStoppedOnBrowser",(function(){s.evtMyScreenShareStoppedOnBrowser&&s.evtMyScreenShareStoppedOnBrowser()})),n.on("peerScreenShareStarted",(function(e){s.evtPeerScreenShareStarted&&s.evtPeerScreenShareStarted(e)})),n.on("peerScreenShareStopped",(function(e){s.evtPeerScreenShareStopped&&s.evtPeerScreenShareStopped(e)})),n.on("myTalkingStatusUpdated",(function(e){s.evtMyTalkingStatusUpdated&&s.evtMyTalkingStatusUpdated(e)})),n.on("confPeersTalkingStatusUpdated",(function(e){s.evtPeersTalkingStatusUpdated&&s.evtPeersTalkingStatusUpdated(e)})),n.on("shortDataReceived",(function(e,t,r){s.evtShortDataReceived&&s.evtShortDataReceived(e,t,r)})),n.on("appControlMessageReceived",(function(e){s.evtAppControlMessageReceived&&s.evtAppControlMessageReceived(e)})),n.on("peersSharedContentsSet",(function(e){s.evtPeersSharedContentsSet&&s.evtPeersSharedContentsSet(e)})),n.on("peersSharedContentsUnset",(function(e){s.evtPeersSharedContentsUnset&&s.evtPeersSharedContentsUnset(e)})),n.on("peerExclusivelySharedContentsSet",(function(e,t,r){s.evtPeerExclusivelySharedContentsSet&&s.evtPeerExclusivelySharedContentsSet(e,t,r)})),n.on("peerExclusivelySharedContentsUnset",(function(e){s.evtPeerExclusivelySharedContentsUnset&&s.evtPeerExclusivelySharedContentsUnset(e)})),n.on("peerRoomSharedContentsSet",(function(e,t,r){s.evtPeerRoomSharedContentsSet&&s.evtPeerRoomSharedContentsSet(e,t,r)})),n.on("peerRoomSharedContentsUnset",(function(e){s.evtPeerRoomSharedContentsUnset&&s.evtPeerRoomSharedContentsUnset(e)})),n.on("innerLog",(function(e){s.evtInnerLog&&s.evtInnerLog(e)})),n.on("ended",(function(e){n.wtpRelease(),s.evtDisconnected&&s.evtDisconnected(r.getDisconnectedParam(e.plnRelCode.code,e.releaser))})),n.on("failed",(function(){s.evtFailed&&s.evtFailed()}))}},{key:"_setCallParams",value:function(e){return!!(O(e.myId)&&O(e.myServiceId)&&O(e.roomId)&&O(e.roomServiceId)&&O(e.mediaType))&&(this._checkParamType(e.maxSendLinkBandwidth,"maxSendLinkBandwidth","number"),this._checkParamType(e.maxReceiveLinkBandwidth,"maxReceiveLinkBandwidth","number"),this.callParams={myId:e.myId,myServiceId:e.myServiceId,roomId:e.roomId,roomServiceId:e.roomServiceId,mediaType:e.mediaType,appServerData:O(e.appServerData)?e.appServerData:void 0,delegate:e.delegate?e.delegate:{},cameraOn:void 0===e.cameraOn||e.cameraOn,micOn:void 0===e.micOn||e.micOn,pauseVideoByPageHidden:void 0===e.pauseVideoByPageHidden||e.pauseVideoByPageHidden,ignoreDeviceError:void 0!==e.ignoreDeviceError&&e.ignoreDeviceError,enableTalkingStatusEvent:!0===e.enableTalkingStatusEvent,displayName:void 0!==e.displayName?e.displayName:"",maxSendLinkBandwidth:void 0!==e.maxSendLinkBandwidth?e.maxSendLinkBandwidth:void 0,maxReceiveLinkBandwidth:void 0!==e.maxReceiveLinkBandwidth?e.maxReceiveLinkBandwidth:void 0,mediaHtmlElement:e.mediaHtmlElement?e.mediaHtmlElement:{},mediaDeviceId:e.mediaDeviceId?e.mediaDeviceId:{},initMedia:e.initMedia?e.initMedia:{}},O(e.myCountryCode)&&(this.callParams.myCountryCode=e.myCountryCode),O(e.peerCountryCode)&&(this.callParams.peerCountryCode=e.peerCountryCode),!0)}},{key:"_getWtpGcallParams",value:function(e){var t={myId:this.callParams.myId,fromSvcId:this.callParams.myServiceId,roomId:this.callParams.roomId,toSvcId:this.callParams.roomServiceId,stid:this.callParams.appServerData,cameraOn:this.callParams.cameraOn,micOn:this.callParams.micOn,callType:this.callParams.mediaType===g.VIDEO?"V":"A",svckey:this.callParams.mediaType===g.VIDEO?"groupcall.video":"groupcall.audio",pauseVideoByPageHidden:this.callParams.pauseVideoByPageHidden,ignoreDeviceError:this.callParams.ignoreDeviceError,enableTalkingStatusEvent:this.callParams.enableTalkingStatusEvent,displayName:this.callParams.displayName,maxSendLinkBandwidth:this.callParams.maxSendLinkBandwidth,maxReceiveLinkBandwidth:this.callParams.maxReceiveLinkBandwidth,initMedia:this.callParams.initMedia,inviteHeaders:e,planetKitVersion:f},r={},n=this.callParams.mediaHtmlElement;n.myVideo&&(r.local={video:n.myVideo}),n.roomAudio&&(r.remote={audio:n.roomAudio}),t.media=r;var i={},o=this.callParams.mediaDeviceId;return o.inputAudio&&(i.audio=o.inputAudio),o.inputVideo&&(i.video=o.inputVideo),t.mediaId=i,Promise.resolve(t)}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),a}(k)})(),n})()));