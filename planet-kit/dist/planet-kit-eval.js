!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PlanetKit=t():e.PlanetKit=t()}(self,(()=>(()=>{var e={9662:(e,t,r)=>{var n=r(7854),i=r(614),o=r(6330),a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not a function")}},9483:(e,t,r)=>{var n=r(7854),i=r(4411),o=r(6330),a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not a constructor")}},6077:(e,t,r)=>{var n=r(7854),i=r(614),o=n.String,a=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw a("Can't set "+o(e)+" as a prototype")}},1223:(e,t,r)=>{var n=r(5112),i=r(30),o=r(3070),a=n("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},1530:(e,t,r)=>{"use strict";var n=r(8710).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},5787:(e,t,r)=>{var n=r(7854),i=r(7976),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},9670:(e,t,r)=>{var n=r(7854),i=r(111),o=n.String,a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not an object")}},7556:(e,t,r)=>{var n=r(7293);e.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},8533:(e,t,r)=>{"use strict";var n=r(2092).forEach,i=r(9341)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},8457:(e,t,r)=>{"use strict";var n=r(7854),i=r(9974),o=r(6916),a=r(7908),s=r(3411),c=r(7659),u=r(4411),l=r(6244),d=r(6135),h=r(8554),p=r(1246),f=n.Array;e.exports=function(e){var t=a(e),r=u(this),n=arguments.length,g=n>1?arguments[1]:void 0,v=void 0!==g;v&&(g=i(g,n>2?arguments[2]:void 0));var m,S,E,y,_,T,R=p(t),b=0;if(!R||this==f&&c(R))for(m=l(t),S=r?new this(m):f(m);m>b;b++)T=v?g(t[b],b):t[b],d(S,b,T);else for(_=(y=h(t,R)).next,S=r?new this:[];!(E=o(_,y)).done;b++)T=v?s(y,g,[E.value,b],!0):E.value,d(S,b,T);return S.length=b,S}},1318:(e,t,r)=>{var n=r(5656),i=r(1400),o=r(6244),a=function(e){return function(t,r,a){var s,c=n(t),u=o(c),l=i(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},2092:(e,t,r)=>{var n=r(9974),i=r(1702),o=r(8361),a=r(7908),s=r(6244),c=r(5417),u=i([].push),l=function(e){var t=1==e,r=2==e,i=3==e,l=4==e,d=6==e,h=7==e,p=5==e||d;return function(f,g,v,m){for(var S,E,y=a(f),_=o(y),T=n(g,v),R=s(_),b=0,w=m||c,A=t?w(f,R):r||h?w(f,0):void 0;R>b;b++)if((p||b in _)&&(E=T(S=_[b],b,y),e))if(t)A[b]=E;else if(E)switch(e){case 3:return!0;case 5:return S;case 6:return b;case 2:u(A,S)}else switch(e){case 4:return!1;case 7:u(A,S)}return d?-1:i||l?l:A}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},1194:(e,t,r)=>{var n=r(7293),i=r(5112),o=r(7392),a=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},9341:(e,t,r)=>{"use strict";var n=r(7293);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},1589:(e,t,r)=>{var n=r(7854),i=r(1400),o=r(6244),a=r(6135),s=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),l=i(void 0===r?n:r,n),d=s(c(l-u,0)),h=0;u<l;u++,h++)a(d,h,e[u]);return d.length=h,d}},206:(e,t,r)=>{var n=r(1702);e.exports=n([].slice)},7475:(e,t,r)=>{var n=r(7854),i=r(3157),o=r(4411),a=r(111),s=r(5112)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||a(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?c:t}},5417:(e,t,r)=>{var n=r(7475);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},3411:(e,t,r)=>{var n=r(9670),i=r(9212);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},7072:(e,t,r)=>{var n=r(5112)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},4326:(e,t,r)=>{var n=r(1702),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},648:(e,t,r)=>{var n=r(7854),i=r(1694),o=r(614),a=r(4326),s=r(5112)("toStringTag"),c=n.Object,u="Arguments"==a(function(){return arguments}());e.exports=i?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),s))?r:u?a(t):"Object"==(n=a(t))&&o(t.callee)?"Arguments":n}},9320:(e,t,r)=>{"use strict";var n=r(1702),i=r(2248),o=r(2423).getWeakData,a=r(9670),s=r(111),c=r(5787),u=r(408),l=r(2092),d=r(2597),h=r(9909),p=h.set,f=h.getterFor,g=l.find,v=l.findIndex,m=n([].splice),S=0,E=function(e){return e.frozen||(e.frozen=new y)},y=function(){this.entries=[]},_=function(e,t){return g(e.entries,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=_(this,e);if(t)return t[1]},has:function(e){return!!_(this,e)},set:function(e,t){var r=_(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=v(this.entries,(function(t){return t[0]===e}));return~t&&m(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,r,n){var l=e((function(e,i){c(e,h),p(e,{type:t,id:S++,frozen:void 0}),null!=i&&u(i,e[n],{that:e,AS_ENTRIES:r})})),h=l.prototype,g=f(t),v=function(e,t,r){var n=g(e),i=o(a(t),!0);return!0===i?E(n).set(t,r):i[n.id]=r,e};return i(h,{delete:function(e){var t=g(this);if(!s(e))return!1;var r=o(e);return!0===r?E(t).delete(e):r&&d(r,t.id)&&delete r[t.id]},has:function(e){var t=g(this);if(!s(e))return!1;var r=o(e);return!0===r?E(t).has(e):r&&d(r,t.id)}}),i(h,r?{get:function(e){var t=g(this);if(s(e)){var r=o(e);return!0===r?E(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),l}}},7710:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(1702),a=r(4705),s=r(1320),c=r(2423),u=r(408),l=r(5787),d=r(614),h=r(111),p=r(7293),f=r(7072),g=r(8003),v=r(9587);e.exports=function(e,t,r){var m=-1!==e.indexOf("Map"),S=-1!==e.indexOf("Weak"),E=m?"set":"add",y=i[e],_=y&&y.prototype,T=y,R={},b=function(e){var t=o(_[e]);s(_,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return S&&!h(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(a(e,!d(y)||!(S||_.forEach&&!p((function(){(new y).entries().next()})))))T=r.getConstructor(t,e,m,E),c.enable();else if(a(e,!0)){var w=new T,A=w[E](S?{}:-0,1)!=w,C=p((function(){w.has(1)})),I=f((function(e){new y(e)})),O=!S&&p((function(){for(var e=new y,t=5;t--;)e[E](t,t);return!e.has(-0)}));I||((T=t((function(e,t){l(e,_);var r=v(new y,e,T);return null!=t&&u(t,r[E],{that:r,AS_ENTRIES:m}),r}))).prototype=_,_.constructor=T),(C||O)&&(b("delete"),b("has"),m&&b("get")),(O||A)&&b(E),S&&_.clear&&delete _.clear}return R[e]=T,n({global:!0,forced:T!=y},R),g(T,e),S||r.setStrong(T,e,m),T}},9920:(e,t,r)=>{var n=r(2597),i=r(3887),o=r(1236),a=r(3070);e.exports=function(e,t,r){for(var s=i(t),c=a.f,u=o.f,l=0;l<s.length;l++){var d=s[l];n(e,d)||r&&n(r,d)||c(e,d,u(t,d))}}},4964:(e,t,r)=>{var n=r(5112)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},8544:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:(e,t,r)=>{"use strict";var n=r(3383).IteratorPrototype,i=r(30),o=r(9114),a=r(8003),s=r(7497),c=function(){return this};e.exports=function(e,t,r,u){var l=t+" Iterator";return e.prototype=i(n,{next:o(+!u,r)}),a(e,l,!1,!0),s[l]=c,e}},8880:(e,t,r)=>{var n=r(9781),i=r(3070),o=r(9114);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},9114:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6135:(e,t,r)=>{"use strict";var n=r(4948),i=r(3070),o=r(9114);e.exports=function(e,t,r){var a=n(t);a in e?i.f(e,a,o(0,r)):e[a]=r}},654:(e,t,r)=>{"use strict";var n=r(2109),i=r(6916),o=r(1913),a=r(6530),s=r(614),c=r(4994),u=r(9518),l=r(7674),d=r(8003),h=r(8880),p=r(1320),f=r(5112),g=r(7497),v=r(3383),m=a.PROPER,S=a.CONFIGURABLE,E=v.IteratorPrototype,y=v.BUGGY_SAFARI_ITERATORS,_=f("iterator"),T="keys",R="values",b="entries",w=function(){return this};e.exports=function(e,t,r,a,f,v,A){c(r,t,a);var C,I,O,P=function(e){if(e===f&&L)return L;if(!y&&e in M)return M[e];switch(e){case T:case R:case b:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",k=!1,M=e.prototype,D=M[_]||M["@@iterator"]||f&&M[f],L=!y&&D||P(f),x="Array"==t&&M.entries||D;if(x&&(C=u(x.call(new e)))!==Object.prototype&&C.next&&(o||u(C)===E||(l?l(C,E):s(C[_])||p(C,_,w)),d(C,N,!0,!0),o&&(g[N]=w)),m&&f==R&&D&&D.name!==R&&(!o&&S?h(M,"name",R):(k=!0,L=function(){return i(D,this)})),f)if(I={values:P(R),keys:v?L:P(T),entries:P(b)},A)for(O in I)(y||k||!(O in M))&&p(M,O,I[O]);else n({target:t,proto:!0,forced:y||k},I);return o&&!A||M[_]===L||p(M,_,L,{name:f}),g[t]=L,I}},7235:(e,t,r)=>{var n=r(857),i=r(2597),o=r(6061),a=r(3070).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},9781:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:(e,t,r)=>{var n=r(7854),i=r(111),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},8324:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(e,t,r)=>{var n=r(317)("span").classList,i=n&&n.constructor&&n.constructor.prototype;e.exports=i===Object.prototype?void 0:i},7871:e=>{e.exports="object"==typeof window},1528:(e,t,r)=>{var n=r(8113),i=r(7854);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},6833:(e,t,r)=>{var n=r(8113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},5268:(e,t,r)=>{var n=r(4326),i=r(7854);e.exports="process"==n(i.process)},1036:(e,t,r)=>{var n=r(8113);e.exports=/web0s(?!.*chrome)/i.test(n)},8113:(e,t,r)=>{var n=r(5005);e.exports=n("navigator","userAgent")||""},7392:(e,t,r)=>{var n,i,o=r(7854),a=r(8113),s=o.process,c=o.Deno,u=s&&s.versions||c&&c.version,l=u&&u.v8;l&&(i=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},748:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(e,t,r)=>{var n=r(7854),i=r(1236).f,o=r(8880),a=r(1320),s=r(3505),c=r(9920),u=r(4705);e.exports=function(e,t){var r,l,d,h,p,f=e.target,g=e.global,v=e.stat;if(r=g?n:v?n[f]||s(f,{}):(n[f]||{}).prototype)for(l in t){if(h=t[l],d=e.noTargetGet?(p=i(r,l))&&p.value:r[l],!u(g?l:f+(v?".":"#")+l,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;c(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),a(r,l,h,e)}}},7293:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},7007:(e,t,r)=>{"use strict";r(4916);var n=r(1702),i=r(1320),o=r(2261),a=r(7293),s=r(5112),c=r(8880),u=s("species"),l=RegExp.prototype;e.exports=function(e,t,r,d){var h=s(e),p=!a((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),f=p&&!a((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[u]=function(){return r},r.flags="",r[h]=/./[h]),r.exec=function(){return t=!0,null},r[h](""),!t}));if(!p||!f||r){var g=n(/./[h]),v=t(h,""[e],(function(e,t,r,i,a){var s=n(e),c=t.exec;return c===o||c===l.exec?p&&!a?{done:!0,value:g(t,r,i)}:{done:!0,value:s(r,t,i)}:{done:!1}}));i(String.prototype,e,v[0]),i(l,h,v[1])}d&&c(l[h],"sham",!0)}},6677:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},2104:e=>{var t=Function.prototype,r=t.apply,n=t.bind,i=t.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?i.bind(r):function(){return i.apply(r,arguments)})},9974:(e,t,r)=>{var n=r(1702),i=r(9662),o=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?o(e,t):function(){return e.apply(t,arguments)}}},7065:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(9662),a=r(111),s=r(2597),c=r(206),u=n.Function,l=i([].concat),d=i([].join),h={},p=function(e,t,r){if(!s(h,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";h[t]=u("C,a","return new C("+d(n,",")+")")}return h[t](e,r)};e.exports=u.bind||function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=l(n,c(arguments));return this instanceof i?p(t,r.length,r):t.apply(e,r)};return a(r)&&(i.prototype=r),i}},6916:e=>{var t=Function.prototype.call;e.exports=t.bind?t.bind(t):function(){return t.apply(t,arguments)}},6530:(e,t,r)=>{var n=r(9781),i=r(2597),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=i(o,"name"),c=s&&"something"===function(){}.name,u=s&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:c,CONFIGURABLE:u}},1702:e=>{var t=Function.prototype,r=t.bind,n=t.call,i=r&&r.bind(n);e.exports=r?function(e){return e&&i(n,e)}:function(e){return e&&function(){return n.apply(e,arguments)}}},5005:(e,t,r)=>{var n=r(7854),i=r(614),o=function(e){return i(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e]):n[e]&&n[e][t]}},1246:(e,t,r)=>{var n=r(648),i=r(8173),o=r(7497),a=r(5112)("iterator");e.exports=function(e){if(null!=e)return i(e,a)||i(e,"@@iterator")||o[n(e)]}},8554:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9662),a=r(9670),s=r(6330),c=r(1246),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return a(i(r,e));throw u(s(e)+" is not iterable")}},8173:(e,t,r)=>{var n=r(9662);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},647:(e,t,r)=>{var n=r(1702),i=r(7908),o=Math.floor,a=n("".charAt),s=n("".replace),c=n("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,d,h){var p=r+e.length,f=n.length,g=l;return void 0!==d&&(d=i(d),g=u),s(h,g,(function(i,s){var u;switch(a(s,0)){case"$":return"$";case"&":return e;case"`":return c(t,0,r);case"'":return c(t,p);case"<":u=d[c(s,1,-1)];break;default:var l=+s;if(0===l)return i;if(l>f){var h=o(l/10);return 0===h?i:h<=f?void 0===n[h-1]?a(s,1):n[h-1]+a(s,1):i}u=n[l-1]}return void 0===u?"":u}))}},7854:(e,t,r)=>{var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},2597:(e,t,r)=>{var n=r(1702),i=r(7908),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},3501:e=>{e.exports={}},842:(e,t,r)=>{var n=r(7854);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},490:(e,t,r)=>{var n=r(5005);e.exports=n("document","documentElement")},4664:(e,t,r)=>{var n=r(9781),i=r(7293),o=r(317);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},8361:(e,t,r)=>{var n=r(7854),i=r(1702),o=r(7293),a=r(4326),s=n.Object,c=i("".split);e.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"==a(e)?c(e,""):s(e)}:s},9587:(e,t,r)=>{var n=r(614),i=r(111),o=r(7674);e.exports=function(e,t,r){var a,s;return o&&n(a=t.constructor)&&a!==r&&i(s=a.prototype)&&s!==r.prototype&&o(e,s),e}},2788:(e,t,r)=>{var n=r(1702),i=r(614),o=r(5465),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},2423:(e,t,r)=>{var n=r(2109),i=r(1702),o=r(3501),a=r(111),s=r(2597),c=r(3070).f,u=r(8006),l=r(1156),d=r(2050),h=r(9711),p=r(6677),f=!1,g=h("meta"),v=0,m=function(e){c(e,g,{value:{objectID:"O"+v++,weakData:{}}})},S=e.exports={enable:function(){S.enable=function(){},f=!0;var e=u.f,t=i([].splice),r={};r[g]=1,e(r).length&&(u.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===g){t(n,i,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:l.f}))},fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,g)){if(!d(e))return"F";if(!t)return"E";m(e)}return e[g].objectID},getWeakData:function(e,t){if(!s(e,g)){if(!d(e))return!0;if(!t)return!1;m(e)}return e[g].weakData},onFreeze:function(e){return p&&f&&d(e)&&!s(e,g)&&m(e),e}};o[g]=!0},9909:(e,t,r)=>{var n,i,o,a=r(8536),s=r(7854),c=r(1702),u=r(111),l=r(8880),d=r(2597),h=r(5465),p=r(6200),f=r(3501),g="Object already initialized",v=s.TypeError,m=s.WeakMap;if(a||h.state){var S=h.state||(h.state=new m),E=c(S.get),y=c(S.has),_=c(S.set);n=function(e,t){if(y(S,e))throw new v(g);return t.facade=e,_(S,e,t),t},i=function(e){return E(S,e)||{}},o=function(e){return y(S,e)}}else{var T=p("state");f[T]=!0,n=function(e,t){if(d(e,T))throw new v(g);return t.facade=e,l(e,T,t),t},i=function(e){return d(e,T)?e[T]:{}},o=function(e){return d(e,T)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw v("Incompatible receiver, "+e+" required");return r}}}},7659:(e,t,r)=>{var n=r(5112),i=r(7497),o=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},3157:(e,t,r)=>{var n=r(4326);e.exports=Array.isArray||function(e){return"Array"==n(e)}},614:e=>{e.exports=function(e){return"function"==typeof e}},4411:(e,t,r)=>{var n=r(1702),i=r(7293),o=r(614),a=r(648),s=r(5005),c=r(2788),u=function(){},l=[],d=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=n(h.exec),f=!h.exec(u),g=function(e){if(!o(e))return!1;try{return d(u,l,e),!0}catch(e){return!1}},v=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};v.sham=!0,e.exports=!d||i((function(){var e;return g(g.call)||!g(Object)||!g((function(){e=!0}))||e}))?v:g},4705:(e,t,r)=>{var n=r(7293),i=r(614),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r==l||r!=u&&(i(t)?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},u=a.NATIVE="N",l=a.POLYFILL="P";e.exports=a},5988:(e,t,r)=>{var n=r(111),i=Math.floor;e.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&i(e)===e}},111:(e,t,r)=>{var n=r(614);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},1913:e=>{e.exports=!1},7850:(e,t,r)=>{var n=r(111),i=r(4326),o=r(5112)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},2190:(e,t,r)=>{var n=r(7854),i=r(5005),o=r(614),a=r(7976),s=r(3307),c=n.Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&a(t.prototype,c(e))}},408:(e,t,r)=>{var n=r(7854),i=r(9974),o=r(6916),a=r(9670),s=r(6330),c=r(7659),u=r(6244),l=r(7976),d=r(8554),h=r(1246),p=r(9212),f=n.TypeError,g=function(e,t){this.stopped=e,this.result=t},v=g.prototype;e.exports=function(e,t,r){var n,m,S,E,y,_,T,R=r&&r.that,b=!(!r||!r.AS_ENTRIES),w=!(!r||!r.IS_ITERATOR),A=!(!r||!r.INTERRUPTED),C=i(t,R),I=function(e){return n&&p(n,"normal",e),new g(!0,e)},O=function(e){return b?(a(e),A?C(e[0],e[1],I):C(e[0],e[1])):A?C(e,I):C(e)};if(w)n=e;else{if(!(m=h(e)))throw f(s(e)+" is not iterable");if(c(m)){for(S=0,E=u(e);E>S;S++)if((y=O(e[S]))&&l(v,y))return y;return new g(!1)}n=d(e,m)}for(_=n.next;!(T=o(_,n)).done;){try{y=O(T.value)}catch(e){p(n,"throw",e)}if("object"==typeof y&&y&&l(v,y))return y}return new g(!1)}},9212:(e,t,r)=>{var n=r(6916),i=r(9670),o=r(8173);e.exports=function(e,t,r){var a,s;i(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=n(a,e)}catch(e){s=!0,a=e}if("throw"===t)throw r;if(s)throw a;return i(a),r}},3383:(e,t,r)=>{"use strict";var n,i,o,a=r(7293),s=r(614),c=r(30),u=r(9518),l=r(1320),d=r(5112),h=r(1913),p=d("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):f=!0),null==n||a((function(){var e={};return n[p].call(e)!==e}))?n={}:h&&(n=c(n)),s(n[p])||l(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},7497:e=>{e.exports={}},6244:(e,t,r)=>{var n=r(7466);e.exports=function(e){return n(e.length)}},5948:(e,t,r)=>{var n,i,o,a,s,c,u,l,d=r(7854),h=r(9974),p=r(1236).f,f=r(261).set,g=r(6833),v=r(1528),m=r(1036),S=r(5268),E=d.MutationObserver||d.WebKitMutationObserver,y=d.document,_=d.process,T=d.Promise,R=p(d,"queueMicrotask"),b=R&&R.value;b||(n=function(){var e,t;for(S&&(e=_.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():o=void 0,e}}o=void 0,e&&e.enter()},g||S||m||!E||!y?!v&&T&&T.resolve?((u=T.resolve(void 0)).constructor=T,l=h(u.then,u),a=function(){l(n)}):S?a=function(){_.nextTick(n)}:(f=h(f,d),a=function(){f(n)}):(s=!0,c=y.createTextNode(""),new E(n).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=b||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,a()),o=t}},3366:(e,t,r)=>{var n=r(7854);e.exports=n.Promise},133:(e,t,r)=>{var n=r(7392),i=r(7293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},8536:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2788),a=n.WeakMap;e.exports=i(a)&&/native code/.test(o(a))},8523:(e,t,r)=>{"use strict";var n=r(9662),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},3929:(e,t,r)=>{var n=r(7854),i=r(7850),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},1574:(e,t,r)=>{"use strict";var n=r(9781),i=r(1702),o=r(6916),a=r(7293),s=r(1956),c=r(5181),u=r(5296),l=r(7908),d=r(8361),h=Object.assign,p=Object.defineProperty,f=i([].concat);e.exports=!h||a((function(){if(n&&1!==h({b:1},h(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!=h({},e)[r]||s(h({},t)).join("")!=i}))?function(e,t){for(var r=l(e),i=arguments.length,a=1,h=c.f,p=u.f;i>a;)for(var g,v=d(arguments[a++]),m=h?f(s(v),h(v)):s(v),S=m.length,E=0;S>E;)g=m[E++],n&&!o(p,v,g)||(r[g]=v[g]);return r}:h},30:(e,t,r)=>{var n,i=r(9670),o=r(6048),a=r(748),s=r(3501),c=r(490),u=r(317),l=r(6200),d="prototype",h="script",p=l("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},v=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&n?v(n):(t=u("iframe"),r="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):v(n);for(var i=a.length;i--;)delete m[d][a[i]];return m()};s[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[d]=i(e),r=new f,f[d]=null,r[p]=e):r=m(),void 0===t?r:o(r,t)}},6048:(e,t,r)=>{var n=r(9781),i=r(3070),o=r(9670),a=r(5656),s=r(1956);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),c=s(t),u=c.length,l=0;u>l;)i.f(e,r=c[l++],n[r]);return e}},3070:(e,t,r)=>{var n=r(7854),i=r(9781),o=r(4664),a=r(9670),s=r(4948),c=n.TypeError,u=Object.defineProperty;t.f=i?u:function(e,t,r){if(a(e),t=s(t),a(r),o)try{return u(e,t,r)}catch(e){}if("get"in r||"set"in r)throw c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},1236:(e,t,r)=>{var n=r(9781),i=r(6916),o=r(5296),a=r(9114),s=r(5656),c=r(4948),u=r(2597),l=r(4664),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=s(e),t=c(t),l)try{return d(e,t)}catch(e){}if(u(e,t))return a(!i(o.f,e,t),e[t])}},1156:(e,t,r)=>{var n=r(4326),i=r(5656),o=r(8006).f,a=r(1589),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return a(s)}}(e):o(i(e))}},8006:(e,t,r)=>{var n=r(6324),i=r(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},5181:(e,t)=>{t.f=Object.getOwnPropertySymbols},9518:(e,t,r)=>{var n=r(7854),i=r(2597),o=r(614),a=r(7908),s=r(6200),c=r(8544),u=s("IE_PROTO"),l=n.Object,d=l.prototype;e.exports=c?l.getPrototypeOf:function(e){var t=a(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof l?d:null}},2050:(e,t,r)=>{var n=r(7293),i=r(111),o=r(4326),a=r(7556),s=Object.isExtensible,c=n((function(){s(1)}));e.exports=c||a?function(e){return!!i(e)&&(!a||"ArrayBuffer"!=o(e))&&(!s||s(e))}:s},7976:(e,t,r)=>{var n=r(1702);e.exports=n({}.isPrototypeOf)},6324:(e,t,r)=>{var n=r(1702),i=r(2597),o=r(5656),a=r(1318).indexOf,s=r(3501),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,l=[];for(r in n)!i(s,r)&&i(n,r)&&c(l,r);for(;t.length>u;)i(n,r=t[u++])&&(~a(l,r)||c(l,r));return l}},1956:(e,t,r)=>{var n=r(6324),i=r(748);e.exports=Object.keys||function(e){return n(e,i)}},5296:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},7674:(e,t,r)=>{var n=r(1702),i=r(9670),o=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},288:(e,t,r)=>{"use strict";var n=r(1694),i=r(648);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},2140:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(614),a=r(111),s=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!a(n=i(r,e)))return n;if(o(r=e.valueOf)&&!a(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!a(n=i(r,e)))return n;throw s("Can't convert object to primitive value")}},3887:(e,t,r)=>{var n=r(5005),i=r(1702),o=r(8006),a=r(5181),s=r(9670),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},857:(e,t,r)=>{var n=r(7854);e.exports=n},2534:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},9478:(e,t,r)=>{var n=r(9670),i=r(111),o=r(8523);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},8572:e=>{var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},2248:(e,t,r)=>{var n=r(1320);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},1320:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2597),a=r(8880),s=r(3505),c=r(2788),u=r(9909),l=r(6530).CONFIGURABLE,d=u.get,h=u.enforce,p=String(String).split("String");(e.exports=function(e,t,r,c){var u,d=!!c&&!!c.unsafe,f=!!c&&!!c.enumerable,g=!!c&&!!c.noTargetGet,v=c&&void 0!==c.name?c.name:t;i(r)&&("Symbol("===String(v).slice(0,7)&&(v="["+String(v).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(r,"name")||l&&r.name!==v)&&a(r,"name",v),(u=h(r)).source||(u.source=p.join("string"==typeof v?v:""))),e!==n?(d?!g&&e[t]&&(f=!0):delete e[t],f?e[t]=r:a(e,t,r)):f?e[t]=r:s(t,r)})(Function.prototype,"toString",(function(){return i(this)&&d(this).source||c(this)}))},7651:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9670),a=r(614),s=r(4326),c=r(2261),u=n.TypeError;e.exports=function(e,t){var r=e.exec;if(a(r)){var n=i(r,e,t);return null!==n&&o(n),n}if("RegExp"===s(e))return i(c,e,t);throw u("RegExp#exec called on incompatible receiver")}},2261:(e,t,r)=>{"use strict";var n,i,o=r(6916),a=r(1702),s=r(1340),c=r(7066),u=r(2999),l=r(2309),d=r(30),h=r(9909).get,p=r(9441),f=r(7168),g=l("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,m=v,S=a("".charAt),E=a("".indexOf),y=a("".replace),_=a("".slice),T=(i=/b*/g,o(v,n=/a/,"a"),o(v,i,"a"),0!==n.lastIndex||0!==i.lastIndex),R=u.BROKEN_CARET,b=void 0!==/()??/.exec("")[1];(T||b||R||p||f)&&(m=function(e){var t,r,n,i,a,u,l,p=this,f=h(p),w=s(e),A=f.raw;if(A)return A.lastIndex=p.lastIndex,t=o(m,A,w),p.lastIndex=A.lastIndex,t;var C=f.groups,I=R&&p.sticky,O=o(c,p),P=p.source,N=0,k=w;if(I&&(O=y(O,"y",""),-1===E(O,"g")&&(O+="g"),k=_(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==S(w,p.lastIndex-1))&&(P="(?: "+P+")",k=" "+k,N++),r=new RegExp("^(?:"+P+")",O)),b&&(r=new RegExp("^"+P+"$(?!\\s)",O)),T&&(n=p.lastIndex),i=o(v,I?r:p,k),I?i?(i.input=_(i.input,N),i[0]=_(i[0],N),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:T&&i&&(p.lastIndex=p.global?i.index+i[0].length:n),b&&i&&i.length>1&&o(g,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&C)for(i.groups=u=d(null),a=0;a<C.length;a++)u[(l=C[a])[0]]=i[l[1]];return i}),e.exports=m},7066:(e,t,r)=>{"use strict";var n=r(9670);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},2999:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp,o=n((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),a=o||n((function(){return!i("a","y").sticky})),s=o||n((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:s,MISSED_STICKY:a,UNSUPPORTED_Y:o}},9441:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},4488:(e,t,r)=>{var n=r(7854).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},3505:(e,t,r)=>{var n=r(7854),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},6340:(e,t,r)=>{"use strict";var n=r(5005),i=r(3070),o=r(5112),a=r(9781),s=o("species");e.exports=function(e){var t=n(e),r=i.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},8003:(e,t,r)=>{var n=r(3070).f,i=r(2597),o=r(5112)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!i(e,o)&&n(e,o,{configurable:!0,value:t})}},6200:(e,t,r)=>{var n=r(2309),i=r(9711),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},5465:(e,t,r)=>{var n=r(7854),i=r(3505),o="__core-js_shared__",a=n[o]||i(o,{});e.exports=a},2309:(e,t,r)=>{var n=r(1913),i=r(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.1",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},6707:(e,t,r)=>{var n=r(9670),i=r(9483),o=r(5112)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},8710:(e,t,r)=>{var n=r(1702),i=r(9303),o=r(1340),a=r(4488),s=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,d=o(a(t)),h=i(r),p=d.length;return h<0||h>=p?e?"":void 0:(n=c(d,h))<55296||n>56319||h+1===p||(l=c(d,h+1))<56320||l>57343?e?s(d,h):n:e?u(d,h,h+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},3111:(e,t,r)=>{var n=r(1702),i=r(4488),o=r(1340),a=r(1361),s=n("".replace),c="["+a+"]",u=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),d=function(e){return function(t){var r=o(i(t));return 1&e&&(r=s(r,u,"")),2&e&&(r=s(r,l,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},261:(e,t,r)=>{var n,i,o,a,s=r(7854),c=r(2104),u=r(9974),l=r(614),d=r(2597),h=r(7293),p=r(490),f=r(206),g=r(317),v=r(6833),m=r(5268),S=s.setImmediate,E=s.clearImmediate,y=s.process,_=s.Dispatch,T=s.Function,R=s.MessageChannel,b=s.String,w=0,A={},C="onreadystatechange";try{n=s.location}catch(e){}var I=function(e){if(d(A,e)){var t=A[e];delete A[e],t()}},O=function(e){return function(){I(e)}},P=function(e){I(e.data)},N=function(e){s.postMessage(b(e),n.protocol+"//"+n.host)};S&&E||(S=function(e){var t=f(arguments,1);return A[++w]=function(){c(l(e)?e:T(e),void 0,t)},i(w),w},E=function(e){delete A[e]},m?i=function(e){y.nextTick(O(e))}:_&&_.now?i=function(e){_.now(O(e))}:R&&!v?(a=(o=new R).port2,o.port1.onmessage=P,i=u(a.postMessage,a)):s.addEventListener&&l(s.postMessage)&&!s.importScripts&&n&&"file:"!==n.protocol&&!h(N)?(i=N,s.addEventListener("message",P,!1)):i=C in g("script")?function(e){p.appendChild(g("script"))[C]=function(){p.removeChild(this),I(e)}}:function(e){setTimeout(O(e),0)}),e.exports={set:S,clear:E}},863:(e,t,r)=>{var n=r(1702);e.exports=n(1..valueOf)},1400:(e,t,r)=>{var n=r(9303),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},5656:(e,t,r)=>{var n=r(8361),i=r(4488);e.exports=function(e){return n(i(e))}},9303:e=>{var t=Math.ceil,r=Math.floor;e.exports=function(e){var n=+e;return n!=n||0===n?0:(n>0?r:t)(n)}},7466:(e,t,r)=>{var n=r(9303),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},7908:(e,t,r)=>{var n=r(7854),i=r(4488),o=n.Object;e.exports=function(e){return o(i(e))}},7593:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(111),a=r(2190),s=r(8173),c=r(2140),u=r(5112),l=n.TypeError,d=u("toPrimitive");e.exports=function(e,t){if(!o(e)||a(e))return e;var r,n=s(e,d);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||a(r))return r;throw l("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},4948:(e,t,r)=>{var n=r(7593),i=r(2190);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},1694:(e,t,r)=>{var n={};n[r(5112)("toStringTag")]="z",e.exports="[object z]"===String(n)},1340:(e,t,r)=>{var n=r(7854),i=r(648),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6330:(e,t,r)=>{var n=r(7854).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},9711:(e,t,r)=>{var n=r(1702),i=0,o=Math.random(),a=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},3307:(e,t,r)=>{var n=r(133);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},6061:(e,t,r)=>{var n=r(5112);t.f=n},5112:(e,t,r)=>{var n=r(7854),i=r(2309),o=r(2597),a=r(9711),s=r(133),c=r(3307),u=i("wks"),l=n.Symbol,d=l&&l.for,h=c?l:l&&l.withoutSetter||a;e.exports=function(e){if(!o(u,e)||!s&&"string"!=typeof u[e]){var t="Symbol."+e;s&&o(l,e)?u[e]=l[e]:u[e]=c&&d?d(t):h(t)}return u[e]}},1361:e=>{e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},2222:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(7293),a=r(3157),s=r(111),c=r(7908),u=r(6244),l=r(6135),d=r(5417),h=r(1194),p=r(5112),f=r(7392),g=p("isConcatSpreadable"),v=9007199254740991,m="Maximum allowed index exceeded",S=i.TypeError,E=f>=51||!o((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),y=h("concat"),_=function(e){if(!s(e))return!1;var t=e[g];return void 0!==t?!!t:a(e)};n({target:"Array",proto:!0,forced:!E||!y},{concat:function(e){var t,r,n,i,o,a=c(this),s=d(a,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(_(o=-1===t?a:arguments[t])){if(h+(i=u(o))>v)throw S(m);for(r=0;r<i;r++,h++)r in o&&l(s,h,o[r])}else{if(h>=v)throw S(m);l(s,h++,o)}return s.length=h,s}})},7327:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).filter;n({target:"Array",proto:!0,forced:!r(1194)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},9826:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).find,o=r(1223),a="find",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),n({target:"Array",proto:!0,forced:s},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(a)},9554:(e,t,r)=>{"use strict";var n=r(2109),i=r(8533);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},1038:(e,t,r)=>{var n=r(2109),i=r(8457);n({target:"Array",stat:!0,forced:!r(7072)((function(e){Array.from(e)}))},{from:i})},9753:(e,t,r)=>{r(2109)({target:"Array",stat:!0},{isArray:r(3157)})},6992:(e,t,r)=>{"use strict";var n=r(5656),i=r(1223),o=r(7497),a=r(9909),s=r(3070).f,c=r(654),u=r(1913),l=r(9781),d="Array Iterator",h=a.set,p=a.getterFor(d);e.exports=c(Array,"Array",(function(e,t){h(this,{type:d,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var f=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!u&&l&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}},9600:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(8361),a=r(5656),s=r(9341),c=i([].join),u=o!=Object,l=s("join",",");n({target:"Array",proto:!0,forced:u||!l},{join:function(e){return c(a(this),void 0===e?",":e)}})},7042:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(3157),a=r(4411),s=r(111),c=r(1400),u=r(6244),l=r(5656),d=r(6135),h=r(5112),p=r(1194),f=r(206),g=p("slice"),v=h("species"),m=i.Array,S=Math.max;n({target:"Array",proto:!0,forced:!g},{slice:function(e,t){var r,n,i,h=l(this),p=u(h),g=c(e,p),E=c(void 0===t?p:t,p);if(o(h)&&(r=h.constructor,(a(r)&&(r===m||o(r.prototype))||s(r)&&null===(r=r[v]))&&(r=void 0),r===m||void 0===r))return f(h,g,E);for(n=new(void 0===r?m:r)(S(E-g,0)),i=0;g<E;g++,i++)g in h&&d(n,i,h[g]);return n.length=i,n}})},5212:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).some;n({target:"Array",proto:!0,forced:!r(9341)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},3710:(e,t,r)=>{var n=r(1702),i=r(1320),o=Date.prototype,a="Invalid Date",s="toString",c=n(o[s]),u=n(o.getTime);String(new Date(NaN))!=a&&i(o,s,(function(){var e=u(this);return e==e?c(this):a}))},8309:(e,t,r)=>{var n=r(9781),i=r(6530).EXISTS,o=r(1702),a=r(3070).f,s=Function.prototype,c=o(s.toString),u=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,l=o(u.exec);n&&!i&&a(s,"name",{configurable:!0,get:function(){try{return l(u,c(this))[1]}catch(e){return""}}})},9653:(e,t,r)=>{"use strict";var n=r(9781),i=r(7854),o=r(1702),a=r(4705),s=r(1320),c=r(2597),u=r(9587),l=r(7976),d=r(2190),h=r(7593),p=r(7293),f=r(8006).f,g=r(1236).f,v=r(3070).f,m=r(863),S=r(3111).trim,E="Number",y=i[E],_=y.prototype,T=i.TypeError,R=o("".slice),b=o("".charCodeAt),w=function(e){var t=h(e,"number");return"bigint"==typeof t?t:A(t)},A=function(e){var t,r,n,i,o,a,s,c,u=h(e,"number");if(d(u))throw T("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=S(u),43===(t=b(u,0))||45===t){if(88===(r=b(u,2))||120===r)return NaN}else if(48===t){switch(b(u,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+u}for(a=(o=R(u,2)).length,s=0;s<a;s++)if((c=b(o,s))<48||c>i)return NaN;return parseInt(o,n)}return+u};if(a(E,!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var C,I=function(e){var t=arguments.length<1?0:y(w(e)),r=this;return l(_,r)&&p((function(){m(r)}))?u(Object(t),r,I):t},O=n?f(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),P=0;O.length>P;P++)c(y,C=O[P])&&!c(I,C)&&v(I,C,g(y,C));I.prototype=_,_.constructor=I,s(i,E,I)}},3161:(e,t,r)=>{r(2109)({target:"Number",stat:!0},{isInteger:r(5988)})},9601:(e,t,r)=>{var n=r(2109),i=r(1574);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},8011:(e,t,r)=>{r(2109)({target:"Object",stat:!0,sham:!r(9781)},{create:r(30)})},3321:(e,t,r)=>{var n=r(2109),i=r(9781);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:r(6048)})},9070:(e,t,r)=>{var n=r(2109),i=r(9781);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:r(3070).f})},3371:(e,t,r)=>{var n=r(2109),i=r(6677),o=r(7293),a=r(111),s=r(2423).onFreeze,c=Object.freeze;n({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!i},{freeze:function(e){return c&&a(e)?c(s(e)):e}})},5003:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(5656),a=r(1236).f,s=r(9781),c=i((function(){a(1)}));n({target:"Object",stat:!0,forced:!s||c,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(o(e),t)}})},9337:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(3887),a=r(5656),s=r(1236),c=r(6135);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=a(e),i=s.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},489:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(7908),a=r(9518),s=r(8544);n({target:"Object",stat:!0,forced:i((function(){a(1)})),sham:!s},{getPrototypeOf:function(e){return a(o(e))}})},7941:(e,t,r)=>{var n=r(2109),i=r(7908),o=r(1956);n({target:"Object",stat:!0,forced:r(7293)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},8304:(e,t,r)=>{r(2109)({target:"Object",stat:!0},{setPrototypeOf:r(7674)})},1539:(e,t,r)=>{var n=r(1694),i=r(1320),o=r(288);n||i(Object.prototype,"toString",o,{unsafe:!0})},8674:(e,t,r)=>{"use strict";var n,i,o,a,s=r(2109),c=r(1913),u=r(7854),l=r(5005),d=r(6916),h=r(3366),p=r(1320),f=r(2248),g=r(7674),v=r(8003),m=r(6340),S=r(9662),E=r(614),y=r(111),_=r(5787),T=r(2788),R=r(408),b=r(7072),w=r(6707),A=r(261).set,C=r(5948),I=r(9478),O=r(842),P=r(8523),N=r(2534),k=r(8572),M=r(9909),D=r(4705),L=r(5112),x=r(7871),V=r(5268),U=r(7392),j=L("species"),H="Promise",B=M.getterFor(H),$=M.set,F=M.getterFor(H),q=h&&h.prototype,W=h,K=q,G=u.TypeError,Y=u.document,z=u.process,X=P.f,J=X,Z=!!(Y&&Y.createEvent&&u.dispatchEvent),Q=E(u.PromiseRejectionEvent),ee="unhandledrejection",te=!1,re=D(H,(function(){var e=T(W),t=e!==String(W);if(!t&&66===U)return!0;if(c&&!K.finally)return!0;if(U>=51&&/native code/.test(e))return!1;var r=new W((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[j]=n,!(te=r.then((function(){}))instanceof n)||!t&&x&&!Q})),ne=re||!b((function(e){W.all(e).catch((function(){}))})),ie=function(e){var t;return!(!y(e)||!E(t=e.then))&&t},oe=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&le(t),t.rejection=1),!0===s?r=o:(l&&l.enter(),r=s(o),l&&(l.exit(),i=!0)),r===e.promise?u(G("Promise-chain cycle")):(n=ie(r))?d(n,r,c,u):c(r)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},ae=function(e,t){e.notified||(e.notified=!0,C((function(){for(var r,n=e.reactions;r=n.get();)oe(r,e);e.notified=!1,t&&!e.rejection&&ce(e)})))},se=function(e,t,r){var n,i;Z?((n=Y.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Q&&(i=u["on"+e])?i(n):e===ee&&O("Unhandled promise rejection",r)},ce=function(e){d(A,u,(function(){var t,r=e.facade,n=e.value;if(ue(e)&&(t=N((function(){V?z.emit("unhandledRejection",n,r):se(ee,r,n)})),e.rejection=V||ue(e)?2:1,t.error))throw t.value}))},ue=function(e){return 1!==e.rejection&&!e.parent},le=function(e){d(A,u,(function(){var t=e.facade;V?z.emit("rejectionHandled",t):se("rejectionhandled",t,e.value)}))},de=function(e,t,r){return function(n){e(t,n,r)}},he=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,ae(e,!0))},pe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw G("Promise can't be resolved itself");var n=ie(t);n?C((function(){var r={done:!1};try{d(n,t,de(pe,r,e),de(he,r,e))}catch(t){he(r,t,e)}})):(e.value=t,e.state=1,ae(e,!1))}catch(t){he({done:!1},t,e)}}};if(re&&(K=(W=function(e){_(this,K),S(e),d(n,this);var t=B(this);try{e(de(pe,t),de(he,t))}catch(e){he(t,e)}}).prototype,(n=function(e){$(this,{type:H,done:!1,notified:!1,parent:!1,reactions:new k,rejection:!1,state:0,value:void 0})}).prototype=f(K,{then:function(e,t){var r=F(this),n=X(w(this,W));return r.parent=!0,n.ok=!E(e)||e,n.fail=E(t)&&t,n.domain=V?z.domain:void 0,0==r.state?r.reactions.add(n):C((function(){oe(n,r)})),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=B(e);this.promise=e,this.resolve=de(pe,t),this.reject=de(he,t)},P.f=X=function(e){return e===W||e===o?new i(e):J(e)},!c&&E(h)&&q!==Object.prototype)){a=q.then,te||(p(q,"then",(function(e,t){var r=this;return new W((function(e,t){d(a,r,e,t)})).then(e,t)}),{unsafe:!0}),p(q,"catch",K.catch,{unsafe:!0}));try{delete q.constructor}catch(e){}g&&g(q,K)}s({global:!0,wrap:!0,forced:re},{Promise:W}),v(W,H,!1,!0),m(H),o=l(H),s({target:H,stat:!0,forced:re},{reject:function(e){var t=X(this);return d(t.reject,void 0,e),t.promise}}),s({target:H,stat:!0,forced:c||re},{resolve:function(e){return I(c&&this===o?W:this,e)}}),s({target:H,stat:!0,forced:ne},{all:function(e){var t=this,r=X(t),n=r.resolve,i=r.reject,o=N((function(){var r=S(t.resolve),o=[],a=0,s=1;R(e,(function(e){var c=a++,u=!1;s++,d(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=X(t),n=r.reject,i=N((function(){var i=S(t.resolve);R(e,(function(e){d(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},2419:(e,t,r)=>{var n=r(2109),i=r(5005),o=r(2104),a=r(7065),s=r(9483),c=r(9670),u=r(111),l=r(30),d=r(7293),h=i("Reflect","construct"),p=Object.prototype,f=[].push,g=d((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),v=!d((function(){h((function(){}))})),m=g||v;n({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,t){s(e),c(t);var r=arguments.length<3?e:s(arguments[2]);if(v&&!g)return h(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return o(f,n,t),new(o(a,e,n))}var i=r.prototype,d=l(u(i)?i:p),m=o(e,d,t);return u(m)?m:d}})},4916:(e,t,r)=>{"use strict";var n=r(2109),i=r(2261);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},7852:(e,t,r)=>{"use strict";var n,i=r(2109),o=r(1702),a=r(1236).f,s=r(7466),c=r(1340),u=r(3929),l=r(4488),d=r(4964),h=r(1913),p=o("".endsWith),f=o("".slice),g=Math.min,v=d("endsWith");i({target:"String",proto:!0,forced:!(!h&&!v&&(n=a(String.prototype,"endsWith"),n&&!n.writable)||v)},{endsWith:function(e){var t=c(l(this));u(e);var r=arguments.length>1?arguments[1]:void 0,n=t.length,i=void 0===r?n:g(s(r),n),o=c(e);return p?p(t,o,i):f(t,i-o.length,i)===o}})},8783:(e,t,r)=>{"use strict";var n=r(8710).charAt,i=r(1340),o=r(9909),a=r(654),s="String Iterator",c=o.set,u=o.getterFor(s);a(String,"String",(function(e){c(this,{type:s,string:i(e),index:0})}),(function(){var e,t=u(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},5306:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),a=r(7007),s=r(7293),c=r(9670),u=r(614),l=r(9303),d=r(7466),h=r(1340),p=r(4488),f=r(1530),g=r(8173),v=r(647),m=r(7651),S=r(5112)("replace"),E=Math.max,y=Math.min,_=o([].concat),T=o([].push),R=o("".indexOf),b=o("".slice),w="$0"==="a".replace(/./,"$0"),A=!!/./[S]&&""===/./[S]("a","$0");a("replace",(function(e,t,r){var o=A?"$":"$0";return[function(e,r){var n=p(this),o=null==e?void 0:g(e,S);return o?i(o,e,n,r):i(t,h(n),e,r)},function(e,i){var a=c(this),s=h(e);if("string"==typeof i&&-1===R(i,o)&&-1===R(i,"$<")){var p=r(t,a,s,i);if(p.done)return p.value}var g=u(i);g||(i=h(i));var S=a.global;if(S){var w=a.unicode;a.lastIndex=0}for(var A=[];;){var C=m(a,s);if(null===C)break;if(T(A,C),!S)break;""===h(C[0])&&(a.lastIndex=f(s,d(a.lastIndex),w))}for(var I,O="",P=0,N=0;N<A.length;N++){for(var k=h((C=A[N])[0]),M=E(y(l(C.index),s.length),0),D=[],L=1;L<C.length;L++)T(D,void 0===(I=C[L])?I:String(I));var x=C.groups;if(g){var V=_([k],D,M,s);void 0!==x&&T(V,x);var U=h(n(i,void 0,V))}else U=v(k,s,M,D,x,i);M>=P&&(O+=b(s,P,M)+U,P=M+k.length)}return O+b(s,P)}]}),!!s((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!w||A)},3123:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),a=r(7007),s=r(7850),c=r(9670),u=r(4488),l=r(6707),d=r(1530),h=r(7466),p=r(1340),f=r(8173),g=r(1589),v=r(7651),m=r(2261),S=r(2999),E=r(7293),y=S.UNSUPPORTED_Y,_=4294967295,T=Math.min,R=[].push,b=o(/./.exec),w=o(R),A=o("".slice);a("split",(function(e,t,r){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var o=p(u(this)),a=void 0===r?_:r>>>0;if(0===a)return[];if(void 0===e)return[o];if(!s(e))return i(t,o,e,a);for(var c,l,d,h=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),v=0,S=new RegExp(e.source,f+"g");(c=i(m,S,o))&&!((l=S.lastIndex)>v&&(w(h,A(o,v,c.index)),c.length>1&&c.index<o.length&&n(R,h,g(c,1)),d=c[0].length,v=l,h.length>=a));)S.lastIndex===c.index&&S.lastIndex++;return v===o.length?!d&&b(S,"")||w(h,""):w(h,A(o,v)),h.length>a?g(h,0,a):h}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:i(t,this,e,r)}:t,[function(t,r){var n=u(this),a=null==t?void 0:f(t,e);return a?i(a,t,n,r):i(o,p(n),t,r)},function(e,n){var i=c(this),a=p(e),s=r(o,i,a,n,o!==t);if(s.done)return s.value;var u=l(i,RegExp),f=i.unicode,g=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(y?"g":"y"),m=new u(y?"^(?:"+i.source+")":i,g),S=void 0===n?_:n>>>0;if(0===S)return[];if(0===a.length)return null===v(m,a)?[a]:[];for(var E=0,R=0,b=[];R<a.length;){m.lastIndex=y?0:R;var C,I=v(m,y?A(a,R):a);if(null===I||(C=T(h(m.lastIndex+(y?R:0)),a.length))===E)R=d(a,R,f);else{if(w(b,A(a,E,R)),b.length===S)return b;for(var O=1;O<=I.length-1;O++)if(w(b,I[O]),b.length===S)return b;R=E=C}}return w(b,A(a,E)),b}]}),!!E((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),y)},1817:(e,t,r)=>{"use strict";var n=r(2109),i=r(9781),o=r(7854),a=r(1702),s=r(2597),c=r(614),u=r(7976),l=r(1340),d=r(3070).f,h=r(9920),p=o.Symbol,f=p&&p.prototype;if(i&&c(p)&&(!("description"in f)||void 0!==p().description)){var g={},v=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:l(arguments[0]),t=u(f,this)?new p(e):void 0===e?p():p(e);return""===e&&(g[t]=!0),t};h(v,p),v.prototype=f,f.constructor=v;var m="Symbol(test)"==String(p("test")),S=a(f.toString),E=a(f.valueOf),y=/^Symbol\((.*)\)[^)]+$/,_=a("".replace),T=a("".slice);d(f,"description",{configurable:!0,get:function(){var e=E(this),t=S(e);if(s(g,e))return"";var r=m?T(t,7,-1):_(t,y,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:v})}},2165:(e,t,r)=>{r(7235)("iterator")},2526:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(5005),a=r(2104),s=r(6916),c=r(1702),u=r(1913),l=r(9781),d=r(133),h=r(7293),p=r(2597),f=r(3157),g=r(614),v=r(111),m=r(7976),S=r(2190),E=r(9670),y=r(7908),_=r(5656),T=r(4948),R=r(1340),b=r(9114),w=r(30),A=r(1956),C=r(8006),I=r(1156),O=r(5181),P=r(1236),N=r(3070),k=r(5296),M=r(206),D=r(1320),L=r(2309),x=r(6200),V=r(3501),U=r(9711),j=r(5112),H=r(6061),B=r(7235),$=r(8003),F=r(9909),q=r(2092).forEach,W=x("hidden"),K="Symbol",G="prototype",Y=j("toPrimitive"),z=F.set,X=F.getterFor(K),J=Object[G],Z=i.Symbol,Q=Z&&Z[G],ee=i.TypeError,te=i.QObject,re=o("JSON","stringify"),ne=P.f,ie=N.f,oe=I.f,ae=k.f,se=c([].push),ce=L("symbols"),ue=L("op-symbols"),le=L("string-to-symbol-registry"),de=L("symbol-to-string-registry"),he=L("wks"),pe=!te||!te[G]||!te[G].findChild,fe=l&&h((function(){return 7!=w(ie({},"a",{get:function(){return ie(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=ne(J,t);n&&delete J[t],ie(e,t,r),n&&e!==J&&ie(J,t,n)}:ie,ge=function(e,t){var r=ce[e]=w(Q);return z(r,{type:K,tag:e,description:t}),l||(r.description=t),r},ve=function(e,t,r){e===J&&ve(ue,t,r),E(e);var n=T(t);return E(r),p(ce,n)?(r.enumerable?(p(e,W)&&e[W][n]&&(e[W][n]=!1),r=w(r,{enumerable:b(0,!1)})):(p(e,W)||ie(e,W,b(1,{})),e[W][n]=!0),fe(e,n,r)):ie(e,n,r)},me=function(e,t){E(e);var r=_(t),n=A(r).concat(_e(r));return q(n,(function(t){l&&!s(Se,r,t)||ve(e,t,r[t])})),e},Se=function(e){var t=T(e),r=s(ae,this,t);return!(this===J&&p(ce,t)&&!p(ue,t))&&(!(r||!p(this,t)||!p(ce,t)||p(this,W)&&this[W][t])||r)},Ee=function(e,t){var r=_(e),n=T(t);if(r!==J||!p(ce,n)||p(ue,n)){var i=ne(r,n);return!i||!p(ce,n)||p(r,W)&&r[W][n]||(i.enumerable=!0),i}},ye=function(e){var t=oe(_(e)),r=[];return q(t,(function(e){p(ce,e)||p(V,e)||se(r,e)})),r},_e=function(e){var t=e===J,r=oe(t?ue:_(e)),n=[];return q(r,(function(e){!p(ce,e)||t&&!p(J,e)||se(n,ce[e])})),n};if(d||(D(Q=(Z=function(){if(m(Q,this))throw ee("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?R(arguments[0]):void 0,t=U(e),r=function(e){this===J&&s(r,ue,e),p(this,W)&&p(this[W],t)&&(this[W][t]=!1),fe(this,t,b(1,e))};return l&&pe&&fe(J,t,{configurable:!0,set:r}),ge(t,e)})[G],"toString",(function(){return X(this).tag})),D(Z,"withoutSetter",(function(e){return ge(U(e),e)})),k.f=Se,N.f=ve,P.f=Ee,C.f=I.f=ye,O.f=_e,H.f=function(e){return ge(j(e),e)},l&&(ie(Q,"description",{configurable:!0,get:function(){return X(this).description}}),u||D(J,"propertyIsEnumerable",Se,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:Z}),q(A(he),(function(e){B(e)})),n({target:K,stat:!0,forced:!d},{for:function(e){var t=R(e);if(p(le,t))return le[t];var r=Z(t);return le[t]=r,de[r]=t,r},keyFor:function(e){if(!S(e))throw ee(e+" is not a symbol");if(p(de,e))return de[e]},useSetter:function(){pe=!0},useSimple:function(){pe=!1}}),n({target:"Object",stat:!0,forced:!d,sham:!l},{create:function(e,t){return void 0===t?w(e):me(w(e),t)},defineProperty:ve,defineProperties:me,getOwnPropertyDescriptor:Ee}),n({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:ye,getOwnPropertySymbols:_e}),n({target:"Object",stat:!0,forced:h((function(){O.f(1)}))},{getOwnPropertySymbols:function(e){return O.f(y(e))}}),re&&n({target:"JSON",stat:!0,forced:!d||h((function(){var e=Z();return"[null]"!=re([e])||"{}"!=re({a:e})||"{}"!=re(Object(e))}))},{stringify:function(e,t,r){var n=M(arguments),i=t;if((v(t)||void 0!==e)&&!S(e))return f(t)||(t=function(e,t){if(g(i)&&(t=s(i,this,e,t)),!S(t))return t}),n[1]=t,a(re,null,n)}}),!Q[Y]){var Te=Q.valueOf;D(Q,Y,(function(e){return s(Te,this)}))}$(Z,K),V[W]=!0},8478:(e,t,r)=>{"use strict";r(7710)("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(9320))},4747:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),a=r(8533),s=r(8880),c=function(e){if(e&&e.forEach!==a)try{s(e,"forEach",a)}catch(t){e.forEach=a}};for(var u in i)i[u]&&c(n[u]&&n[u].prototype);c(o)},3948:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),a=r(6992),s=r(8880),c=r(5112),u=c("iterator"),l=c("toStringTag"),d=a.values,h=function(e,t){if(e){if(e[u]!==d)try{s(e,u,d)}catch(t){e[u]=d}if(e[l]||s(e,l,t),i[t])for(var r in a)if(e[r]!==a[r])try{s(e,r,a[r])}catch(t){e[r]=a[r]}}};for(var p in i)h(n[p]&&n[p].prototype,p);h(o,"DOMTokenList")},2564:(e,t,r)=>{var n=r(2109),i=r(7854),o=r(2104),a=r(614),s=r(8113),c=r(206),u=/MSIE .\./.test(s),l=i.Function,d=function(e){return function(t,r){var n=arguments.length>2,i=n?c(arguments,2):void 0;return e(n?function(){o(a(t)?t:l(t),this,i)}:t,r)}};n({global:!0,bind:!0,forced:u},{setTimeout:d(i.setTimeout),setInterval:d(i.setInterval)})},5666:e=>{var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n=d;return function(i,o){if(n===p)throw new Error("Generator is already running");if(n===f){if("throw"===i)throw o;return P()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=l(e,t,r);if("normal"===c.type){if(n=r.done?f:h,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",p="executing",f="completed",g={};function v(){}function m(){}function S(){}var E={};E[o]=function(){return this};var y=Object.getPrototypeOf,_=y&&y(y(O([])));_&&_!==r&&n.call(_,o)&&(E=_);var T=S.prototype=v.prototype=Object.create(E);function R(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,w(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function O(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=T.constructor=S,S.constructor=m,m.displayName=c(S,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,c(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},R(b.prototype),b.prototype[a]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new b(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},R(T),c(T,s,"Generator"),T[o]=function(){return this},T.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=O,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}},2968:e=>{var t;self,t=()=>(()=>{var e={9662:(e,t,r)=>{var n=r(7854),i=r(614),o=r(6330),a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not a function")}},9483:(e,t,r)=>{var n=r(7854),i=r(4411),o=r(6330),a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not a constructor")}},6077:(e,t,r)=>{var n=r(7854),i=r(614),o=n.String,a=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw a("Can't set "+o(e)+" as a prototype")}},1223:(e,t,r)=>{var n=r(5112),i=r(30),o=r(3070),a=n("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},1530:(e,t,r)=>{"use strict";var n=r(8710).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},5787:(e,t,r)=>{var n=r(7854),i=r(7976),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},9670:(e,t,r)=>{var n=r(7854),i=r(111),o=n.String,a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not an object")}},4019:e=>{e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7556:(e,t,r)=>{var n=r(7293);e.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},260:(e,t,r)=>{"use strict";var n,i,o,a=r(4019),s=r(9781),c=r(7854),u=r(614),l=r(111),d=r(2597),h=r(648),p=r(6330),f=r(8880),g=r(1320),v=r(3070).f,m=r(7976),S=r(9518),E=r(7674),y=r(5112),_=r(9711),T=c.Int8Array,R=T&&T.prototype,b=c.Uint8ClampedArray,w=b&&b.prototype,A=T&&S(T),C=R&&S(R),I=Object.prototype,O=c.TypeError,P=y("toStringTag"),N=_("TYPED_ARRAY_TAG"),k=_("TYPED_ARRAY_CONSTRUCTOR"),M=a&&!!E&&"Opera"!==h(c.opera),D=!1,L={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},x={BigInt64Array:8,BigUint64Array:8},V=function(e){if(!l(e))return!1;var t=h(e);return d(L,t)||d(x,t)};for(n in L)(o=(i=c[n])&&i.prototype)?f(o,k,i):M=!1;for(n in x)(o=(i=c[n])&&i.prototype)&&f(o,k,i);if((!M||!u(A)||A===Function.prototype)&&(A=function(){throw O("Incorrect invocation")},M))for(n in L)c[n]&&E(c[n],A);if((!M||!C||C===I)&&(C=A.prototype,M))for(n in L)c[n]&&E(c[n].prototype,C);if(M&&S(w)!==C&&E(w,C),s&&!d(C,P))for(n in D=!0,v(C,P,{get:function(){return l(this)?this[N]:void 0}}),L)c[n]&&f(c[n],N,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_CONSTRUCTOR:k,TYPED_ARRAY_TAG:D&&N,aTypedArray:function(e){if(V(e))return e;throw O("Target is not a typed array")},aTypedArrayConstructor:function(e){if(u(e)&&(!E||m(A,e)))return e;throw O(p(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(s){if(r)for(var i in L){var o=c[i];if(o&&d(o.prototype,e))try{delete o.prototype[e]}catch(r){try{o.prototype[e]=t}catch(e){}}}C[e]&&!r||g(C,e,r?t:M&&R[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(s){if(E){if(r)for(n in L)if((i=c[n])&&d(i,e))try{delete i[e]}catch(e){}if(A[e]&&!r)return;try{return g(A,e,r?t:M&&A[e]||t)}catch(e){}}for(n in L)!(i=c[n])||i[e]&&!r||g(i,e,t)}},isView:function(e){if(!l(e))return!1;var t=h(e);return"DataView"===t||d(L,t)||d(x,t)},isTypedArray:V,TypedArray:A,TypedArrayPrototype:C}},3331:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(9781),a=r(4019),s=r(6530),c=r(8880),u=r(2248),l=r(7293),d=r(5787),h=r(9303),p=r(7466),f=r(7067),g=r(1179),v=r(9518),m=r(7674),S=r(8006).f,E=r(3070).f,y=r(1285),_=r(1589),T=r(8003),R=r(9909),b=s.PROPER,w=s.CONFIGURABLE,A=R.get,C=R.set,I="ArrayBuffer",O="DataView",P="prototype",N="Wrong index",k=n[I],M=k,D=M&&M[P],L=n[O],x=L&&L[P],V=Object.prototype,U=n.Array,j=n.RangeError,H=i(y),B=i([].reverse),$=g.pack,F=g.unpack,q=function(e){return[255&e]},W=function(e){return[255&e,e>>8&255]},K=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},G=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Y=function(e){return $(e,23,4)},z=function(e){return $(e,52,8)},X=function(e,t){E(e[P],t,{get:function(){return A(this)[t]}})},J=function(e,t,r,n){var i=f(r),o=A(e);if(i+t>o.byteLength)throw j(N);var a=A(o.buffer).bytes,s=i+o.byteOffset,c=_(a,s,s+t);return n?c:B(c)},Z=function(e,t,r,n,i,o){var a=f(r),s=A(e);if(a+t>s.byteLength)throw j(N);for(var c=A(s.buffer).bytes,u=a+s.byteOffset,l=n(+i),d=0;d<t;d++)c[u+d]=l[o?d:t-d-1]};if(a){var Q=b&&k.name!==I;if(l((function(){k(1)}))&&l((function(){new k(-1)}))&&!l((function(){return new k,new k(1.5),new k(NaN),Q&&!w})))Q&&w&&c(k,"name",I);else{(M=function(e){return d(this,D),new k(f(e))})[P]=D;for(var ee,te=S(k),re=0;te.length>re;)(ee=te[re++])in M||c(M,ee,k[ee]);D.constructor=M}m&&v(x)!==V&&m(x,V);var ne=new L(new M(2)),ie=i(x.setInt8);ne.setInt8(0,2147483648),ne.setInt8(1,2147483649),!ne.getInt8(0)&&ne.getInt8(1)||u(x,{setInt8:function(e,t){ie(this,e,t<<24>>24)},setUint8:function(e,t){ie(this,e,t<<24>>24)}},{unsafe:!0})}else D=(M=function(e){d(this,D);var t=f(e);C(this,{bytes:H(U(t),0),byteLength:t}),o||(this.byteLength=t)})[P],x=(L=function(e,t,r){d(this,x),d(e,D);var n=A(e).byteLength,i=h(t);if(i<0||i>n)throw j("Wrong offset");if(i+(r=void 0===r?n-i:p(r))>n)throw j("Wrong length");C(this,{buffer:e,byteLength:r,byteOffset:i}),o||(this.buffer=e,this.byteLength=r,this.byteOffset=i)})[P],o&&(X(M,"byteLength"),X(L,"buffer"),X(L,"byteLength"),X(L,"byteOffset")),u(x,{getInt8:function(e){return J(this,1,e)[0]<<24>>24},getUint8:function(e){return J(this,1,e)[0]},getInt16:function(e){var t=J(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=J(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return G(J(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return G(J(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return F(J(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return F(J(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Z(this,1,e,q,t)},setUint8:function(e,t){Z(this,1,e,q,t)},setInt16:function(e,t){Z(this,2,e,W,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Z(this,2,e,W,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Z(this,4,e,K,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Z(this,4,e,K,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Z(this,4,e,Y,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Z(this,8,e,z,t,arguments.length>2?arguments[2]:void 0)}});T(M,I),T(L,O),e.exports={ArrayBuffer:M,DataView:L}},1048:(e,t,r)=>{"use strict";var n=r(7908),i=r(1400),o=r(6244),a=Math.min;e.exports=[].copyWithin||function(e,t){var r=n(this),s=o(r),c=i(e,s),u=i(t,s),l=arguments.length>2?arguments[2]:void 0,d=a((void 0===l?s:i(l,s))-u,s-c),h=1;for(u<c&&c<u+d&&(h=-1,u+=d-1,c+=d-1);d-- >0;)u in r?r[c]=r[u]:delete r[c],c+=h,u+=h;return r}},1285:(e,t,r)=>{"use strict";var n=r(7908),i=r(1400),o=r(6244);e.exports=function(e){for(var t=n(this),r=o(t),a=arguments.length,s=i(a>1?arguments[1]:void 0,r),c=a>2?arguments[2]:void 0,u=void 0===c?r:i(c,r);u>s;)t[s++]=e;return t}},8533:(e,t,r)=>{"use strict";var n=r(2092).forEach,i=r(9341)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},7745:(e,t,r)=>{var n=r(6244);e.exports=function(e,t){for(var r=0,i=n(t),o=new e(i);i>r;)o[r]=t[r++];return o}},8457:(e,t,r)=>{"use strict";var n=r(7854),i=r(9974),o=r(6916),a=r(7908),s=r(3411),c=r(7659),u=r(4411),l=r(6244),d=r(6135),h=r(8554),p=r(1246),f=n.Array;e.exports=function(e){var t=a(e),r=u(this),n=arguments.length,g=n>1?arguments[1]:void 0,v=void 0!==g;v&&(g=i(g,n>2?arguments[2]:void 0));var m,S,E,y,_,T,R=p(t),b=0;if(!R||this==f&&c(R))for(m=l(t),S=r?new this(m):f(m);m>b;b++)T=v?g(t[b],b):t[b],d(S,b,T);else for(_=(y=h(t,R)).next,S=r?new this:[];!(E=o(_,y)).done;b++)T=v?s(y,g,[E.value,b],!0):E.value,d(S,b,T);return S.length=b,S}},1318:(e,t,r)=>{var n=r(5656),i=r(1400),o=r(6244),a=function(e){return function(t,r,a){var s,c=n(t),u=o(c),l=i(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},2092:(e,t,r)=>{var n=r(9974),i=r(1702),o=r(8361),a=r(7908),s=r(6244),c=r(5417),u=i([].push),l=function(e){var t=1==e,r=2==e,i=3==e,l=4==e,d=6==e,h=7==e,p=5==e||d;return function(f,g,v,m){for(var S,E,y=a(f),_=o(y),T=n(g,v),R=s(_),b=0,w=m||c,A=t?w(f,R):r||h?w(f,0):void 0;R>b;b++)if((p||b in _)&&(E=T(S=_[b],b,y),e))if(t)A[b]=E;else if(E)switch(e){case 3:return!0;case 5:return S;case 6:return b;case 2:u(A,S)}else switch(e){case 4:return!1;case 7:u(A,S)}return d?-1:i||l?l:A}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},6583:(e,t,r)=>{"use strict";var n=r(2104),i=r(5656),o=r(9303),a=r(6244),s=r(9341),c=Math.min,u=[].lastIndexOf,l=!!u&&1/[1].lastIndexOf(1,-0)<0,d=s("lastIndexOf"),h=l||!d;e.exports=h?function(e){if(l)return n(u,this,arguments)||0;var t=i(this),r=a(t),s=r-1;for(arguments.length>1&&(s=c(s,o(arguments[1]))),s<0&&(s=r+s);s>=0;s--)if(s in t&&t[s]===e)return s||0;return-1}:u},1194:(e,t,r)=>{var n=r(7293),i=r(5112),o=r(7392),a=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},9341:(e,t,r)=>{"use strict";var n=r(7293);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}},3671:(e,t,r)=>{var n=r(7854),i=r(9662),o=r(7908),a=r(8361),s=r(6244),c=n.TypeError,u=function(e){return function(t,r,n,u){i(r);var l=o(t),d=a(l),h=s(l),p=e?h-1:0,f=e?-1:1;if(n<2)for(;;){if(p in d){u=d[p],p+=f;break}if(p+=f,e?p<0:h<=p)throw c("Reduce of empty array with no initial value")}for(;e?p>=0:h>p;p+=f)p in d&&(u=r(u,d[p],p,l));return u}};e.exports={left:u(!1),right:u(!0)}},1589:(e,t,r)=>{var n=r(7854),i=r(1400),o=r(6244),a=r(6135),s=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),l=i(void 0===r?n:r,n),d=s(c(l-u,0)),h=0;u<l;u++,h++)a(d,h,e[u]);return d.length=h,d}},206:(e,t,r)=>{var n=r(1702);e.exports=n([].slice)},4362:(e,t,r)=>{var n=r(1589),i=Math.floor,o=function(e,t){var r=e.length,c=i(r/2);return r<8?a(e,t):s(e,o(n(e,0,c),t),o(n(e,c),t),t)},a=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},s=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e};e.exports=o},7475:(e,t,r)=>{var n=r(7854),i=r(3157),o=r(4411),a=r(111),s=r(5112)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||a(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?c:t}},5417:(e,t,r)=>{var n=r(7475);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},3411:(e,t,r)=>{var n=r(9670),i=r(9212);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},7072:(e,t,r)=>{var n=r(5112)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},4326:(e,t,r)=>{var n=r(1702),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},648:(e,t,r)=>{var n=r(7854),i=r(1694),o=r(614),a=r(4326),s=r(5112)("toStringTag"),c=n.Object,u="Arguments"==a(function(){return arguments}());e.exports=i?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),s))?r:u?a(t):"Object"==(n=a(t))&&o(t.callee)?"Arguments":n}},5631:(e,t,r)=>{"use strict";var n=r(3070).f,i=r(30),o=r(2248),a=r(9974),s=r(5787),c=r(408),u=r(654),l=r(6340),d=r(9781),h=r(2423).fastKey,p=r(9909),f=p.set,g=p.getterFor;e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){s(e,p),f(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),p=l.prototype,v=g(t),m=function(e,t,r){var n,i,o=v(e),a=S(e,t);return a?a.value=r:(o.last=a={index:i=h(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=a),n&&(n.next=a),d?o.size++:e.size++,"F"!==i&&(o.index[i]=a)),e},S=function(e,t){var r,n=v(e),i=h(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return o(p,{clear:function(){for(var e=v(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=this,r=v(t),n=S(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),d?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=v(this),n=a(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!S(this,e)}}),o(p,r?{get:function(e){var t=S(this,e);return t&&t.value},set:function(e,t){return m(this,0===e?0:e,t)}}:{add:function(e){return m(this,e=0===e?0:e,e)}}),d&&n(p,"size",{get:function(){return v(this).size}}),l},setStrong:function(e,t,r){var n=t+" Iterator",i=g(t),o=g(n);u(e,t,(function(e,t){f(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),l(t)}}},9320:(e,t,r)=>{"use strict";var n=r(1702),i=r(2248),o=r(2423).getWeakData,a=r(9670),s=r(111),c=r(5787),u=r(408),l=r(2092),d=r(2597),h=r(9909),p=h.set,f=h.getterFor,g=l.find,v=l.findIndex,m=n([].splice),S=0,E=function(e){return e.frozen||(e.frozen=new y)},y=function(){this.entries=[]},_=function(e,t){return g(e.entries,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=_(this,e);if(t)return t[1]},has:function(e){return!!_(this,e)},set:function(e,t){var r=_(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=v(this.entries,(function(t){return t[0]===e}));return~t&&m(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,r,n){var l=e((function(e,i){c(e,h),p(e,{type:t,id:S++,frozen:void 0}),null!=i&&u(i,e[n],{that:e,AS_ENTRIES:r})})),h=l.prototype,g=f(t),v=function(e,t,r){var n=g(e),i=o(a(t),!0);return!0===i?E(n).set(t,r):i[n.id]=r,e};return i(h,{delete:function(e){var t=g(this);if(!s(e))return!1;var r=o(e);return!0===r?E(t).delete(e):r&&d(r,t.id)&&delete r[t.id]},has:function(e){var t=g(this);if(!s(e))return!1;var r=o(e);return!0===r?E(t).has(e):r&&d(r,t.id)}}),i(h,r?{get:function(e){var t=g(this);if(s(e)){var r=o(e);return!0===r?E(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),l}}},7710:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(1702),a=r(4705),s=r(1320),c=r(2423),u=r(408),l=r(5787),d=r(614),h=r(111),p=r(7293),f=r(7072),g=r(8003),v=r(9587);e.exports=function(e,t,r){var m=-1!==e.indexOf("Map"),S=-1!==e.indexOf("Weak"),E=m?"set":"add",y=i[e],_=y&&y.prototype,T=y,R={},b=function(e){var t=o(_[e]);s(_,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return S&&!h(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(S&&!h(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(a(e,!d(y)||!(S||_.forEach&&!p((function(){(new y).entries().next()})))))T=r.getConstructor(t,e,m,E),c.enable();else if(a(e,!0)){var w=new T,A=w[E](S?{}:-0,1)!=w,C=p((function(){w.has(1)})),I=f((function(e){new y(e)})),O=!S&&p((function(){for(var e=new y,t=5;t--;)e[E](t,t);return!e.has(-0)}));I||((T=t((function(e,t){l(e,_);var r=v(new y,e,T);return null!=t&&u(t,r[E],{that:r,AS_ENTRIES:m}),r}))).prototype=_,_.constructor=T),(C||O)&&(b("delete"),b("has"),m&&b("get")),(O||A)&&b(E),S&&_.clear&&delete _.clear}return R[e]=T,n({global:!0,forced:T!=y},R),g(T,e),S||r.setStrong(T,e,m),T}},9920:(e,t,r)=>{var n=r(2597),i=r(3887),o=r(1236),a=r(3070);e.exports=function(e,t,r){for(var s=i(t),c=a.f,u=o.f,l=0;l<s.length;l++){var d=s[l];n(e,d)||r&&n(r,d)||c(e,d,u(t,d))}}},4964:(e,t,r)=>{var n=r(5112)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},8544:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:(e,t,r)=>{"use strict";var n=r(3383).IteratorPrototype,i=r(30),o=r(9114),a=r(8003),s=r(7497),c=function(){return this};e.exports=function(e,t,r,u){var l=t+" Iterator";return e.prototype=i(n,{next:o(+!u,r)}),a(e,l,!1,!0),s[l]=c,e}},8880:(e,t,r)=>{var n=r(9781),i=r(3070),o=r(9114);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},9114:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6135:(e,t,r)=>{"use strict";var n=r(4948),i=r(3070),o=r(9114);e.exports=function(e,t,r){var a=n(t);a in e?i.f(e,a,o(0,r)):e[a]=r}},8709:(e,t,r)=>{"use strict";var n=r(7854),i=r(9670),o=r(2140),a=n.TypeError;e.exports=function(e){if(i(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw a("Incorrect hint");return o(this,e)}},654:(e,t,r)=>{"use strict";var n=r(2109),i=r(6916),o=r(1913),a=r(6530),s=r(614),c=r(4994),u=r(9518),l=r(7674),d=r(8003),h=r(8880),p=r(1320),f=r(5112),g=r(7497),v=r(3383),m=a.PROPER,S=a.CONFIGURABLE,E=v.IteratorPrototype,y=v.BUGGY_SAFARI_ITERATORS,_=f("iterator"),T="keys",R="values",b="entries",w=function(){return this};e.exports=function(e,t,r,a,f,v,A){c(r,t,a);var C,I,O,P=function(e){if(e===f&&L)return L;if(!y&&e in M)return M[e];switch(e){case T:case R:case b:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",k=!1,M=e.prototype,D=M[_]||M["@@iterator"]||f&&M[f],L=!y&&D||P(f),x="Array"==t&&M.entries||D;if(x&&(C=u(x.call(new e)))!==Object.prototype&&C.next&&(o||u(C)===E||(l?l(C,E):s(C[_])||p(C,_,w)),d(C,N,!0,!0),o&&(g[N]=w)),m&&f==R&&D&&D.name!==R&&(!o&&S?h(M,"name",R):(k=!0,L=function(){return i(D,this)})),f)if(I={values:P(R),keys:v?L:P(T),entries:P(b)},A)for(O in I)(y||k||!(O in M))&&p(M,O,I[O]);else n({target:t,proto:!0,forced:y||k},I);return o&&!A||M[_]===L||p(M,_,L,{name:f}),g[t]=L,I}},7235:(e,t,r)=>{var n=r(857),i=r(2597),o=r(6061),a=r(3070).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},9781:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:(e,t,r)=>{var n=r(7854),i=r(111),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},8324:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(e,t,r)=>{var n=r(317)("span").classList,i=n&&n.constructor&&n.constructor.prototype;e.exports=i===Object.prototype?void 0:i},8886:(e,t,r)=>{var n=r(8113).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},7871:e=>{e.exports="object"==typeof window},256:(e,t,r)=>{var n=r(8113);e.exports=/MSIE|Trident/.test(n)},1528:(e,t,r)=>{var n=r(8113),i=r(7854);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},6833:(e,t,r)=>{var n=r(8113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},5268:(e,t,r)=>{var n=r(4326),i=r(7854);e.exports="process"==n(i.process)},1036:(e,t,r)=>{var n=r(8113);e.exports=/web0s(?!.*chrome)/i.test(n)},8113:(e,t,r)=>{var n=r(5005);e.exports=n("navigator","userAgent")||""},7392:(e,t,r)=>{var n,i,o=r(7854),a=r(8113),s=o.process,c=o.Deno,u=s&&s.versions||c&&c.version,l=u&&u.v8;l&&(i=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},8008:(e,t,r)=>{var n=r(8113).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},748:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(e,t,r)=>{var n=r(7854),i=r(1236).f,o=r(8880),a=r(1320),s=r(3505),c=r(9920),u=r(4705);e.exports=function(e,t){var r,l,d,h,p,f=e.target,g=e.global,v=e.stat;if(r=g?n:v?n[f]||s(f,{}):(n[f]||{}).prototype)for(l in t){if(h=t[l],d=e.noTargetGet?(p=i(r,l))&&p.value:r[l],!u(g?l:f+(v?".":"#")+l,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;c(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),a(r,l,h,e)}}},7293:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},7007:(e,t,r)=>{"use strict";r(4916);var n=r(1702),i=r(1320),o=r(2261),a=r(7293),s=r(5112),c=r(8880),u=s("species"),l=RegExp.prototype;e.exports=function(e,t,r,d){var h=s(e),p=!a((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),f=p&&!a((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[u]=function(){return r},r.flags="",r[h]=/./[h]),r.exec=function(){return t=!0,null},r[h](""),!t}));if(!p||!f||r){var g=n(/./[h]),v=t(h,""[e],(function(e,t,r,i,a){var s=n(e),c=t.exec;return c===o||c===l.exec?p&&!a?{done:!0,value:g(t,r,i)}:{done:!0,value:s(r,t,i)}:{done:!1}}));i(String.prototype,e,v[0]),i(l,h,v[1])}d&&c(l[h],"sham",!0)}},6677:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},2104:(e,t,r)=>{var n=r(4374),i=Function.prototype,o=i.apply,a=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?a.bind(o):function(){return a.apply(o,arguments)})},9974:(e,t,r)=>{var n=r(1702),i=r(9662),o=r(4374),a=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},4374:(e,t,r)=>{var n=r(7293);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},7065:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(9662),a=r(111),s=r(2597),c=r(206),u=r(4374),l=n.Function,d=i([].concat),h=i([].join),p={},f=function(e,t,r){if(!s(p,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";p[t]=l("C,a","return new C("+h(n,",")+")")}return p[t](e,r)};e.exports=u?l.bind:function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=d(n,c(arguments));return this instanceof i?f(t,r.length,r):t.apply(e,r)};return a(r)&&(i.prototype=r),i}},6916:(e,t,r)=>{var n=r(4374),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},6530:(e,t,r)=>{var n=r(9781),i=r(2597),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=i(o,"name"),c=s&&"something"===function(){}.name,u=s&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:c,CONFIGURABLE:u}},1702:(e,t,r)=>{var n=r(4374),i=Function.prototype,o=i.bind,a=i.call,s=n&&o.bind(a,a);e.exports=n?function(e){return e&&s(e)}:function(e){return e&&function(){return a.apply(e,arguments)}}},5005:(e,t,r)=>{var n=r(7854),i=r(614),o=function(e){return i(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e]):n[e]&&n[e][t]}},1246:(e,t,r)=>{var n=r(648),i=r(8173),o=r(7497),a=r(5112)("iterator");e.exports=function(e){if(null!=e)return i(e,a)||i(e,"@@iterator")||o[n(e)]}},8554:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9662),a=r(9670),s=r(6330),c=r(1246),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return a(i(r,e));throw u(s(e)+" is not iterable")}},8173:(e,t,r)=>{var n=r(9662);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},647:(e,t,r)=>{var n=r(1702),i=r(7908),o=Math.floor,a=n("".charAt),s=n("".replace),c=n("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,d,h){var p=r+e.length,f=n.length,g=l;return void 0!==d&&(d=i(d),g=u),s(h,g,(function(i,s){var u;switch(a(s,0)){case"$":return"$";case"&":return e;case"`":return c(t,0,r);case"'":return c(t,p);case"<":u=d[c(s,1,-1)];break;default:var l=+s;if(0===l)return i;if(l>f){var h=o(l/10);return 0===h?i:h<=f?void 0===n[h-1]?a(s,1):n[h-1]+a(s,1):i}u=n[l-1]}return void 0===u?"":u}))}},7854:(e,t,r)=>{var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},2597:(e,t,r)=>{var n=r(1702),i=r(7908),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},3501:e=>{e.exports={}},842:(e,t,r)=>{var n=r(7854);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},490:(e,t,r)=>{var n=r(5005);e.exports=n("document","documentElement")},4664:(e,t,r)=>{var n=r(9781),i=r(7293),o=r(317);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},1179:(e,t,r)=>{var n=r(7854).Array,i=Math.abs,o=Math.pow,a=Math.floor,s=Math.log,c=Math.LN2;e.exports={pack:function(e,t,r){var u,l,d,h=n(r),p=8*r-t-1,f=(1<<p)-1,g=f>>1,v=23===t?o(2,-24)-o(2,-77):0,m=e<0||0===e&&1/e<0?1:0,S=0;for((e=i(e))!=e||e===1/0?(l=e!=e?1:0,u=f):(u=a(s(e)/c),e*(d=o(2,-u))<1&&(u--,d*=2),(e+=u+g>=1?v/d:v*o(2,1-g))*d>=2&&(u++,d/=2),u+g>=f?(l=0,u=f):u+g>=1?(l=(e*d-1)*o(2,t),u+=g):(l=e*o(2,g-1)*o(2,t),u=0));t>=8;)h[S++]=255&l,l/=256,t-=8;for(u=u<<t|l,p+=t;p>0;)h[S++]=255&u,u/=256,p-=8;return h[--S]|=128*m,h},unpack:function(e,t){var r,n=e.length,i=8*n-t-1,a=(1<<i)-1,s=a>>1,c=i-7,u=n-1,l=e[u--],d=127&l;for(l>>=7;c>0;)d=256*d+e[u--],c-=8;for(r=d&(1<<-c)-1,d>>=-c,c+=t;c>0;)r=256*r+e[u--],c-=8;if(0===d)d=1-s;else{if(d===a)return r?NaN:l?-1/0:1/0;r+=o(2,t),d-=s}return(l?-1:1)*r*o(2,d-t)}}},8361:(e,t,r)=>{var n=r(7854),i=r(1702),o=r(7293),a=r(4326),s=n.Object,c=i("".split);e.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"==a(e)?c(e,""):s(e)}:s},9587:(e,t,r)=>{var n=r(614),i=r(111),o=r(7674);e.exports=function(e,t,r){var a,s;return o&&n(a=t.constructor)&&a!==r&&i(s=a.prototype)&&s!==r.prototype&&o(e,s),e}},2788:(e,t,r)=>{var n=r(1702),i=r(614),o=r(5465),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},2423:(e,t,r)=>{var n=r(2109),i=r(1702),o=r(3501),a=r(111),s=r(2597),c=r(3070).f,u=r(8006),l=r(1156),d=r(2050),h=r(9711),p=r(6677),f=!1,g=h("meta"),v=0,m=function(e){c(e,g,{value:{objectID:"O"+v++,weakData:{}}})},S=e.exports={enable:function(){S.enable=function(){},f=!0;var e=u.f,t=i([].splice),r={};r[g]=1,e(r).length&&(u.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===g){t(n,i,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:l.f}))},fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,g)){if(!d(e))return"F";if(!t)return"E";m(e)}return e[g].objectID},getWeakData:function(e,t){if(!s(e,g)){if(!d(e))return!0;if(!t)return!1;m(e)}return e[g].weakData},onFreeze:function(e){return p&&f&&d(e)&&!s(e,g)&&m(e),e}};o[g]=!0},9909:(e,t,r)=>{var n,i,o,a=r(8536),s=r(7854),c=r(1702),u=r(111),l=r(8880),d=r(2597),h=r(5465),p=r(6200),f=r(3501),g="Object already initialized",v=s.TypeError,m=s.WeakMap;if(a||h.state){var S=h.state||(h.state=new m),E=c(S.get),y=c(S.has),_=c(S.set);n=function(e,t){if(y(S,e))throw new v(g);return t.facade=e,_(S,e,t),t},i=function(e){return E(S,e)||{}},o=function(e){return y(S,e)}}else{var T=p("state");f[T]=!0,n=function(e,t){if(d(e,T))throw new v(g);return t.facade=e,l(e,T,t),t},i=function(e){return d(e,T)?e[T]:{}},o=function(e){return d(e,T)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw v("Incompatible receiver, "+e+" required");return r}}}},7659:(e,t,r)=>{var n=r(5112),i=r(7497),o=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},3157:(e,t,r)=>{var n=r(4326);e.exports=Array.isArray||function(e){return"Array"==n(e)}},614:e=>{e.exports=function(e){return"function"==typeof e}},4411:(e,t,r)=>{var n=r(1702),i=r(7293),o=r(614),a=r(648),s=r(5005),c=r(2788),u=function(){},l=[],d=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=n(h.exec),f=!h.exec(u),g=function(e){if(!o(e))return!1;try{return d(u,l,e),!0}catch(e){return!1}},v=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};v.sham=!0,e.exports=!d||i((function(){var e;return g(g.call)||!g(Object)||!g((function(){e=!0}))||e}))?v:g},4705:(e,t,r)=>{var n=r(7293),i=r(614),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r==l||r!=u&&(i(t)?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},u=a.NATIVE="N",l=a.POLYFILL="P";e.exports=a},5988:(e,t,r)=>{var n=r(111),i=Math.floor;e.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&i(e)===e}},111:(e,t,r)=>{var n=r(614);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},1913:e=>{e.exports=!1},7850:(e,t,r)=>{var n=r(111),i=r(4326),o=r(5112)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},2190:(e,t,r)=>{var n=r(7854),i=r(5005),o=r(614),a=r(7976),s=r(3307),c=n.Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&a(t.prototype,c(e))}},408:(e,t,r)=>{var n=r(7854),i=r(9974),o=r(6916),a=r(9670),s=r(6330),c=r(7659),u=r(6244),l=r(7976),d=r(8554),h=r(1246),p=r(9212),f=n.TypeError,g=function(e,t){this.stopped=e,this.result=t},v=g.prototype;e.exports=function(e,t,r){var n,m,S,E,y,_,T,R=r&&r.that,b=!(!r||!r.AS_ENTRIES),w=!(!r||!r.IS_ITERATOR),A=!(!r||!r.INTERRUPTED),C=i(t,R),I=function(e){return n&&p(n,"normal",e),new g(!0,e)},O=function(e){return b?(a(e),A?C(e[0],e[1],I):C(e[0],e[1])):A?C(e,I):C(e)};if(w)n=e;else{if(!(m=h(e)))throw f(s(e)+" is not iterable");if(c(m)){for(S=0,E=u(e);E>S;S++)if((y=O(e[S]))&&l(v,y))return y;return new g(!1)}n=d(e,m)}for(_=n.next;!(T=o(_,n)).done;){try{y=O(T.value)}catch(e){p(n,"throw",e)}if("object"==typeof y&&y&&l(v,y))return y}return new g(!1)}},9212:(e,t,r)=>{var n=r(6916),i=r(9670),o=r(8173);e.exports=function(e,t,r){var a,s;i(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=n(a,e)}catch(e){s=!0,a=e}if("throw"===t)throw r;if(s)throw a;return i(a),r}},3383:(e,t,r)=>{"use strict";var n,i,o,a=r(7293),s=r(614),c=r(30),u=r(9518),l=r(1320),d=r(5112),h=r(1913),p=d("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):f=!0),null==n||a((function(){var e={};return n[p].call(e)!==e}))?n={}:h&&(n=c(n)),s(n[p])||l(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},7497:e=>{e.exports={}},6244:(e,t,r)=>{var n=r(7466);e.exports=function(e){return n(e.length)}},5948:(e,t,r)=>{var n,i,o,a,s,c,u,l,d=r(7854),h=r(9974),p=r(1236).f,f=r(261).set,g=r(6833),v=r(1528),m=r(1036),S=r(5268),E=d.MutationObserver||d.WebKitMutationObserver,y=d.document,_=d.process,T=d.Promise,R=p(d,"queueMicrotask"),b=R&&R.value;b||(n=function(){var e,t;for(S&&(e=_.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():o=void 0,e}}o=void 0,e&&e.enter()},g||S||m||!E||!y?!v&&T&&T.resolve?((u=T.resolve(void 0)).constructor=T,l=h(u.then,u),a=function(){l(n)}):S?a=function(){_.nextTick(n)}:(f=h(f,d),a=function(){f(n)}):(s=!0,c=y.createTextNode(""),new E(n).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=b||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,a()),o=t}},3366:(e,t,r)=>{var n=r(7854);e.exports=n.Promise},133:(e,t,r)=>{var n=r(7392),i=r(7293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},590:(e,t,r)=>{var n=r(7293),i=r(5112),o=r(1913),a=i("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),o&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host}))},8536:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2788),a=n.WeakMap;e.exports=i(a)&&/native code/.test(o(a))},8523:(e,t,r)=>{"use strict";var n=r(9662),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},3929:(e,t,r)=>{var n=r(7854),i=r(7850),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},3009:(e,t,r)=>{var n=r(7854),i=r(7293),o=r(1702),a=r(1340),s=r(3111).trim,c=r(1361),u=n.parseInt,l=n.Symbol,d=l&&l.iterator,h=/^[+-]?0x/i,p=o(h.exec),f=8!==u(c+"08")||22!==u(c+"0x16")||d&&!i((function(){u(Object(d))}));e.exports=f?function(e,t){var r=s(a(e));return u(r,t>>>0||(p(h,r)?16:10))}:u},1574:(e,t,r)=>{"use strict";var n=r(9781),i=r(1702),o=r(6916),a=r(7293),s=r(1956),c=r(5181),u=r(5296),l=r(7908),d=r(8361),h=Object.assign,p=Object.defineProperty,f=i([].concat);e.exports=!h||a((function(){if(n&&1!==h({b:1},h(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!=h({},e)[r]||s(h({},t)).join("")!=i}))?function(e,t){for(var r=l(e),i=arguments.length,a=1,h=c.f,p=u.f;i>a;)for(var g,v=d(arguments[a++]),m=h?f(s(v),h(v)):s(v),S=m.length,E=0;S>E;)g=m[E++],n&&!o(p,v,g)||(r[g]=v[g]);return r}:h},30:(e,t,r)=>{var n,i=r(9670),o=r(6048),a=r(748),s=r(3501),c=r(490),u=r(317),l=r(6200),d="prototype",h="script",p=l("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},v=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&n?v(n):(t=u("iframe"),r="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):v(n);for(var i=a.length;i--;)delete m[d][a[i]];return m()};s[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[d]=i(e),r=new f,f[d]=null,r[p]=e):r=m(),void 0===t?r:o.f(r,t)}},6048:(e,t,r)=>{var n=r(9781),i=r(3353),o=r(3070),a=r(9670),s=r(5656),c=r(1956);t.f=n&&!i?Object.defineProperties:function(e,t){a(e);for(var r,n=s(t),i=c(t),u=i.length,l=0;u>l;)o.f(e,r=i[l++],n[r]);return e}},3070:(e,t,r)=>{var n=r(7854),i=r(9781),o=r(4664),a=r(3353),s=r(9670),c=r(4948),u=n.TypeError,l=Object.defineProperty,d=Object.getOwnPropertyDescriptor,h="enumerable",p="configurable",f="writable";t.f=i?a?function(e,t,r){if(s(e),t=c(t),s(r),"function"==typeof e&&"prototype"===t&&"value"in r&&f in r&&!r[f]){var n=d(e,t);n&&n[f]&&(e[t]=r.value,r={configurable:p in r?r[p]:n[p],enumerable:h in r?r[h]:n[h],writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(s(e),t=c(t),s(r),o)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},1236:(e,t,r)=>{var n=r(9781),i=r(6916),o=r(5296),a=r(9114),s=r(5656),c=r(4948),u=r(2597),l=r(4664),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=s(e),t=c(t),l)try{return d(e,t)}catch(e){}if(u(e,t))return a(!i(o.f,e,t),e[t])}},1156:(e,t,r)=>{var n=r(4326),i=r(5656),o=r(8006).f,a=r(1589),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return a(s)}}(e):o(i(e))}},8006:(e,t,r)=>{var n=r(6324),i=r(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},5181:(e,t)=>{t.f=Object.getOwnPropertySymbols},9518:(e,t,r)=>{var n=r(7854),i=r(2597),o=r(614),a=r(7908),s=r(6200),c=r(8544),u=s("IE_PROTO"),l=n.Object,d=l.prototype;e.exports=c?l.getPrototypeOf:function(e){var t=a(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof l?d:null}},2050:(e,t,r)=>{var n=r(7293),i=r(111),o=r(4326),a=r(7556),s=Object.isExtensible,c=n((function(){s(1)}));e.exports=c||a?function(e){return!!i(e)&&(!a||"ArrayBuffer"!=o(e))&&(!s||s(e))}:s},7976:(e,t,r)=>{var n=r(1702);e.exports=n({}.isPrototypeOf)},6324:(e,t,r)=>{var n=r(1702),i=r(2597),o=r(5656),a=r(1318).indexOf,s=r(3501),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,l=[];for(r in n)!i(s,r)&&i(n,r)&&c(l,r);for(;t.length>u;)i(n,r=t[u++])&&(~a(l,r)||c(l,r));return l}},1956:(e,t,r)=>{var n=r(6324),i=r(748);e.exports=Object.keys||function(e){return n(e,i)}},5296:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},7674:(e,t,r)=>{var n=r(1702),i=r(9670),o=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},4699:(e,t,r)=>{var n=r(9781),i=r(1702),o=r(1956),a=r(5656),s=i(r(5296).f),c=i([].push),u=function(e){return function(t){for(var r,i=a(t),u=o(i),l=u.length,d=0,h=[];l>d;)r=u[d++],n&&!s(i,r)||c(h,e?[r,i[r]]:i[r]);return h}};e.exports={entries:u(!0),values:u(!1)}},288:(e,t,r)=>{"use strict";var n=r(1694),i=r(648);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},2140:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(614),a=r(111),s=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!a(n=i(r,e)))return n;if(o(r=e.valueOf)&&!a(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!a(n=i(r,e)))return n;throw s("Can't convert object to primitive value")}},3887:(e,t,r)=>{var n=r(5005),i=r(1702),o=r(8006),a=r(5181),s=r(9670),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},857:(e,t,r)=>{var n=r(7854);e.exports=n},2534:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},9478:(e,t,r)=>{var n=r(9670),i=r(111),o=r(8523);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},8572:e=>{var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},2248:(e,t,r)=>{var n=r(1320);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},1320:(e,t,r)=>{var n=r(7854),i=r(614),o=r(2597),a=r(8880),s=r(3505),c=r(2788),u=r(9909),l=r(6530).CONFIGURABLE,d=u.get,h=u.enforce,p=String(String).split("String");(e.exports=function(e,t,r,c){var u,d=!!c&&!!c.unsafe,f=!!c&&!!c.enumerable,g=!!c&&!!c.noTargetGet,v=c&&void 0!==c.name?c.name:t;i(r)&&("Symbol("===String(v).slice(0,7)&&(v="["+String(v).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(r,"name")||l&&r.name!==v)&&a(r,"name",v),(u=h(r)).source||(u.source=p.join("string"==typeof v?v:""))),e!==n?(d?!g&&e[t]&&(f=!0):delete e[t],f?e[t]=r:a(e,t,r)):f?e[t]=r:s(t,r)})(Function.prototype,"toString",(function(){return i(this)&&d(this).source||c(this)}))},7651:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(9670),a=r(614),s=r(4326),c=r(2261),u=n.TypeError;e.exports=function(e,t){var r=e.exec;if(a(r)){var n=i(r,e,t);return null!==n&&o(n),n}if("RegExp"===s(e))return i(c,e,t);throw u("RegExp#exec called on incompatible receiver")}},2261:(e,t,r)=>{"use strict";var n,i,o=r(6916),a=r(1702),s=r(1340),c=r(7066),u=r(2999),l=r(2309),d=r(30),h=r(9909).get,p=r(9441),f=r(7168),g=l("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,m=v,S=a("".charAt),E=a("".indexOf),y=a("".replace),_=a("".slice),T=(i=/b*/g,o(v,n=/a/,"a"),o(v,i,"a"),0!==n.lastIndex||0!==i.lastIndex),R=u.BROKEN_CARET,b=void 0!==/()??/.exec("")[1];(T||b||R||p||f)&&(m=function(e){var t,r,n,i,a,u,l,p=this,f=h(p),w=s(e),A=f.raw;if(A)return A.lastIndex=p.lastIndex,t=o(m,A,w),p.lastIndex=A.lastIndex,t;var C=f.groups,I=R&&p.sticky,O=o(c,p),P=p.source,N=0,k=w;if(I&&(O=y(O,"y",""),-1===E(O,"g")&&(O+="g"),k=_(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==S(w,p.lastIndex-1))&&(P="(?: "+P+")",k=" "+k,N++),r=new RegExp("^(?:"+P+")",O)),b&&(r=new RegExp("^"+P+"$(?!\\s)",O)),T&&(n=p.lastIndex),i=o(v,I?r:p,k),I?i?(i.input=_(i.input,N),i[0]=_(i[0],N),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:T&&i&&(p.lastIndex=p.global?i.index+i[0].length:n),b&&i&&i.length>1&&o(g,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&C)for(i.groups=u=d(null),a=0;a<C.length;a++)u[(l=C[a])[0]]=i[l[1]];return i}),e.exports=m},7066:(e,t,r)=>{"use strict";var n=r(9670);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},2999:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp,o=n((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),a=o||n((function(){return!i("a","y").sticky})),s=o||n((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:s,MISSED_STICKY:a,UNSUPPORTED_Y:o}},9441:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:(e,t,r)=>{var n=r(7293),i=r(7854).RegExp;e.exports=n((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},4488:(e,t,r)=>{var n=r(7854).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},1150:e=>{e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},3505:(e,t,r)=>{var n=r(7854),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},6340:(e,t,r)=>{"use strict";var n=r(5005),i=r(3070),o=r(5112),a=r(9781),s=o("species");e.exports=function(e){var t=n(e),r=i.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},8003:(e,t,r)=>{var n=r(3070).f,i=r(2597),o=r(5112)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!i(e,o)&&n(e,o,{configurable:!0,value:t})}},6200:(e,t,r)=>{var n=r(2309),i=r(9711),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},5465:(e,t,r)=>{var n=r(7854),i=r(3505),o="__core-js_shared__",a=n[o]||i(o,{});e.exports=a},2309:(e,t,r)=>{var n=r(1913),i=r(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:n?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},6707:(e,t,r)=>{var n=r(9670),i=r(9483),o=r(5112)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},8710:(e,t,r)=>{var n=r(1702),i=r(9303),o=r(1340),a=r(4488),s=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,d=o(a(t)),h=i(r),p=d.length;return h<0||h>=p?e?"":void 0:(n=c(d,h))<55296||n>56319||h+1===p||(l=c(d,h+1))<56320||l>57343?e?s(d,h):n:e?u(d,h,h+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},4986:(e,t,r)=>{var n=r(8113);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},6650:(e,t,r)=>{var n=r(1702),i=r(7466),o=r(1340),a=r(8415),s=r(4488),c=n(a),u=n("".slice),l=Math.ceil,d=function(e){return function(t,r,n){var a,d,h=o(s(t)),p=i(r),f=h.length,g=void 0===n?" ":o(n);return p<=f||""==g?h:((d=c(g,l((a=p-f)/g.length))).length>a&&(d=u(d,0,a)),e?h+d:d+h)}};e.exports={start:d(!1),end:d(!0)}},3197:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=2147483647,a=/[^\0-\u007E]/,s=/[.\u3002\uFF0E\uFF61]/g,c="Overflow: input needs wider integers to process",u=n.RangeError,l=i(s.exec),d=Math.floor,h=String.fromCharCode,p=i("".charCodeAt),f=i([].join),g=i([].push),v=i("".replace),m=i("".split),S=i("".toLowerCase),E=function(e){return e+22+75*(e<26)},y=function(e,t,r){var n=0;for(e=r?d(e/700):e>>1,e+=d(e/t);e>455;)e=d(e/35),n+=36;return d(n+36*e/(e+38))},_=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=p(e,r++);if(i>=55296&&i<=56319&&r<n){var o=p(e,r++);56320==(64512&o)?g(t,((1023&i)<<10)+(1023&o)+65536):(g(t,i),r--)}else g(t,i)}return t}(e);var r,n,i=e.length,a=128,s=0,l=72;for(r=0;r<e.length;r++)(n=e[r])<128&&g(t,h(n));var v=t.length,m=v;for(v&&g(t,"-");m<i;){var S=o;for(r=0;r<e.length;r++)(n=e[r])>=a&&n<S&&(S=n);var _=m+1;if(S-a>d((o-s)/_))throw u(c);for(s+=(S-a)*_,a=S,r=0;r<e.length;r++){if((n=e[r])<a&&++s>o)throw u(c);if(n==a){for(var T=s,R=36;;){var b=R<=l?1:R>=l+26?26:R-l;if(T<b)break;var w=T-b,A=36-b;g(t,h(E(b+w%A))),T=d(w/A),R+=36}g(t,h(E(T))),l=y(s,_,m==v),s=0,m++}}s++,a++}return f(t,"")};e.exports=function(e){var t,r,n=[],i=m(v(S(e),s,"."),".");for(t=0;t<i.length;t++)r=i[t],g(n,l(a,r)?"xn--"+_(r):r);return f(n,".")}},8415:(e,t,r)=>{"use strict";var n=r(7854),i=r(9303),o=r(1340),a=r(4488),s=n.RangeError;e.exports=function(e){var t=o(a(this)),r="",n=i(e);if(n<0||n==1/0)throw s("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r}},6091:(e,t,r)=>{var n=r(6530).PROPER,i=r(7293),o=r(1361);e.exports=function(e){return i((function(){return!!o[e]()||"​᠎"!=="​᠎"[e]()||n&&o[e].name!==e}))}},3111:(e,t,r)=>{var n=r(1702),i=r(4488),o=r(1340),a=r(1361),s=n("".replace),c="["+a+"]",u=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),d=function(e){return function(t){var r=o(i(t));return 1&e&&(r=s(r,u,"")),2&e&&(r=s(r,l,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},261:(e,t,r)=>{var n,i,o,a,s=r(7854),c=r(2104),u=r(9974),l=r(614),d=r(2597),h=r(7293),p=r(490),f=r(206),g=r(317),v=r(8053),m=r(6833),S=r(5268),E=s.setImmediate,y=s.clearImmediate,_=s.process,T=s.Dispatch,R=s.Function,b=s.MessageChannel,w=s.String,A=0,C={},I="onreadystatechange";try{n=s.location}catch(e){}var O=function(e){if(d(C,e)){var t=C[e];delete C[e],t()}},P=function(e){return function(){O(e)}},N=function(e){O(e.data)},k=function(e){s.postMessage(w(e),n.protocol+"//"+n.host)};E&&y||(E=function(e){v(arguments.length,1);var t=l(e)?e:R(e),r=f(arguments,1);return C[++A]=function(){c(t,void 0,r)},i(A),A},y=function(e){delete C[e]},S?i=function(e){_.nextTick(P(e))}:T&&T.now?i=function(e){T.now(P(e))}:b&&!m?(a=(o=new b).port2,o.port1.onmessage=N,i=u(a.postMessage,a)):s.addEventListener&&l(s.postMessage)&&!s.importScripts&&n&&"file:"!==n.protocol&&!h(k)?(i=k,s.addEventListener("message",N,!1)):i=I in g("script")?function(e){p.appendChild(g("script"))[I]=function(){p.removeChild(this),O(e)}}:function(e){setTimeout(P(e),0)}),e.exports={set:E,clear:y}},863:(e,t,r)=>{var n=r(1702);e.exports=n(1..valueOf)},1400:(e,t,r)=>{var n=r(9303),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},7067:(e,t,r)=>{var n=r(7854),i=r(9303),o=r(7466),a=n.RangeError;e.exports=function(e){if(void 0===e)return 0;var t=i(e),r=o(t);if(t!==r)throw a("Wrong length or index");return r}},5656:(e,t,r)=>{var n=r(8361),i=r(4488);e.exports=function(e){return n(i(e))}},9303:e=>{var t=Math.ceil,r=Math.floor;e.exports=function(e){var n=+e;return n!=n||0===n?0:(n>0?r:t)(n)}},7466:(e,t,r)=>{var n=r(9303),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},7908:(e,t,r)=>{var n=r(7854),i=r(4488),o=n.Object;e.exports=function(e){return o(i(e))}},4590:(e,t,r)=>{var n=r(7854),i=r(3002),o=n.RangeError;e.exports=function(e,t){var r=i(e);if(r%t)throw o("Wrong offset");return r}},3002:(e,t,r)=>{var n=r(7854),i=r(9303),o=n.RangeError;e.exports=function(e){var t=i(e);if(t<0)throw o("The argument can't be less than 0");return t}},7593:(e,t,r)=>{var n=r(7854),i=r(6916),o=r(111),a=r(2190),s=r(8173),c=r(2140),u=r(5112),l=n.TypeError,d=u("toPrimitive");e.exports=function(e,t){if(!o(e)||a(e))return e;var r,n=s(e,d);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||a(r))return r;throw l("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},4948:(e,t,r)=>{var n=r(7593),i=r(2190);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},1694:(e,t,r)=>{var n={};n[r(5112)("toStringTag")]="z",e.exports="[object z]"===String(n)},1340:(e,t,r)=>{var n=r(7854),i=r(648),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6330:(e,t,r)=>{var n=r(7854).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},9843:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(6916),a=r(9781),s=r(3832),c=r(260),u=r(3331),l=r(5787),d=r(9114),h=r(8880),p=r(5988),f=r(7466),g=r(7067),v=r(4590),m=r(4948),S=r(2597),E=r(648),y=r(111),_=r(2190),T=r(30),R=r(7976),b=r(7674),w=r(8006).f,A=r(7321),C=r(2092).forEach,I=r(6340),O=r(3070),P=r(1236),N=r(9909),k=r(9587),M=N.get,D=N.set,L=O.f,x=P.f,V=Math.round,U=i.RangeError,j=u.ArrayBuffer,H=j.prototype,B=u.DataView,$=c.NATIVE_ARRAY_BUFFER_VIEWS,F=c.TYPED_ARRAY_CONSTRUCTOR,q=c.TYPED_ARRAY_TAG,W=c.TypedArray,K=c.TypedArrayPrototype,G=c.aTypedArrayConstructor,Y=c.isTypedArray,z="BYTES_PER_ELEMENT",X="Wrong length",J=function(e,t){G(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},Z=function(e,t){L(e,t,{get:function(){return M(this)[t]}})},Q=function(e){var t;return R(H,e)||"ArrayBuffer"==(t=E(e))||"SharedArrayBuffer"==t},ee=function(e,t){return Y(e)&&!_(t)&&t in e&&p(+t)&&t>=0},te=function(e,t){return t=m(t),ee(e,t)?d(2,e[t]):x(e,t)},re=function(e,t,r){return t=m(t),!(ee(e,t)&&y(r)&&S(r,"value"))||S(r,"get")||S(r,"set")||r.configurable||S(r,"writable")&&!r.writable||S(r,"enumerable")&&!r.enumerable?L(e,t,r):(e[t]=r.value,e)};a?($||(P.f=te,O.f=re,Z(K,"buffer"),Z(K,"byteOffset"),Z(K,"byteLength"),Z(K,"length")),n({target:"Object",stat:!0,forced:!$},{getOwnPropertyDescriptor:te,defineProperty:re}),e.exports=function(e,t,r){var a=e.match(/\d+$/)[0]/8,c=e+(r?"Clamped":"")+"Array",u="get"+e,d="set"+e,p=i[c],m=p,S=m&&m.prototype,E={},_=function(e,t){L(e,t,{get:function(){return function(e,t){var r=M(e);return r.view[u](t*a+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=M(e);r&&(n=(n=V(n))<0?0:n>255?255:255&n),i.view[d](t*a+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};$?s&&(m=t((function(e,t,r,n){return l(e,S),k(y(t)?Q(t)?void 0!==n?new p(t,v(r,a),n):void 0!==r?new p(t,v(r,a)):new p(t):Y(t)?J(m,t):o(A,m,t):new p(g(t)),e,m)})),b&&b(m,W),C(w(p),(function(e){e in m||h(m,e,p[e])})),m.prototype=S):(m=t((function(e,t,r,n){l(e,S);var i,s,c,u=0,d=0;if(y(t)){if(!Q(t))return Y(t)?J(m,t):o(A,m,t);i=t,d=v(r,a);var h=t.byteLength;if(void 0===n){if(h%a)throw U(X);if((s=h-d)<0)throw U(X)}else if((s=f(n)*a)+d>h)throw U(X);c=s/a}else c=g(t),i=new j(s=c*a);for(D(e,{buffer:i,byteOffset:d,byteLength:s,length:c,view:new B(i)});u<c;)_(e,u++)})),b&&b(m,W),S=m.prototype=T(K)),S.constructor!==m&&h(S,"constructor",m),h(S,F,m),q&&h(S,q,c),E[c]=m,n({global:!0,forced:m!=p,sham:!$},E),z in m||h(m,z,a),z in S||h(S,z,a),I(c)}):e.exports=function(){}},3832:(e,t,r)=>{var n=r(7854),i=r(7293),o=r(7072),a=r(260).NATIVE_ARRAY_BUFFER_VIEWS,s=n.ArrayBuffer,c=n.Int8Array;e.exports=!a||!i((function(){c(1)}))||!i((function(){new c(-1)}))||!o((function(e){new c,new c(null),new c(1.5),new c(e)}),!0)||i((function(){return 1!==new c(new s(2),1,void 0).length}))},3074:(e,t,r)=>{var n=r(7745),i=r(6304);e.exports=function(e,t){return n(i(e),t)}},7321:(e,t,r)=>{var n=r(9974),i=r(6916),o=r(9483),a=r(7908),s=r(6244),c=r(8554),u=r(1246),l=r(7659),d=r(260).aTypedArrayConstructor;e.exports=function(e){var t,r,h,p,f,g,v=o(this),m=a(e),S=arguments.length,E=S>1?arguments[1]:void 0,y=void 0!==E,_=u(m);if(_&&!l(_))for(g=(f=c(m,_)).next,m=[];!(p=i(g,f)).done;)m.push(p.value);for(y&&S>2&&(E=n(E,arguments[2])),r=s(m),h=new(d(v))(r),t=0;r>t;t++)h[t]=y?E(m[t],t):m[t];return h}},6304:(e,t,r)=>{var n=r(260),i=r(6707),o=n.TYPED_ARRAY_CONSTRUCTOR,a=n.aTypedArrayConstructor;e.exports=function(e){return a(i(e,e[o]))}},9711:(e,t,r)=>{var n=r(1702),i=0,o=Math.random(),a=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},3307:(e,t,r)=>{var n=r(133);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:(e,t,r)=>{var n=r(9781),i=r(7293);e.exports=n&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8053:(e,t,r)=>{var n=r(7854).TypeError;e.exports=function(e,t){if(e<t)throw n("Not enough arguments");return e}},6061:(e,t,r)=>{var n=r(5112);t.f=n},5112:(e,t,r)=>{var n=r(7854),i=r(2309),o=r(2597),a=r(9711),s=r(133),c=r(3307),u=i("wks"),l=n.Symbol,d=l&&l.for,h=c?l:l&&l.withoutSetter||a;e.exports=function(e){if(!o(u,e)||!s&&"string"!=typeof u[e]){var t="Symbol."+e;s&&o(l,e)?u[e]=l[e]:u[e]=c&&d?d(t):h(t)}return u[e]}},1361:e=>{e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},9575:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(7293),a=r(3331),s=r(9670),c=r(1400),u=r(7466),l=r(6707),d=a.ArrayBuffer,h=a.DataView,p=h.prototype,f=i(d.prototype.slice),g=i(p.getUint8),v=i(p.setUint8);n({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:o((function(){return!new d(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(f&&void 0===t)return f(s(this),e);for(var r=s(this).byteLength,n=c(e,r),i=c(void 0===t?r:t,r),o=new(l(this,d))(u(i-n)),a=new h(this),p=new h(o),m=0;n<i;)v(p,m++,g(a,n++));return o}})},2222:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(7293),a=r(3157),s=r(111),c=r(7908),u=r(6244),l=r(6135),d=r(5417),h=r(1194),p=r(5112),f=r(7392),g=p("isConcatSpreadable"),v=9007199254740991,m="Maximum allowed index exceeded",S=i.TypeError,E=f>=51||!o((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),y=h("concat"),_=function(e){if(!s(e))return!1;var t=e[g];return void 0!==t?!!t:a(e)};n({target:"Array",proto:!0,forced:!E||!y},{concat:function(e){var t,r,n,i,o,a=c(this),s=d(a,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(_(o=-1===t?a:arguments[t])){if(h+(i=u(o))>v)throw S(m);for(r=0;r<i;r++,h++)r in o&&l(s,h,o[r])}else{if(h>=v)throw S(m);l(s,h++,o)}return s.length=h,s}})},7327:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).filter;n({target:"Array",proto:!0,forced:!r(1194)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},9826:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).find,o=r(1223),a="find",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),n({target:"Array",proto:!0,forced:s},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(a)},9554:(e,t,r)=>{"use strict";var n=r(2109),i=r(8533);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},1038:(e,t,r)=>{var n=r(2109),i=r(8457);n({target:"Array",stat:!0,forced:!r(7072)((function(e){Array.from(e)}))},{from:i})},6699:(e,t,r)=>{"use strict";var n=r(2109),i=r(1318).includes,o=r(1223);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},2772:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(1318).indexOf,a=r(9341),s=i([].indexOf),c=!!s&&1/s([1],1,-0)<0,u=a("indexOf");n({target:"Array",proto:!0,forced:c||!u},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return c?s(this,e,t)||0:o(this,e,t)}})},9753:(e,t,r)=>{r(2109)({target:"Array",stat:!0},{isArray:r(3157)})},6992:(e,t,r)=>{"use strict";var n=r(5656),i=r(1223),o=r(7497),a=r(9909),s=r(3070).f,c=r(654),u=r(1913),l=r(9781),d="Array Iterator",h=a.set,p=a.getterFor(d);e.exports=c(Array,"Array",(function(e,t){h(this,{type:d,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var f=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!u&&l&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}},9600:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(8361),a=r(5656),s=r(9341),c=i([].join),u=o!=Object,l=s("join",",");n({target:"Array",proto:!0,forced:u||!l},{join:function(e){return c(a(this),void 0===e?",":e)}})},5827:(e,t,r)=>{"use strict";var n=r(2109),i=r(3671).left,o=r(9341),a=r(7392),s=r(5268);n({target:"Array",proto:!0,forced:!o("reduce")||!s&&a>79&&a<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},7042:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(3157),a=r(4411),s=r(111),c=r(1400),u=r(6244),l=r(5656),d=r(6135),h=r(5112),p=r(1194),f=r(206),g=p("slice"),v=h("species"),m=i.Array,S=Math.max;n({target:"Array",proto:!0,forced:!g},{slice:function(e,t){var r,n,i,h=l(this),p=u(h),g=c(e,p),E=c(void 0===t?p:t,p);if(o(h)&&(r=h.constructor,(a(r)&&(r===m||o(r.prototype))||s(r)&&null===(r=r[v]))&&(r=void 0),r===m||void 0===r))return f(h,g,E);for(n=new(void 0===r?m:r)(S(E-g,0)),i=0;g<E;g++,i++)g in h&&d(n,i,h[g]);return n.length=i,n}})},5212:(e,t,r)=>{"use strict";var n=r(2109),i=r(2092).some;n({target:"Array",proto:!0,forced:!r(9341)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},561:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(1400),a=r(9303),s=r(6244),c=r(7908),u=r(5417),l=r(6135),d=r(1194)("splice"),h=i.TypeError,p=Math.max,f=Math.min,g=9007199254740991,v="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,n,i,d,m,S,E=c(this),y=s(E),_=o(e,y),T=arguments.length;if(0===T?r=n=0:1===T?(r=0,n=y-_):(r=T-2,n=f(p(a(t),0),y-_)),y+r-n>g)throw h(v);for(i=u(E,n),d=0;d<n;d++)(m=_+d)in E&&l(i,d,E[m]);if(i.length=n,r<n){for(d=_;d<y-n;d++)S=d+r,(m=d+n)in E?E[S]=E[m]:delete E[S];for(d=y;d>y-n+r;d--)delete E[d-1]}else if(r>n)for(d=y-n;d>_;d--)S=d+r-1,(m=d+n-1)in E?E[S]=E[m]:delete E[S];for(d=0;d<r;d++)E[d+_]=arguments[d+2];return E.length=y-n+r,i}})},3843:(e,t,r)=>{var n=r(2109),i=r(7854),o=r(1702),a=i.Date,s=o(a.prototype.getTime);n({target:"Date",stat:!0},{now:function(){return s(new a)}})},6078:(e,t,r)=>{var n=r(2597),i=r(1320),o=r(8709),a=r(5112)("toPrimitive"),s=Date.prototype;n(s,a)||i(s,a,o)},3710:(e,t,r)=>{var n=r(1702),i=r(1320),o=Date.prototype,a="Invalid Date",s="toString",c=n(o[s]),u=n(o.getTime);String(new Date(NaN))!=a&&i(o,s,(function(){var e=u(this);return e==e?c(this):a}))},4812:(e,t,r)=>{var n=r(2109),i=r(7065);n({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},8309:(e,t,r)=>{var n=r(9781),i=r(6530).EXISTS,o=r(1702),a=r(3070).f,s=Function.prototype,c=o(s.toString),u=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,l=o(u.exec);n&&!i&&a(s,"name",{configurable:!0,get:function(){try{return l(u,c(this))[1]}catch(e){return""}}})},1532:(e,t,r)=>{"use strict";r(7710)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(5631))},9653:(e,t,r)=>{"use strict";var n=r(9781),i=r(7854),o=r(1702),a=r(4705),s=r(1320),c=r(2597),u=r(9587),l=r(7976),d=r(2190),h=r(7593),p=r(7293),f=r(8006).f,g=r(1236).f,v=r(3070).f,m=r(863),S=r(3111).trim,E="Number",y=i[E],_=y.prototype,T=i.TypeError,R=o("".slice),b=o("".charCodeAt),w=function(e){var t=h(e,"number");return"bigint"==typeof t?t:A(t)},A=function(e){var t,r,n,i,o,a,s,c,u=h(e,"number");if(d(u))throw T("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=S(u),43===(t=b(u,0))||45===t){if(88===(r=b(u,2))||120===r)return NaN}else if(48===t){switch(b(u,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+u}for(a=(o=R(u,2)).length,s=0;s<a;s++)if((c=b(o,s))<48||c>i)return NaN;return parseInt(o,n)}return+u};if(a(E,!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var C,I=function(e){var t=arguments.length<1?0:y(w(e)),r=this;return l(_,r)&&p((function(){m(r)}))?u(Object(t),r,I):t},O=n?f(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),P=0;O.length>P;P++)c(y,C=O[P])&&!c(I,C)&&v(I,C,g(y,C));I.prototype=_,_.constructor=I,s(i,E,I)}},3161:(e,t,r)=>{r(2109)({target:"Number",stat:!0},{isInteger:r(5988)})},9601:(e,t,r)=>{var n=r(2109),i=r(1574);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},8011:(e,t,r)=>{r(2109)({target:"Object",stat:!0,sham:!r(9781)},{create:r(30)})},3321:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(6048).f;n({target:"Object",stat:!0,forced:Object.defineProperties!==o,sham:!i},{defineProperties:o})},9070:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(3070).f;n({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!i},{defineProperty:o})},9720:(e,t,r)=>{var n=r(2109),i=r(4699).entries;n({target:"Object",stat:!0},{entries:function(e){return i(e)}})},3371:(e,t,r)=>{var n=r(2109),i=r(6677),o=r(7293),a=r(111),s=r(2423).onFreeze,c=Object.freeze;n({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!i},{freeze:function(e){return c&&a(e)?c(s(e)):e}})},5003:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(5656),a=r(1236).f,s=r(9781),c=i((function(){a(1)}));n({target:"Object",stat:!0,forced:!s||c,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(o(e),t)}})},9337:(e,t,r)=>{var n=r(2109),i=r(9781),o=r(3887),a=r(5656),s=r(1236),c=r(6135);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=a(e),i=s.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},489:(e,t,r)=>{var n=r(2109),i=r(7293),o=r(7908),a=r(9518),s=r(8544);n({target:"Object",stat:!0,forced:i((function(){a(1)})),sham:!s},{getPrototypeOf:function(e){return a(o(e))}})},3304:(e,t,r)=>{r(2109)({target:"Object",stat:!0},{is:r(1150)})},7941:(e,t,r)=>{var n=r(2109),i=r(7908),o=r(1956);n({target:"Object",stat:!0,forced:r(7293)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},8304:(e,t,r)=>{r(2109)({target:"Object",stat:!0},{setPrototypeOf:r(7674)})},1539:(e,t,r)=>{var n=r(1694),i=r(1320),o=r(288);n||i(Object.prototype,"toString",o,{unsafe:!0})},2479:(e,t,r)=>{var n=r(2109),i=r(4699).values;n({target:"Object",stat:!0},{values:function(e){return i(e)}})},1058:(e,t,r)=>{var n=r(2109),i=r(3009);n({global:!0,forced:parseInt!=i},{parseInt:i})},7727:(e,t,r)=>{"use strict";var n=r(2109),i=r(1913),o=r(3366),a=r(7293),s=r(5005),c=r(614),u=r(6707),l=r(9478),d=r(1320);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&a((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,s("Promise")),r=c(e);return this.then(r?function(r){return l(t,e()).then((function(){return r}))}:e,r?function(r){return l(t,e()).then((function(){throw r}))}:e)}}),!i&&c(o)){var h=s("Promise").prototype.finally;o.prototype.finally!==h&&d(o.prototype,"finally",h,{unsafe:!0})}},8674:(e,t,r)=>{"use strict";var n,i,o,a,s=r(2109),c=r(1913),u=r(7854),l=r(5005),d=r(6916),h=r(3366),p=r(1320),f=r(2248),g=r(7674),v=r(8003),m=r(6340),S=r(9662),E=r(614),y=r(111),_=r(5787),T=r(2788),R=r(408),b=r(7072),w=r(6707),A=r(261).set,C=r(5948),I=r(9478),O=r(842),P=r(8523),N=r(2534),k=r(8572),M=r(9909),D=r(4705),L=r(5112),x=r(7871),V=r(5268),U=r(7392),j=L("species"),H="Promise",B=M.getterFor(H),$=M.set,F=M.getterFor(H),q=h&&h.prototype,W=h,K=q,G=u.TypeError,Y=u.document,z=u.process,X=P.f,J=X,Z=!!(Y&&Y.createEvent&&u.dispatchEvent),Q=E(u.PromiseRejectionEvent),ee="unhandledrejection",te=!1,re=D(H,(function(){var e=T(W),t=e!==String(W);if(!t&&66===U)return!0;if(c&&!K.finally)return!0;if(U>=51&&/native code/.test(e))return!1;var r=new W((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[j]=n,!(te=r.then((function(){}))instanceof n)||!t&&x&&!Q})),ne=re||!b((function(e){W.all(e).catch((function(){}))})),ie=function(e){var t;return!(!y(e)||!E(t=e.then))&&t},oe=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&le(t),t.rejection=1),!0===s?r=o:(l&&l.enter(),r=s(o),l&&(l.exit(),i=!0)),r===e.promise?u(G("Promise-chain cycle")):(n=ie(r))?d(n,r,c,u):c(r)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},ae=function(e,t){e.notified||(e.notified=!0,C((function(){for(var r,n=e.reactions;r=n.get();)oe(r,e);e.notified=!1,t&&!e.rejection&&ce(e)})))},se=function(e,t,r){var n,i;Z?((n=Y.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Q&&(i=u["on"+e])?i(n):e===ee&&O("Unhandled promise rejection",r)},ce=function(e){d(A,u,(function(){var t,r=e.facade,n=e.value;if(ue(e)&&(t=N((function(){V?z.emit("unhandledRejection",n,r):se(ee,r,n)})),e.rejection=V||ue(e)?2:1,t.error))throw t.value}))},ue=function(e){return 1!==e.rejection&&!e.parent},le=function(e){d(A,u,(function(){var t=e.facade;V?z.emit("rejectionHandled",t):se("rejectionhandled",t,e.value)}))},de=function(e,t,r){return function(n){e(t,n,r)}},he=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,ae(e,!0))},pe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw G("Promise can't be resolved itself");var n=ie(t);n?C((function(){var r={done:!1};try{d(n,t,de(pe,r,e),de(he,r,e))}catch(t){he(r,t,e)}})):(e.value=t,e.state=1,ae(e,!1))}catch(t){he({done:!1},t,e)}}};if(re&&(K=(W=function(e){_(this,K),S(e),d(n,this);var t=B(this);try{e(de(pe,t),de(he,t))}catch(e){he(t,e)}}).prototype,(n=function(e){$(this,{type:H,done:!1,notified:!1,parent:!1,reactions:new k,rejection:!1,state:0,value:void 0})}).prototype=f(K,{then:function(e,t){var r=F(this),n=X(w(this,W));return r.parent=!0,n.ok=!E(e)||e,n.fail=E(t)&&t,n.domain=V?z.domain:void 0,0==r.state?r.reactions.add(n):C((function(){oe(n,r)})),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=B(e);this.promise=e,this.resolve=de(pe,t),this.reject=de(he,t)},P.f=X=function(e){return e===W||e===o?new i(e):J(e)},!c&&E(h)&&q!==Object.prototype)){a=q.then,te||(p(q,"then",(function(e,t){var r=this;return new W((function(e,t){d(a,r,e,t)})).then(e,t)}),{unsafe:!0}),p(q,"catch",K.catch,{unsafe:!0}));try{delete q.constructor}catch(e){}g&&g(q,K)}s({global:!0,wrap:!0,forced:re},{Promise:W}),v(W,H,!1,!0),m(H),o=l(H),s({target:H,stat:!0,forced:re},{reject:function(e){var t=X(this);return d(t.reject,void 0,e),t.promise}}),s({target:H,stat:!0,forced:c||re},{resolve:function(e){return I(c&&this===o?W:this,e)}}),s({target:H,stat:!0,forced:ne},{all:function(e){var t=this,r=X(t),n=r.resolve,i=r.reject,o=N((function(){var r=S(t.resolve),o=[],a=0,s=1;R(e,(function(e){var c=a++,u=!1;s++,d(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=X(t),n=r.reject,i=N((function(){var i=S(t.resolve);R(e,(function(e){d(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},2419:(e,t,r)=>{var n=r(2109),i=r(5005),o=r(2104),a=r(7065),s=r(9483),c=r(9670),u=r(111),l=r(30),d=r(7293),h=i("Reflect","construct"),p=Object.prototype,f=[].push,g=d((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),v=!d((function(){h((function(){}))})),m=g||v;n({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,t){s(e),c(t);var r=arguments.length<3?e:s(arguments[2]);if(v&&!g)return h(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return o(f,n,t),new(o(a,e,n))}var i=r.prototype,d=l(u(i)?i:p),m=o(e,d,t);return u(m)?m:d}})},4603:(e,t,r)=>{var n=r(9781),i=r(7854),o=r(1702),a=r(4705),s=r(9587),c=r(8880),u=r(3070).f,l=r(8006).f,d=r(7976),h=r(7850),p=r(1340),f=r(7066),g=r(2999),v=r(1320),m=r(7293),S=r(2597),E=r(9909).enforce,y=r(6340),_=r(5112),T=r(9441),R=r(7168),b=_("match"),w=i.RegExp,A=w.prototype,C=i.SyntaxError,I=o(f),O=o(A.exec),P=o("".charAt),N=o("".replace),k=o("".indexOf),M=o("".slice),D=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,L=/a/g,x=/a/g,V=new w(L)!==L,U=g.MISSED_STICKY,j=g.UNSUPPORTED_Y;if(a("RegExp",n&&(!V||U||T||R||m((function(){return x[b]=!1,w(L)!=L||w(x)==x||"/a/i"!=w(L,"i")}))))){for(var H=function(e,t){var r,n,i,o,a,u,l=d(A,this),f=h(e),g=void 0===t,v=[],m=e;if(!l&&f&&g&&e.constructor===H)return e;if((f||d(A,e))&&(e=e.source,g&&(t="flags"in m?m.flags:I(m))),e=void 0===e?"":p(e),t=void 0===t?"":p(t),m=e,T&&"dotAll"in L&&(n=!!t&&k(t,"s")>-1)&&(t=N(t,/s/g,"")),r=t,U&&"sticky"in L&&(i=!!t&&k(t,"y")>-1)&&j&&(t=N(t,/y/g,"")),R&&(o=function(e){for(var t,r=e.length,n=0,i="",o=[],a={},s=!1,c=!1,u=0,l="";n<=r;n++){if("\\"===(t=P(e,n)))t+=P(e,++n);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:O(D,M(e,n+1))&&(n+=2,c=!0),i+=t,u++;continue;case">"===t&&c:if(""===l||S(a,l))throw new C("Invalid capture group name");a[l]=!0,o[o.length]=[l,u],c=!1,l="";continue}c?l+=t:i+=t}return[i,o]}(e),e=o[0],v=o[1]),a=s(w(e,t),l?this:A,H),(n||i||v.length)&&(u=E(a),n&&(u.dotAll=!0,u.raw=H(function(e){for(var t,r=e.length,n=0,i="",o=!1;n<=r;n++)"\\"!==(t=P(e,n))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+P(e,++n);return i}(e),r)),i&&(u.sticky=!0),v.length&&(u.groups=v)),e!==m)try{c(a,"source",""===m?"(?:)":m)}catch(e){}return a},B=function(e){e in H||u(H,e,{configurable:!0,get:function(){return w[e]},set:function(t){w[e]=t}})},$=l(w),F=0;$.length>F;)B($[F++]);A.constructor=H,H.prototype=A,v(i,"RegExp",H)}y("RegExp")},4916:(e,t,r)=>{"use strict";var n=r(2109),i=r(2261);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},9714:(e,t,r)=>{"use strict";var n=r(1702),i=r(6530).PROPER,o=r(1320),a=r(9670),s=r(7976),c=r(1340),u=r(7293),l=r(7066),d="toString",h=RegExp.prototype,p=h[d],f=n(l),g=u((function(){return"/a/b"!=p.call({source:"a",flags:"b"})})),v=i&&p.name!=d;(g||v)&&o(RegExp.prototype,d,(function(){var e=a(this),t=c(e.source),r=e.flags;return"/"+t+"/"+c(void 0===r&&s(h,e)&&!("flags"in h)?f(e):r)}),{unsafe:!0})},189:(e,t,r)=>{"use strict";r(7710)("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(5631))},2023:(e,t,r)=>{"use strict";var n=r(2109),i=r(1702),o=r(3929),a=r(4488),s=r(1340),c=r(4964),u=i("".indexOf);n({target:"String",proto:!0,forced:!c("includes")},{includes:function(e){return!!~u(s(a(this)),s(o(e)),arguments.length>1?arguments[1]:void 0)}})},8783:(e,t,r)=>{"use strict";var n=r(8710).charAt,i=r(1340),o=r(9909),a=r(654),s="String Iterator",c=o.set,u=o.getterFor(s);a(String,"String",(function(e){c(this,{type:s,string:i(e),index:0})}),(function(){var e,t=u(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},4723:(e,t,r)=>{"use strict";var n=r(6916),i=r(7007),o=r(9670),a=r(7466),s=r(1340),c=r(4488),u=r(8173),l=r(1530),d=r(7651);i("match",(function(e,t,r){return[function(t){var r=c(this),i=null==t?void 0:u(t,e);return i?n(i,t,r):new RegExp(t)[e](s(r))},function(e){var n=o(this),i=s(e),c=r(t,n,i);if(c.done)return c.value;if(!n.global)return d(n,i);var u=n.unicode;n.lastIndex=0;for(var h,p=[],f=0;null!==(h=d(n,i));){var g=s(h[0]);p[f]=g,""===g&&(n.lastIndex=l(i,a(n.lastIndex),u)),f++}return 0===f?null:p}]}))},3112:(e,t,r)=>{"use strict";var n=r(2109),i=r(6650).start;n({target:"String",proto:!0,forced:r(4986)},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},5306:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),a=r(7007),s=r(7293),c=r(9670),u=r(614),l=r(9303),d=r(7466),h=r(1340),p=r(4488),f=r(1530),g=r(8173),v=r(647),m=r(7651),S=r(5112)("replace"),E=Math.max,y=Math.min,_=o([].concat),T=o([].push),R=o("".indexOf),b=o("".slice),w="$0"==="a".replace(/./,"$0"),A=!!/./[S]&&""===/./[S]("a","$0");a("replace",(function(e,t,r){var o=A?"$":"$0";return[function(e,r){var n=p(this),o=null==e?void 0:g(e,S);return o?i(o,e,n,r):i(t,h(n),e,r)},function(e,i){var a=c(this),s=h(e);if("string"==typeof i&&-1===R(i,o)&&-1===R(i,"$<")){var p=r(t,a,s,i);if(p.done)return p.value}var g=u(i);g||(i=h(i));var S=a.global;if(S){var w=a.unicode;a.lastIndex=0}for(var A=[];;){var C=m(a,s);if(null===C)break;if(T(A,C),!S)break;""===h(C[0])&&(a.lastIndex=f(s,d(a.lastIndex),w))}for(var I,O="",P=0,N=0;N<A.length;N++){for(var k=h((C=A[N])[0]),M=E(y(l(C.index),s.length),0),D=[],L=1;L<C.length;L++)T(D,void 0===(I=C[L])?I:String(I));var x=C.groups;if(g){var V=_([k],D,M,s);void 0!==x&&T(V,x);var U=h(n(i,void 0,V))}else U=v(k,s,M,D,x,i);M>=P&&(O+=b(s,P,M)+U,P=M+k.length)}return O+b(s,P)}]}),!!s((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!w||A)},3123:(e,t,r)=>{"use strict";var n=r(2104),i=r(6916),o=r(1702),a=r(7007),s=r(7850),c=r(9670),u=r(4488),l=r(6707),d=r(1530),h=r(7466),p=r(1340),f=r(8173),g=r(1589),v=r(7651),m=r(2261),S=r(2999),E=r(7293),y=S.UNSUPPORTED_Y,_=4294967295,T=Math.min,R=[].push,b=o(/./.exec),w=o(R),A=o("".slice);a("split",(function(e,t,r){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var o=p(u(this)),a=void 0===r?_:r>>>0;if(0===a)return[];if(void 0===e)return[o];if(!s(e))return i(t,o,e,a);for(var c,l,d,h=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),v=0,S=new RegExp(e.source,f+"g");(c=i(m,S,o))&&!((l=S.lastIndex)>v&&(w(h,A(o,v,c.index)),c.length>1&&c.index<o.length&&n(R,h,g(c,1)),d=c[0].length,v=l,h.length>=a));)S.lastIndex===c.index&&S.lastIndex++;return v===o.length?!d&&b(S,"")||w(h,""):w(h,A(o,v)),h.length>a?g(h,0,a):h}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:i(t,this,e,r)}:t,[function(t,r){var n=u(this),a=null==t?void 0:f(t,e);return a?i(a,t,n,r):i(o,p(n),t,r)},function(e,n){var i=c(this),a=p(e),s=r(o,i,a,n,o!==t);if(s.done)return s.value;var u=l(i,RegExp),f=i.unicode,g=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(y?"g":"y"),m=new u(y?"^(?:"+i.source+")":i,g),S=void 0===n?_:n>>>0;if(0===S)return[];if(0===a.length)return null===v(m,a)?[a]:[];for(var E=0,R=0,b=[];R<a.length;){m.lastIndex=y?0:R;var C,I=v(m,y?A(a,R):a);if(null===I||(C=T(h(m.lastIndex+(y?R:0)),a.length))===E)R=d(a,R,f);else{if(w(b,A(a,E,R)),b.length===S)return b;for(var O=1;O<=I.length-1;O++)if(w(b,I[O]),b.length===S)return b;R=E=C}}return w(b,A(a,E)),b}]}),!!E((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),y)},6755:(e,t,r)=>{"use strict";var n,i=r(2109),o=r(1702),a=r(1236).f,s=r(7466),c=r(1340),u=r(3929),l=r(4488),d=r(4964),h=r(1913),p=o("".startsWith),f=o("".slice),g=Math.min,v=d("startsWith");i({target:"String",proto:!0,forced:!(!h&&!v&&(n=a(String.prototype,"startsWith"),n&&!n.writable)||v)},{startsWith:function(e){var t=c(l(this));u(e);var r=s(g(arguments.length>1?arguments[1]:void 0,t.length)),n=c(e);return p?p(t,n,r):f(t,r,r+n.length)===n}})},3210:(e,t,r)=>{"use strict";var n=r(2109),i=r(3111).trim;n({target:"String",proto:!0,forced:r(6091)("trim")},{trim:function(){return i(this)}})},1817:(e,t,r)=>{"use strict";var n=r(2109),i=r(9781),o=r(7854),a=r(1702),s=r(2597),c=r(614),u=r(7976),l=r(1340),d=r(3070).f,h=r(9920),p=o.Symbol,f=p&&p.prototype;if(i&&c(p)&&(!("description"in f)||void 0!==p().description)){var g={},v=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:l(arguments[0]),t=u(f,this)?new p(e):void 0===e?p():p(e);return""===e&&(g[t]=!0),t};h(v,p),v.prototype=f,f.constructor=v;var m="Symbol(test)"==String(p("test")),S=a(f.toString),E=a(f.valueOf),y=/^Symbol\((.*)\)[^)]+$/,_=a("".replace),T=a("".slice);d(f,"description",{configurable:!0,get:function(){var e=E(this),t=S(e);if(s(g,e))return"";var r=m?T(t,7,-1):_(t,y,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:v})}},2165:(e,t,r)=>{r(7235)("iterator")},2526:(e,t,r)=>{"use strict";var n=r(2109),i=r(7854),o=r(5005),a=r(2104),s=r(6916),c=r(1702),u=r(1913),l=r(9781),d=r(133),h=r(7293),p=r(2597),f=r(3157),g=r(614),v=r(111),m=r(7976),S=r(2190),E=r(9670),y=r(7908),_=r(5656),T=r(4948),R=r(1340),b=r(9114),w=r(30),A=r(1956),C=r(8006),I=r(1156),O=r(5181),P=r(1236),N=r(3070),k=r(6048),M=r(5296),D=r(206),L=r(1320),x=r(2309),V=r(6200),U=r(3501),j=r(9711),H=r(5112),B=r(6061),$=r(7235),F=r(8003),q=r(9909),W=r(2092).forEach,K=V("hidden"),G="Symbol",Y="prototype",z=H("toPrimitive"),X=q.set,J=q.getterFor(G),Z=Object[Y],Q=i.Symbol,ee=Q&&Q[Y],te=i.TypeError,re=i.QObject,ne=o("JSON","stringify"),ie=P.f,oe=N.f,ae=I.f,se=M.f,ce=c([].push),ue=x("symbols"),le=x("op-symbols"),de=x("string-to-symbol-registry"),he=x("symbol-to-string-registry"),pe=x("wks"),fe=!re||!re[Y]||!re[Y].findChild,ge=l&&h((function(){return 7!=w(oe({},"a",{get:function(){return oe(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=ie(Z,t);n&&delete Z[t],oe(e,t,r),n&&e!==Z&&oe(Z,t,n)}:oe,ve=function(e,t){var r=ue[e]=w(ee);return X(r,{type:G,tag:e,description:t}),l||(r.description=t),r},me=function(e,t,r){e===Z&&me(le,t,r),E(e);var n=T(t);return E(r),p(ue,n)?(r.enumerable?(p(e,K)&&e[K][n]&&(e[K][n]=!1),r=w(r,{enumerable:b(0,!1)})):(p(e,K)||oe(e,K,b(1,{})),e[K][n]=!0),ge(e,n,r)):oe(e,n,r)},Se=function(e,t){E(e);var r=_(t),n=A(r).concat(Te(r));return W(n,(function(t){l&&!s(Ee,r,t)||me(e,t,r[t])})),e},Ee=function(e){var t=T(e),r=s(se,this,t);return!(this===Z&&p(ue,t)&&!p(le,t))&&(!(r||!p(this,t)||!p(ue,t)||p(this,K)&&this[K][t])||r)},ye=function(e,t){var r=_(e),n=T(t);if(r!==Z||!p(ue,n)||p(le,n)){var i=ie(r,n);return!i||!p(ue,n)||p(r,K)&&r[K][n]||(i.enumerable=!0),i}},_e=function(e){var t=ae(_(e)),r=[];return W(t,(function(e){p(ue,e)||p(U,e)||ce(r,e)})),r},Te=function(e){var t=e===Z,r=ae(t?le:_(e)),n=[];return W(r,(function(e){!p(ue,e)||t&&!p(Z,e)||ce(n,ue[e])})),n};if(d||(L(ee=(Q=function(){if(m(ee,this))throw te("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?R(arguments[0]):void 0,t=j(e),r=function(e){this===Z&&s(r,le,e),p(this,K)&&p(this[K],t)&&(this[K][t]=!1),ge(this,t,b(1,e))};return l&&fe&&ge(Z,t,{configurable:!0,set:r}),ve(t,e)})[Y],"toString",(function(){return J(this).tag})),L(Q,"withoutSetter",(function(e){return ve(j(e),e)})),M.f=Ee,N.f=me,k.f=Se,P.f=ye,C.f=I.f=_e,O.f=Te,B.f=function(e){return ve(H(e),e)},l&&(oe(ee,"description",{configurable:!0,get:function(){return J(this).description}}),u||L(Z,"propertyIsEnumerable",Ee,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:Q}),W(A(pe),(function(e){$(e)})),n({target:G,stat:!0,forced:!d},{for:function(e){var t=R(e);if(p(de,t))return de[t];var r=Q(t);return de[t]=r,he[r]=t,r},keyFor:function(e){if(!S(e))throw te(e+" is not a symbol");if(p(he,e))return he[e]},useSetter:function(){fe=!0},useSimple:function(){fe=!1}}),n({target:"Object",stat:!0,forced:!d,sham:!l},{create:function(e,t){return void 0===t?w(e):Se(w(e),t)},defineProperty:me,defineProperties:Se,getOwnPropertyDescriptor:ye}),n({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:_e,getOwnPropertySymbols:Te}),n({target:"Object",stat:!0,forced:h((function(){O.f(1)}))},{getOwnPropertySymbols:function(e){return O.f(y(e))}}),ne&&n({target:"JSON",stat:!0,forced:!d||h((function(){var e=Q();return"[null]"!=ne([e])||"{}"!=ne({a:e})||"{}"!=ne(Object(e))}))},{stringify:function(e,t,r){var n=D(arguments),i=t;if((v(t)||void 0!==e)&&!S(e))return f(t)||(t=function(e,t){if(g(i)&&(t=s(i,this,e,t)),!S(t))return t}),n[1]=t,a(ne,null,n)}}),!ee[z]){var Re=ee.valueOf;L(ee,z,(function(e){return s(Re,this)}))}F(Q,G),U[K]=!0},6649:(e,t,r)=>{r(7235)("toPrimitive")},2990:(e,t,r)=>{"use strict";var n=r(1702),i=r(260),o=n(r(1048)),a=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(e,t){return o(a(this),e,t,arguments.length>2?arguments[2]:void 0)}))},8927:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).every,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("every",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},3105:(e,t,r)=>{"use strict";var n=r(260),i=r(6916),o=r(1285),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("fill",(function(e){var t=arguments.length;return i(o,a(this),e,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}))},5035:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).filter,o=r(3074),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("filter",(function(e){var t=i(a(this),e,arguments.length>1?arguments[1]:void 0);return o(this,t)}))},7174:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).findIndex,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("findIndex",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},4345:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).find,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("find",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},2846:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).forEach,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("forEach",(function(e){i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},4731:(e,t,r)=>{"use strict";var n=r(260),i=r(1318).includes,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("includes",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},7209:(e,t,r)=>{"use strict";var n=r(260),i=r(1318).indexOf,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("indexOf",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},6319:(e,t,r)=>{"use strict";var n=r(7854),i=r(7293),o=r(1702),a=r(260),s=r(6992),c=r(5112)("iterator"),u=n.Uint8Array,l=o(s.values),d=o(s.keys),h=o(s.entries),p=a.aTypedArray,f=a.exportTypedArrayMethod,g=u&&u.prototype,v=!i((function(){g[c].call([1])})),m=!!g&&g.values&&g[c]===g.values&&"values"===g.values.name,S=function(){return l(p(this))};f("entries",(function(){return h(p(this))}),v),f("keys",(function(){return d(p(this))}),v),f("values",S,v||!m,{name:"values"}),f(c,S,v||!m,{name:"values"})},8867:(e,t,r)=>{"use strict";var n=r(260),i=r(1702),o=n.aTypedArray,a=n.exportTypedArrayMethod,s=i([].join);a("join",(function(e){return s(o(this),e)}))},7789:(e,t,r)=>{"use strict";var n=r(260),i=r(2104),o=r(6583),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return i(o,a(this),t>1?[e,arguments[1]]:[e])}))},3739:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).map,o=r(6304),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("map",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(o(e))(t)}))}))},4483:(e,t,r)=>{"use strict";var n=r(260),i=r(3671).right,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return i(o(this),e,t,t>1?arguments[1]:void 0)}))},9368:(e,t,r)=>{"use strict";var n=r(260),i=r(3671).left,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return i(o(this),e,t,t>1?arguments[1]:void 0)}))},2056:(e,t,r)=>{"use strict";var n=r(260),i=n.aTypedArray,o=n.exportTypedArrayMethod,a=Math.floor;o("reverse",(function(){for(var e,t=this,r=i(t).length,n=a(r/2),o=0;o<n;)e=t[o],t[o++]=t[--r],t[r]=e;return t}))},3462:(e,t,r)=>{"use strict";var n=r(7854),i=r(6916),o=r(260),a=r(6244),s=r(4590),c=r(7908),u=r(7293),l=n.RangeError,d=n.Int8Array,h=d&&d.prototype,p=h&&h.set,f=o.aTypedArray,g=o.exportTypedArrayMethod,v=!u((function(){var e=new Uint8ClampedArray(2);return i(p,e,{length:1,0:3},1),3!==e[1]})),m=v&&o.NATIVE_ARRAY_BUFFER_VIEWS&&u((function(){var e=new d(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));g("set",(function(e){f(this);var t=s(arguments.length>1?arguments[1]:void 0,1),r=c(e);if(v)return i(p,this,r,t);var n=this.length,o=a(r),u=0;if(o+t>n)throw l("Wrong length");for(;u<o;)this[t+u]=r[u++]}),!v||m)},678:(e,t,r)=>{"use strict";var n=r(260),i=r(6304),o=r(7293),a=r(206),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("slice",(function(e,t){for(var r=a(s(this),e,t),n=i(this),o=0,c=r.length,u=new n(c);c>o;)u[o]=r[o++];return u}),o((function(){new Int8Array(1).slice()})))},7462:(e,t,r)=>{"use strict";var n=r(260),i=r(2092).some,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("some",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},3824:(e,t,r)=>{"use strict";var n=r(7854),i=r(1702),o=r(7293),a=r(9662),s=r(4362),c=r(260),u=r(8886),l=r(256),d=r(7392),h=r(8008),p=n.Array,f=c.aTypedArray,g=c.exportTypedArrayMethod,v=n.Uint16Array,m=v&&i(v.prototype.sort),S=!(!m||o((function(){m(new v(2),null)}))&&o((function(){m(new v(2),{})}))),E=!!m&&!o((function(){if(d)return d<74;if(u)return u<67;if(l)return!0;if(h)return h<602;var e,t,r=new v(516),n=p(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(m(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));g("sort",(function(e){return void 0!==e&&a(e),E?m(this,e):s(f(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!E||S)},5021:(e,t,r)=>{"use strict";var n=r(260),i=r(7466),o=r(1400),a=r(6304),s=n.aTypedArray;(0,n.exportTypedArrayMethod)("subarray",(function(e,t){var r=s(this),n=r.length,c=o(e,n);return new(a(r))(r.buffer,r.byteOffset+c*r.BYTES_PER_ELEMENT,i((void 0===t?n:o(t,n))-c))}))},2974:(e,t,r)=>{"use strict";var n=r(7854),i=r(2104),o=r(260),a=r(7293),s=r(206),c=n.Int8Array,u=o.aTypedArray,l=o.exportTypedArrayMethod,d=[].toLocaleString,h=!!c&&a((function(){d.call(new c(1))}));l("toLocaleString",(function(){return i(d,h?s(u(this)):u(this),s(arguments))}),a((function(){return[1,2].toLocaleString()!=new c([1,2]).toLocaleString()}))||!a((function(){c.prototype.toLocaleString.call([1,2])})))},5016:(e,t,r)=>{"use strict";var n=r(260).exportTypedArrayMethod,i=r(7293),o=r(7854),a=r(1702),s=o.Uint8Array,c=s&&s.prototype||{},u=[].toString,l=a([].join);i((function(){u.call({})}))&&(u=function(){return l(this)});var d=c.toString!=u;n("toString",u,d)},2472:(e,t,r)=>{r(9843)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},8478:(e,t,r)=>{"use strict";r(7710)("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(9320))},4747:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),a=r(8533),s=r(8880),c=function(e){if(e&&e.forEach!==a)try{s(e,"forEach",a)}catch(t){e.forEach=a}};for(var u in i)i[u]&&c(n[u]&&n[u].prototype);c(o)},3948:(e,t,r)=>{var n=r(7854),i=r(8324),o=r(8509),a=r(6992),s=r(8880),c=r(5112),u=c("iterator"),l=c("toStringTag"),d=a.values,h=function(e,t){if(e){if(e[u]!==d)try{s(e,u,d)}catch(t){e[u]=d}if(e[l]||s(e,l,t),i[t])for(var r in a)if(e[r]!==a[r])try{s(e,r,a[r])}catch(t){e[r]=a[r]}}};for(var p in i)h(n[p]&&n[p].prototype,p);h(o,"DOMTokenList")},2564:(e,t,r)=>{var n=r(2109),i=r(7854),o=r(2104),a=r(614),s=r(8113),c=r(206),u=r(8053),l=/MSIE .\./.test(s),d=i.Function,h=function(e){return function(t,r){var n=u(arguments.length,1)>2,i=a(t)?t:d(t),s=n?c(arguments,2):void 0;return e(n?function(){o(i,this,s)}:i,r)}};n({global:!0,bind:!0,forced:l},{setTimeout:h(i.setTimeout),setInterval:h(i.setInterval)})},1637:(e,t,r)=>{"use strict";r(6992);var n=r(2109),i=r(7854),o=r(5005),a=r(6916),s=r(1702),c=r(590),u=r(1320),l=r(2248),d=r(8003),h=r(4994),p=r(9909),f=r(5787),g=r(614),v=r(2597),m=r(9974),S=r(648),E=r(9670),y=r(111),_=r(1340),T=r(30),R=r(9114),b=r(8554),w=r(1246),A=r(8053),C=r(5112),I=r(4362),O=C("iterator"),P="URLSearchParams",N=P+"Iterator",k=p.set,M=p.getterFor(P),D=p.getterFor(N),L=o("fetch"),x=o("Request"),V=o("Headers"),U=x&&x.prototype,j=V&&V.prototype,H=i.RegExp,B=i.TypeError,$=i.decodeURIComponent,F=i.encodeURIComponent,q=s("".charAt),W=s([].join),K=s([].push),G=s("".replace),Y=s([].shift),z=s([].splice),X=s("".split),J=s("".slice),Z=/\+/g,Q=Array(4),ee=function(e){return Q[e-1]||(Q[e-1]=H("((?:%[\\da-f]{2}){"+e+"})","gi"))},te=function(e){try{return $(e)}catch(t){return e}},re=function(e){var t=G(e,Z," "),r=4;try{return $(t)}catch(e){for(;r;)t=G(t,ee(r--),te);return t}},ne=/[!'()~]|%20/g,ie={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},oe=function(e){return ie[e]},ae=function(e){return G(F(e),ne,oe)},se=h((function(e,t){k(this,{type:N,iterator:b(M(e).entries),kind:t})}),"Iterator",(function(){var e=D(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),ce=function(e){this.entries=[],this.url=null,void 0!==e&&(y(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===q(e,0)?J(e,1):e:_(e)))};ce.prototype={type:P,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,s,c,u=w(e);if(u)for(r=(t=b(e,u)).next;!(n=a(r,t)).done;){if(o=(i=b(E(n.value))).next,(s=a(o,i)).done||(c=a(o,i)).done||!a(o,i).done)throw B("Expected sequence with length 2");K(this.entries,{key:_(s.value),value:_(c.value)})}else for(var l in e)v(e,l)&&K(this.entries,{key:l,value:_(e[l])})},parseQuery:function(e){if(e)for(var t,r,n=X(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=X(t,"="),K(this.entries,{key:re(Y(r)),value:re(W(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],K(r,ae(e.key)+"="+ae(e.value));return W(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ue=function(){f(this,le),k(this,new ce(arguments.length>0?arguments[0]:void 0))},le=ue.prototype;if(l(le,{append:function(e,t){A(arguments.length,2);var r=M(this);K(r.entries,{key:_(e),value:_(t)}),r.updateURL()},delete:function(e){A(arguments.length,1);for(var t=M(this),r=t.entries,n=_(e),i=0;i<r.length;)r[i].key===n?z(r,i,1):i++;t.updateURL()},get:function(e){A(arguments.length,1);for(var t=M(this).entries,r=_(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){A(arguments.length,1);for(var t=M(this).entries,r=_(e),n=[],i=0;i<t.length;i++)t[i].key===r&&K(n,t[i].value);return n},has:function(e){A(arguments.length,1);for(var t=M(this).entries,r=_(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){A(arguments.length,1);for(var r,n=M(this),i=n.entries,o=!1,a=_(e),s=_(t),c=0;c<i.length;c++)(r=i[c]).key===a&&(o?z(i,c--,1):(o=!0,r.value=s));o||K(i,{key:a,value:s}),n.updateURL()},sort:function(){var e=M(this);I(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=M(this).entries,n=m(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new se(this,"keys")},values:function(){return new se(this,"values")},entries:function(){return new se(this,"entries")}},{enumerable:!0}),u(le,O,le.entries,{name:"entries"}),u(le,"toString",(function(){return M(this).serialize()}),{enumerable:!0}),d(ue,P),n({global:!0,forced:!c},{URLSearchParams:ue}),!c&&g(V)){var de=s(j.has),he=s(j.set),pe=function(e){if(y(e)){var t,r=e.body;if(S(r)===P)return t=e.headers?new V(e.headers):new V,de(t,"content-type")||he(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),T(e,{body:R(0,_(r)),headers:R(0,t)})}return e};if(g(L)&&n({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return L(e,arguments.length>1?pe(arguments[1]):{})}}),g(x)){var fe=function(e){return f(this,U),new x(e,arguments.length>1?pe(arguments[1]):{})};U.constructor=fe,fe.prototype=U,n({global:!0,forced:!0},{Request:fe})}}e.exports={URLSearchParams:ue,getState:M}},285:(e,t,r)=>{"use strict";r(8783);var n,i=r(2109),o=r(9781),a=r(590),s=r(7854),c=r(9974),u=r(1702),l=r(6048).f,d=r(1320),h=r(5787),p=r(2597),f=r(1574),g=r(8457),v=r(1589),m=r(8710).codeAt,S=r(3197),E=r(1340),y=r(8003),_=r(8053),T=r(1637),R=r(9909),b=R.set,w=R.getterFor("URL"),A=T.URLSearchParams,C=T.getState,I=s.URL,O=s.TypeError,P=s.parseInt,N=Math.floor,k=Math.pow,M=u("".charAt),D=u(/./.exec),L=u([].join),x=u(1..toString),V=u([].pop),U=u([].push),j=u("".replace),H=u([].shift),B=u("".split),$=u("".slice),F=u("".toLowerCase),q=u([].unshift),W="Invalid scheme",K="Invalid host",G="Invalid port",Y=/[a-z]/i,z=/[\d+-.a-z]/i,X=/\d/,J=/^0x/i,Z=/^[0-7]+$/,Q=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,re=/[\0\t\n\r #/:<>?@[\\\]^|]/,ne=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,ie=/[\t\n\r]/g,oe=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)q(t,e%256),e=N(e/256);return L(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,o=0;o<8;o++)0!==e[o]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=o),++i);return i>r&&(t=n,r=i),t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=x(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},ae={},se=f({},ae,{" ":1,'"':1,"<":1,">":1,"`":1}),ce=f({},se,{"#":1,"?":1,"{":1,"}":1}),ue=f({},ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),le=function(e,t){var r=m(e,0);return r>32&&r<127&&!p(t,e)?e:encodeURIComponent(e)},de={ftp:21,file:null,http:80,https:443,ws:80,wss:443},he=function(e,t){var r;return 2==e.length&&D(Y,M(e,0))&&(":"==(r=M(e,1))||!t&&"|"==r)},pe=function(e){var t;return e.length>1&&he($(e,0,2))&&(2==e.length||"/"===(t=M(e,2))||"\\"===t||"?"===t||"#"===t)},fe=function(e){return"."===e||"%2e"===F(e)},ge={},ve={},me={},Se={},Ee={},ye={},_e={},Te={},Re={},be={},we={},Ae={},Ce={},Ie={},Oe={},Pe={},Ne={},ke={},Me={},De={},Le={},xe=function(e,t,r){var n,i,o,a=E(e);if(t){if(i=this.parse(a))throw O(i);this.searchParams=null}else{if(void 0!==r&&(n=new xe(r,!0)),i=this.parse(a,null,n))throw O(i);(o=C(new A)).bindURL(this),this.searchParams=o}};xe.prototype={type:"URL",parse:function(e,t,r){var i,o,a,s,c,u=this,l=t||ge,d=0,h="",f=!1,m=!1,S=!1;for(e=E(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=j(e,ne,"")),e=j(e,ie,""),i=g(e);d<=i.length;){switch(o=i[d],l){case ge:if(!o||!D(Y,o)){if(t)return W;l=me;continue}h+=F(o),l=ve;break;case ve:if(o&&(D(z,o)||"+"==o||"-"==o||"."==o))h+=F(o);else{if(":"!=o){if(t)return W;h="",l=me,d=0;continue}if(t&&(u.isSpecial()!=p(de,h)||"file"==h&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&de[u.scheme]==u.port&&(u.port=null));h="","file"==u.scheme?l=Ie:u.isSpecial()&&r&&r.scheme==u.scheme?l=Se:u.isSpecial()?l=Te:"/"==i[d+1]?(l=Ee,d++):(u.cannotBeABaseURL=!0,U(u.path,""),l=Me)}break;case me:if(!r||r.cannotBeABaseURL&&"#"!=o)return W;if(r.cannotBeABaseURL&&"#"==o){u.scheme=r.scheme,u.path=v(r.path),u.query=r.query,u.fragment="",u.cannotBeABaseURL=!0,l=Le;break}l="file"==r.scheme?Ie:ye;continue;case Se:if("/"!=o||"/"!=i[d+1]){l=ye;continue}l=Re,d++;break;case Ee:if("/"==o){l=be;break}l=ke;continue;case ye:if(u.scheme=r.scheme,o==n)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.query=r.query;else if("/"==o||"\\"==o&&u.isSpecial())l=_e;else if("?"==o)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.query="",l=De;else{if("#"!=o){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.path.length--,l=ke;continue}u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=v(r.path),u.query=r.query,u.fragment="",l=Le}break;case _e:if(!u.isSpecial()||"/"!=o&&"\\"!=o){if("/"!=o){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,l=ke;continue}l=be}else l=Re;break;case Te:if(l=Re,"/"!=o||"/"!=M(h,d+1))continue;d++;break;case Re:if("/"!=o&&"\\"!=o){l=be;continue}break;case be:if("@"==o){f&&(h="%40"+h),f=!0,a=g(h);for(var y=0;y<a.length;y++){var _=a[y];if(":"!=_||S){var T=le(_,ue);S?u.password+=T:u.username+=T}else S=!0}h=""}else if(o==n||"/"==o||"?"==o||"#"==o||"\\"==o&&u.isSpecial()){if(f&&""==h)return"Invalid authority";d-=g(h).length+1,h="",l=we}else h+=o;break;case we:case Ae:if(t&&"file"==u.scheme){l=Pe;continue}if(":"!=o||m){if(o==n||"/"==o||"?"==o||"#"==o||"\\"==o&&u.isSpecial()){if(u.isSpecial()&&""==h)return K;if(t&&""==h&&(u.includesCredentials()||null!==u.port))return;if(s=u.parseHost(h))return s;if(h="",l=Ne,t)return;continue}"["==o?m=!0:"]"==o&&(m=!1),h+=o}else{if(""==h)return K;if(s=u.parseHost(h))return s;if(h="",l=Ce,t==Ae)return}break;case Ce:if(!D(X,o)){if(o==n||"/"==o||"?"==o||"#"==o||"\\"==o&&u.isSpecial()||t){if(""!=h){var R=P(h,10);if(R>65535)return G;u.port=u.isSpecial()&&R===de[u.scheme]?null:R,h=""}if(t)return;l=Ne;continue}return G}h+=o;break;case Ie:if(u.scheme="file","/"==o||"\\"==o)l=Oe;else{if(!r||"file"!=r.scheme){l=ke;continue}if(o==n)u.host=r.host,u.path=v(r.path),u.query=r.query;else if("?"==o)u.host=r.host,u.path=v(r.path),u.query="",l=De;else{if("#"!=o){pe(L(v(i,d),""))||(u.host=r.host,u.path=v(r.path),u.shortenPath()),l=ke;continue}u.host=r.host,u.path=v(r.path),u.query=r.query,u.fragment="",l=Le}}break;case Oe:if("/"==o||"\\"==o){l=Pe;break}r&&"file"==r.scheme&&!pe(L(v(i,d),""))&&(he(r.path[0],!0)?U(u.path,r.path[0]):u.host=r.host),l=ke;continue;case Pe:if(o==n||"/"==o||"\\"==o||"?"==o||"#"==o){if(!t&&he(h))l=ke;else if(""==h){if(u.host="",t)return;l=Ne}else{if(s=u.parseHost(h))return s;if("localhost"==u.host&&(u.host=""),t)return;h="",l=Ne}continue}h+=o;break;case Ne:if(u.isSpecial()){if(l=ke,"/"!=o&&"\\"!=o)continue}else if(t||"?"!=o)if(t||"#"!=o){if(o!=n&&(l=ke,"/"!=o))continue}else u.fragment="",l=Le;else u.query="",l=De;break;case ke:if(o==n||"/"==o||"\\"==o&&u.isSpecial()||!t&&("?"==o||"#"==o)){if(".."===(c=F(c=h))||"%2e."===c||".%2e"===c||"%2e%2e"===c?(u.shortenPath(),"/"==o||"\\"==o&&u.isSpecial()||U(u.path,"")):fe(h)?"/"==o||"\\"==o&&u.isSpecial()||U(u.path,""):("file"==u.scheme&&!u.path.length&&he(h)&&(u.host&&(u.host=""),h=M(h,0)+":"),U(u.path,h)),h="","file"==u.scheme&&(o==n||"?"==o||"#"==o))for(;u.path.length>1&&""===u.path[0];)H(u.path);"?"==o?(u.query="",l=De):"#"==o&&(u.fragment="",l=Le)}else h+=le(o,ce);break;case Me:"?"==o?(u.query="",l=De):"#"==o?(u.fragment="",l=Le):o!=n&&(u.path[0]+=le(o,ae));break;case De:t||"#"!=o?o!=n&&("'"==o&&u.isSpecial()?u.query+="%27":u.query+="#"==o?"%23":le(o,ae)):(u.fragment="",l=Le);break;case Le:o!=n&&(u.fragment+=le(o,se))}d++}},parseHost:function(e){var t,r,n;if("["==M(e,0)){if("]"!=M(e,e.length-1))return K;if(t=function(e){var t,r,n,i,o,a,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,h=function(){return M(e,d)};if(":"==h()){if(":"!=M(e,1))return;d+=2,l=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=r=0;r<4&&D(ee,h());)t=16*t+P(h(),16),d++,r++;if("."==h()){if(0==r)return;if(d-=r,u>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;d++}if(!D(X,h()))return;for(;D(X,h());){if(o=P(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}c[u]=256*c[u]+i,2!=++n&&4!=n||u++}if(4!=n)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(a=u-l,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[l+a-1],c[l+--a]=s;else if(8!=u)return;return c}($(e,1,-1)),!t)return K;this.host=t}else if(this.isSpecial()){if(e=S(e),D(te,e))return K;if(t=function(e){var t,r,n,i,o,a,s,c=B(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=c[n]))return e;if(o=10,i.length>1&&"0"==M(i,0)&&(o=D(J,i)?16:8,i=$(i,8==o?1:2)),""===i)a=0;else{if(!D(10==o?Q:8==o?Z:ee,i))return e;a=P(i,o)}U(r,a)}for(n=0;n<t;n++)if(a=r[n],n==t-1){if(a>=k(256,5-t))return null}else if(a>255)return null;for(s=V(r),n=0;n<r.length;n++)s+=r[n]*k(256,3-n);return s}(e),null===t)return K;this.host=t}else{if(D(re,e))return K;for(t="",r=g(e),n=0;n<r.length;n++)t+=le(r[n],ae);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return p(de,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&he(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=oe(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+L(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw O(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new Ve(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+oe(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(E(e)+":",ge)},getUsername:function(){return this.username},setUsername:function(e){var t=g(E(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=le(t[r],ue)}},getPassword:function(){return this.password},setPassword:function(e){var t=g(E(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=le(t[r],ue)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?oe(e):oe(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,we)},getHostname:function(){var e=this.host;return null===e?"":oe(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Ae)},getPort:function(){var e=this.port;return null===e?"":E(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=E(e))?this.port=null:this.parse(e,Ce))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+L(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ne))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=E(e))?this.query=null:("?"==M(e,0)&&(e=$(e,1)),this.query="",this.parse(e,De)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=E(e))?("#"==M(e,0)&&(e=$(e,1)),this.fragment="",this.parse(e,Le)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ve=function(e){var t=h(this,Ue),r=_(arguments.length,1)>1?arguments[1]:void 0,n=b(t,new xe(e,!1,r));o||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Ue=Ve.prototype,je=function(e,t){return{get:function(){return w(this)[e]()},set:t&&function(e){return w(this)[t](e)},configurable:!0,enumerable:!0}};if(o&&l(Ue,{href:je("serialize","setHref"),origin:je("getOrigin"),protocol:je("getProtocol","setProtocol"),username:je("getUsername","setUsername"),password:je("getPassword","setPassword"),host:je("getHost","setHost"),hostname:je("getHostname","setHostname"),port:je("getPort","setPort"),pathname:je("getPathname","setPathname"),search:je("getSearch","setSearch"),searchParams:je("getSearchParams"),hash:je("getHash","setHash")}),d(Ue,"toJSON",(function(){return w(this).serialize()}),{enumerable:!0}),d(Ue,"toString",(function(){return w(this).serialize()}),{enumerable:!0}),I){var He=I.createObjectURL,Be=I.revokeObjectURL;He&&d(Ve,"createObjectURL",c(He,I)),Be&&d(Ve,"revokeObjectURL",c(Be,I))}y(Ve,"URL"),i({global:!0,forced:!a,sham:!o},{URL:Ve})},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,o,a,u;if(s(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,l=f(c,u);for(r=0;r<u;++r)n(l[r],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,o,a;if(s(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},5666:e=>{var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n=d;return function(i,o){if(n===p)throw new Error("Generator is already running");if(n===f){if("throw"===i)throw o;return P()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=l(e,t,r);if("normal"===c.type){if(n=r.done?f:h,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",p="executing",f="completed",g={};function v(){}function m(){}function S(){}var E={};c(E,o,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(O([])));_&&_!==r&&n.call(_,o)&&(E=_);var T=S.prototype=v.prototype=Object.create(E);function R(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,w(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function O(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=S,c(T,"constructor",S),c(S,"constructor",m),m.displayName=c(S,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,c(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},R(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new b(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},R(T),c(T,s,"Generator"),c(T,o,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=O,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{AMP_TERM_CODE:()=>tr,CALL_TYPE:()=>wt,DEBUG_NOTICE:()=>Nn,LOG_LEVEL:()=>$t,MediaStreamManager:()=>po,PLANET_KIT_USER_TYPE:()=>Gt,PLANET_REL_CODE:()=>ir,RESOLUTION:()=>vr,VIDEO_STATE:()=>It,WTP_STATE:()=>$n,Wtp:()=>fo,WtpCall:()=>fi,WtpConference:()=>Zi,WtpTestCall:()=>so,WtpUtil:()=>_t}),r(5666),r(1539),r(8674),r(8309),r(4916),r(5306),r(6992),r(9575),r(2472),r(2990),r(8927),r(3105),r(5035),r(4345),r(7174),r(2846),r(4731),r(7209),r(6319),r(8867),r(7789),r(3739),r(9368),r(4483),r(2056),r(3462),r(678),r(7462),r(3824),r(5021),r(2974),r(5016),r(9554),r(4747),r(6755),r(8304),r(4812),r(489),r(2419),r(8011),r(9070),r(6649),r(6078),r(2526),r(1817),r(9653),r(2165),r(8783),r(3948);const e=(e,t)=>{const r=[],n=e.split(/\r\n/);let i;for(let e=0;e<n.length;){const o=n[e];if(/^m=(?:audio|video)/.test(o))i={index:e,stripped:[]},r.push(i);else if(i){const r=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(r&&t===r[2]){n.splice(e,1),i.stripped.push(r[1]);continue}}e++}for(const e of r){const t=n[e.index].split(" ");for(let r=3;r<t.length;)-1===e.stripped.indexOf(t[r])?r++:t.splice(r,1);n[e.index]=t.join(" ")}return n.join("\r\n")};function t(t){return t.sdp=e(t.sdp||"","telephone-event"),Promise.resolve(t)}var i,o;r(1532),r(9720),r(9601),r(9826),r(2564),r(7327),r(2222),r(9600),r(3843),r(3710),r(9714),r(1058),r(3123),r(4603),r(3210),r(4723),r(5827),r(3304),r(3112),r(3161),r(7941),r(7042),r(1038),r(9753);class a{constructor(e){this.parameters={};for(const t in e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}setParam(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())}getParam(e){if(e)return this.parameters[e.toLowerCase()]}hasParam(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())}deleteParam(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){const t=this.parameters[e];return delete this.parameters[e],t}}clearParams(){this.parameters={}}}class s extends a{constructor(e,t,r,n,i,o){if(super(i),this.headers={},!r)throw new TypeError('missing or invalid "host" parameter');e=e||"sip";for(const e in o)o.hasOwnProperty(e)&&this.setHeader(e,o[e]);this.raw={scheme:e,user:t,host:r,port:n},this.normal={scheme:e.toLowerCase(),user:t,host:r.toLowerCase(),port:n}}get scheme(){return this.normal.scheme}set scheme(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()}get user(){return this.normal.user}set user(e){this.normal.user=this.raw.user=e}get host(){return this.normal.host}set host(e){this.raw.host=e,this.normal.host=e.toLowerCase()}get aor(){return this.normal.user+"@"+this.normal.host}get port(){return this.normal.port}set port(e){this.normal.port=this.raw.port=e}setHeader(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]}getHeader(e){if(e)return this.headers[this.headerize(e)]}hasHeader(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))}deleteHeader(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){const t=this.headers[e];return delete this.headers[e],t}}clearHeaders(){this.headers={}}clone(){return new s(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))}toRaw(){return this._toString(this._raw)}toString(){return this._toString(this._normal)}get _normal(){return this.normal}get _raw(){return this.raw}_toString(e){let t=e.scheme+":";e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,(e.port||0===e.port)&&(t+=":"+e.port);for(const e in this.parameters)this.parameters.hasOwnProperty(e)&&(t+=";"+e,null!==this.parameters[e]&&(t+="="+this.parameters[e]));const r=[];for(const e in this.headers)if(this.headers.hasOwnProperty(e))for(const t in this.headers[e])this.headers[e].hasOwnProperty(t)&&r.push(e+"="+this.headers[e][t]);return r.length>0&&(t+="?"+r.join("&")),t}escapeUser(e){let t;try{t=decodeURIComponent(e)}catch(e){throw e}return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}headerize(e){const t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length;let i="";for(let e=0;e<n;e++)0!==e&&(i+="-"),i+=r[e].charAt(0).toUpperCase()+r[e].substring(1);return t[i]&&(i=t[i]),i}}!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e[e.debug=3]="debug"}(i||(i={}));class c{constructor(e,t,r){this.logger=e,this.category=t,this.label=r}error(e){this.genericLog(i.error,e)}warn(e){this.genericLog(i.warn,e)}log(e){this.genericLog(i.log,e)}debug(e){this.genericLog(i.debug,e)}genericLog(e,t){this.logger.genericLog(e,this.category,this.label,t)}}class u{constructor(){this.builtinEnabled=!0,this._level=i.log,this.loggers={},this.logger=this.getLogger("sip:loggerfactory")}get level(){return this._level}set level(e){e>=0&&e<=3?this._level=e:e>3?this._level=3:i.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))}get connector(){return this._connector}set connector(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0}getLogger(e,t){if(t&&3===this.level)return new c(this,e,t);if(this.loggers[e])return this.loggers[e];{const t=new c(this,e);return this.loggers[e]=t,t}}genericLog(e,t,r,n){this.level>=e&&this.builtinEnabled&&this.print(e,t,r,n),this.connector&&this.connector(i[e],t,r,n)}print(e,t,r,n){if("string"==typeof n){const e=[new Date,t];r&&e.push(r),n=e.concat(n).join(" | ")}switch(e){case i.error:console.error(n);break;case i.warn:console.warn(n);break;case i.log:console.log(n);break;case i.debug:console.debug(n)}}}class l extends a{constructor(e,t,r){super(r),this.uri=e,this._displayName=t}get friendlyName(){return this.displayName||this.uri.aor}get displayName(){return this._displayName}set displayName(e){this._displayName=e}clone(){return new l(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))}toString(){let e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";e+="<"+this.uri.toString()+">";for(const t in this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e}}class d extends Error{constructor(e,t,r,n){super(),this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,d)}static buildMessage(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e)))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e)))}function o(e){switch(e.type){case"literal":return'"'+n(e.text)+'"';case"class":const t=e.parts.map((e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){const t=e.map(o);let r,n;if(t.sort(),t.length>0){for(r=1,n=1;r<t.length;r++)t[r-1]!==t[r]&&(t[n]=t[r],n++);t.length=n}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+((a=t)?'"'+n(a)+'"':"end of input")+" found.";var a}}!function(e){e.parse=function(e,t){const r={startRule:t};try{!function(e,t){t=void 0!==t?t:{};const r={},n={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231};let i=119;const o=["\r\n",E("\r\n",!1),/^[0-9]/,y([["0","9"]],!1,!1),/^[a-zA-Z]/,y([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,y([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,y([["\0","ÿ"]],!1,!1),/^["]/,y(['"'],!1,!1)," ",E(" ",!1),"\t",E("\t",!1),/^[a-zA-Z0-9]/,y([["a","z"],["A","Z"],["0","9"]],!1,!1),";",E(";",!1),"/",E("/",!1),"?",E("?",!1),":",E(":",!1),"@",E("@",!1),"&",E("&",!1),"=",E("=",!1),"+",E("+",!1),"$",E("$",!1),",",E(",",!1),"-",E("-",!1),"_",E("_",!1),".",E(".",!1),"!",E("!",!1),"~",E("~",!1),"*",E("*",!1),"'",E("'",!1),"(",E("(",!1),")",E(")",!1),"%",E("%",!1),function(){return" "},function(){return":"},/^[!-~]/,y([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,y([["","￿"]],!1,!1),/^[\x80-\xBF]/,y([["","¿"]],!1,!1),/^[a-f]/,y([["a","f"]],!1,!1),"`",E("`",!1),"<",E("<",!1),">",E(">",!1),"\\",E("\\",!1),"[",E("[",!1),"]",E("]",!1),"{",E("{",!1),"}",E("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,y([["!","'"]],!1,!1),/^[*-[]/,y([["*","["]],!1,!1),/^[\]-~]/,y([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,y([["#","["]],!1,!1),/^[\0-\t]/,y([["\0","\t"]],!1,!1),/^[\x0B-\f]/,y([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,y([["",""]],!1,!1),function(){(t=t||{data:{}}).data.uri=new s(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){(t=t||{data:{}}).data.uri=new s(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",E("sips",!0),"sip",E("sip",!0),function(e){(t=t||{data:{}}).data.scheme=e},function(){(t=t||{data:{}}).data.user=decodeURIComponent(m().slice(0,-1))},function(){(t=t||{data:{}}).data.password=m()},function(){return(t=t||{data:{}}).data.host=m(),t.data.host},function(){return(t=t||{data:{}}).data.host_type="domain",m()},/^[a-zA-Z0-9_\-]/,y([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,y([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return(t=t||{data:{}}).data.host_type="IPv6",m()},"::",E("::",!1),function(){return(t=t||{data:{}}).data.host_type="IPv6",m()},function(){return(t=t||{data:{}}).data.host_type="IPv4",m()},"25",E("25",!1),/^[0-5]/,y([["0","5"]],!1,!1),"2",E("2",!1),/^[0-4]/,y([["0","4"]],!1,!1),"1",E("1",!1),/^[1-9]/,y([["1","9"]],!1,!1),function(e){return t=t||{data:{}},e=parseInt(e.join("")),t.data.port=e,e},"transport=",E("transport=",!0),"udp",E("udp",!0),"tcp",E("tcp",!0),"sctp",E("sctp",!0),"tls",E("tls",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",E("user=",!0),"phone",E("phone",!0),"ip",E("ip",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",E("method=",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",E("ttl=",!0),function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",E("maddr=",!0),function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",E("lr",!0),function(){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,r){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),r=null===r?void 0:r[1],t.data.uri_params[e.toLowerCase()]=r},function(e,r){e=e.join("").toLowerCase(),r=r.join(""),(t=t||{data:{}}).data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(r):t.data.uri_headers[e]=[r]},function(){"Refer_To"===(t=t||{data:{}}).startRule&&(t.data.uri=new s(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",E("//",!1),function(){(t=t||{data:{}}).data.scheme=m()},E("SIP",!0),function(){(t=t||{data:{}}).data.sip_version=m()},"INVITE",E("INVITE",!1),"ACK",E("ACK",!1),"VXACH",E("VXACH",!1),"OPTIONS",E("OPTIONS",!1),"BYE",E("BYE",!1),"CANCEL",E("CANCEL",!1),"REGISTER",E("REGISTER",!1),"SUBSCRIBE",E("SUBSCRIBE",!1),"NOTIFY",E("NOTIFY",!1),"REFER",E("REFER",!1),"PUBLISH",E("PUBLISH",!1),function(){return(t=t||{data:{}}).data.method=m(),t.data.method},function(e){(t=t||{data:{}}).data.status_code=parseInt(e.join(""))},function(){(t=t||{data:{}}).data.reason_phrase=m()},function(){(t=t||{data:{}}).data=m()},function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new l(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:c,offset:S().start.offset,parsed:e})},function(e){'"'===(e=m().trim())[0]&&(e=e.substring(1,e.length-1)),(t=t||{data:{}}).data.displayName=e},"q",E("q",!0),function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.q=e},"expires",E("expires",!0),function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",E("0",!1),function(){return parseFloat(m())},function(e,r){(t=t||{data:{}}).data.params||(t.data.params={}),r=null===r?void 0:r[1],t.data.params[e.toLowerCase()]=r},"render",E("render",!0),"session",E("session",!0),"icon",E("icon",!0),"alert",E("alert",!0),function(){"Content_Disposition"===(t=t||{data:{}}).startRule&&(t.data.type=m().toLowerCase())},"handling",E("handling",!0),"optional",E("optional",!0),"required",E("required",!0),function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},function(){(t=t||{data:{}}).data=m()},"text",E("text",!0),"image",E("image",!0),"audio",E("audio",!0),"video",E("video",!0),"application",E("application",!0),"message",E("message",!0),"multipart",E("multipart",!0),"x-",E("x-",!0),function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},function(e){(t=t||{data:{}}).data=e},function(e){(t=t||{data:{}}).data.event=e.toLowerCase()},function(){var e=(t=t||{data:{}}).data.tag;t.data=new l(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",E("tag",!0),function(e){(t=t||{data:{}}).data.tag=e},function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},function(e){(t=t||{data:{}}).data=e},function(){(t=t||{data:{}}).data=new l(t.data.uri,t.data.displayName,t.data.params)},"digest",E("Digest",!0),"realm",E("realm",!0),function(e){(t=t||{data:{}}).data.realm=e},"domain",E("domain",!0),"nonce",E("nonce",!0),function(e){(t=t||{data:{}}).data.nonce=e},"opaque",E("opaque",!0),function(e){(t=t||{data:{}}).data.opaque=e},"stale",E("stale",!0),"true",E("true",!0),function(){(t=t||{data:{}}).data.stale=!0},"false",E("false",!0),function(){(t=t||{data:{}}).data.stale=!1},"algorithm",E("algorithm",!0),"md5",E("MD5",!0),"md5-sess",E("MD5-sess",!0),function(e){(t=t||{data:{}}).data.algorithm=e.toUpperCase()},"qop",E("qop",!0),"auth-int",E("auth-int",!0),"auth",E("auth",!0),function(e){(t=t||{data:{}}).data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new l(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:c,offset:S().start.offset,parsed:e})},function(){(t=t||{data:{}}).data=new l(t.data.uri,t.data.displayName,t.data.params)},function(){(t=t||{data:{}}).data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){(t=t||{data:{}}).data={call_id:t.data}},"from-tag",E("from-tag",!0),function(e){(t=t||{data:{}}).data.replaces_from_tag=e},"to-tag",E("to-tag",!0),function(e){(t=t||{data:{}}).data.replaces_to_tag=e},"early-only",E("early-only",!0),function(){(t=t||{data:{}}).data.early_only=!0},function(e,t){return t},function(e,t){return function(e,t){return[e].concat(t)}(e,t)},function(e){"Require"===(t=t||{data:{}}).startRule&&(t.data=e||[])},function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},"active",E("active",!0),"pending",E("pending",!0),"terminated",E("terminated",!0),function(){(t=t||{data:{}}).data.state=m()},"reason",E("reason",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.reason=e)},function(e){t=t||{data:{}},void 0!==e&&(t.data.expires=e)},"retry_after",E("retry_after",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.retry_after=e)},"deactivated",E("deactivated",!0),"probation",E("probation",!0),"rejected",E("rejected",!0),"timeout",E("timeout",!0),"giveup",E("giveup",!0),"noresource",E("noresource",!0),"invariant",E("invariant",!0),function(e){"Supported"===(t=t||{data:{}}).startRule&&(t.data=e||[])},function(){var e=(t=t||{data:{}}).data.tag;t.data=new l(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",E("ttl",!0),function(e){(t=t||{data:{}}).data.ttl=e},"maddr",E("maddr",!0),function(e){(t=t||{data:{}}).data.maddr=e},"received",E("received",!0),function(e){(t=t||{data:{}}).data.received=e},"branch",E("branch",!0),function(e){(t=t||{data:{}}).data.branch=e},"rport",E("rport",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.rport=e.join(""))},function(e){(t=t||{data:{}}).data.protocol=e},E("UDP",!0),E("TCP",!0),E("TLS",!0),E("SCTP",!0),function(e){(t=t||{data:{}}).data.transport=e},function(){(t=t||{data:{}}).data.host=m()},function(e){(t=t||{data:{}}).data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.deltaSeconds=e)},"refresher",E("refresher",!1),"uas",E("uas",!1),"uac",E("uac",!1),function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.refresher=e)},function(e){"Min_SE"===(t=t||{data:{}}).startRule&&(t.data=e)},"stuns",E("stuns",!0),"stun",E("stun",!0),function(e){(t=t||{data:{}}).data.scheme=e},function(e){(t=t||{data:{}}).data.host=e},"?transport=",E("?transport=",!1),"turns",E("turns",!0),"turn",E("turn",!0),function(e){(t=t||{data:{}}).data.transport=e},function(){(t=t||{data:{}}).data=m()},"Referred-By",E("Referred-By",!1),"b",E("b",!1),"cid",E("cid",!1)],a=[b('2 ""6 7!'),b('4"""5!7#'),b('4$""5!7%'),b('4&""5!7\''),b(";'.# &;("),b('4(""5!7)'),b('4*""5!7+'),b('2,""6,7-'),b('2.""6.7/'),b('40""5!71'),b('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),b(";).# &;,"),b('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),b('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),b('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),b(';.." &"'),b("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),b('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),b('4\\""5!7].# &;3'),b('4^""5!7_'),b('4`""5!7a'),b(';!.) &4b""5!7c'),b('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),b('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),b('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),b('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),b("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),b("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),b("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),b("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),b("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),b('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),b('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),b("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),b("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),b("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),b("%;//0#;&/'$8\":~\" )(\"'#&'#"),b("%;&/0#;//'$8\":~\" )(\"'#&'#"),b("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),b('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),b("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),b("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),b(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),b('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),b("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),b("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),b('%3""5$7.) &3""5#7/\' 8!:!! )'),b('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),b("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),b('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),b('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),b('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b("%;U.) &;\\.# &;X/& 8!:! )"),b('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),b('$4""5!7/,#0)*4""5!7&&&#'),b('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),b('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),b('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),b('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),b("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),b("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),b('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),b('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),b('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),b(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),b('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),b('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),b('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),b('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),b('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),b('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),b('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),b('%$;j/&#0#*;j&&&#/"!&,)'),b('%$;j/&#0#*;j&&&#/"!&,)'),b(";k.) &;+.# &;-"),b('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),b('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),b('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),b("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),b("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),b('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),b(";.# &;r"),b("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),b(";M.# &;t"),b("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),b('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),b('%24""6475/,#;{/#$+")("\'#&\'#'),b("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),b(";*.) &;+.# &;-"),b(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),b('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),b('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),b("$;~0#*;~&"),b(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),b('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),b(";.# &;"),b('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),b('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),b("$;y0#*;y&"),b('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),b('2Õ""6Õ7Ö'),b('2×""6×7Ø'),b('2Ù""6Ù7Ú'),b('2Û""6Û7Ü'),b('2Ý""6Ý7Þ'),b('2ß""6ß7à'),b('2á""6á7â'),b('2ã""6ã7ä'),b('2å""6å7æ'),b('2ç""6ç7è'),b('2é""6é7ê'),b("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),b("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),b("%;/' 8!:ì!! )"),b("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),b("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),b("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),b("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),b("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),b("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),b("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),b(";.) &;.# &; "),b("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),b("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),b('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),b('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),b(";6.) &;T.# &;H"),b("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),b(";¥.# &; "),b('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),b("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),b("%;©/& 8!:č! )"),b("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),b(";«.# &;¬"),b('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),b('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),b(";6.# &;®"),b('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),b(";­.# &;6"),b("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),b(";6.# &;H"),b("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),b("%;/' 8!:ğ!! )"),b('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),b('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),b("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),b(";¹.# &; "),b("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),b("%;/' 8!:Ħ!! )"),b("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),b(";¾"),b("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),b("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),b("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),b(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),b("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),b("%;I/' 8!:Ĭ!! )"),b("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),b(";t.# &;w"),b("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),b("%;I/' 8!:ı!! )"),b("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),b('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),b('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),b('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),b('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),b("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),b("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),b("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),b('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),b("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),b("%;/& 8!:Ő! )"),b('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),b('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),b("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),b("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),b("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),b('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),b(';1." &"'),b('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),b("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),b(";¹.# &; "),b("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),b(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),b("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),b("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),b("%3Ƃ\"\"5(7ƃ/F#;</=$;\\.) &;Y.# &;X/($8#:Ƅ#! )(#'#(\"'#&'#"),b("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),b("%3ƈ\"\"5%7Ɖ/A#;</8$$;!0#*;!&/($8#:Ɗ#! )(#'#(\"'#&'#"),b("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),b('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),b('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),b('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),b('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),b('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),b(";¾"),b('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),b(";ô.# &; "),b('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),b('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),b("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),b("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),b("$;%0#*;%&"),b("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),b('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),b('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),b(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),b('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),b('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),b('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),b('%3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\' 8!:Ʃ!! )'),b("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),b("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),b("%;ă/,#;ă/#$+\")(\"'#&'#"),b("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),b("%;q/T#$;m0#*;m&/D$%; /,#;ø/#$+\")(\"'#&'#.\" &\"/#$+#)(#'#(\"'#&'#"),b('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),b(";.# &;L"),b("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),b("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")];let c=0,u=0;const h=[{line:1,column:1}];let p,f=0,g=[],v=0;if(void 0!==t.startRule){if(!(t.startRule in n))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=n[t.startRule]}function m(){return e.substring(u,c)}function S(){return T(u,c)}function E(e,t){return{type:"literal",text:e,ignoreCase:t}}function y(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function _(t){let r,n=h[t];if(n)return n;for(r=t-1;!h[r];)r--;for(n=h[r],n={line:n.line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return h[t]=n,n}function T(e,t){const r=_(e),n=_(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function R(e){c<f||(c>f&&(f=c,g=[]),g.push(e))}function b(e){return e.split("").map((e=>e.charCodeAt(0)-32))}if(t.data={},p=function t(n){const i=a[n];let s=0;const l=[];let d=i.length;const h=[],p=[];let f;for(;;){for(;s<d;)switch(i[s]){case 0:p.push(o[i[s+1]]),s+=2;break;case 1:p.push(void 0),s++;break;case 2:p.push(null),s++;break;case 3:p.push(r),s++;break;case 4:p.push([]),s++;break;case 5:p.push(c),s++;break;case 6:p.pop(),s++;break;case 7:c=p.pop(),s++;break;case 8:p.length-=i[s+1],s+=2;break;case 9:p.splice(-2,1),s++;break;case 10:p[p.length-2].push(p.pop()),s++;break;case 11:p.push(p.splice(p.length-i[s+1],i[s+1])),s+=2;break;case 12:p.push(e.substring(p.pop(),c)),s++;break;case 13:h.push(d),l.push(s+3+i[s+1]+i[s+2]),p[p.length-1]?(d=s+3+i[s+1],s+=3):(d=s+3+i[s+1]+i[s+2],s+=3+i[s+1]);break;case 14:h.push(d),l.push(s+3+i[s+1]+i[s+2]),p[p.length-1]===r?(d=s+3+i[s+1],s+=3):(d=s+3+i[s+1]+i[s+2],s+=3+i[s+1]);break;case 15:h.push(d),l.push(s+3+i[s+1]+i[s+2]),p[p.length-1]!==r?(d=s+3+i[s+1],s+=3):(d=s+3+i[s+1]+i[s+2],s+=3+i[s+1]);break;case 16:p[p.length-1]!==r?(h.push(d),l.push(s),d=s+2+i[s+1],s+=2):s+=2+i[s+1];break;case 17:h.push(d),l.push(s+3+i[s+1]+i[s+2]),e.length>c?(d=s+3+i[s+1],s+=3):(d=s+3+i[s+1]+i[s+2],s+=3+i[s+1]);break;case 18:h.push(d),l.push(s+4+i[s+2]+i[s+3]),e.substr(c,o[i[s+1]].length)===o[i[s+1]]?(d=s+4+i[s+2],s+=4):(d=s+4+i[s+2]+i[s+3],s+=4+i[s+2]);break;case 19:h.push(d),l.push(s+4+i[s+2]+i[s+3]),e.substr(c,o[i[s+1]].length).toLowerCase()===o[i[s+1]]?(d=s+4+i[s+2],s+=4):(d=s+4+i[s+2]+i[s+3],s+=4+i[s+2]);break;case 20:h.push(d),l.push(s+4+i[s+2]+i[s+3]),o[i[s+1]].test(e.charAt(c))?(d=s+4+i[s+2],s+=4):(d=s+4+i[s+2]+i[s+3],s+=4+i[s+2]);break;case 21:p.push(e.substr(c,i[s+1])),c+=i[s+1],s+=2;break;case 22:p.push(o[i[s+1]]),c+=o[i[s+1]].length,s+=2;break;case 23:p.push(r),0===v&&R(o[i[s+1]]),s+=2;break;case 24:u=p[p.length-1-i[s+1]],s+=2;break;case 25:u=c,s++;break;case 26:f=i.slice(s+4,s+4+i[s+3]).map((function(e){return p[p.length-1-e]})),p.splice(p.length-i[s+2],i[s+2],o[i[s+1]].apply(null,f)),s+=4+i[s+3];break;case 27:p.push(t(i[s+1])),s+=2;break;case 28:v++,s++;break;case 29:v--,s++;break;default:throw new Error("Invalid opcode: "+i[s]+".")}if(!(h.length>0))break;d=h.pop(),s=l.pop()}return p[0]}(i),p!==r&&c===e.length)return p;throw p!==r&&c<e.length&&R({type:"end"}),w=g,A=f<e.length?e.charAt(f):null,C=f<e.length?T(f,f+1):T(f,f),new d(d.buildMessage(w,A),w,A,C);var w,A,C}(e,r)}catch(e){r.data=-1}return r.data},e.nameAddrHeaderParse=function(t){const r=e.parse(t,"Name_Addr_Header");return-1!==r?r:void 0},e.URIParse=function(t){const r=e.parse(t,"SIP_URI");return-1!==r?r:void 0}}(o||(o={}));class h{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=h.hexChars,r=h.hexOut;let n,i,o,a;for(a=0;a<4;a+=1)for(i=8*a,n=e[a],o=0;o<8;o+=2)r[i+1+o]=t.charAt(15&n),n>>>=4,r[i+0+o]=t.charAt(15&n),n>>>=4;return r.join("")}static _md5cycle(e,t){let r=e[0],n=e[1],i=e[2],o=e[3];r+=(n&i|~n&o)+t[0]-680876936|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[1]-389564586|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[2]+606105819|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[3]-1044525330|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&o)+t[4]-176418897|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[5]+1200080426|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[6]-1473231341|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[7]-45705983|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&o)+t[8]+1770035416|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[9]-1958414417|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[10]-42063|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[11]-1990404162|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&o)+t[12]+1804603682|0,r=(r<<7|r>>>25)+n|0,o+=(r&n|~r&i)+t[13]-40341101|0,o=(o<<12|o>>>20)+r|0,i+=(o&r|~o&n)+t[14]-1502002290|0,i=(i<<17|i>>>15)+o|0,n+=(i&o|~i&r)+t[15]+1236535329|0,n=(n<<22|n>>>10)+i|0,r+=(n&o|i&~o)+t[1]-165796510|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[6]-1069501632|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[11]+643717713|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[0]-373897302|0,n=(n<<20|n>>>12)+i|0,r+=(n&o|i&~o)+t[5]-701558691|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[10]+38016083|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[15]-660478335|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[4]-405537848|0,n=(n<<20|n>>>12)+i|0,r+=(n&o|i&~o)+t[9]+568446438|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[14]-1019803690|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[3]-187363961|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[8]+1163531501|0,n=(n<<20|n>>>12)+i|0,r+=(n&o|i&~o)+t[13]-1444681467|0,r=(r<<5|r>>>27)+n|0,o+=(r&i|n&~i)+t[2]-51403784|0,o=(o<<9|o>>>23)+r|0,i+=(o&n|r&~n)+t[7]+1735328473|0,i=(i<<14|i>>>18)+o|0,n+=(i&r|o&~r)+t[12]-1926607734|0,n=(n<<20|n>>>12)+i|0,r+=(n^i^o)+t[5]-378558|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[8]-2022574463|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[11]+1839030562|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[14]-35309556|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^o)+t[1]-1530992060|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[4]+1272893353|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[7]-155497632|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[10]-1094730640|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^o)+t[13]+681279174|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[0]-358537222|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[3]-722521979|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[6]+76029189|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^o)+t[9]-640364487|0,r=(r<<4|r>>>28)+n|0,o+=(r^n^i)+t[12]-421815835|0,o=(o<<11|o>>>21)+r|0,i+=(o^r^n)+t[15]+530742520|0,i=(i<<16|i>>>16)+o|0,n+=(i^o^r)+t[2]-995338651|0,n=(n<<23|n>>>9)+i|0,r+=(i^(n|~o))+t[0]-198630844|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[7]+1126891415|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[14]-1416354905|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[5]-57434055|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[12]+1700485571|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[3]-1894986606|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[10]-1051523|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[1]-2054922799|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[8]+1873313359|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[15]-30611744|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[6]-1560198380|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[13]+1309151649|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[4]-145523070|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[11]-1120210379|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[2]+718787259|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[9]-343485551|0,n=(n<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(h.stateIdentity),this}appendStr(e){const t=this._buffer8,r=this._buffer32;let n,i,o=this._bufferLength;for(i=0;i<e.length;i+=1){if(n=e.charCodeAt(i),n<128)t[o++]=n;else if(n<2048)t[o++]=192+(n>>>6),t[o++]=63&n|128;else if(n<55296||n>56319)t[o++]=224+(n>>>12),t[o++]=n>>>6&63|128,t[o++]=63&n|128;else{if(n=1024*(n-55296)+(e.charCodeAt(++i)-56320)+65536,n>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[o++]=240+(n>>>18),t[o++]=n>>>12&63|128,t[o++]=n>>>6&63|128,t[o++]=63&n|128}o>=64&&(this._dataLength+=64,h._md5cycle(this._state,r),o-=64,r[0]=r[16])}return this._bufferLength=o,this}appendAsciiStr(e){const t=this._buffer8,r=this._buffer32;let n,i=this._bufferLength,o=0;for(;;){for(n=Math.min(e.length-o,64-i);n--;)t[i++]=e.charCodeAt(o++);if(i<64)break;this._dataLength+=64,h._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}appendByteArray(e){const t=this._buffer8,r=this._buffer32;let n,i=this._bufferLength,o=0;for(;;){for(n=Math.min(e.length-o,64-i);n--;)t[i++]=e[o++];if(i<64)break;this._dataLength+=64,h._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}getState(){const e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}}setState(e){const t=e.buffer,r=e.state,n=this._state;let i;for(this._dataLength=e.length,this._bufferLength=e.buflen,n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],i=0;i<t.length;i+=1)this._buffer8[i]=t.charCodeAt(i)}end(e=!1){const t=this._bufferLength,r=this._buffer8,n=this._buffer32,i=1+(t>>2);let o;if(this._dataLength+=t,r[t]=128,r[t+1]=r[t+2]=r[t+3]=0,n.set(h.buffer32Identity.subarray(i),i),t>55&&(h._md5cycle(this._state,n),n.set(h.buffer32Identity)),o=8*this._dataLength,o<=4294967295)n[14]=o;else{const e=o.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),r=parseInt(e[1],16)||0;n[14]=t,n[15]=r}return h._md5cycle(this._state,n),e?this._state:h._hex(this._state)}}h.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),h.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),h.hexChars="0123456789abcdef",h.hexOut=[],h.onePassHasher=new h,"5d41402abc4b2a76b9719d911017c592"!==h.hashStr("hello")&&console.error("Md5 self test failed.");const p={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"};function f(e,t=32){let r="";for(let n=0;n<e;n++)r+=Math.floor(Math.random()*t).toString(t);return r}function g(e){return p[e]||""}function v(){return f(10)}function m(e){const t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length;let i="";for(let e=0;e<n;e++)0!==e&&(i+="-"),i+=r[e].charAt(0).toUpperCase()+r[e].substring(1);return t[i]&&(i=t[i]),i}function S(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}function E(e){return h.hashStr(e)}class y{constructor(e,t,r,n){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=r,this.password=n,this.ha1=t,this.nc=0,this.ncHex="00000000"}authenticate(e,t,r){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=f(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(r),!0}toString(){const e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")}updateNcHex(){const e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e}calculateResponse(e){let t,r;t=this.ha1,""!==t&&void 0!==t||(t=E(this.username+":"+this.realm+":"+this.password)),"auth"===this.qop?(r=E(this.method+":"+this.uri),this.response=E(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+r)):"auth-int"===this.qop?(r=E(this.method+":"+this.uri+":"+E(e||"")),this.response=E(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+r)):void 0===this.qop&&(r=E(this.method+":"+this.uri),this.response=E(t+":"+this.nonce+":"+r))}}var _,T,R,b,w;!function(e){e.ACK="ACK",e.BYE="BYE",e.CANCEL="CANCEL",e.INFO="INFO",e.INVITE="INVITE",e.MESSAGE="MESSAGE",e.NOTIFY="NOTIFY",e.OPTIONS="OPTIONS",e.REGISTER="REGISTER",e.UPDATE="UPDATE",e.SUBSCRIBE="SUBSCRIBE",e.PUBLISH="PUBLISH",e.REFER="REFER",e.PRACK="PRACK"}(_||(_={}));class A{constructor(e,t,r,n,i,o,a){this.headers={},this.extraHeaders=[],this.options=A.getDefaultOptions(),i&&(this.options=Object.assign(Object.assign({},this.options),i),this.options.optionTags&&this.options.optionTags.length&&(this.options.optionTags=this.options.optionTags.slice()),this.options.routeSet&&this.options.routeSet.length&&(this.options.routeSet=this.options.routeSet.slice())),o&&o.length&&(this.extraHeaders=o.slice()),a&&(this.body={body:a.content,contentType:a.contentType}),this.method=e,this.ruri=t.clone(),this.fromURI=r.clone(),this.fromTag=this.options.fromTag?this.options.fromTag:v(),this.from=A.makeNameAddrHeader(this.fromURI,this.options.fromDisplayName,this.fromTag),this.toURI=n.clone(),this.toTag=this.options.toTag,this.to=A.makeNameAddrHeader(this.toURI,this.options.toDisplayName,this.toTag),this.callId=this.options.callId?this.options.callId:this.options.callIdPrefix+f(15),this.cseq=this.options.cseq,this.setHeader("route",this.options.routeSet),this.setHeader("via",""),this.setHeader("to",this.to.toString()),this.setHeader("from",this.from.toString()),this.setHeader("cseq",this.cseq+" "+this.method),this.setHeader("call-id",this.callId),this.setHeader("max-forwards","70")}static getDefaultOptions(){return{callId:"",callIdPrefix:"",cseq:1,toDisplayName:"",toTag:"",fromDisplayName:"",fromTag:"",forceRport:!1,hackViaTcp:!1,optionTags:["outbound"],routeSet:[],userAgentString:"sip.js",viaHost:""}}static makeNameAddrHeader(e,t,r){const n={};return r&&(n.tag=r),new l(e,t,n)}getHeader(e){const t=this.headers[m(e)];if(t){if(t[0])return t[0]}else{const t=new RegExp("^\\s*"+e+"\\s*:","i");for(const e of this.extraHeaders)if(t.test(e))return e.substring(e.indexOf(":")+1).trim()}}getHeaders(e){const t=[],r=this.headers[m(e)];if(r)for(const e of r)t.push(e);else{const r=new RegExp("^\\s*"+e+"\\s*:","i");for(const e of this.extraHeaders)r.test(e)&&t.push(e.substring(e.indexOf(":")+1).trim())}return t}hasHeader(e){if(this.headers[m(e)])return!0;{const t=new RegExp("^\\s*"+e+"\\s*:","i");for(const e of this.extraHeaders)if(t.test(e))return!0}return!1}setHeader(e,t){this.headers[m(e)]=t instanceof Array?t:[t]}setViaHeader(e,t){this.options.hackViaTcp&&(t="TCP");let r="SIP/2.0/"+t;r+=" "+this.options.viaHost+";branch="+e,this.options.forceRport&&(r+=";rport"),this.setHeader("via",r),this.branch=e}toString(){let e="";e+=this.method+" "+this.ruri.toRaw()+" SIP/2.0\r\n";for(const t in this.headers)if(this.headers[t])for(const r of this.headers[t])e+=t+": "+r+"\r\n";for(const t of this.extraHeaders)e+=t.trim()+"\r\n";return e+="Supported: "+this.options.optionTags.join(", ")+"\r\n",e+="User-Agent: "+this.options.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+S(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+S(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e}}function C(e,t){const r="\r\n";if(t.statusCode<100||t.statusCode>699)throw new TypeError("Invalid statusCode: "+t.statusCode);const n=t.reasonPhrase?t.reasonPhrase:g(t.statusCode);let i="SIP/2.0 "+t.statusCode+" "+n+r;t.statusCode>=100&&t.statusCode,t.statusCode;const o="From: "+e.getHeader("From")+r,a="Call-ID: "+e.callId+r,s="CSeq: "+e.cseq+" "+e.method+r,c=e.getHeaders("via").reduce(((e,t)=>e+"Via: "+t+r),"");let u="To: "+e.getHeader("to");if(t.statusCode>100&&!e.parseHeader("to").hasParam("tag")){let e=t.toTag;e||(e=v()),u+=";tag="+e}u+=r;let l="";t.supported&&(l="Supported: "+t.supported.join(", ")+r);let d="";t.userAgent&&(d="User-Agent: "+t.userAgent+r);let h="";return t.extraHeaders&&(h=t.extraHeaders.reduce(((e,t)=>e+t.trim()+r),"")),i+=c,i+=o,i+=u,i+=s,i+=a,i+=l,i+=d,i+=h,t.body?(i+="Content-Type: "+t.body.contentType+r,i+="Content-Length: "+S(t.body.content)+r+r,i+=t.body.content):i+="Content-Length: 0\r\n\r\n",{message:i}}class I extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class O extends I{constructor(e){super(e||"Unspecified transport error.")}}class P{constructor(e,t,r,n,i){this._transport=e,this._user=t,this._id=r,this._state=n,this.listeners=new Array,this.logger=t.loggerFactory.getLogger(i,r),this.logger.debug(`Constructing ${this.typeToString()} with id ${this.id}.`)}dispose(){this.logger.debug(`Destroyed ${this.typeToString()} with id ${this.id}.`)}get id(){return this._id}get kind(){throw new Error("Invalid kind.")}get state(){return this._state}get transport(){return this._transport}addStateChangeListener(e,t){const r=()=>{this.removeStateChangeListener(r),e()};!0===(null==t?void 0:t.once)?this.listeners.push(r):this.listeners.push(e)}notifyStateChangeListeners(){this.listeners.slice().forEach((e=>e()))}removeStateChangeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}logTransportError(e,t){this.logger.error(e.message),this.logger.error(`Transport error occurred in ${this.typeToString()} with id ${this.id}.`),this.logger.error(t)}send(e){return this.transport.send(e).catch((e=>{if(e instanceof O)throw this.onTransportError(e),e;let t;throw t=e&&"string"==typeof e.message?new O(e.message):new O,this.onTransportError(t),t}))}setState(e){this.logger.debug(`State change to "${e}" on ${this.typeToString()} with id ${this.id}.`),this._state=e,this._user.onStateChange&&this._user.onStateChange(e),this.notifyStateChangeListeners()}typeToString(){return"UnknownType"}}class N extends P{constructor(e,t,r,n,i){super(t,r,N.makeId(e),n,i),this._request=e,this.user=r,e.setViaHeader(this.id,t.protocol)}static makeId(e){if("CANCEL"===e.method){if(!e.branch)throw new Error("Outgoing CANCEL request without a branch.");return e.branch}return"z9hG4bK"+Math.floor(1e7*Math.random())}get request(){return this._request}onRequestTimeout(){this.user.onRequestTimeout&&this.user.onRequestTimeout()}}!function(e){e.Accepted="Accepted",e.Calling="Calling",e.Completed="Completed",e.Confirmed="Confirmed",e.Proceeding="Proceeding",e.Terminated="Terminated",e.Trying="Trying"}(T||(T={}));class k extends N{constructor(e,t,r){super(e,t,r,T.Trying,"sip.transaction.nict"),this.F=setTimeout((()=>this.timerF()),32e3),this.send(e.toString()).catch((e=>{this.logTransportError(e,"Failed to send initial outgoing request.")}))}dispose(){this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),super.dispose()}get kind(){return"nict"}receiveResponse(e){const t=e.statusCode;if(!t||t<100||t>699)throw new Error(`Invalid status code ${t}`);switch(this.state){case T.Trying:if(t>=100&&t<=199)return this.stateTransition(T.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=699)return this.stateTransition(T.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Proceeding:if(t>=100&&t<=199&&this.user.receiveResponse)return this.user.receiveResponse(e);if(t>=200&&t<=699)return this.stateTransition(T.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Completed:case T.Terminated:return;default:throw new Error(`Invalid state ${this.state}`)}const r=`Non-INVITE client transaction received unexpected ${t} response while in state ${this.state}.`;this.logger.warn(r)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(T.Terminated,!0)}typeToString(){return"non-INVITE client transaction"}stateTransition(e,t=!1){const r=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Trying:r();break;case T.Proceeding:this.state!==T.Trying&&r();break;case T.Completed:this.state!==T.Trying&&this.state!==T.Proceeding&&r();break;case T.Terminated:this.state!==T.Trying&&this.state!==T.Proceeding&&this.state!==T.Completed&&(t||r());break;default:r()}e===T.Completed&&(this.F&&(clearTimeout(this.F),this.F=void 0),this.K=setTimeout((()=>this.timerK()),0)),e===T.Terminated&&this.dispose(),this.setState(e)}timerF(){this.logger.debug(`Timer F expired for non-INVITE client transaction ${this.id}.`),this.state!==T.Trying&&this.state!==T.Proceeding||(this.onRequestTimeout(),this.stateTransition(T.Terminated))}timerK(){this.state===T.Completed&&this.stateTransition(T.Terminated)}}class M extends P{constructor(e,t,r,n,i){super(t,r,e.viaBranch,n,i),this._request=e,this.user=r}get request(){return this._request}}class D extends M{constructor(e,t,r){super(e,t,r,T.Proceeding,"sip.transaction.ist")}dispose(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),super.dispose()}get kind(){return"ist"}receiveRequest(e){switch(this.state){case T.Proceeding:if(e.method===_.INVITE)return void(this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")})));break;case T.Accepted:if(e.method===_.INVITE)return;break;case T.Completed:if(e.method===_.INVITE){if(!this.lastFinalResponse)throw new Error("Last final response undefined.");return void this.send(this.lastFinalResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of final response.")}))}if(e.method===_.ACK)return void this.stateTransition(T.Confirmed);break;case T.Confirmed:case T.Terminated:if(e.method===_.INVITE||e.method===_.ACK)return;break;default:throw new Error(`Invalid state ${this.state}`)}const t=`INVITE server transaction received unexpected ${e.method} request while in state ${this.state}.`;this.logger.warn(t)}receiveResponse(e,t){if(e<100||e>699)throw new Error(`Invalid status code ${e}`);switch(this.state){case T.Proceeding:if(e>=100&&e<=199)return this.lastProvisionalResponse=t,e>100&&this.startProgressExtensionTimer(),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send 1xx response.")}));if(e>=200&&e<=299)return this.lastFinalResponse=t,this.stateTransition(T.Accepted),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send 2xx response.")}));if(e>=300&&e<=699)return this.lastFinalResponse=t,this.stateTransition(T.Completed),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send non-2xx final response.")}));break;case T.Accepted:if(e>=200&&e<=299)return void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send 2xx response.")}));break;case T.Completed:case T.Confirmed:case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}const r=`INVITE server transaction received unexpected ${e} response from TU while in state ${this.state}.`;throw this.logger.error(r),new Error(r)}retransmitAcceptedResponse(){this.state===T.Accepted&&this.lastFinalResponse&&this.send(this.lastFinalResponse).catch((e=>{this.logTransportError(e,"Failed to send 2xx response.")}))}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e)}typeToString(){return"INVITE server transaction"}stateTransition(e){const t=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Proceeding:t();break;case T.Accepted:case T.Completed:this.state!==T.Proceeding&&t();break;case T.Confirmed:this.state!==T.Completed&&t();break;case T.Terminated:this.state!==T.Accepted&&this.state!==T.Completed&&this.state!==T.Confirmed&&t();break;default:t()}this.stopProgressExtensionTimer(),e===T.Accepted&&(this.L=setTimeout((()=>this.timerL()),32e3)),e===T.Completed&&(this.H=setTimeout((()=>this.timerH()),32e3)),e===T.Confirmed&&(this.I=setTimeout((()=>this.timerI()),0)),e===T.Terminated&&this.dispose(),this.setState(e)}startProgressExtensionTimer(){void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval((()=>{if(this.logger.debug(`Progress extension timer expired for INVITE server transaction ${this.id}.`),!this.lastProvisionalResponse)throw new Error("Last provisional response undefined.");this.send(this.lastProvisionalResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")}))}),6e4))}stopProgressExtensionTimer(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)}timerG(){}timerH(){this.logger.debug(`Timer H expired for INVITE server transaction ${this.id}.`),this.state===T.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(T.Terminated))}timerI(){this.logger.debug(`Timer I expired for INVITE server transaction ${this.id}.`),this.stateTransition(T.Terminated)}timerL(){this.logger.debug(`Timer L expired for INVITE server transaction ${this.id}.`),this.state===T.Accepted&&this.stateTransition(T.Terminated)}}class L{constructor(e,t){this.core=e,this.dialogState=t,this.core.dialogs.set(this.id,this)}static initialDialogStateForUserAgentClient(e,t){const r=t.getHeaders("record-route").reverse(),n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof l))throw new Error("Contact not instance of NameAddrHeader.");const i=n.uri,o=e.cseq,a=e.callId,s=e.fromTag,c=t.toTag;if(!a)throw new Error("Call id undefined.");if(!s)throw new Error("From tag undefined.");if(!c)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");const u=e.from.uri,d=e.to.uri;if(!t.statusCode)throw new Error("Incoming response status code undefined.");return{id:a+s+c,early:t.statusCode<200,callId:a,localTag:s,remoteTag:c,localSequenceNumber:o,remoteSequenceNumber:void 0,localURI:u,remoteURI:d,remoteTarget:i,routeSet:r,secure:!1}}static initialDialogStateForUserAgentServer(e,t,r=!1){const n=e.getHeaders("record-route"),i=e.parseHeader("contact");if(!i)throw new Error("Contact undefined.");if(!(i instanceof l))throw new Error("Contact not instance of NameAddrHeader.");const o=i.uri,a=e.cseq,s=e.callId,c=t,u=e.fromTag,d=e.from.uri;return{id:s+c+u,early:r,callId:s,localTag:c,remoteTag:u,localSequenceNumber:void 0,remoteSequenceNumber:a,localURI:e.to.uri,remoteURI:d,remoteTarget:o,routeSet:n,secure:!1}}dispose(){this.core.dialogs.delete(this.id)}get id(){return this.dialogState.id}get early(){return this.dialogState.early}get callId(){return this.dialogState.callId}get localTag(){return this.dialogState.localTag}get remoteTag(){return this.dialogState.remoteTag}get localSequenceNumber(){return this.dialogState.localSequenceNumber}get remoteSequenceNumber(){return this.dialogState.remoteSequenceNumber}get localURI(){return this.dialogState.localURI}get remoteURI(){return this.dialogState.remoteURI}get remoteTarget(){return this.dialogState.remoteTarget}get routeSet(){return this.dialogState.routeSet}get secure(){return this.dialogState.secure}get userAgentCore(){return this.core}confirm(){this.dialogState.early=!1}receiveRequest(e){if(e.method!==_.ACK){if(this.remoteSequenceNumber){if(e.cseq<=this.remoteSequenceNumber)throw new Error("Out of sequence in dialog request. Did you forget to call sequenceGuard()?");this.dialogState.remoteSequenceNumber=e.cseq}this.remoteSequenceNumber||(this.dialogState.remoteSequenceNumber=e.cseq)}}recomputeRouteSet(e){this.dialogState.routeSet=e.getHeaders("record-route").reverse()}createOutgoingRequestMessage(e,t){const r=this.remoteURI,n=this.remoteTag,i=this.localURI,o=this.localTag,a=this.callId;let s;s=t&&t.cseq?t.cseq:this.dialogState.localSequenceNumber?this.dialogState.localSequenceNumber+=1:this.dialogState.localSequenceNumber=1;const c=this.remoteTarget,u=this.routeSet,l=t&&t.extraHeaders,d=t&&t.body;return this.userAgentCore.makeOutgoingRequestMessage(e,c,i,r,{callId:a,cseq:s,fromTag:o,toTag:n,routeSet:u},l,d)}incrementLocalSequenceNumber(){if(!this.dialogState.localSequenceNumber)throw new Error("Local sequence number undefined.");this.dialogState.localSequenceNumber+=1}sequenceGuard(e){return!(e.method!==_.ACK&&this.remoteSequenceNumber&&e.cseq<=this.remoteSequenceNumber&&(this.core.replyStateless(e,{statusCode:500}),1))}}class x{constructor(){this.headers={}}addHeader(e,t){const r={raw:t};e=m(e),this.headers[e]?this.headers[e].push(r):this.headers[e]=[r]}getHeader(e){const t=this.headers[m(e)];if(t)return t[0]?t[0].raw:void 0}getHeaders(e){const t=this.headers[m(e)],r=[];if(!t)return[];for(const e of t)r.push(e.raw);return r}hasHeader(e){return!!this.headers[m(e)]}parseHeader(e,t=0){if(e=m(e),!this.headers[e])return;if(t>=this.headers[e].length)return;const r=this.headers[e][t],n=r.raw;if(r.parsed)return r.parsed;const i=o.parse(n,e.replace(/-/g,"_"));return-1===i?void this.headers[e].splice(t,1):(r.parsed=i,i)}s(e,t=0){return this.parseHeader(e,t)}setHeader(e,t){this.headers[m(e)]=[{raw:t}]}toString(){return this.data}}class V extends x{constructor(){super()}}class U extends x{constructor(){super()}}function j(e){return"application/sdp"===e?"session":"render"}function H(e){const t="string"==typeof e?e:e.body,r="string"==typeof e?"application/sdp":e.contentType;return{contentDisposition:j(r),contentType:r,content:t}}function B(e){return!(!e||"string"!=typeof e.content||"string"!=typeof e.contentType||void 0!==e.contentDisposition)||"string"==typeof e.contentDisposition}function $(e){let t,r,n;if(e instanceof V&&e.body){const i=e.parseHeader("Content-Disposition");t=i?i.type:void 0,r=e.parseHeader("Content-Type"),n=e.body}if(e instanceof U&&e.body){const i=e.parseHeader("Content-Disposition");t=i?i.type:void 0,r=e.parseHeader("Content-Type"),n=e.body}if(e instanceof A&&e.body)if(t=e.getHeader("Content-Disposition"),r=e.getHeader("Content-Type"),"string"==typeof e.body){if(!r)throw new Error("Header content type header does not equal body content type.");n=e.body}else{if(r&&r!==e.body.contentType)throw new Error("Header content type header does not equal body content type.");r=e.body.contentType,n=e.body.body}if(B(e)&&(t=e.contentDisposition,r=e.contentType,n=e.content),n){if(r&&!t&&(t=j(r)),!t)throw new Error("Content disposition undefined.");if(!r)throw new Error("Content type undefined.");return{contentDisposition:t,contentType:r,content:n}}}!function(e){e.Initial="Initial",e.Early="Early",e.AckWait="AckWait",e.Confirmed="Confirmed",e.Terminated="Terminated"}(R||(R={})),function(e){e.Initial="Initial",e.HaveLocalOffer="HaveLocalOffer",e.HaveRemoteOffer="HaveRemoteOffer",e.Stable="Stable",e.Closed="Closed"}(b||(b={}));class F extends N{constructor(e,t,r){super(e,t,r,T.Calling,"sip.transaction.ict"),this.ackRetransmissionCache=new Map,this.B=setTimeout((()=>this.timerB()),32e3),this.send(e.toString()).catch((e=>{this.logTransportError(e,"Failed to send initial outgoing request.")}))}dispose(){this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),super.dispose()}get kind(){return"ict"}ackResponse(e){const t=e.toTag;if(!t)throw new Error("To tag undefined.");const r="z9hG4bK"+Math.floor(1e7*Math.random());e.setViaHeader(r,this.transport.protocol),this.ackRetransmissionCache.set(t,e),this.send(e.toString()).catch((e=>{this.logTransportError(e,"Failed to send ACK to 2xx response.")}))}receiveResponse(e){const t=e.statusCode;if(!t||t<100||t>699)throw new Error(`Invalid status code ${t}`);switch(this.state){case T.Calling:if(t>=100&&t<=199)return this.stateTransition(T.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(T.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=300&&t<=699)return this.stateTransition(T.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Proceeding:if(t>=100&&t<=199)return void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(T.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=300&&t<=699)return this.stateTransition(T.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case T.Accepted:if(t>=200&&t<=299){if(!this.ackRetransmissionCache.has(e.toTag))return this.ackRetransmissionCache.set(e.toTag,void 0),void(this.user.receiveResponse&&this.user.receiveResponse(e));const t=this.ackRetransmissionCache.get(e.toTag);return t?void this.send(t.toString()).catch((e=>{this.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")})):void 0}break;case T.Completed:if(t>=300&&t<=699)return void this.ack(e);break;case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}const r=`Received unexpected ${t} response while in state ${this.state}.`;this.logger.warn(r)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(T.Terminated,!0)}typeToString(){return"INVITE client transaction"}ack(e){const t=this.request.ruri,r=this.request.callId,n=this.request.cseq,i=this.request.getHeader("from"),o=e.getHeader("to"),a=this.request.getHeader("via"),s=this.request.getHeader("route");if(!i)throw new Error("From undefined.");if(!o)throw new Error("To undefined.");if(!a)throw new Error("Via undefined.");let c=`ACK ${t} SIP/2.0\r\n`;s&&(c+=`Route: ${s}\r\n`),c+=`Via: ${a}\r\n`,c+=`To: ${o}\r\n`,c+=`From: ${i}\r\n`,c+=`Call-ID: ${r}\r\n`,c+=`CSeq: ${n} ACK\r\n`,c+="Max-Forwards: 70\r\n",c+="Content-Length: 0\r\n\r\n",this.send(c).catch((e=>{this.logTransportError(e,"Failed to send ACK to non-2xx response.")}))}stateTransition(e,t=!1){const r=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Calling:r();break;case T.Proceeding:this.state!==T.Calling&&r();break;case T.Accepted:case T.Completed:this.state!==T.Calling&&this.state!==T.Proceeding&&r();break;case T.Terminated:this.state!==T.Calling&&this.state!==T.Accepted&&this.state!==T.Completed&&(t||r());break;default:r()}this.B&&(clearTimeout(this.B),this.B=void 0),T.Proceeding,e===T.Completed&&(this.D=setTimeout((()=>this.timerD()),0)),e===T.Accepted&&(this.M=setTimeout((()=>this.timerM()),32e3)),e===T.Terminated&&this.dispose(),this.setState(e)}timerA(){}timerB(){this.logger.debug(`Timer B expired for INVITE client transaction ${this.id}.`),this.state===T.Calling&&(this.onRequestTimeout(),this.stateTransition(T.Terminated))}timerD(){this.logger.debug(`Timer D expired for INVITE client transaction ${this.id}.`),this.state===T.Completed&&this.stateTransition(T.Terminated)}timerM(){this.logger.debug(`Timer M expired for INVITE client transaction ${this.id}.`),this.state===T.Accepted&&this.stateTransition(T.Terminated)}}class q{constructor(e,t,r,n){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=n,this.challenged=!1,this.stale=!1,this.logger=this.loggerFactory.getLogger("sip.user-agent-client"),this.init()}dispose(){this.transaction.dispose()}get loggerFactory(){return this.core.loggerFactory}get transaction(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction}cancel(e,t={}){if(!this.transaction)throw new Error("Transaction undefined.");if(!this.message.to)throw new Error("To undefined.");if(!this.message.from)throw new Error("From undefined.");const r=this.core.makeOutgoingRequestMessage(_.CANCEL,this.message.ruri,this.message.from.uri,this.message.to.uri,{toTag:this.message.toTag,fromTag:this.message.fromTag,callId:this.message.callId,cseq:this.message.cseq},t.extraHeaders);return r.branch=this.message.branch,this.message.headers.Route&&(r.headers.Route=this.message.headers.Route),e&&r.setHeader("Reason",e),this.transaction.state===T.Proceeding?new q(k,this.core,r):this.transaction.addStateChangeListener((()=>{this.transaction&&this.transaction.state===T.Proceeding&&new q(k,this.core,r)}),{once:!0}),r}authenticationGuard(e,t){const r=e.statusCode;if(!r)throw new Error("Response status code undefined.");if(401!==r&&407!==r)return!0;let n,i;if(401===r?(n=e.parseHeader("www-authenticate"),i="authorization"):(n=e.parseHeader("proxy-authenticate"),i="proxy-authorization"),!n)return this.logger.warn(r+" with wrong or missing challenge, cannot authenticate"),!0;if(this.challenged&&(this.stale||!0!==n.stale))return this.logger.warn(r+" apparently in authentication loop, cannot authenticate"),!0;if(!this.credentials&&(this.credentials=this.core.configuration.authenticationFactory(),!this.credentials))return this.logger.warn("Unable to obtain credentials, cannot authenticate"),!0;if(!this.credentials.authenticate(this.message,n))return!0;this.challenged=!0,n.stale&&(this.stale=!0);let o=this.message.cseq+=1;return t&&t.localSequenceNumber&&(t.incrementLocalSequenceNumber(),o=this.message.cseq=t.localSequenceNumber),this.message.setHeader("cseq",o+" "+this.message.method),this.message.setHeader(i,this.credentials.toString()),this.init(),!1}onRequestTimeout(){this.logger.warn("User agent client request timed out. Generating internal 408 Request Timeout.");const e=new U;e.statusCode=408,e.reasonPhrase="Request Timeout",this.receiveResponse(e)}onTransportError(e){this.logger.error(e.message),this.logger.error("User agent client request transport error. Generating internal 503 Service Unavailable.");const t=new U;t.statusCode=503,t.reasonPhrase="Service Unavailable",this.receiveResponse(t)}receiveResponse(e){if(!this.authenticationGuard(e))return;const t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e});break;case/^2[0-9]{2}$/.test(t):this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e});break;case/^3[0-9]{2}$/.test(t):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error(`Invalid status code ${t}`)}}init(){const e={loggerFactory:this.loggerFactory,onRequestTimeout:()=>this.onRequestTimeout(),onStateChange:e=>{e===T.Terminated&&(this.core.userAgentClients.delete(r),t===this._transaction&&this.dispose())},onTransportError:e=>this.onTransportError(e),receiveResponse:e=>this.receiveResponse(e)},t=new this.transactionConstructor(this.message,this.core.transport,e);this._transaction=t;const r=t.id+t.request.method;this.core.userAgentClients.set(r,this)}}class W extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.BYE,r);super(k,e.userAgentCore,n,t),e.dispose()}}class K extends M{constructor(e,t,r){super(e,t,r,T.Trying,"sip.transaction.nist")}dispose(){this.J&&(clearTimeout(this.J),this.J=void 0),super.dispose()}get kind(){return"nist"}receiveRequest(e){switch(this.state){case T.Trying:break;case T.Proceeding:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")}));break;case T.Completed:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch((e=>{this.logTransportError(e,"Failed to send retransmission of final response.")}));break;case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}}receiveResponse(e,t){if(e<100||e>699)throw new Error(`Invalid status code ${e}`);if(e>100&&e<=199)throw new Error("Provisional response other than 100 not allowed.");switch(this.state){case T.Trying:if(this.lastResponse=t,e>=100&&e<200)return this.stateTransition(T.Proceeding),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send provisional response.")}));if(e>=200&&e<=699)return this.stateTransition(T.Completed),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send final response.")}));break;case T.Proceeding:if(this.lastResponse=t,e>=200&&e<=699)return this.stateTransition(T.Completed),void this.send(t).catch((e=>{this.logTransportError(e,"Failed to send final response.")}));break;case T.Completed:return;case T.Terminated:break;default:throw new Error(`Invalid state ${this.state}`)}const r=`Non-INVITE server transaction received unexpected ${e} response from TU while in state ${this.state}.`;throw this.logger.error(r),new Error(r)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(T.Terminated,!0)}typeToString(){return"non-INVITE server transaction"}stateTransition(e,t=!1){const r=()=>{throw new Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case T.Trying:r();break;case T.Proceeding:this.state!==T.Trying&&r();break;case T.Completed:this.state!==T.Trying&&this.state!==T.Proceeding&&r();break;case T.Terminated:this.state!==T.Proceeding&&this.state!==T.Completed&&(t||r());break;default:r()}e===T.Completed&&(this.J=setTimeout((()=>this.timerJ()),0)),e===T.Terminated&&this.dispose(),this.setState(e)}timerJ(){this.logger.debug(`Timer J expired for NON-INVITE server transaction ${this.id}.`),this.state===T.Completed&&this.stateTransition(T.Terminated)}}class G extends I{constructor(e){super(e||"Transaction state error.")}}class Y{constructor(e,t,r,n){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=n,this.logger=this.loggerFactory.getLogger("sip.user-agent-server"),this.toTag=r.toTag?r.toTag:v(),this.init()}dispose(){this.transaction.dispose()}get loggerFactory(){return this.core.loggerFactory}get transaction(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction}accept(e={statusCode:200}){if(!this.acceptable)throw new G(`${this.message.method} not acceptable in state ${this.transaction.state}.`);const t=e.statusCode;if(t<200||t>299)throw new TypeError(`Invalid statusCode: ${t}`);return this.reply(e)}progress(e={statusCode:180}){if(!this.progressable)throw new G(`${this.message.method} not progressable in state ${this.transaction.state}.`);const t=e.statusCode;if(t<101||t>199)throw new TypeError(`Invalid statusCode: ${t}`);return this.reply(e)}redirect(e,t={statusCode:302}){if(!this.redirectable)throw new G(`${this.message.method} not redirectable in state ${this.transaction.state}.`);const r=t.statusCode;if(r<300||r>399)throw new TypeError(`Invalid statusCode: ${r}`);const n=new Array;return e.forEach((e=>n.push(`Contact: ${e.toString()}`))),t.extraHeaders=(t.extraHeaders||[]).concat(n),this.reply(t)}reject(e={statusCode:480}){if(!this.rejectable)throw new G(`${this.message.method} not rejectable in state ${this.transaction.state}.`);const t=e.statusCode;if(t<400||t>699)throw new TypeError(`Invalid statusCode: ${t}`);return this.reply(e)}trying(e){if(!this.tryingable)throw new G(`${this.message.method} not tryingable in state ${this.transaction.state}.`);return this.reply({statusCode:100})}receiveCancel(e){this.delegate&&this.delegate.onCancel&&this.delegate.onCancel(e)}get acceptable(){if(this.transaction instanceof D)return this.transaction.state===T.Proceeding||this.transaction.state===T.Accepted;if(this.transaction instanceof K)return this.transaction.state===T.Trying||this.transaction.state===T.Proceeding;throw new Error("Unknown transaction type.")}get progressable(){if(this.transaction instanceof D)return this.transaction.state===T.Proceeding;if(this.transaction instanceof K)return!1;throw new Error("Unknown transaction type.")}get redirectable(){if(this.transaction instanceof D)return this.transaction.state===T.Proceeding;if(this.transaction instanceof K)return this.transaction.state===T.Trying||this.transaction.state===T.Proceeding;throw new Error("Unknown transaction type.")}get rejectable(){if(this.transaction instanceof D)return this.transaction.state===T.Proceeding;if(this.transaction instanceof K)return this.transaction.state===T.Trying||this.transaction.state===T.Proceeding;throw new Error("Unknown transaction type.")}get tryingable(){if(this.transaction instanceof D)return this.transaction.state===T.Proceeding;if(this.transaction instanceof K)return this.transaction.state===T.Trying;throw new Error("Unknown transaction type.")}reply(e){e.toTag||100===e.statusCode||(e.toTag=this.toTag),e.userAgent=e.userAgent||this.core.configuration.userAgentHeaderFieldValue,e.supported=e.supported||this.core.configuration.supportedOptionTagsResponse;const t=C(this.message,e);return this.transaction.receiveResponse(e.statusCode,t.message),t}init(){const e={loggerFactory:this.loggerFactory,onStateChange:e=>{e===T.Terminated&&(this.core.userAgentServers.delete(r),this.dispose())},onTransportError:e=>{this.logger.error(e.message),this.delegate&&this.delegate.onTransportError?this.delegate.onTransportError(e):this.logger.error("User agent server response transport error.")}},t=new this.transactionConstructor(this.message,this.core.transport,e);this._transaction=t;const r=t.id;this.core.userAgentServers.set(t.id,this)}}class z extends Y{constructor(e,t,r){super(K,e.userAgentCore,t,r)}}class X extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.INFO,r);super(k,e.userAgentCore,n,t)}}class J extends Y{constructor(e,t,r){super(K,e.userAgentCore,t,r)}}class Z extends q{constructor(e,t,r){super(k,e,t,r)}}class Q extends Y{constructor(e,t,r){super(K,e,t,r)}}class ee extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.NOTIFY,r);super(k,e.userAgentCore,n,t)}}class te extends Y{constructor(e,t,r){const n=void 0!==e.userAgentCore?e.userAgentCore:e;super(K,n,t,r)}}class re extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.PRACK,r);super(k,e.userAgentCore,n,t),e.signalingStateTransition(n)}}class ne extends Y{constructor(e,t,r){super(K,e.userAgentCore,t,r),e.signalingStateTransition(t),this.dialog=e}accept(e={statusCode:200}){return e.body&&this.dialog.signalingStateTransition(e.body),super.accept(e)}}class ie extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.INVITE,r);super(F,e.userAgentCore,n,t),this.delegate=t,e.signalingStateTransition(n),e.reinviteUserAgentClient=this,this.dialog=e}receiveResponse(e){if(!this.authenticationGuard(e,this.dialog))return;const t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:this.dialog,prack:e=>{throw new Error("Unimplemented.")}});break;case/^2[0-9]{2}$/.test(t):this.dialog.signalingStateTransition(e),this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e,session:this.dialog,ack:e=>this.dialog.ack(e)});break;case/^3[0-9]{2}$/.test(t):this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentClient=void 0,this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentClient=void 0,this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error(`Invalid status code ${t}`)}}}class oe extends Y{constructor(e,t,r){super(D,e.userAgentCore,t,r),e.reinviteUserAgentServer=this,this.dialog=e}accept(e={statusCode:200}){e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(this.dialog.routeSet.map((e=>`Record-Route: ${e}`)));const t=super.accept(e),r=this.dialog,n=Object.assign(Object.assign({},t),{session:r});return e.body&&this.dialog.signalingStateTransition(e.body),this.dialog.reConfirm(),n}progress(e={statusCode:180}){const t=super.progress(e),r=this.dialog,n=Object.assign(Object.assign({},t),{session:r});return e.body&&this.dialog.signalingStateTransition(e.body),n}redirect(e,t={statusCode:302}){throw this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentServer=void 0,new Error("Unimplemented.")}reject(e={statusCode:488}){return this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentServer=void 0,super.reject(e)}}class ae extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.REFER,r);super(k,e.userAgentCore,n,t)}}class se extends Y{constructor(e,t,r){const n=void 0!==e.userAgentCore?e.userAgentCore:e;super(K,n,t,r)}}class ce extends L{constructor(e,t,r,n){super(t,r),this.initialTransaction=e,this._signalingState=b.Initial,this.ackWait=!1,this.ackProcessing=!1,this.delegate=n,e instanceof D&&(this.ackWait=!0),this.early||this.start2xxRetransmissionTimer(),this.signalingStateTransition(e.request),this.logger=t.loggerFactory.getLogger("sip.invite-dialog"),this.logger.log(`INVITE dialog ${this.id} constructed`)}dispose(){super.dispose(),this._signalingState=b.Closed,this._offer=void 0,this._answer=void 0,this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.logger.log(`INVITE dialog ${this.id} destroyed`)}get sessionState(){return this.early?R.Early:this.ackWait?R.AckWait:this._signalingState===b.Closed?R.Terminated:R.Confirmed}get signalingState(){return this._signalingState}get offer(){return this._offer}get answer(){return this._answer}confirm(){this.early&&this.start2xxRetransmissionTimer(),super.confirm()}reConfirm(){this.reinviteUserAgentServer&&this.startReInvite2xxRetransmissionTimer()}ack(e={}){let t;if(this.logger.log(`INVITE dialog ${this.id} sending ACK request`),this.reinviteUserAgentClient){if(!(this.reinviteUserAgentClient.transaction instanceof F))throw new Error("Transaction not instance of InviteClientTransaction.");t=this.reinviteUserAgentClient.transaction,this.reinviteUserAgentClient=void 0}else{if(!(this.initialTransaction instanceof F))throw new Error("Initial transaction not instance of InviteClientTransaction.");t=this.initialTransaction}const r=this.createOutgoingRequestMessage(_.ACK,{cseq:t.request.cseq,extraHeaders:e.extraHeaders,body:e.body});return t.ackResponse(r),this.signalingStateTransition(r),{message:r}}bye(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending BYE request`),this.initialTransaction instanceof D){if(this.early)throw new Error("UAS MUST NOT send a BYE on early dialogs.");if(this.ackWait&&this.initialTransaction.state!==T.Terminated)throw new Error("UAS MUST NOT send a BYE on a confirmed dialog until it has received an ACK for its 2xx response or until the server transaction times out.")}return new W(this,e,t)}info(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending INFO request`),this.early)throw new Error("Dialog not confirmed.");return new X(this,e,t)}invite(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending INVITE request`),this.early)throw new Error("Dialog not confirmed.");if(this.reinviteUserAgentClient)throw new Error("There is an ongoing re-INVITE client transaction.");if(this.reinviteUserAgentServer)throw new Error("There is an ongoing re-INVITE server transaction.");return new ie(this,e,t)}message(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending MESSAGE request`),this.early)throw new Error("Dialog not confirmed.");const r=this.createOutgoingRequestMessage(_.MESSAGE,t);return new Z(this.core,r,e)}notify(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending NOTIFY request`),this.early)throw new Error("Dialog not confirmed.");return new ee(this,e,t)}prack(e,t){return this.logger.log(`INVITE dialog ${this.id} sending PRACK request`),new re(this,e,t)}refer(e,t){if(this.logger.log(`INVITE dialog ${this.id} sending REFER request`),this.early)throw new Error("Dialog not confirmed.");return new ae(this,e,t)}receiveRequest(e){if(this.logger.log(`INVITE dialog ${this.id} received ${e.method} request`),e.method!==_.ACK)if(this.sequenceGuard(e)){if(super.receiveRequest(e),e.method===_.INVITE){const t=()=>{const e=this.ackWait?"waiting for initial ACK":"processing initial ACK";this.logger.warn(`INVITE dialog ${this.id} received re-INVITE while ${e}`);let t="RFC 5407 suggests the following to avoid this race condition... ";t+=" Note: Implementation issues are outside the scope of this document,",t+=" but the following tip is provided for avoiding race conditions of",t+=" this type.  The caller can delay sending re-INVITE F6 for some period",t+=" of time (2 seconds, perhaps), after which the caller can reasonably",t+=" assume that its ACK has been received.  Implementors can decouple the",t+=" actions of the user (e.g., pressing the hold button) from the actions",t+=" of the protocol (the sending of re-INVITE F6), so that the UA can",t+=" behave like this.  In this case, it is the implementor's choice as to",t+=" how long to wait.  In most cases, such an implementation may be",t+=" useful to prevent the type of race condition shown in this section.",t+=" This document expresses no preference about whether or not they",t+=" should wait for an ACK to be delivered.  After considering the impact",t+=" on user experience, implementors should decide whether or not to wait",t+=" for a while, because the user experience depends on the",t+=" implementation and has no direct bearing on protocol behavior.",this.logger.warn("RFC 5407 suggests the following to avoid this race condition...  Note: Implementation issues are outside the scope of this document, but the following tip is provided for avoiding race conditions of this type.  The caller can delay sending re-INVITE F6 for some period of time (2 seconds, perhaps), after which the caller can reasonably assume that its ACK has been received.  Implementors can decouple the actions of the user (e.g., pressing the hold button) from the actions of the protocol (the sending of re-INVITE F6), so that the UA can behave like this.  In this case, it is the implementor's choice as to how long to wait.  In most cases, such an implementation may be useful to prevent the type of race condition shown in this section. This document expresses no preference about whether or not they should wait for an ACK to be delivered.  After considering the impact on user experience, implementors should decide whether or not to wait for a while, because the user experience depends on the implementation and has no direct bearing on protocol behavior.")},r=[`Retry-After: ${Math.floor(10*Math.random())+1}`];if(this.ackProcessing)return this.core.replyStateless(e,{statusCode:500,extraHeaders:r}),void t();if(this.ackWait&&this.signalingState!==b.Stable)return this.core.replyStateless(e,{statusCode:500,extraHeaders:r}),void t();if(this.reinviteUserAgentServer)return void this.core.replyStateless(e,{statusCode:500,extraHeaders:r});if(this.reinviteUserAgentClient)return void this.core.replyStateless(e,{statusCode:491})}if(e.method===_.INVITE){const t=e.parseHeader("contact");if(!t)throw new Error("Contact undefined.");if(!(t instanceof l))throw new Error("Contact not instance of NameAddrHeader.");this.dialogState.remoteTarget=t.uri}switch(e.method){case _.BYE:{const t=new z(this,e);this.delegate&&this.delegate.onBye?this.delegate.onBye(t):t.accept(),this.dispose()}break;case _.INFO:{const t=new J(this,e);this.delegate&&this.delegate.onInfo?this.delegate.onInfo(t):t.reject({statusCode:469,extraHeaders:["Recv-Info :"]})}break;case _.INVITE:{const t=new oe(this,e);this.signalingStateTransition(e),this.delegate&&this.delegate.onInvite?this.delegate.onInvite(t):t.reject({statusCode:488})}break;case _.MESSAGE:{const t=new Q(this.core,e);this.delegate&&this.delegate.onMessage?this.delegate.onMessage(t):t.accept()}break;case _.NOTIFY:{const t=new te(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(t):t.accept()}break;case _.PRACK:{const t=new ne(this,e);this.delegate&&this.delegate.onPrack?this.delegate.onPrack(t):t.accept()}break;case _.REFER:{const t=new se(this,e);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(t):t.reject()}break;default:this.logger.log(`INVITE dialog ${this.id} received unimplemented ${e.method} request`),this.core.replyStateless(e,{statusCode:501})}}else this.logger.log(`INVITE dialog ${this.id} rejected out of order ${e.method} request.`);else{if(this.ackWait){if(this.initialTransaction instanceof F)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);if(this.initialTransaction.request.cseq!==e.cseq)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);this.ackWait=!1}else{if(!this.reinviteUserAgentServer)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);if(this.reinviteUserAgentServer.transaction.request.cseq!==e.cseq)return void this.logger.warn(`INVITE dialog ${this.id} received unexpected ${e.method} request, dropping.`);this.reinviteUserAgentServer=void 0}if(this.signalingStateTransition(e),this.delegate&&this.delegate.onAck){const t=this.delegate.onAck({message:e});t instanceof Promise&&(this.ackProcessing=!0,t.then((()=>this.ackProcessing=!1)).catch((()=>this.ackProcessing=!1)))}}}reliableSequenceGuard(e){const t=e.statusCode;if(!t)throw new Error("Status code undefined");if(t>100&&t<200){const t=e.getHeader("require"),r=e.getHeader("rseq"),n=t&&t.includes("100rel")&&r?Number(r):void 0;if(n){if(this.rseq&&this.rseq+1!==n)return!1;this.rseq=this.rseq?this.rseq+1:n}}return!0}signalingStateRollback(){this._signalingState!==b.HaveLocalOffer&&this.signalingState!==b.HaveRemoteOffer||this._rollbackOffer&&this._rollbackAnswer&&(this._signalingState=b.Stable,this._offer=this._rollbackOffer,this._answer=this._rollbackAnswer)}signalingStateTransition(e){const t=$(e);if(t&&"session"===t.contentDisposition){if(this._signalingState===b.Stable&&(this._rollbackOffer=this._offer,this._rollbackAnswer=this._answer),e instanceof V)switch(this._signalingState){case b.Initial:case b.Stable:this._signalingState=b.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case b.HaveLocalOffer:this._signalingState=b.Stable,this._answer=t;break;case b.HaveRemoteOffer:case b.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof U)switch(this._signalingState){case b.Initial:case b.Stable:this._signalingState=b.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case b.HaveLocalOffer:this._signalingState=b.Stable,this._answer=t;break;case b.HaveRemoteOffer:case b.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof A)switch(this._signalingState){case b.Initial:case b.Stable:this._signalingState=b.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case b.HaveLocalOffer:break;case b.HaveRemoteOffer:this._signalingState=b.Stable,this._answer=t;break;case b.Closed:break;default:throw new Error("Unexpected signaling state.")}if(B(e))switch(this._signalingState){case b.Initial:case b.Stable:this._signalingState=b.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case b.HaveLocalOffer:break;case b.HaveRemoteOffer:this._signalingState=b.Stable,this._answer=t;break;case b.Closed:break;default:throw new Error("Unexpected signaling state.")}}}start2xxRetransmissionTimer(){if(this.initialTransaction instanceof D){const e=this.initialTransaction;let t=500;const r=()=>{this.ackWait?(this.logger.log("No ACK for 2xx response received, attempting retransmission"),e.retransmitAcceptedResponse(),t=Math.min(2*t,4e3),this.invite2xxTimer=setTimeout(r,t)):this.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(r,t);const n=()=>{e.state===T.Terminated&&(e.removeStateChangeListener(n),this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.ackWait&&(this.delegate&&this.delegate.onAckTimeout?this.delegate.onAckTimeout():this.bye()))};e.addStateChangeListener(n)}}startReInvite2xxRetransmissionTimer(){if(this.reinviteUserAgentServer&&this.reinviteUserAgentServer.transaction instanceof D){const e=this.reinviteUserAgentServer.transaction;let t=500;const r=()=>{this.reinviteUserAgentServer?(this.logger.log("No ACK for 2xx response received, attempting retransmission"),e.retransmitAcceptedResponse(),t=Math.min(2*t,4e3),this.invite2xxTimer=setTimeout(r,t)):this.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(r,t);const n=()=>{e.state===T.Terminated&&(e.removeStateChangeListener(n),this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.reinviteUserAgentServer)};e.addStateChangeListener(n)}}}class ue extends q{constructor(e,t,r){super(F,e,t,r),this.confirmedDialogAcks=new Map,this.confirmedDialogs=new Map,this.earlyDialogs=new Map,this.delegate=r}dispose(){this.earlyDialogs.forEach((e=>e.dispose())),this.earlyDialogs.clear(),super.dispose()}onTransportError(e){if(this.transaction.state===T.Calling)return super.onTransportError(e);this.logger.error(e.message),this.logger.error("User agent client request transport error while sending ACK.")}receiveResponse(e){if(!this.authenticationGuard(e))return;const t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):return void(this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e}));case/^1[0-9]{2}$/.test(t):{if(!e.toTag)return void this.logger.warn("Non-100 1xx INVITE response received without a to tag, dropping.");if(!e.parseHeader("contact"))return void this.logger.error("Non-100 1xx INVITE response received without a Contact header field, dropping.");const t=L.initialDialogStateForUserAgentClient(this.message,e);let r=this.earlyDialogs.get(t.id);if(!r){const e=this.transaction;if(!(e instanceof F))throw new Error("Transaction not instance of InviteClientTransaction.");r=new ce(e,this.core,t),this.earlyDialogs.set(r.id,r)}if(!r.reliableSequenceGuard(e))return void this.logger.warn("1xx INVITE reliable response received out of order or is a retransmission, dropping.");r.signalingState!==b.Initial&&r.signalingState!==b.HaveLocalOffer||r.signalingStateTransition(e);const n=r;this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:n,prack:e=>n.prack(void 0,e)})}return;case/^2[0-9]{2}$/.test(t):{if(!e.toTag)return void this.logger.error("2xx INVITE response received without a to tag, dropping.");if(!e.parseHeader("contact"))return void this.logger.error("2xx INVITE response received without a Contact header field, dropping.");const t=L.initialDialogStateForUserAgentClient(this.message,e);let r=this.confirmedDialogs.get(t.id);if(r){const e=this.confirmedDialogAcks.get(t.id);if(e){const t=this.transaction;if(!(t instanceof F))throw new Error("Client transaction not instance of InviteClientTransaction.");t.ackResponse(e.message)}return}if(r=this.earlyDialogs.get(t.id),r)r.confirm(),r.recomputeRouteSet(e),this.earlyDialogs.delete(r.id),this.confirmedDialogs.set(r.id,r);else{const e=this.transaction;if(!(e instanceof F))throw new Error("Transaction not instance of InviteClientTransaction.");r=new ce(e,this.core,t),this.confirmedDialogs.set(r.id,r)}r.signalingState!==b.Initial&&r.signalingState!==b.HaveLocalOffer||r.signalingStateTransition(e);const n=r;if(this.delegate&&this.delegate.onAccept)this.delegate.onAccept({message:e,session:n,ack:e=>{const t=n.ack(e);return this.confirmedDialogAcks.set(n.id,t),t}});else{const e=n.ack();this.confirmedDialogAcks.set(n.id,e)}}return;case/^3[0-9]{2}$/.test(t):return this.earlyDialogs.forEach((e=>e.dispose())),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e}));case/^[4-6][0-9]{2}$/.test(t):return this.earlyDialogs.forEach((e=>e.dispose())),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e}));default:throw new Error(`Invalid status code ${t}`)}throw new Error(`Executing what should be an unreachable code path receiving ${t} response.`)}}class le extends q{constructor(e,t,r){super(k,e,t,r)}}class de extends q{constructor(e,t,r){super(k,e,t,r)}}!function(e){e.Initial="Initial",e.NotifyWait="NotifyWait",e.Pending="Pending",e.Active="Active",e.Terminated="Terminated"}(w||(w={}));const he=[_.ACK,_.BYE,_.CANCEL,_.INFO,_.INVITE,_.MESSAGE,_.NOTIFY,_.OPTIONS,_.PRACK,_.REFER,_.REGISTER,_.SUBSCRIBE];class pe extends q{constructor(e,t,r){const n=e.createOutgoingRequestMessage(_.SUBSCRIBE,r);super(k,e.userAgentCore,n,t),this.dialog=e}waitNotifyStop(){}receiveResponse(e){if(e.statusCode&&e.statusCode>=200&&e.statusCode<300){const t=e.getHeader("Expires");if(t){const e=Number(t);this.dialog.subscriptionExpires>e&&(this.dialog.subscriptionExpires=e)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE")}e.statusCode&&e.statusCode>=400&&e.statusCode<700&&[404,405,410,416,480,481,482,483,484,485,489,501,604].includes(e.statusCode)&&this.dialog.terminate(),super.receiveResponse(e)}}class fe extends L{constructor(e,t,r,n,i,o){super(n,i),this.delegate=o,this._autoRefresh=!1,this._subscriptionEvent=e,this._subscriptionExpires=t,this._subscriptionExpiresInitial=t,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this._subscriptionRefresh=void 0,this._subscriptionRefreshLastSet=void 0,this._subscriptionState=r,this.logger=n.loggerFactory.getLogger("sip.subscribe-dialog"),this.logger.log(`SUBSCRIBE dialog ${this.id} constructed`)}static initialDialogStateForSubscription(e,t){const r=t.getHeaders("record-route"),n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof l))throw new Error("Contact not instance of NameAddrHeader.");const i=n.uri,o=e.cseq,a=e.callId,s=e.fromTag,c=t.fromTag;if(!a)throw new Error("Call id undefined.");if(!s)throw new Error("From tag undefined.");if(!c)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");return{id:a+s+c,early:!1,callId:a,localTag:s,remoteTag:c,localSequenceNumber:o,remoteSequenceNumber:void 0,localURI:e.from.uri,remoteURI:e.to.uri,remoteTarget:i,routeSet:r,secure:!1}}dispose(){super.dispose(),this.N&&(clearTimeout(this.N),this.N=void 0),this.refreshTimerClear(),this.logger.log(`SUBSCRIBE dialog ${this.id} destroyed`)}get autoRefresh(){return this._autoRefresh}set autoRefresh(e){this._autoRefresh=!0,this.refreshTimerSet()}get subscriptionEvent(){return this._subscriptionEvent}get subscriptionExpires(){const e=Math.floor(Date.now()/1e3)-this._subscriptionExpiresLastSet,t=this._subscriptionExpires-e;return Math.max(t,0)}set subscriptionExpires(e){if(e<0)throw new Error("Expires must be greater than or equal to zero.");if(this._subscriptionExpires=e,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this.autoRefresh){const t=this.subscriptionRefresh;(void 0===t||t>=e)&&this.refreshTimerSet()}}get subscriptionExpiresInitial(){return this._subscriptionExpiresInitial}get subscriptionRefresh(){if(void 0===this._subscriptionRefresh||void 0===this._subscriptionRefreshLastSet)return;const e=Math.floor(Date.now()/1e3)-this._subscriptionRefreshLastSet,t=this._subscriptionRefresh-e;return Math.max(t,0)}get subscriptionState(){return this._subscriptionState}receiveRequest(e){this.logger.log(`SUBSCRIBE dialog ${this.id} received ${e.method} request`),this.sequenceGuard(e)?(super.receiveRequest(e),e.method===_.NOTIFY?this.onNotify(e):(this.logger.log(`SUBSCRIBE dialog ${this.id} received unimplemented ${e.method} request`),this.core.replyStateless(e,{statusCode:501}))):this.logger.log(`SUBSCRIBE dialog ${this.id} rejected out of order ${e.method} request.`)}refresh(){const e="Allow: "+he.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: "+this.subscriptionExpiresInitial),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)}subscribe(e,t={}){if(this.subscriptionState!==w.Pending&&this.subscriptionState!==w.Active)throw new Error(`Invalid state ${this.subscriptionState}. May only re-subscribe while in state "pending" or "active".`);this.logger.log(`SUBSCRIBE dialog ${this.id} sending SUBSCRIBE request`);const r=new pe(this,e,t);return this.N&&(clearTimeout(this.N),this.N=void 0),this.N=setTimeout((()=>this.timerN()),32e3),r}terminate(){this.stateTransition(w.Terminated),this.onTerminated()}unsubscribe(){const e="Allow: "+he.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: 0"),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)}onNotify(e){const t=e.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return void this.core.replyStateless(e,{statusCode:489});this.N&&(clearTimeout(this.N),this.N=void 0);const r=e.parseHeader("Subscription-State");if(!r||!r.state)return void this.core.replyStateless(e,{statusCode:489});const n=r.state,i=r.expires?Math.max(r.expires,0):void 0;switch(n){case"pending":this.stateTransition(w.Pending,i);break;case"active":this.stateTransition(w.Active,i);break;case"terminated":this.stateTransition(w.Terminated,i);break;default:this.logger.warn("Unrecognized subscription state.")}const o=new te(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(o):o.accept()}onRefresh(e){this.delegate&&this.delegate.onRefresh&&this.delegate.onRefresh(e)}onTerminated(){this.delegate&&this.delegate.onTerminated&&this.delegate.onTerminated()}refreshTimerClear(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=void 0)}refreshTimerSet(){if(this.refreshTimerClear(),this.autoRefresh&&this.subscriptionExpires>0){const e=900*this.subscriptionExpires;this._subscriptionRefresh=Math.floor(e/1e3),this._subscriptionRefreshLastSet=Math.floor(Date.now()/1e3),this.refreshTimer=setTimeout((()=>{this.refreshTimer=void 0,this._subscriptionRefresh=void 0,this._subscriptionRefreshLastSet=void 0,this.onRefresh(this.refresh())}),e)}}stateTransition(e,t){const r=()=>{this.logger.warn(`Invalid subscription state transition from ${this.subscriptionState} to ${e}`)};switch(e){case w.Initial:case w.NotifyWait:return void r();case w.Pending:if(this.subscriptionState!==w.NotifyWait&&this.subscriptionState!==w.Pending)return void r();break;case w.Active:case w.Terminated:if(this.subscriptionState!==w.NotifyWait&&this.subscriptionState!==w.Pending&&this.subscriptionState!==w.Active)return void r();break;default:return void r()}e===w.Pending&&t&&(this.subscriptionExpires=t),e===w.Active&&t&&(this.subscriptionExpires=t),e===w.Terminated&&this.dispose(),this._subscriptionState=e}timerN(){this.logger.warn("Timer N expired for SUBSCRIBE dialog. Timed out waiting for NOTIFY."),this.subscriptionState!==w.Terminated&&(this.stateTransition(w.Terminated),this.onTerminated())}}class ge extends q{constructor(e,t,r){const n=t.getHeader("Event");if(!n)throw new Error("Event undefined");const i=t.getHeader("Expires");if(!i)throw new Error("Expires undefined");super(k,e,t,r),this.delegate=r,this.subscriberId=t.callId+t.fromTag+n,this.subscriptionExpiresRequested=this.subscriptionExpires=Number(i),this.subscriptionEvent=n,this.subscriptionState=w.NotifyWait,this.waitNotifyStart()}dispose(){super.dispose()}onNotify(e){const t=e.message.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return this.logger.warn("Failed to parse event."),void e.reject({statusCode:489});const r=e.message.parseHeader("Subscription-State");if(!r||!r.state)return this.logger.warn("Failed to parse subscription state."),void e.reject({statusCode:489});const n=r.state;switch(n){case"pending":case"active":case"terminated":break;default:return this.logger.warn(`Invalid subscription state ${n}`),void e.reject({statusCode:489})}if("terminated"!==n&&!e.message.parseHeader("contact"))return this.logger.warn("Failed to parse contact."),void e.reject({statusCode:489});if(this.dialog)throw new Error("Dialog already created. This implementation only supports install of single subscriptions.");switch(this.waitNotifyStop(),this.subscriptionExpires=r.expires?Math.min(this.subscriptionExpires,Math.max(r.expires,0)):this.subscriptionExpires,n){case"pending":this.subscriptionState=w.Pending;break;case"active":this.subscriptionState=w.Active;break;case"terminated":this.subscriptionState=w.Terminated;break;default:throw new Error(`Unrecognized state ${n}.`)}if(this.subscriptionState!==w.Terminated){const t=fe.initialDialogStateForSubscription(this.message,e.message);this.dialog=new fe(this.subscriptionEvent,this.subscriptionExpires,this.subscriptionState,this.core,t)}if(this.delegate&&this.delegate.onNotify){const t=e,r=this.dialog;this.delegate.onNotify({request:t,subscription:r})}else e.accept()}waitNotifyStart(){this.N||(this.core.subscribers.set(this.subscriberId,this),this.N=setTimeout((()=>this.timerN()),32e3))}waitNotifyStop(){this.N&&(this.core.subscribers.delete(this.subscriberId),clearTimeout(this.N),this.N=void 0)}receiveResponse(e){if(this.authenticationGuard(e)){if(e.statusCode&&e.statusCode>=200&&e.statusCode<300){const t=e.getHeader("Expires");if(t){const e=Number(t);e>this.subscriptionExpiresRequested&&this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),e<this.subscriptionExpires&&(this.subscriptionExpires=e)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE");this.dialog&&this.dialog.subscriptionExpires>this.subscriptionExpires&&(this.dialog.subscriptionExpires=this.subscriptionExpires)}e.statusCode&&e.statusCode>=300&&e.statusCode<700&&this.waitNotifyStop(),super.receiveResponse(e)}}timerN(){this.logger.warn("Timer N expired for SUBSCRIBE user agent client. Timed out waiting for NOTIFY."),this.waitNotifyStop(),this.delegate&&this.delegate.onNotifyTimeout&&this.delegate.onNotifyTimeout()}}class ve extends Y{constructor(e,t,r){super(D,e,t,r),this.core=e}dispose(){this.earlyDialog&&this.earlyDialog.dispose(),super.dispose()}accept(e={statusCode:200}){if(!this.acceptable)throw new G(`${this.message.method} not acceptable in state ${this.transaction.state}.`);if(!this.confirmedDialog)if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{const e=this.transaction;if(!(e instanceof D))throw new Error("Transaction not instance of InviteClientTransaction.");const t=L.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new ce(e,this.core,t)}const t=this.message.getHeaders("record-route").map((e=>`Record-Route: ${e}`)),r=`Contact: ${this.core.configuration.contact.toString()}`,n="Allow: "+he.toString();if(!e.body)if(this.confirmedDialog.signalingState===b.Stable)e.body=this.confirmedDialog.answer;else if(this.confirmedDialog.signalingState===b.Initial||this.confirmedDialog.signalingState===b.HaveRemoteOffer)throw new Error("Response must have a body.");e.statusCode=e.statusCode||200,e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(n),e.extraHeaders.push(r);const i=super.accept(e),o=this.confirmedDialog,a=Object.assign(Object.assign({},i),{session:o});return e.body&&this.confirmedDialog.signalingState!==b.Stable&&this.confirmedDialog.signalingStateTransition(e.body),a}progress(e={statusCode:180}){if(!this.progressable)throw new G(`${this.message.method} not progressable in state ${this.transaction.state}.`);if(!this.earlyDialog){const e=this.transaction;if(!(e instanceof D))throw new Error("Transaction not instance of InviteClientTransaction.");const t=L.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new ce(e,this.core,t)}const t=this.message.getHeaders("record-route").map((e=>`Record-Route: ${e}`)),r=`Contact: ${this.core.configuration.contact}`;e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(r);const n=super.progress(e),i=this.earlyDialog,o=Object.assign(Object.assign({},n),{session:i});return e.body&&this.earlyDialog.signalingState!==b.Stable&&this.earlyDialog.signalingStateTransition(e.body),o}redirect(e,t={statusCode:302}){return super.redirect(e,t)}reject(e={statusCode:486}){return super.reject(e)}}class me extends Y{constructor(e,t,r){super(K,e,t,r),this.core=e}}class Se extends Y{constructor(e,t,r){super(K,e,t,r),this.core=e}}const Ee=["application/sdp","application/dtmf-relay"];class ye{constructor(e,t={}){this.userAgentClients=new Map,this.userAgentServers=new Map,this.configuration=e,this.delegate=t,this.dialogs=new Map,this.subscribers=new Map,this.logger=e.loggerFactory.getLogger("sip.user-agent-core")}dispose(){this.reset()}reset(){this.dialogs.forEach((e=>e.dispose())),this.dialogs.clear(),this.subscribers.forEach((e=>e.dispose())),this.subscribers.clear(),this.userAgentClients.forEach((e=>e.dispose())),this.userAgentClients.clear(),this.userAgentServers.forEach((e=>e.dispose())),this.userAgentServers.clear()}get loggerFactory(){return this.configuration.loggerFactory}get transport(){const e=this.configuration.transportAccessor();if(!e)throw new Error("Transport undefined.");return e}invite(e,t){return new ue(this,e,t)}message(e,t){return new Z(this,e,t)}publish(e,t){return new le(this,e,t)}register(e,t){return new de(this,e,t)}subscribe(e,t){return new ge(this,e,t)}request(e,t){return new q(k,this,e,t)}makeOutgoingRequestMessage(e,t,r,n,i,o,a){const s=this.configuration.sipjsId,c=this.configuration.displayName,u=this.configuration.viaForceRport,l=this.configuration.hackViaTcp,d=this.configuration.supportedOptionTags.slice();e===_.REGISTER&&d.push("path","gruu"),e===_.INVITE&&(this.configuration.contact.pubGruu||this.configuration.contact.tempGruu)&&d.push("gruu");const h={callIdPrefix:s,forceRport:u,fromDisplayName:c,hackViaTcp:l,optionTags:d,routeSet:this.configuration.routeSet,userAgentString:this.configuration.userAgentHeaderFieldValue,viaHost:this.configuration.viaHost},p=Object.assign(Object.assign({},h),i);return new A(e,t,r,n,p,o,a)}receiveIncomingRequestFromTransport(e){this.receiveRequestFromTransport(e)}receiveIncomingResponseFromTransport(e){this.receiveResponseFromTransport(e)}replyStateless(e,t){const r=this.configuration.userAgentHeaderFieldValue,n=this.configuration.supportedOptionTagsResponse;t=Object.assign(Object.assign({},t),{userAgent:r,supported:n});const i=C(e,t);return this.transport.send(i.message).catch((t=>{t instanceof Error&&this.logger.error(t.message),this.logger.error(`Transport error occurred sending stateless reply to ${e.method} request.`)})),i}receiveRequestFromTransport(e){const t=e.viaBranch,r=this.userAgentServers.get(t);e.method===_.ACK&&r&&r.transaction.state===T.Accepted&&r instanceof ve?this.logger.warn(`Discarding out of dialog ACK after 2xx response sent on transaction ${t}.`):e.method!==_.CANCEL?r?r.transaction.receiveRequest(e):this.receiveRequest(e):r?(this.replyStateless(e,{statusCode:200}),r.transaction instanceof D&&r.transaction.state===T.Proceeding&&r instanceof ve&&r.receiveCancel(e)):this.replyStateless(e,{statusCode:481})}receiveRequest(e){if(!he.includes(e.method)){const t="Allow: "+he.toString();return void this.replyStateless(e,{statusCode:405,extraHeaders:[t]})}if(!e.ruri)throw new Error("Request-URI undefined.");if("sip"!==e.ruri.scheme)return void this.replyStateless(e,{statusCode:416});const t=e.ruri,r=e=>!!e&&e.user===t.user;if(!r(this.configuration.aor)&&!(r(this.configuration.contact.uri)||r(this.configuration.contact.pubGruu)||r(this.configuration.contact.tempGruu)))return this.logger.warn("Request-URI does not point to us."),void(e.method!==_.ACK&&this.replyStateless(e,{statusCode:404}));if(e.method!==_.INVITE||e.hasHeader("Contact")){if(!e.toTag){const t=e.viaBranch;if(!this.userAgentServers.has(t)&&Array.from(this.userAgentServers.values()).some((t=>t.transaction.request.fromTag===e.fromTag&&t.transaction.request.callId===e.callId&&t.transaction.request.cseq===e.cseq)))return void this.replyStateless(e,{statusCode:482})}e.toTag?this.receiveInsideDialogRequest(e):this.receiveOutsideDialogRequest(e)}else this.replyStateless(e,{statusCode:400,reasonPhrase:"Missing Contact Header"})}receiveInsideDialogRequest(e){if(e.method===_.NOTIFY){const t=e.parseHeader("Event");if(!t||!t.event)return void this.replyStateless(e,{statusCode:489});const r=e.callId+e.toTag+t.event,n=this.subscribers.get(r);if(n){const t=new te(this,e);return void n.onNotify(t)}}const t=e.callId+e.toTag+e.fromTag,r=this.dialogs.get(t);if(r){if(e.method===_.OPTIONS){const t="Allow: "+he.toString(),r="Accept: "+Ee.toString();return void this.replyStateless(e,{statusCode:200,extraHeaders:[t,r]})}r.receiveRequest(e)}else e.method!==_.ACK&&this.replyStateless(e,{statusCode:481})}receiveOutsideDialogRequest(e){switch(e.method){case _.ACK:break;case _.BYE:this.replyStateless(e,{statusCode:481});break;case _.CANCEL:throw new Error(`Unexpected out of dialog request method ${e.method}.`);case _.INFO:this.replyStateless(e,{statusCode:405});break;case _.INVITE:{const t=new ve(this,e);this.delegate.onInvite?this.delegate.onInvite(t):t.reject()}break;case _.MESSAGE:{const t=new Q(this,e);this.delegate.onMessage?this.delegate.onMessage(t):t.accept()}break;case _.NOTIFY:{const t=new te(this,e);this.delegate.onNotify?this.delegate.onNotify(t):t.reject({statusCode:405})}break;case _.OPTIONS:{const t="Allow: "+he.toString(),r="Accept: "+Ee.toString();this.replyStateless(e,{statusCode:200,extraHeaders:[t,r]})}break;case _.REFER:{const t=new se(this,e);this.delegate.onRefer?this.delegate.onRefer(t):t.reject({statusCode:405})}break;case _.REGISTER:{const t=new me(this,e);this.delegate.onRegister?this.delegate.onRegister(t):t.reject({statusCode:405})}break;case _.SUBSCRIBE:{const t=new Se(this,e);this.delegate.onSubscribe?this.delegate.onSubscribe(t):t.reject({statusCode:480})}break;default:throw new Error(`Unexpected out of dialog request method ${e.method}.`)}}receiveResponseFromTransport(e){if(e.getHeaders("via").length>1)return void this.logger.warn("More than one Via header field present in the response, dropping");const t=e.viaBranch+e.method,r=this.userAgentClients.get(t);r?r.transaction.receiveResponse(e):this.logger.warn(`Discarding unmatched ${e.statusCode} response to ${e.method} ${t}.`)}}var _e,Te,Re,be;!function(e){function t(e,t){let r=t,n=0,i=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===n;){if(i=e.indexOf("\r\n",r),-1===i)return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?r=i+2:n=i}return n}function r(e,t,r,n){const i=t.indexOf(":",r),a=t.substring(r,i).trim(),s=t.substring(i+1,n).trim();let c;switch(a.toLowerCase()){case"via":case"v":e.addHeader("via",s),1===e.getHeaders("via").length?(c=e.parseHeader("Via"),c&&(e.via=c,e.viaBranch=c.branch)):c=0;break;case"from":case"f":e.setHeader("from",s),c=e.parseHeader("from"),c&&(e.from=c,e.fromTag=c.getParam("tag"));break;case"to":case"t":e.setHeader("to",s),c=e.parseHeader("to"),c&&(e.to=c,e.toTag=c.getParam("tag"));break;case"record-route":if(c=o.parse(s,"Record_Route"),-1===c){c=void 0;break}if(!(c instanceof Array)){c=void 0;break}c.forEach((t=>{e.addHeader("record-route",s.substring(t.position,t.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=t.parsed}));break;case"call-id":case"i":e.setHeader("call-id",s),c=e.parseHeader("call-id"),c&&(e.callId=s);break;case"contact":case"m":if(c=o.parse(s,"Contact"),-1===c){c=void 0;break}if(!(c instanceof Array)){c=void 0;break}c.forEach((t=>{e.addHeader("contact",s.substring(t.position,t.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=t.parsed}));break;case"content-length":case"l":e.setHeader("content-length",s),c=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",s),c=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",s),c=e.parseHeader("cseq"),c&&(e.cseq=c.value),e instanceof U&&(e.method=c.method);break;case"max-forwards":e.setHeader("max-forwards",s),c=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",s),c=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",s),c=e.parseHeader("proxy-authenticate");break;case"refer-to":case"r":e.setHeader("refer-to",s),c=e.parseHeader("refer-to"),c&&(e.referTo=c);break;default:e.addHeader(a.toLowerCase(),s),c=0}return void 0!==c||{error:"error parsing header '"+a+"'"}}e.getHeader=t,e.parseHeader=r,e.parseMessage=function(e,n){let i=0,a=e.indexOf("\r\n");if(-1===a)return void n.warn("no CRLF found, not a SIP message, discarded");const s=e.substring(0,a),c=o.parse(s,"Request_Response");let u,l;if(-1!==c){for(c.status_code?(u=new U,u.statusCode=c.status_code,u.reasonPhrase=c.reason_phrase):(u=new V,u.method=c.method,u.ruri=c.uri),u.data=e,i=a+2;;){if(a=t(e,i),-2===a){l=i+2;break}if(-1===a)return void n.error("malformed message");if(!0!==r(u,e,i,a))return void n.error(c.error);i=a+2}return u.hasHeader("content-length")?u.body=e.substr(l,Number(u.getHeader("content-length"))):u.body=e.substring(l),u}n.warn('error parsing first line of SIP message: "'+s+'"')}}(_e||(_e={}));class we{constructor(e,t,r){e.debug("SessionDescriptionHandler.constructor"),this.logger=e,this.mediaStreamFactory=t,this.sessionDescriptionHandlerConfiguration=r,this._localMediaStream=new MediaStream,this._remoteMediaStream=new MediaStream,this._peerConnection=new RTCPeerConnection(null==r?void 0:r.peerConnectionConfiguration),this.initPeerConnectionEventHandlers()}get localMediaStream(){return this._localMediaStream}get remoteMediaStream(){return this._remoteMediaStream}get dataChannel(){return this._dataChannel}get peerConnection(){return this._peerConnection}get peerConnectionDelegate(){return this._peerConnectionDelegate}set peerConnectionDelegate(e){this._peerConnectionDelegate=e}static dispatchAddTrackEvent(e,t){e.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:t}))}static dispatchRemoveTrackEvent(e,t){e.dispatchEvent(new MediaStreamTrackEvent("removetrack",{track:t}))}close(){this.logger.debug("SessionDescriptionHandler.close"),void 0!==this._peerConnection&&(this._peerConnection.getReceivers().forEach((e=>{e.track&&e.track.stop()})),this._peerConnection.getSenders().forEach((e=>{e.track&&e.track.stop()})),this._dataChannel&&this._dataChannel.close(),this._peerConnection.close(),this._peerConnection=void 0)}getDescription(e,t){var r,n;if(this.logger.debug("SessionDescriptionHandler.getDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));this.onDataChannel=null==e?void 0:e.onDataChannel;const i=null===(r=null==e?void 0:e.offerOptions)||void 0===r?void 0:r.iceRestart,o=void 0===(null==e?void 0:e.iceGatheringTimeout)?null===(n=this.sessionDescriptionHandlerConfiguration)||void 0===n?void 0:n.iceGatheringTimeout:null==e?void 0:e.iceGatheringTimeout;return this.getLocalMediaStream(e).then((()=>this.createDataChannel(e))).then((()=>this.createLocalOfferOrAnswer(e))).then((e=>this.applyModifiers(e,t))).then((e=>this.setLocalSessionDescription(e))).then((()=>this.waitForIceGatheringComplete(i,o))).then((()=>this.getLocalSessionDescription())).then((e=>({body:e.sdp,contentType:"application/sdp"}))).catch((e=>{throw this.logger.error("SessionDescriptionHandler.getDescription failed - "+e),e}))}hasDescription(e){return this.logger.debug("SessionDescriptionHandler.hasDescription"),"application/sdp"===e}sendDtmf(e,t){if(this.logger.debug("SessionDescriptionHandler.sendDtmf"),void 0===this._peerConnection)return this.logger.error("SessionDescriptionHandler.sendDtmf failed - peer connection closed"),!1;const r=this._peerConnection.getSenders();if(0===r.length)return this.logger.error("SessionDescriptionHandler.sendDtmf failed - no senders"),!1;const n=r[0].dtmf;if(!n)return this.logger.error("SessionDescriptionHandler.sendDtmf failed - no DTMF sender"),!1;const i=null==t?void 0:t.duration,o=null==t?void 0:t.interToneGap;try{n.insertDTMF(e,i,o)}catch(e){return this.logger.error(e),!1}return this.logger.log("SessionDescriptionHandler.sendDtmf sent via RTP: "+e.toString()),!0}setDescription(e,t,r){if(this.logger.debug("SessionDescriptionHandler.setDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));this.onDataChannel=null==t?void 0:t.onDataChannel;const n="have-local-offer"===this._peerConnection.signalingState?"answer":"offer";return this.getLocalMediaStream(t).then((()=>this.applyModifiers({sdp:e,type:n},r))).then((e=>this.setRemoteSessionDescription(e))).catch((e=>{throw this.logger.error("SessionDescriptionHandler.setDescription failed - "+e),e}))}applyModifiers(e,t){return this.logger.debug("SessionDescriptionHandler.applyModifiers"),t&&0!==t.length?t.reduce(((e,t)=>e.then(t)),Promise.resolve(e)).then((e=>{if(this.logger.debug("SessionDescriptionHandler.applyModifiers - modified sdp"),!e.sdp||!e.type)throw new Error("Invalid SDP.");return{sdp:e.sdp,type:e.type}})):Promise.resolve(e)}createDataChannel(e){if(void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));if(!0!==(null==e?void 0:e.dataChannel))return Promise.resolve();if(this._dataChannel)return Promise.resolve();switch(this._peerConnection.signalingState){case"stable":this.logger.debug("SessionDescriptionHandler.createDataChannel - creating data channel");try{return this._dataChannel=this._peerConnection.createDataChannel((null==e?void 0:e.dataChannelLabel)||"",null==e?void 0:e.dataChannelOptions),this.onDataChannel&&this.onDataChannel(this._dataChannel),Promise.resolve()}catch(e){return Promise.reject(e)}case"have-remote-offer":return Promise.resolve();default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}}createLocalOfferOrAnswer(e){if(void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));switch(this._peerConnection.signalingState){case"stable":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP offer"),this._peerConnection.createOffer(null==e?void 0:e.offerOptions);case"have-remote-offer":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP answer"),this._peerConnection.createAnswer(null==e?void 0:e.answerOptions);default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}}getLocalMediaStream(e){if(this.logger.debug("SessionDescriptionHandler.getLocalMediaStream"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));let t=Object.assign({},null==e?void 0:e.constraints);if(this.localMediaStreamConstraints){if(t.audio=t.audio||this.localMediaStreamConstraints.audio,t.video=t.video||this.localMediaStreamConstraints.video,JSON.stringify(this.localMediaStreamConstraints.audio)===JSON.stringify(t.audio)&&JSON.stringify(this.localMediaStreamConstraints.video)===JSON.stringify(t.video))return Promise.resolve()}else void 0===t.audio&&void 0===t.video&&(t={audio:!0});return this.localMediaStreamConstraints=t,this.mediaStreamFactory(t,this).then((e=>this.setLocalMediaStream(e)))}setLocalMediaStream(e){if(this.logger.debug("SessionDescriptionHandler.setLocalMediaStream"),!this._peerConnection)throw new Error("Peer connection undefined.");const t=this._peerConnection,r=this._localMediaStream,n=[],i=e=>{const i=e.kind;if("audio"!==i&&"video"!==i)throw new Error(`Unknown new track kind ${i}.`);const o=t.getSenders().find((e=>e.track&&e.track.kind===i));o?n.push(new Promise((e=>{this.logger.debug(`SessionDescriptionHandler.setLocalMediaStream - replacing sender ${i} track`),e()})).then((()=>o.replaceTrack(e).then((()=>{const t=r.getTracks().find((e=>e.kind===i));t&&(t.stop(),r.removeTrack(t),we.dispatchRemoveTrackEvent(r,t)),r.addTrack(e),we.dispatchAddTrackEvent(r,e)})).catch((e=>{throw this.logger.error(`SessionDescriptionHandler.setLocalMediaStream - failed to replace sender ${i} track`),e}))))):n.push(new Promise((e=>{this.logger.debug(`SessionDescriptionHandler.setLocalMediaStream - adding sender ${i} track`),e()})).then((()=>{try{t.addTrack(e,r)}catch(e){throw this.logger.error(`SessionDescriptionHandler.setLocalMediaStream - failed to add sender ${i} track`),e}r.addTrack(e),we.dispatchAddTrackEvent(r,e)})))},o=e.getAudioTracks();o.length&&i(o[0]);const a=e.getVideoTracks();return a.length&&i(a[0]),n.reduce(((e,t)=>e.then((()=>t))),Promise.resolve())}getLocalSessionDescription(){if(this.logger.debug("SessionDescriptionHandler.getLocalSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));const e=this._peerConnection.localDescription;return e?Promise.resolve(e):Promise.reject(new Error("Failed to get local session description"))}setLocalSessionDescription(e){return this.logger.debug("SessionDescriptionHandler.setLocalSessionDescription"),void 0===this._peerConnection?Promise.reject(new Error("Peer connection closed.")):this._peerConnection.setLocalDescription(e)}setRemoteSessionDescription(e){if(this.logger.debug("SessionDescriptionHandler.setRemoteSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));const t=e.sdp;let r;switch(this._peerConnection.signalingState){case"stable":r="offer";break;case"have-local-offer":r="answer";break;default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}return t?this._peerConnection.setRemoteDescription({sdp:t,type:r}):(this.logger.error("SessionDescriptionHandler.setRemoteSessionDescription failed - cannot set null sdp"),Promise.reject(new Error("SDP is undefined")))}setRemoteTrack(e){this.logger.debug("SessionDescriptionHandler.setRemoteTrack");const t=this._remoteMediaStream;t.getTrackById(e.id)?this.logger.debug(`SessionDescriptionHandler.setRemoteTrack - have remote ${e.kind} track`):"audio"===e.kind?(this.logger.debug(`SessionDescriptionHandler.setRemoteTrack - adding remote ${e.kind} track`),t.getAudioTracks().forEach((e=>{e.stop(),t.removeTrack(e),we.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),we.dispatchAddTrackEvent(t,e)):"video"===e.kind&&(this.logger.debug(`SessionDescriptionHandler.setRemoteTrack - adding remote ${e.kind} track`),t.getVideoTracks().forEach((e=>{e.stop(),t.removeTrack(e),we.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),we.dispatchAddTrackEvent(t,e))}iceGatheringComplete(){this.logger.debug("SessionDescriptionHandler.iceGatheringComplete"),void 0!==this.iceGatheringCompleteTimeoutId&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - clearing timeout"),clearTimeout(this.iceGatheringCompleteTimeoutId),this.iceGatheringCompleteTimeoutId=void 0),void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - resolving promise"),this.iceGatheringCompleteResolve&&this.iceGatheringCompleteResolve(),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0)}waitForIceGatheringComplete(e=!1,t=0){return this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete"),void 0===this._peerConnection?Promise.reject("Peer connection closed."):e||"complete"!==this._peerConnection.iceGatheringState?(void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - rejecting prior waiting promise"),this.iceGatheringCompleteReject&&this.iceGatheringCompleteReject(new Error("Promise superseded.")),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0),this.iceGatheringCompletePromise=new Promise(((e,r)=>{this.iceGatheringCompleteResolve=e,this.iceGatheringCompleteReject=r,t>0&&(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - timeout in "+t),this.iceGatheringCompleteTimeoutId=setTimeout((()=>{this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - timeout"),this.iceGatheringComplete()}),t))})),this.iceGatheringCompletePromise):(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringToComplete - already complete"),Promise.resolve())}initPeerConnectionEventHandlers(){if(this.logger.debug("SessionDescriptionHandler.initPeerConnectionEventHandlers"),!this._peerConnection)throw new Error("Peer connection undefined.");const e=this._peerConnection;e.onconnectionstatechange=t=>{var r;const n=e.connectionState;this.logger.debug(`SessionDescriptionHandler.onconnectionstatechange ${n}`),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.onconnectionstatechange)&&this._peerConnectionDelegate.onconnectionstatechange(t)},e.ondatachannel=e=>{var t;this.logger.debug("SessionDescriptionHandler.ondatachannel"),this._dataChannel=e.channel,this.onDataChannel&&this.onDataChannel(this._dataChannel),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.ondatachannel)&&this._peerConnectionDelegate.ondatachannel(e)},e.onicecandidate=e=>{var t;this.logger.debug("SessionDescriptionHandler.onicecandidate"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onicecandidate)&&this._peerConnectionDelegate.onicecandidate(e)},e.onicecandidateerror=e=>{var t;this.logger.debug("SessionDescriptionHandler.onicecandidateerror"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onicecandidateerror)&&this._peerConnectionDelegate.onicecandidateerror(e)},e.oniceconnectionstatechange=t=>{var r;const n=e.iceConnectionState;this.logger.debug(`SessionDescriptionHandler.oniceconnectionstatechange ${n}`),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.oniceconnectionstatechange)&&this._peerConnectionDelegate.oniceconnectionstatechange(t)},e.onicegatheringstatechange=t=>{var r;const n=e.iceGatheringState;this.logger.debug(`SessionDescriptionHandler.onicegatheringstatechange ${n}`),"complete"===n&&this.iceGatheringComplete(),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.onicegatheringstatechange)&&this._peerConnectionDelegate.onicegatheringstatechange(t)},e.onnegotiationneeded=e=>{var t;this.logger.debug("SessionDescriptionHandler.onnegotiationneeded"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onnegotiationneeded)&&this._peerConnectionDelegate.onnegotiationneeded(e)},e.onsignalingstatechange=t=>{var r;const n=e.signalingState;this.logger.debug(`SessionDescriptionHandler.onsignalingstatechange ${n}`),(null===(r=this._peerConnectionDelegate)||void 0===r?void 0:r.onsignalingstatechange)&&this._peerConnectionDelegate.onsignalingstatechange(t)},e.onstatsended=e=>{var t;this.logger.debug("SessionDescriptionHandler.onstatsended"),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.onstatsended)&&this._peerConnectionDelegate.onstatsended(e)},e.ontrack=e=>{var t;const r=e.track.kind,n=e.track.enabled?"enabled":"disabled";this.logger.debug(`SessionDescriptionHandler.ontrack ${r} ${n}`),this.setRemoteTrack(e.track),(null===(t=this._peerConnectionDelegate)||void 0===t?void 0:t.ontrack)&&this._peerConnectionDelegate.ontrack(e)}}}class Ae{constructor(){this.listeners=new Array}addListener(e,t){const r=t=>{this.removeListener(r),e(t)};!0===(null==t?void 0:t.once)?this.listeners.push(r):this.listeners.push(e)}emit(e){this.listeners.slice().forEach((t=>t(e)))}removeAllListeners(){this.listeners=[]}removeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}on(e){return this.addListener(e)}off(e){return this.removeListener(e)}once(e){return this.addListener(e,{once:!0})}}class Ce extends I{constructor(e){super(e||"An error occurred during state transition.")}}!function(e){e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Disconnected="Disconnected"}(Te||(Te={}));class Ie{constructor(e,t){if(this._state=Te.Disconnected,this.transitioningState=!1,this._stateEventEmitter=new Ae,this.logger=e,t){const e=t,r=null==e?void 0:e.wsServers,n=null==e?void 0:e.maxReconnectionAttempts;if(void 0!==r){const e='The transport option "wsServers" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}if(void 0!==n){const e='The transport option "maxReconnectionAttempts" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}r&&!t.server&&("string"==typeof r&&(t.server=r),r instanceof Array&&(t.server=r[0]))}this.configuration=Object.assign(Object.assign({},Ie.defaultOptions),t);const r=this.configuration.server,n=o.parse(r,"absoluteURI");if(-1===n)throw this.logger.error(`Invalid WebSocket Server URL "${r}"`),new Error("Invalid WebSocket Server URL");if(!["wss","ws","udp"].includes(n.scheme))throw this.logger.error(`Invalid scheme in WebSocket Server URL "${r}"`),new Error("Invalid scheme in WebSocket Server URL");this._protocol=n.scheme.toUpperCase()}dispose(){return this.disconnect()}get protocol(){return this._protocol}get server(){return this.configuration.server}get state(){return this._state}get stateChange(){return this._stateEventEmitter}get ws(){return this._ws}connect(){return this._connect()}disconnect(){return this._disconnect()}isConnected(){return this.state===Te.Connected}send(e){return this._send(e)}_connect(){switch(this.logger.log(`Connecting ${this.server}`),this.state){case Te.Connecting:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Connecting));if(!this.connectPromise)throw new Error("Connect promise must be defined.");return this.connectPromise;case Te.Connected:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Connecting));if(this.connectPromise)throw new Error("Connect promise must not be defined.");return Promise.resolve();case Te.Disconnecting:if(this.connectPromise)throw new Error("Connect promise must not be defined.");try{this.transitionState(Te.Connecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;case Te.Disconnected:if(this.connectPromise)throw new Error("Connect promise must not be defined.");try{this.transitionState(Te.Connecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;default:throw new Error("Unknown state")}let e;try{e=new WebSocket(this.server,"sip"),e.binaryType="arraybuffer",e.addEventListener("close",(t=>this.onWebSocketClose(t,e))),e.addEventListener("error",(t=>this.onWebSocketError(t,e))),e.addEventListener("open",(t=>this.onWebSocketOpen(t,e))),e.addEventListener("message",(t=>this.onWebSocketMessage(t,e))),this._ws=e}catch(e){return this._ws=void 0,this.logger.error("WebSocket construction failed."),this.logger.error(e),new Promise(((t,r)=>{this.connectResolve=t,this.connectReject=r,this.transitionState(Te.Disconnected,e)}))}return this.connectPromise=new Promise(((t,r)=>{this.connectResolve=t,this.connectReject=r,this.connectTimeout=setTimeout((()=>{this.logger.warn("Connect timed out. Exceeded time set in configuration.connectionTimeout: "+this.configuration.connectionTimeout+"s."),e.close(1e3)}),1e3*this.configuration.connectionTimeout)})),this.connectPromise}_disconnect(){switch(this.logger.log(`Disconnecting ${this.server}`),this.state){case Te.Connecting:if(this.disconnectPromise)throw new Error("Disconnect promise must not be defined.");try{this.transitionState(Te.Disconnecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;case Te.Connected:if(this.disconnectPromise)throw new Error("Disconnect promise must not be defined.");try{this.transitionState(Te.Disconnecting)}catch(e){if(e instanceof Ce)return Promise.reject(e);throw e}break;case Te.Disconnecting:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Disconnecting));if(!this.disconnectPromise)throw new Error("Disconnect promise must be defined.");return this.disconnectPromise;case Te.Disconnected:if(this.transitioningState)return Promise.reject(this.transitionLoopDetectedError(Te.Disconnecting));if(this.disconnectPromise)throw new Error("Disconnect promise must not be defined.");return Promise.resolve();default:throw new Error("Unknown state")}if(!this._ws)throw new Error("WebSocket must be defined.");const e=this._ws;return this.disconnectPromise=new Promise(((t,r)=>{this.disconnectResolve=t,this.disconnectReject=r;try{e.close(1e3)}catch(e){throw this.logger.error("WebSocket close failed."),this.logger.error(e),e}})),this.disconnectPromise}_send(e){if(!0===this.configuration.traceSip&&this.logger.log("Sending WebSocket message:\n\n"+e+"\n"),this._state!==Te.Connected)return Promise.reject(new Error("Not connected."));if(!this._ws)throw new Error("WebSocket undefined.");try{this._ws.send(e)}catch(e){return e instanceof Error?Promise.reject(e):Promise.reject(new Error("WebSocket send failed."))}return Promise.resolve()}onWebSocketClose(e,t){if(t!==this._ws)return;const r=`WebSocket closed ${this.server} (code: ${e.code})`,n=this.disconnectPromise?void 0:new Error(r);n&&this.logger.warn("WebSocket closed unexpectedly"),this.logger.log(r),this._ws=void 0,this.transitionState(Te.Disconnected,n)}onWebSocketError(e,t){t===this._ws&&this.logger.error("WebSocket error occurred.")}onWebSocketMessage(e,t){if(t!==this._ws)return;const r=e.data;let n;if(/^(\r\n)+$/.test(r))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("Received WebSocket message with CRLF Keep Alive response"));if(r){if("string"!=typeof r){try{n=(new TextDecoder).decode(new Uint8Array(r))}catch(e){return this.logger.error(e),void this.logger.error("Received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("Received WebSocket binary message:\n\n"+n+"\n")}else n=r,!0===this.configuration.traceSip&&this.logger.log("Received WebSocket text message:\n\n"+n+"\n");if(this.state===Te.Connected){if(this.onMessage)try{this.onMessage(n)}catch(e){throw this.logger.error(e),this.logger.error("Exception thrown by onMessage callback"),e}}else this.logger.warn("Received message while not connected, discarding...")}else this.logger.warn("Received empty message, discarding...")}onWebSocketOpen(e,t){t===this._ws&&this._state===Te.Connecting&&(this.logger.log(`WebSocket opened ${this.server}`),this.transitionState(Te.Connected))}transitionLoopDetectedError(e){let t="A state transition loop has been detected.";return t+=` An attempt to transition from ${this._state} to ${e} before the prior transition completed.`,t+=" Perhaps you are synchronously calling connect() or disconnect() from a callback or state change handler?",this.logger.error(t),new Ce("Loop detected.")}transitionState(e,t){const r=()=>{throw new Error(`Invalid state transition from ${this._state} to ${e}`)};if(this.transitioningState)throw this.transitionLoopDetectedError(e);switch(this.transitioningState=!0,this._state){case Te.Connecting:e!==Te.Connected&&e!==Te.Disconnecting&&e!==Te.Disconnected&&r();break;case Te.Connected:e!==Te.Disconnecting&&e!==Te.Disconnected&&r();break;case Te.Disconnecting:e!==Te.Connecting&&e!==Te.Disconnected&&r();break;case Te.Disconnected:e!==Te.Connecting&&r();break;default:throw new Error("Unknown state.")}const n=this._state;this._state=e;const i=this.connectResolve,o=this.connectReject;n===Te.Connecting&&(this.connectPromise=void 0,this.connectResolve=void 0,this.connectReject=void 0);const a=this.disconnectResolve,s=this.disconnectReject;if(n===Te.Disconnecting&&(this.disconnectPromise=void 0,this.disconnectResolve=void 0,this.disconnectReject=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.logger.log(`Transitioned from ${n} to ${this._state}`),this._stateEventEmitter.emit(this._state),e===Te.Connected&&(this.startSendingKeepAlives(),this.onConnect))try{this.onConnect()}catch(e){throw this.logger.error(e),this.logger.error("Exception thrown by onConnect callback"),e}if(n===Te.Connected&&(this.stopSendingKeepAlives(),this.onDisconnect))try{t?this.onDisconnect(t):this.onDisconnect()}catch(e){throw this.logger.error(e),this.logger.error("Exception thrown by onDisconnect callback"),e}if(n===Te.Connecting){if(!i)throw new Error("Connect resolve undefined.");if(!o)throw new Error("Connect reject undefined.");e===Te.Connected?i():o(t||new Error("Connect aborted."))}if(n===Te.Disconnecting){if(!a)throw new Error("Disconnect resolve undefined.");if(!s)throw new Error("Disconnect reject undefined.");e===Te.Disconnected?a():s(t||new Error("Disconnect aborted."))}this.transitioningState=!1}clearKeepAliveTimeout(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0}sendKeepAlive(){return this.keepAliveDebounceTimeout?Promise.resolve():(this.keepAliveDebounceTimeout=setTimeout((()=>{this.clearKeepAliveTimeout()}),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n"))}startSendingKeepAlives(){this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval((()=>{this.sendKeepAlive(),this.startSendingKeepAlives()}),(e=>{const t=.8*e;return 1e3*(Math.random()*(e-t)+t)})(this.configuration.keepAliveInterval)))}stopSendingKeepAlives(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0}}Ie.defaultOptions={server:"",connectionTimeout:5,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!0};class Oe extends I{constructor(e){super(e||"Unsupported content type.")}}class Pe extends I{constructor(e){super(e||"Unspecified session description handler error.")}}class Ne extends I{constructor(){super("The session has terminated.")}}class ke{constructor(e){this.incomingByeRequest=e}get request(){return this.incomingByeRequest.message}accept(e){return this.incomingByeRequest.accept(e),Promise.resolve()}reject(e){return this.incomingByeRequest.reject(e),Promise.resolve()}}class Me extends I{constructor(e){super(e||"Request pending.")}}class De{constructor(e){this.incomingInfoRequest=e}get request(){return this.incomingInfoRequest.message}accept(e){return this.incomingInfoRequest.accept(e),Promise.resolve()}reject(e){return this.incomingInfoRequest.reject(e),Promise.resolve()}}class Le{constructor(e){this.incomingMessageRequest=e}get request(){return this.incomingMessageRequest.message}accept(e){return this.incomingMessageRequest.accept(e),Promise.resolve()}reject(e){return this.incomingMessageRequest.reject(e),Promise.resolve()}}class xe{constructor(e){this.incomingNotifyRequest=e}get request(){return this.incomingNotifyRequest.message}accept(e){return this.incomingNotifyRequest.accept(e),Promise.resolve()}reject(e){return this.incomingNotifyRequest.reject(e),Promise.resolve()}}class Ve{constructor(e,t){this.incomingReferRequest=e,this.session=t}get referTo(){const e=this.incomingReferRequest.message.parseHeader("refer-to");if(!(e instanceof l))throw new Error("Failed to parse Refer-To header.");return e}get referredBy(){return this.incomingReferRequest.message.getHeader("referred-by")}get replaces(){return this.referTo.uri.getHeader("replaces")}get request(){return this.incomingReferRequest.message}accept(e={statusCode:202}){return this.incomingReferRequest.accept(e),Promise.resolve()}reject(e){return this.incomingReferRequest.reject(e),Promise.resolve()}makeInviter(e){if(this.inviter)return this.inviter;const t=this.referTo.uri.clone();t.clearHeaders();const r=((e=e||{}).extraHeaders||[]).slice(),n=this.replaces;n&&r.push("Replaces: "+decodeURIComponent(n));const i=this.referredBy;return i&&r.push("Referred-By: "+i),e.extraHeaders=r,this.inviter=this.session.userAgent._makeInviter(t,e),this.inviter._referred=this.session,this.session._referral=this.inviter,this.inviter}}!function(e){e.Initial="Initial",e.Establishing="Establishing",e.Established="Established",e.Terminating="Terminating",e.Terminated="Terminated"}(Re||(Re={}));class Ue{constructor(e,t={}){this.pendingReinvite=!1,this.pendingReinviteAck=!1,this._state=Re.Initial,this.delegate=t.delegate,this._stateEventEmitter=new Ae,this._userAgent=e}dispose(){switch(this.logger.log(`Session ${this.id} in state ${this._state} is being disposed`),delete this.userAgent._sessions[this.id],this._sessionDescriptionHandler&&this._sessionDescriptionHandler.close(),this.state){case Re.Initial:case Re.Establishing:break;case Re.Established:return new Promise((e=>{this._bye({onAccept:()=>e(),onRedirect:()=>e(),onReject:()=>e()})}));case Re.Terminating:case Re.Terminated:break;default:throw new Error("Unknown state.")}return Promise.resolve()}get assertedIdentity(){return this._assertedIdentity}get dialog(){return this._dialog}get id(){return this._id}get replacee(){return this._replacee}get sessionDescriptionHandler(){return this._sessionDescriptionHandler}get sessionDescriptionHandlerFactory(){return this.userAgent.configuration.sessionDescriptionHandlerFactory}get sessionDescriptionHandlerModifiers(){return this._sessionDescriptionHandlerModifiers||[]}set sessionDescriptionHandlerModifiers(e){this._sessionDescriptionHandlerModifiers=e.slice()}get sessionDescriptionHandlerOptions(){return this._sessionDescriptionHandlerOptions||{}}set sessionDescriptionHandlerOptions(e){this._sessionDescriptionHandlerOptions=Object.assign({},e)}get sessionDescriptionHandlerModifiersReInvite(){return this._sessionDescriptionHandlerModifiersReInvite||[]}set sessionDescriptionHandlerModifiersReInvite(e){this._sessionDescriptionHandlerModifiersReInvite=e.slice()}get sessionDescriptionHandlerOptionsReInvite(){return this._sessionDescriptionHandlerOptionsReInvite||{}}set sessionDescriptionHandlerOptionsReInvite(e){this._sessionDescriptionHandlerOptionsReInvite=Object.assign({},e)}get state(){return this._state}get stateChange(){return this._stateEventEmitter}get userAgent(){return this._userAgent}bye(e={}){let t="Session.bye() may only be called if established session.";switch(this.state){case Re.Initial:"function"==typeof this.cancel?(t+=" However Inviter.invite() has not yet been called.",t+=" Perhaps you should have called Inviter.cancel()?"):"function"==typeof this.reject&&(t+=" However Invitation.accept() has not yet been called.",t+=" Perhaps you should have called Invitation.reject()?");break;case Re.Establishing:"function"==typeof this.cancel?(t+=" However a dialog does not yet exist.",t+=" Perhaps you should have called Inviter.cancel()?"):"function"==typeof this.reject&&(t+=" However Invitation.accept() has not yet been called (or not yet resolved).",t+=" Perhaps you should have called Invitation.reject()?");break;case Re.Established:{const t=e.requestDelegate,r=this.copyRequestOptions(e.requestOptions);return this._bye(t,r)}case Re.Terminating:t+=" However this session is already terminating.","function"==typeof this.cancel?t+=" Perhaps you have already called Inviter.cancel()?":"function"==typeof this.reject&&(t+=" Perhaps you have already called Session.bye()?");break;case Re.Terminated:t+=" However this session is already terminated.";break;default:throw new Error("Unknown state")}return this.logger.error(t),Promise.reject(new Error(`Invalid session state ${this.state}`))}info(e={}){if(this.state!==Re.Established){const e="Session.info() may only be called if established session.";return this.logger.error(e),Promise.reject(new Error(`Invalid session state ${this.state}`))}const t=e.requestDelegate,r=this.copyRequestOptions(e.requestOptions);return this._info(t,r)}invite(e={}){if(this.logger.log("Session.invite"),this.state!==Re.Established)return Promise.reject(new Error(`Invalid session state ${this.state}`));if(this.pendingReinvite)return Promise.reject(new Me("Reinvite in progress. Please wait until complete, then try again."));this.pendingReinvite=!0,e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiersReInvite=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptionsReInvite=e.sessionDescriptionHandlerOptions);const t={onAccept:t=>{const r=$(t.message);if(!r)return this.logger.error("Received 2xx response to re-INVITE without a session description"),this.ackAndBye(t,400,"Missing session description"),this.stateTransition(Re.Terminated),void(this.pendingReinvite=!1);if(e.withoutSdp){const n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};this.setOfferAndGetAnswer(r,n).then((e=>{t.ack({body:e})})).catch((e=>{this.logger.error("Failed to handle offer in 2xx response to re-INVITE"),this.logger.error(e.message),this.state===Re.Terminated?t.ack():(this.ackAndBye(t,488,"Bad Media Description"),this.stateTransition(Re.Terminated))})).then((()=>{this.pendingReinvite=!1,e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(t)}))}else{const n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};this.setAnswer(r,n).then((()=>{t.ack()})).catch((e=>{this.logger.error("Failed to handle answer in 2xx response to re-INVITE"),this.logger.error(e.message),this.state!==Re.Terminated?(this.ackAndBye(t,488,"Bad Media Description"),this.stateTransition(Re.Terminated)):t.ack()})).then((()=>{this.pendingReinvite=!1,e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(t)}))}},onProgress:e=>{},onRedirect:e=>{},onReject:t=>{this.logger.warn("Received a non-2xx response to re-INVITE"),this.pendingReinvite=!1,e.withoutSdp?e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(t):this.rollbackOffer().catch((e=>{if(this.logger.error("Failed to rollback offer on non-2xx response to re-INVITE"),this.logger.error(e.message),this.state!==Re.Terminated){if(!this.dialog)throw new Error("Dialog undefined.");const e=[];e.push("Reason: "+this.getReasonHeaderValue(500,"Internal Server Error")),this.dialog.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated)}})).then((()=>{e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(t)}))},onTrying:e=>{}},r=e.requestOptions||{};if(r.extraHeaders=(r.extraHeaders||[]).slice(),r.extraHeaders.push("Allow: "+he.toString()),r.extraHeaders.push("Contact: "+this._contact),e.withoutSdp){if(!this.dialog)throw this.pendingReinvite=!1,new Error("Dialog undefined.");return Promise.resolve(this.dialog.invite(t,r))}const n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};return this.getOffer(n).then((e=>{if(!this.dialog)throw this.pendingReinvite=!1,new Error("Dialog undefined.");return r.body=e,this.dialog.invite(t,r)})).catch((e=>{throw this.logger.error(e.message),this.logger.error("Failed to send re-INVITE"),this.pendingReinvite=!1,e}))}message(e={}){if(this.state!==Re.Established){const e="Session.message() may only be called if established session.";return this.logger.error(e),Promise.reject(new Error(`Invalid session state ${this.state}`))}const t=e.requestDelegate,r=this.copyRequestOptions(e.requestOptions);return this._message(t,r)}refer(e,t={}){if(this.state!==Re.Established){const e="Session.refer() may only be called if established session.";return this.logger.error(e),Promise.reject(new Error(`Invalid session state ${this.state}`))}const r=t.requestDelegate,n=this.copyRequestOptions(t.requestOptions);return n.extraHeaders=n.extraHeaders?n.extraHeaders.concat(this.referExtraHeaders(this.referToString(e))):this.referExtraHeaders(this.referToString(e)),this._refer(t.onNotify,r,n)}_bye(e,t){if(!this.dialog)return Promise.reject(new Error("Session dialog undefined."));const r=this.dialog;switch(r.sessionState){case R.Initial:case R.Early:throw new Error(`Invalid dialog state ${r.sessionState}`);case R.AckWait:return this.stateTransition(Re.Terminating),new Promise((n=>{r.delegate={onAck:()=>{const i=r.bye(e,t);return this.stateTransition(Re.Terminated),n(i),Promise.resolve()},onAckTimeout:()=>{const i=r.bye(e,t);this.stateTransition(Re.Terminated),n(i)}}}));case R.Confirmed:{const n=r.bye(e,t);return this.stateTransition(Re.Terminated),Promise.resolve(n)}case R.Terminated:throw new Error(`Invalid dialog state ${r.sessionState}`);default:throw new Error("Unrecognized state.")}}_info(e,t){return this.dialog?Promise.resolve(this.dialog.info(e,t)):Promise.reject(new Error("Session dialog undefined."))}_message(e,t){return this.dialog?Promise.resolve(this.dialog.message(e,t)):Promise.reject(new Error("Session dialog undefined."))}_refer(e,t,r){return this.dialog?(this.onNotify=e,Promise.resolve(this.dialog.refer(t,r))):Promise.reject(new Error("Session dialog undefined."))}ackAndBye(e,t,r){e.ack();const n=[];t&&n.push("Reason: "+this.getReasonHeaderValue(t,r)),e.session.bye(void 0,{extraHeaders:n})}onAckRequest(e){if(this.logger.log("Session.onAckRequest"),this.state!==Re.Established&&this.state!==Re.Terminating)return this.logger.error(`ACK received while in state ${this.state}, dropping request`),Promise.resolve();const t=this.dialog;if(!t)throw new Error("Dialog undefined.");const r={sessionDescriptionHandlerOptions:this.pendingReinviteAck?this.sessionDescriptionHandlerOptionsReInvite:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.pendingReinviteAck?this._sessionDescriptionHandlerModifiersReInvite:this._sessionDescriptionHandlerModifiers};switch(this.pendingReinviteAck=!1,t.signalingState){case b.Initial:{this.logger.error(`Invalid signaling state ${t.signalingState}.`);const e=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return t.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated),Promise.resolve()}case b.Stable:{const n=$(e.message);return n?"render"===n.contentDisposition?(this._renderbody=n.content,this._rendertype=n.contentType,Promise.resolve()):"session"!==n.contentDisposition?Promise.resolve():this.setAnswer(n,r).catch((e=>{this.logger.error(e.message);const r=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];t.bye(void 0,{extraHeaders:r}),this.stateTransition(Re.Terminated)})):Promise.resolve()}case b.HaveLocalOffer:{this.logger.error(`Invalid signaling state ${t.signalingState}.`);const e=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return t.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated),Promise.resolve()}case b.HaveRemoteOffer:{this.logger.error(`Invalid signaling state ${t.signalingState}.`);const e=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return t.bye(void 0,{extraHeaders:e}),this.stateTransition(Re.Terminated),Promise.resolve()}case b.Closed:default:throw new Error(`Invalid signaling state ${t.signalingState}.`)}}onByeRequest(e){if(this.logger.log("Session.onByeRequest"),this.state===Re.Established){if(this.delegate&&this.delegate.onBye){const t=new ke(e);this.delegate.onBye(t)}else e.accept();this.stateTransition(Re.Terminated)}else this.logger.error(`BYE received while in state ${this.state}, dropping request`)}onInfoRequest(e){if(this.logger.log("Session.onInfoRequest"),this.state===Re.Established)if(this.delegate&&this.delegate.onInfo){const t=new De(e);this.delegate.onInfo(t)}else e.accept();else this.logger.error(`INFO received while in state ${this.state}, dropping request`)}onInviteRequest(e){if(this.logger.log("Session.onInviteRequest"),this.state!==Re.Established)return void this.logger.error(`INVITE received while in state ${this.state}, dropping request`);this.pendingReinviteAck=!0;const t=["Contact: "+this._contact];if(e.message.hasHeader("P-Asserted-Identity")){const t=e.message.getHeader("P-Asserted-Identity");if(!t)throw new Error("Header undefined.");this._assertedIdentity=o.nameAddrHeaderParse(t)}const r={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptionsReInvite,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiersReInvite};this.generateResponseOfferAnswerInDialog(r).then((r=>{const n=e.accept({statusCode:200,extraHeaders:t,body:r});this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,n.message,200)})).catch((r=>{if(this.logger.error(r.message),this.logger.error("Failed to handle to re-INVITE request"),!this.dialog)throw new Error("Dialog undefined.");if(this.logger.error(this.dialog.signalingState),this.dialog.signalingState!==b.Stable)this.rollbackOffer().then((()=>{const t=e.reject({statusCode:488});this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,t.message,488)})).catch((r=>{this.logger.error(r.message),this.logger.error("Failed to rollback offer on re-INVITE request");const n=e.reject({statusCode:488});if(this.state!==Re.Terminated){if(!this.dialog)throw new Error("Dialog undefined.");[].push("Reason: "+this.getReasonHeaderValue(500,"Internal Server Error")),this.dialog.bye(void 0,{extraHeaders:t}),this.stateTransition(Re.Terminated)}this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,n.message,488)}));else{const t=e.reject({statusCode:488});this.delegate&&this.delegate.onInvite&&this.delegate.onInvite(e.message,t.message,488)}}))}onMessageRequest(e){if(this.logger.log("Session.onMessageRequest"),this.state===Re.Established)if(this.delegate&&this.delegate.onMessage){const t=new Le(e);this.delegate.onMessage(t)}else e.accept();else this.logger.error(`MESSAGE received while in state ${this.state}, dropping request`)}onNotifyRequest(e){if(this.logger.log("Session.onNotifyRequest"),this.state===Re.Established)if(this.onNotify){const t=new xe(e);this.onNotify(t)}else if(this.delegate&&this.delegate.onNotify){const t=new xe(e);this.delegate.onNotify(t)}else e.accept();else this.logger.error(`NOTIFY received while in state ${this.state}, dropping request`)}onPrackRequest(e){if(this.logger.log("Session.onPrackRequest"),this.state===Re.Established)throw new Error("Unimplemented.");this.logger.error(`PRACK received while in state ${this.state}, dropping request`)}onReferRequest(e){if(this.logger.log("Session.onReferRequest"),this.state!==Re.Established)return void this.logger.error(`REFER received while in state ${this.state}, dropping request`);if(!e.message.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting."),void e.reject();const t=new Ve(e,this);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(t):(this.logger.log("No delegate available to handle REFER, automatically accepting and following."),t.accept().then((()=>t.makeInviter(this._referralInviterOptions).invite())).catch((e=>{this.logger.error(e.message)})))}generateResponseOfferAnswer(e,t){if(this.dialog)return this.generateResponseOfferAnswerInDialog(t);const r=$(e.message);return r&&"session"===r.contentDisposition?this.setOfferAndGetAnswer(r,t):this.getOffer(t)}generateResponseOfferAnswerInDialog(e){if(!this.dialog)throw new Error("Dialog undefined.");switch(this.dialog.signalingState){case b.Initial:return this.getOffer(e);case b.HaveLocalOffer:return Promise.resolve(void 0);case b.HaveRemoteOffer:if(!this.dialog.offer)throw new Error(`Session offer undefined in signaling state ${this.dialog.signalingState}.`);return this.setOfferAndGetAnswer(this.dialog.offer,e);case b.Stable:return this.state!==Re.Established?Promise.resolve(void 0):this.getOffer(e);case b.Closed:default:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`)}}getOffer(e){const t=this.setupSessionDescriptionHandler(),r=e.sessionDescriptionHandlerOptions,n=e.sessionDescriptionHandlerModifiers;try{return t.getDescription(r,n).then((e=>H(e))).catch((e=>{this.logger.error("Session.getOffer: SDH getDescription rejected...");const t=e instanceof Error?e:new Error("Session.getOffer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.getOffer: SDH getDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}rollbackOffer(){const e=this.setupSessionDescriptionHandler();if(void 0===e.rollbackDescription)return Promise.resolve();try{return e.rollbackDescription().catch((e=>{this.logger.error("Session.rollbackOffer: SDH rollbackDescription rejected...");const t=e instanceof Error?e:new Error("Session.rollbackOffer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.rollbackOffer: SDH rollbackDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}setAnswer(e,t){const r=this.setupSessionDescriptionHandler(),n=t.sessionDescriptionHandlerOptions,i=t.sessionDescriptionHandlerModifiers;try{if(!r.hasDescription(e.contentType))return Promise.reject(new Oe)}catch(e){this.logger.error("Session.setAnswer: SDH hasDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}try{return r.setDescription(e.content,n,i).catch((e=>{this.logger.error("Session.setAnswer: SDH setDescription rejected...");const t=e instanceof Error?e:new Error("Session.setAnswer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.setAnswer: SDH setDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}setOfferAndGetAnswer(e,t){const r=this.setupSessionDescriptionHandler(),n=t.sessionDescriptionHandlerOptions,i=t.sessionDescriptionHandlerModifiers;try{if(!r.hasDescription(e.contentType))return Promise.reject(new Oe)}catch(e){this.logger.error("Session.setOfferAndGetAnswer: SDH hasDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}try{return r.setDescription(e.content,n,i).then((()=>r.getDescription(n,i))).then((e=>H(e))).catch((e=>{this.logger.error("Session.setOfferAndGetAnswer: SDH setDescription or getDescription rejected...");const t=e instanceof Error?e:new Error("Session.setOfferAndGetAnswer unknown error.");throw this.logger.error(t.message),t}))}catch(e){this.logger.error("Session.setOfferAndGetAnswer: SDH setDescription or getDescription threw...");const t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}}setSessionDescriptionHandler(e){if(this._sessionDescriptionHandler)throw new Error("Session description handler defined.");this._sessionDescriptionHandler=e}setupSessionDescriptionHandler(){var e;return this._sessionDescriptionHandler||(this._sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.userAgent.configuration.sessionDescriptionHandlerFactoryOptions),(null===(e=this.delegate)||void 0===e?void 0:e.onSessionDescriptionHandler)&&this.delegate.onSessionDescriptionHandler(this._sessionDescriptionHandler,!1)),this._sessionDescriptionHandler}stateTransition(e){const t=()=>{throw new Error(`Invalid state transition from ${this._state} to ${e}`)};switch(this._state){case Re.Initial:e!==Re.Establishing&&e!==Re.Established&&e!==Re.Terminating&&e!==Re.Terminated&&t();break;case Re.Establishing:e!==Re.Established&&e!==Re.Terminating&&e!==Re.Terminated&&t();break;case Re.Established:e!==Re.Terminating&&e!==Re.Terminated&&t();break;case Re.Terminating:e!==Re.Terminated&&t();break;case Re.Terminated:t();break;default:throw new Error("Unrecognized state.")}this._state=e,this.logger.log(`Session ${this.id} transitioned to state ${this._state}`),this._stateEventEmitter.emit(this._state),e===Re.Terminated&&this.dispose()}copyRequestOptions(e={}){return{extraHeaders:e.extraHeaders?e.extraHeaders.slice():void 0,body:e.body?{contentDisposition:e.body.contentDisposition||"render",contentType:e.body.contentType||"text/plain",content:e.body.content||""}:void 0}}getReasonHeaderValue(e,t){const r=e;let n=g(e);return!n&&t&&(n=t),"SIP;cause="+r+';text="'+n+'"'}referExtraHeaders(e){const t=[];return t.push("Referred-By: <"+this.userAgent.configuration.uri+">"),t.push("Contact: "+this._contact),t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.push("Refer-To: "+e),t}referToString(e){let t;if(e instanceof s)t=e.toString();else{if(!e.dialog)throw new Error("Dialog undefined.");const r=e.remoteIdentity.friendlyName,n=e.dialog.remoteTarget.toString(),i=e.dialog.callId,o=e.dialog.remoteTag,a=e.dialog.localTag;t=`"${r}" <${n}?Replaces=${encodeURIComponent(`${i};to-tag=${o};from-tag=${a}`)}>`}return t}}!function(e){e.Required="Required",e.Supported="Supported",e.Unsupported="Unsupported"}(be||(be={}));const je={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0};class He extends Ue{constructor(e,t){super(e),this.incomingInviteRequest=t,this.disposed=!1,this.expiresTimer=void 0,this.isCanceled=!1,this.rel100="none",this.rseq=Math.floor(1e4*Math.random()),this.userNoAnswerTimer=void 0,this.waitingForPrack=!1,this.logger=e.getLogger("sip.Invitation");const r=this.incomingInviteRequest.message,n=r.getHeader("require");n&&n.toLowerCase().includes("100rel")&&(this.rel100="required");const i=r.getHeader("supported");if(i&&i.toLowerCase().includes("100rel")&&(this.rel100="supported"),r.toTag=t.toTag,"string"!=typeof r.toTag)throw new TypeError("toTag should have been a string.");if(this.userNoAnswerTimer=setTimeout((()=>{t.reject({statusCode:480}),this.stateTransition(Re.Terminated)}),this.userAgent.configuration.noAnswerTimeout?1e3*this.userAgent.configuration.noAnswerTimeout:6e4),r.hasHeader("expires")){const e=1e3*Number(r.getHeader("expires")||0);this.expiresTimer=setTimeout((()=>{this.state===Re.Initial&&(t.reject({statusCode:487}),this.stateTransition(Re.Terminated))}),e)}const a=this.request.getHeader("P-Asserted-Identity");a&&(this._assertedIdentity=o.nameAddrHeaderParse(a)),this._contact=this.userAgent.contact.toString();const s=r.parseHeader("Content-Disposition");s&&"render"===s.type&&(this._renderbody=r.body,this._rendertype=r.getHeader("Content-Type")),this._id=r.callId+r.fromTag,this.userAgent._sessions[this._id]=this}dispose(){if(this.disposed)return Promise.resolve();switch(this.disposed=!0,this.expiresTimer&&(clearTimeout(this.expiresTimer),this.expiresTimer=void 0),this.userNoAnswerTimer&&(clearTimeout(this.userNoAnswerTimer),this.userNoAnswerTimer=void 0),this.prackNeverArrived(),this.state){case Re.Initial:case Re.Establishing:return this.reject().then((()=>super.dispose()));case Re.Established:case Re.Terminating:case Re.Terminated:return super.dispose();default:throw new Error("Unknown state.")}}get autoSendAnInitialProvisionalResponse(){return"required"!==this.rel100}get body(){return this.incomingInviteRequest.message.body}get localIdentity(){return this.request.to}get remoteIdentity(){return this.request.from}get request(){return this.incomingInviteRequest.message}accept(e={}){if(this.logger.log("Invitation.accept"),this.state!==Re.Initial){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}return e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=e.sessionDescriptionHandlerOptions),this.stateTransition(Re.Establishing),this.sendAccept().then((({message:e,session:t})=>{t.delegate={onAck:e=>this.onAckRequest(e),onAckTimeout:()=>this.onAckTimeout(),onBye:e=>this.onByeRequest(e),onInfo:e=>this.onInfoRequest(e),onInvite:e=>this.onInviteRequest(e),onMessage:e=>this.onMessageRequest(e),onNotify:e=>this.onNotifyRequest(e),onPrack:e=>this.onPrackRequest(e),onRefer:e=>this.onReferRequest(e)},this._dialog=t,this.stateTransition(Re.Established),this._replacee&&this._replacee._bye()})).catch((e=>this.handleResponseError(e)))}progress(e={}){if(this.logger.log("Invitation.progress"),this.state!==Re.Initial){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}const t=e.statusCode||180;if(t<100||t>199)throw new TypeError("Invalid statusCode: "+t);return e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=e.sessionDescriptionHandlerOptions),this.waitingForPrack?(this.logger.warn("Unexpected call for progress while waiting for prack, ignoring"),Promise.resolve()):100===e.statusCode?this.sendProgressTrying().then((()=>{})).catch((e=>this.handleResponseError(e))):"required"===this.rel100||"supported"===this.rel100&&e.rel100||"supported"===this.rel100&&this.userAgent.configuration.sipExtension100rel===be.Required?this.sendProgressReliableWaitForPrack(e).then((()=>{})).catch((e=>this.handleResponseError(e))):this.sendProgress(e).then((()=>{})).catch((e=>this.handleResponseError(e)))}reject(e={}){if(this.logger.log("Invitation.reject"),this.state!==Re.Initial&&this.state!==Re.Establishing){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}const t=e.statusCode||480,r=e.reasonPhrase?e.reasonPhrase:g(t),n=e.extraHeaders||[];if(t<300||t>699)throw new TypeError("Invalid statusCode: "+t);const i=e.body?H(e.body):void 0;return t<400?this.incomingInviteRequest.redirect([],{statusCode:t,reasonPhrase:r,extraHeaders:n,body:i}):this.incomingInviteRequest.reject({statusCode:t,reasonPhrase:r,extraHeaders:n,body:i}),this.stateTransition(Re.Terminated),Promise.resolve()}_onCancel(e){this.logger.log("Invitation._onCancel"),this.state===Re.Initial||this.state===Re.Establishing?(this.isCanceled=!0,this.incomingInviteRequest.reject({statusCode:487}),this.stateTransition(Re.Terminated)):this.logger.error(`CANCEL received while in state ${this.state}, dropping request`)}handlePrackOfferAnswer(e){if(!this.dialog)throw new Error("Dialog undefined.");const t=$(e.message);if(!t||"session"!==t.contentDisposition)return Promise.resolve(void 0);const r={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers};switch(this.dialog.signalingState){case b.Initial:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`);case b.Stable:return this.setAnswer(t,r).then((()=>{}));case b.HaveLocalOffer:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`);case b.HaveRemoteOffer:return this.setOfferAndGetAnswer(t,r);case b.Closed:default:throw new Error(`Invalid signaling state ${this.dialog.signalingState}.`)}}handleResponseError(e){let t=480;if(e instanceof Error?this.logger.error(e.message):this.logger.error(e),e instanceof Oe?(this.logger.error("A session description handler occurred while sending response (content type unsupported"),t=415):e instanceof Pe?this.logger.error("A session description handler occurred while sending response"):e instanceof Ne?this.logger.error("Session ended before response could be formulated and sent (while waiting for PRACK)"):e instanceof G&&this.logger.error("Session changed state before response could be formulated and sent"),this.state===Re.Initial||this.state===Re.Establishing)try{this.incomingInviteRequest.reject({statusCode:t}),this.stateTransition(Re.Terminated)}catch(e){throw this.logger.error("An error occurred attempting to reject the request while handling another error"),e}if(!this.isCanceled)throw e;this.logger.warn("An error occurred while attempting to formulate and send a response to an incoming INVITE. However a CANCEL was received and processed while doing so which can (and often does) result in errors occurring as the session terminates in the meantime. Said error is being ignored.")}onAckTimeout(){if(this.logger.log("Invitation.onAckTimeout"),!this.dialog)throw new Error("Dialog undefined.");this.logger.log("No ACK received for an extended period of time, terminating session"),this.dialog.bye(),this.stateTransition(Re.Terminated)}sendAccept(){const e={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers};return this.waitingForPrack?this.waitForArrivalOfPrack().then((()=>clearTimeout(this.userNoAnswerTimer))).then((()=>this.generateResponseOfferAnswer(this.incomingInviteRequest,e))).then((e=>this.incomingInviteRequest.accept({statusCode:200,body:e}))):(clearTimeout(this.userNoAnswerTimer),this.generateResponseOfferAnswer(this.incomingInviteRequest,e).then((e=>this.incomingInviteRequest.accept({statusCode:200,body:e}))))}sendProgress(e={}){const t=e.statusCode||180,r=e.reasonPhrase,n=(e.extraHeaders||[]).slice(),i=e.body?H(e.body):void 0;if(183===t&&!i)return this.sendProgressWithSDP(e);try{const e=this.incomingInviteRequest.progress({statusCode:t,reasonPhrase:r,extraHeaders:n,body:i});return this._dialog=e.session,Promise.resolve(e)}catch(e){return Promise.reject(e)}}sendProgressWithSDP(e={}){const t={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers},r=e.statusCode||183,n=e.reasonPhrase,i=(e.extraHeaders||[]).slice();return this.generateResponseOfferAnswer(this.incomingInviteRequest,t).then((e=>this.incomingInviteRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:e}))).then((e=>(this._dialog=e.session,e)))}sendProgressReliable(e={}){return e.extraHeaders=(e.extraHeaders||[]).slice(),e.extraHeaders.push("Require: 100rel"),e.extraHeaders.push("RSeq: "+Math.floor(1e4*Math.random())),this.sendProgressWithSDP(e)}sendProgressReliableWaitForPrack(e={}){const t={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers},r=e.statusCode||183,n=e.reasonPhrase,i=(e.extraHeaders||[]).slice();let o;return i.push("Require: 100rel"),i.push("RSeq: "+this.rseq++),new Promise(((e,a)=>{this.waitingForPrack=!0,this.generateResponseOfferAnswer(this.incomingInviteRequest,t).then((e=>(o=e,this.incomingInviteRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:o})))).then((t=>{let s,c;this._dialog=t.session,t.session.delegate={onPrack:r=>{s=r,clearTimeout(u),clearTimeout(h),this.waitingForPrack&&(this.waitingForPrack=!1,this.handlePrackOfferAnswer(s).then((r=>{try{c=s.accept({statusCode:200,body:r}),this.prackArrived(),e({prackRequest:s,prackResponse:c,progressResponse:t})}catch(e){a(e)}})).catch((e=>a(e))))}};const u=setTimeout((()=>{this.waitingForPrack&&(this.waitingForPrack=!1,this.logger.warn("No PRACK received, rejecting INVITE."),clearTimeout(h),this.reject({statusCode:504}).then((()=>a(new Ne))).catch((e=>a(e))))}),32e3),l=()=>{try{this.incomingInviteRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:o})}catch(e){return this.waitingForPrack=!1,void a(e)}h=setTimeout(l,d*=2)};let d=500,h=setTimeout(l,d)})).catch((e=>{this.waitingForPrack=!1,a(e)}))}))}sendProgressTrying(){try{const e=this.incomingInviteRequest.trying();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}waitForArrivalOfPrack(){if(this.waitingForPrackPromise)throw new Error("Already waiting for PRACK");return this.waitingForPrackPromise=new Promise(((e,t)=>{this.waitingForPrackResolve=e,this.waitingForPrackReject=t})),this.waitingForPrackPromise}prackArrived(){this.waitingForPrackResolve&&this.waitingForPrackResolve(),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0}prackNeverArrived(){this.waitingForPrackReject&&this.waitingForPrackReject(new Ne),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0}}class Be extends Ue{constructor(e,t,r={}){super(e,r),this.disposed=!1,this.earlyMedia=!1,this.earlyMediaSessionDescriptionHandlers=new Map,this.isCanceled=!1,this.inviteWithoutSdp=!1,this.logger=e.getLogger("sip.Inviter"),this.earlyMedia=void 0!==r.earlyMedia?r.earlyMedia:this.earlyMedia,this.fromTag=v(),this.inviteWithoutSdp=void 0!==r.inviteWithoutSdp?r.inviteWithoutSdp:this.inviteWithoutSdp;const n=Object.assign({},r);n.params=Object.assign({},r.params);const i=r.anonymous||!1,a=e.contact.toString({anonymous:i,outbound:i?!e.contact.tempGruu:!e.contact.pubGruu});i&&e.configuration.uri&&(n.params.fromDisplayName="Anonymous",n.params.fromUri="sip:anonymous@anonymous.invalid");let s=e.userAgentCore.configuration.aor;if(n.params.fromUri&&(s="string"==typeof n.params.fromUri?o.URIParse(n.params.fromUri):n.params.fromUri),!s)throw new TypeError("Invalid from URI: "+n.params.fromUri);let c=t;if(n.params.toUri&&(c="string"==typeof n.params.toUri?o.URIParse(n.params.toUri):n.params.toUri),!c)throw new TypeError("Invalid to URI: "+n.params.toUri);const u=Object.assign({},n.params);u.fromTag=this.fromTag;const l=(n.extraHeaders||[]).slice();i&&e.configuration.uri&&(l.push("P-Preferred-Identity: "+e.configuration.uri.toString()),l.push("Privacy: id")),l.push("Contact: "+a),l.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),e.configuration.sipExtension100rel===be.Required&&l.push("Require: 100rel"),e.configuration.sipExtensionReplaces===be.Required&&l.push("Require: replaces"),n.extraHeaders=l,this.outgoingRequestMessage=e.userAgentCore.makeOutgoingRequestMessage(_.INVITE,t,s,c,u,l,void 0),this._contact=a,this._referralInviterOptions=n,this._renderbody=r.renderbody,this._rendertype=r.rendertype,r.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=r.sessionDescriptionHandlerModifiers),r.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=r.sessionDescriptionHandlerOptions),r.sessionDescriptionHandlerModifiersReInvite&&(this.sessionDescriptionHandlerModifiersReInvite=r.sessionDescriptionHandlerModifiersReInvite),r.sessionDescriptionHandlerOptionsReInvite&&(this.sessionDescriptionHandlerOptionsReInvite=r.sessionDescriptionHandlerOptionsReInvite),this._id=this.outgoingRequestMessage.callId+this.fromTag,this.userAgent._sessions[this._id]=this}dispose(){if(this.disposed)return Promise.resolve();switch(this.disposed=!0,this.disposeEarlyMedia(),this.state){case Re.Initial:case Re.Establishing:return this.cancel().then((()=>super.dispose()));case Re.Established:case Re.Terminating:case Re.Terminated:return super.dispose();default:throw new Error("Unknown state.")}}get body(){return this.outgoingRequestMessage.body}get localIdentity(){return this.outgoingRequestMessage.from}get remoteIdentity(){return this.outgoingRequestMessage.to}get request(){return this.outgoingRequestMessage}cancel(e={}){if(this.logger.log("Inviter.cancel"),this.state!==Re.Initial&&this.state!==Re.Establishing){const e=new Error(`Invalid session state ${this.state}`);return this.logger.error(e.message),Promise.reject(e)}if(this.isCanceled=!0,this.stateTransition(Re.Terminating),this.outgoingInviteRequest){let t;e.statusCode&&e.reasonPhrase&&(t=function(e,t){if(e&&e<200||e>699)throw new TypeError("Invalid statusCode: "+e);if(e)return"SIP;cause="+e+';text="'+(g(e)||t)+'"'}(e.statusCode,e.reasonPhrase)),this.outgoingInviteRequest.cancel(t,e)}else this.logger.warn("Canceled session before INVITE was sent"),this.stateTransition(Re.Terminated);return Promise.resolve()}invite(e={}){if(this.logger.log("Inviter.invite"),this.state!==Re.Initial)return super.invite(e);if(e.sessionDescriptionHandlerModifiers&&(this.sessionDescriptionHandlerModifiers=e.sessionDescriptionHandlerModifiers),e.sessionDescriptionHandlerOptions&&(this.sessionDescriptionHandlerOptions=e.sessionDescriptionHandlerOptions),e.withoutSdp||this.inviteWithoutSdp)return this._renderbody&&this._rendertype&&(this.outgoingRequestMessage.body={contentType:this._rendertype,body:this._renderbody}),this.stateTransition(Re.Establishing),Promise.resolve(this.sendInvite(e));const t={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.getOffer(t).then((t=>(this.outgoingRequestMessage.body={body:t.content,contentType:t.contentType},this.stateTransition(Re.Establishing),this.sendInvite(e)))).catch((e=>{throw this.logger.log(e.message),this.stateTransition(Re.Terminated),e}))}sendInvite(e={}){return this.outgoingInviteRequest=this.userAgent.userAgentCore.invite(this.outgoingRequestMessage,{onAccept:t=>this.dialog?(this.logger.log("Additional confirmed dialog, sending ACK and BYE"),void this.ackAndBye(t)):this.isCanceled?(this.logger.log("Canceled session accepted, sending ACK and BYE"),this.ackAndBye(t),void this.stateTransition(Re.Terminated)):(this.notifyReferer(t),void this.onAccept(t).then((()=>{this.disposeEarlyMedia()})).catch((()=>{this.disposeEarlyMedia()})).then((()=>{e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(t)}))),onProgress:t=>{this.isCanceled||(this.notifyReferer(t),this.onProgress(t).catch((()=>{this.disposeEarlyMedia()})).then((()=>{e.requestDelegate&&e.requestDelegate.onProgress&&e.requestDelegate.onProgress(t)})))},onRedirect:t=>{this.notifyReferer(t),this.onRedirect(t),e.requestDelegate&&e.requestDelegate.onRedirect&&e.requestDelegate.onRedirect(t)},onReject:t=>{this.notifyReferer(t),this.onReject(t),e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(t)},onTrying:t=>{this.notifyReferer(t),this.onTrying(t),e.requestDelegate&&e.requestDelegate.onTrying&&e.requestDelegate.onTrying(t)}}),this.outgoingInviteRequest}disposeEarlyMedia(){this.earlyMediaSessionDescriptionHandlers.forEach((e=>{e.close()})),this.earlyMediaSessionDescriptionHandlers.clear()}notifyReferer(e){if(!this._referred)return;if(!(this._referred instanceof Ue))throw new Error("Referred session not instance of session");if(!this._referred.dialog)return;if(!e.message.statusCode)throw new Error("Status code undefined.");if(!e.message.reasonPhrase)throw new Error("Reason phrase undefined.");const t=`SIP/2.0 ${e.message.statusCode} ${e.message.reasonPhrase}`.trim();this._referred.dialog.notify(void 0,{extraHeaders:["Event: refer","Subscription-State: terminated"],body:{contentDisposition:"render",contentType:"message/sipfrag",content:t}}).delegate={onReject:()=>{this._referred=void 0}}}onAccept(e){if(this.logger.log("Inviter.onAccept"),this.state!==Re.Establishing)return this.logger.error(`Accept received while in state ${this.state}, dropping response`),Promise.reject(new Error(`Invalid session state ${this.state}`));const t=e.message,r=e.session;switch(t.hasHeader("P-Asserted-Identity")&&(this._assertedIdentity=o.nameAddrHeaderParse(t.getHeader("P-Asserted-Identity"))),r.delegate={onAck:e=>this.onAckRequest(e),onBye:e=>this.onByeRequest(e),onInfo:e=>this.onInfoRequest(e),onInvite:e=>this.onInviteRequest(e),onMessage:e=>this.onMessageRequest(e),onNotify:e=>this.onNotifyRequest(e),onPrack:e=>this.onPrackRequest(e),onRefer:e=>this.onReferRequest(e)},this._dialog=r,r.signalingState){case b.Initial:case b.HaveLocalOffer:return this.logger.error("Received 2xx response to INVITE without a session description"),this.ackAndBye(e,400,"Missing session description"),this.stateTransition(Re.Terminated),Promise.reject(new Error("Bad Media Description"));case b.HaveRemoteOffer:{if(!this._dialog.offer)throw new Error(`Session offer undefined in signaling state ${this._dialog.signalingState}.`);const t={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.setOfferAndGetAnswer(this._dialog.offer,t).then((t=>{e.ack({body:t}),this.stateTransition(Re.Established)})).catch((t=>{throw this.ackAndBye(e,488,"Invalid session description"),this.stateTransition(Re.Terminated),t}))}case b.Stable:{if(this.earlyMediaSessionDescriptionHandlers.size>0){const t=this.earlyMediaSessionDescriptionHandlers.get(r.id);if(!t)throw new Error("Session description handler undefined.");return this.setSessionDescriptionHandler(t),this.earlyMediaSessionDescriptionHandlers.delete(r.id),e.ack(),this.stateTransition(Re.Established),Promise.resolve()}if(this.earlyMediaDialog){if(this.earlyMediaDialog!==r){if(this.earlyMedia){const e="You have set the 'earlyMedia' option to 'true' which requires that your INVITE requests do not fork and yet this INVITE request did in fact fork. Consequentially and not surprisingly the end point which accepted the INVITE (confirmed dialog) does not match the end point with which early media has been setup (early dialog) and thus this session is unable to proceed. In accordance with the SIP specifications, the SIP servers your end point is connected to determine if an INVITE forks and the forking behavior of those servers cannot be controlled by this library. If you wish to use early media with this library you must configure those servers accordingly. Alternatively you may set the 'earlyMedia' to 'false' which will allow this library to function with any INVITE requests which do fork.";this.logger.error(e)}const t=new Error("Early media dialog does not equal confirmed dialog, terminating session");return this.logger.error(t.message),this.ackAndBye(e,488,"Not Acceptable Here"),this.stateTransition(Re.Terminated),Promise.reject(t)}return e.ack(),this.stateTransition(Re.Established),Promise.resolve()}const t=r.answer;if(!t)throw new Error("Answer is undefined.");const n={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.setAnswer(t,n).then((()=>{let t;this._renderbody&&this._rendertype&&(t={body:{contentDisposition:"render",contentType:this._rendertype,content:this._renderbody}}),e.ack(t),this.stateTransition(Re.Established)})).catch((t=>{throw this.logger.error(t.message),this.ackAndBye(e,488,"Not Acceptable Here"),this.stateTransition(Re.Terminated),t}))}case b.Closed:return Promise.reject(new Error("Terminated."));default:throw new Error("Unknown session signaling state.")}}onProgress(e){var t;if(this.logger.log("Inviter.onProgress"),this.state!==Re.Establishing)return this.logger.error(`Progress received while in state ${this.state}, dropping response`),Promise.reject(new Error(`Invalid session state ${this.state}`));if(!this.outgoingInviteRequest)throw new Error("Outgoing INVITE request undefined.");const r=e.message,n=e.session;r.hasHeader("P-Asserted-Identity")&&(this._assertedIdentity=o.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity")));const i=r.getHeader("require"),a=r.getHeader("rseq"),s=!!(i&&i.includes("100rel")&&a?Number(a):void 0),c=[];switch(s&&c.push("RAck: "+r.getHeader("rseq")+" "+r.getHeader("cseq")),n.signalingState){case b.Initial:return s&&(this.logger.warn("First reliable provisional response received MUST contain an offer when INVITE does not contain an offer."),e.prack({extraHeaders:c})),Promise.resolve();case b.HaveLocalOffer:return s&&e.prack({extraHeaders:c}),Promise.resolve();case b.HaveRemoteOffer:if(!s)return this.logger.warn("Non-reliable provisional response MUST NOT contain an initial offer, discarding response."),Promise.resolve();{const i=this.sessionDescriptionHandlerFactory(this,this.userAgent.configuration.sessionDescriptionHandlerFactoryOptions||{});return(null===(t=this.delegate)||void 0===t?void 0:t.onSessionDescriptionHandler)&&this.delegate.onSessionDescriptionHandler(i,!0),this.earlyMediaSessionDescriptionHandlers.set(n.id,i),i.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.sessionDescriptionHandlerModifiers).then((()=>i.getDescription(this.sessionDescriptionHandlerOptions,this.sessionDescriptionHandlerModifiers))).then((t=>{const r={contentDisposition:"session",contentType:t.contentType,content:t.body};e.prack({extraHeaders:c,body:r})})).catch((e=>{throw this.stateTransition(Re.Terminated),e}))}case b.Stable:if(s&&e.prack({extraHeaders:c}),this.earlyMedia&&!this.earlyMediaDialog){this.earlyMediaDialog=n;const e=n.answer;if(!e)throw new Error("Answer is undefined.");const t={sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers,sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions};return this.setAnswer(e,t).catch((e=>{throw this.stateTransition(Re.Terminated),e}))}return Promise.resolve();case b.Closed:return Promise.reject(new Error("Terminated."));default:throw new Error("Unknown session signaling state.")}}onRedirect(e){this.logger.log("Inviter.onRedirect"),this.state===Re.Establishing||this.state===Re.Terminating?this.stateTransition(Re.Terminated):this.logger.error(`Redirect received while in state ${this.state}, dropping response`)}onReject(e){this.logger.log("Inviter.onReject"),this.state===Re.Establishing||this.state===Re.Terminating?this.stateTransition(Re.Terminated):this.logger.error(`Reject received while in state ${this.state}, dropping response`)}onTrying(e){this.logger.log("Inviter.onTrying"),this.state===Re.Establishing||this.logger.error(`Trying received while in state ${this.state}, dropping response`)}}var $e;!function(e){e.Started="Started",e.Stopped="Stopped"}($e||($e={}));class Fe{constructor(e={}){if(this._publishers={},this._registerers={},this._sessions={},this._subscriptions={},this._state=$e.Stopped,this.unloadListener=()=>{this.stop()},this._stateEventEmitter=new Ae,this.delegate=e.delegate,this.options=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Fe.defaultOptions()),{sipjsId:f(5)}),{uri:new s("sip","anonymous."+f(6),"anonymous.invalid")}),{viaHost:f(12)+".invalid"}),Fe.stripUndefinedProperties(e)),this.options.hackIpInContact)if("boolean"==typeof this.options.hackIpInContact&&this.options.hackIpInContact){const e=1,t=254,r=Math.floor(Math.random()*(t-e+1)+e);this.options.viaHost="192.0.2."+r}else this.options.hackIpInContact&&(this.options.viaHost=this.options.hackIpInContact);switch(this.loggerFactory=new u,this.logger=this.loggerFactory.getLogger("sip.UserAgent"),this.loggerFactory.builtinEnabled=this.options.logBuiltinEnabled,this.loggerFactory.connector=this.options.logConnector,this.options.logLevel){case"error":this.loggerFactory.level=i.error;break;case"warn":this.loggerFactory.level=i.warn;break;case"log":this.loggerFactory.level=i.log;break;case"debug":this.loggerFactory.level=i.debug}if(this.options.logConfiguration&&(this.logger.log("Configuration:"),Object.keys(this.options).forEach((e=>{const t=this.options[e];switch(e){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("· "+e+": "+t);break;case"authorizationPassword":this.logger.log("· "+e+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+e+": "+t.name);break;default:this.logger.log("· "+e+": "+JSON.stringify(t))}}))),this.options.transportOptions){const t=this.options.transportOptions,r=t.maxReconnectionAttempts,n=t.reconnectionTimeout;if(void 0!==r){const e='The transport option "maxReconnectionAttempts" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}if(void 0!==n){const e='The transport option "reconnectionTimeout" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}void 0===e.reconnectionDelay&&void 0!==n&&(this.options.reconnectionDelay=n),void 0===e.reconnectionAttempts&&void 0!==r&&(this.options.reconnectionAttempts=r)}if(void 0!==e.reconnectionDelay){const e='The user agent option "reconnectionDelay" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}if(void 0!==e.reconnectionAttempts){const e='The user agent option "reconnectionAttempts" as has apparently been specified and has been deprecated. It will no longer be available starting with SIP.js release 0.16.0. Please update accordingly.';this.logger.warn(e)}this._transport=new this.options.transportConstructor(this.getLogger("sip.Transport"),this.options.transportOptions),this.initTransportCallbacks(),this._contact=this.initContact(),this._userAgentCore=this.initCore(),this.options.autoStart&&this.start()}static makeURI(e){return o.URIParse(e)}static defaultOptions(){return{allowLegacyNotifications:!1,authorizationHa1:"",authorizationPassword:"",authorizationUsername:"",autoStart:!1,autoStop:!0,delegate:{},displayName:"",forceRport:!1,hackAllowUnregisteredOptionTags:!1,hackIpInContact:!1,hackViaTcp:!1,hackWssInTransport:!1,logBuiltinEnabled:!0,logConfiguration:!0,logConnector:()=>{},logLevel:"log",noAnswerTimeout:60,preloadedRouteSet:[],reconnectionAttempts:0,reconnectionDelay:4,sessionDescriptionHandlerFactory:(t,r)=>{void 0===e&&(e=e=>e.audio||e.video?void 0===navigator.mediaDevices?Promise.reject(new Error("Media devices not available in insecure contexts.")):navigator.mediaDevices.getUserMedia.call(navigator.mediaDevices,e):Promise.resolve(new MediaStream));const n={iceGatheringTimeout:void 0!==(null==r?void 0:r.iceGatheringTimeout)?null==r?void 0:r.iceGatheringTimeout:5e3,peerConnectionConfiguration:Object.assign(Object.assign({},{bundlePolicy:"balanced",certificates:void 0,iceCandidatePoolSize:0,iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceTransportPolicy:"all",peerIdentity:void 0,rtcpMuxPolicy:"require"}),null==r?void 0:r.peerConnectionConfiguration)},i=t.userAgent.getLogger("sip.SessionDescriptionHandler");return new we(i,e,n)},sessionDescriptionHandlerFactoryOptions:{},sipExtension100rel:be.Unsupported,sipExtensionReplaces:be.Unsupported,sipExtensionExtraSupported:[],sipjsId:"",transportConstructor:Ie,transportOptions:{},uri:new s("sip","anonymous","anonymous.invalid"),userAgentString:"SIP.js/0.17.1",viaHost:""};var e}static stripUndefinedProperties(e){return Object.keys(e).reduce(((t,r)=>(void 0!==e[r]&&(t[r]=e[r]),t)),{})}get configuration(){return this.options}get contact(){return this._contact}get state(){return this._state}get stateChange(){return this._stateEventEmitter}get transport(){return this._transport}get userAgentCore(){return this._userAgentCore}getLogger(e,t){return this.loggerFactory.getLogger(e,t)}getLoggerFactory(){return this.loggerFactory}isConnected(){return this.transport.isConnected()}reconnect(){return this.state===$e.Stopped?Promise.reject(new Error("User agent stopped.")):Promise.resolve().then((()=>this.transport.connect()))}start(){if(this.state===$e.Started)return this.logger.warn("User agent already started"),Promise.resolve();if(this.logger.log(`Starting ${this.configuration.uri}`),this.transitionState($e.Started),this.options.autoStop){const e=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"==typeof window||"function"!=typeof window.addEventListener||e||window.addEventListener("unload",this.unloadListener)}return this.transport.connect()}async stop(){if(this.state===$e.Stopped)return this.logger.warn("User agent already stopped"),Promise.resolve();if(this.logger.log(`Stopping ${this.configuration.uri}`),this.transitionState($e.Stopped),this.options.autoStop){const e=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"!=typeof window&&window.removeEventListener&&!e&&window.removeEventListener("unload",this.unloadListener)}const e=Object.assign({},this._publishers),t=Object.assign({},this._registerers),r=Object.assign({},this._sessions),n=Object.assign({},this._subscriptions),i=this.transport,o=this.userAgentCore;this.logger.log("Dispose of registerers");for(const e in t)t[e]&&await t[e].dispose().catch((t=>{throw this.logger.error(t.message),delete this._registerers[e],t}));this.logger.log("Dispose of sessions");for(const e in r)r[e]&&await r[e].dispose().catch((t=>{throw this.logger.error(t.message),delete this._sessions[e],t}));this.logger.log("Dispose of subscriptions");for(const e in n)n[e]&&await n[e].dispose().catch((t=>{throw this.logger.error(t.message),delete this._subscriptions[e],t}));this.logger.log("Dispose of publishers");for(const t in e)e[t]&&await e[t].dispose().catch((e=>{throw this.logger.error(e.message),delete this._publishers[t],e}));this.logger.log("Dispose of transport"),await i.dispose().catch((e=>{throw this.logger.error(e.message),e})),this.logger.log("Dispose of core"),o.dispose()}_makeInviter(e,t){return new Be(this,e,t)}attemptReconnection(e=1){const t=this.options.reconnectionAttempts,r=this.options.reconnectionDelay;e>t?this.logger.log("Maximum reconnection attempts reached"):(this.logger.log(`Reconnection attempt ${e} of ${t} - trying`),setTimeout((()=>{this.reconnect().then((()=>{this.logger.log(`Reconnection attempt ${e} of ${t} - succeeded`)})).catch((r=>{this.logger.error(r.message),this.logger.log(`Reconnection attempt ${e} of ${t} - failed`),this.attemptReconnection(++e)}))}),1===e?0:1e3*r))}initContact(){const e=f(8),t=this.options.hackWssInTransport?"wss":"ws";return{pubGruu:void 0,tempGruu:void 0,uri:new s("sip",e,this.options.viaHost,void 0,{transport:t}),toString:(e={})=>{const r=e.anonymous||!1,n=e.outbound||!1;let i="<";return i+=r?this.contact.tempGruu||`sip:anonymous@anonymous.invalid;transport=${t}`:this.contact.pubGruu||this.contact.uri,n&&(i+=";ob"),i+=">",i}}}initCore(){let e=[];e.push("outbound"),this.options.sipExtension100rel===be.Supported&&e.push("100rel"),this.options.sipExtensionReplaces===be.Supported&&e.push("replaces"),this.options.sipExtensionExtraSupported&&e.push(...this.options.sipExtensionExtraSupported),this.options.hackAllowUnregisteredOptionTags||(e=e.filter((e=>je[e]))),e=Array.from(new Set(e));const t=e.slice();(this.contact.pubGruu||this.contact.tempGruu)&&t.push("gruu");const r={aor:this.options.uri,contact:this.contact,displayName:this.options.displayName,loggerFactory:this.loggerFactory,hackViaTcp:this.options.hackViaTcp,routeSet:this.options.preloadedRouteSet,supportedOptionTags:e,supportedOptionTagsResponse:t,sipjsId:this.options.sipjsId,userAgentHeaderFieldValue:this.options.userAgentString,viaForceRport:this.options.forceRport,viaHost:this.options.viaHost,authenticationFactory:()=>{const e=this.options.authorizationUsername?this.options.authorizationUsername:this.options.uri.user,t=this.options.authorizationPassword?this.options.authorizationPassword:void 0,r=this.options.authorizationHa1?this.options.authorizationHa1:void 0;return new y(this.getLoggerFactory(),r,e,t)},transportAccessor:()=>this.transport};return new ye(r,{onInvite:e=>{var t;const r=new He(this,e);if(e.delegate={onCancel:e=>{r._onCancel(e)},onTransportError:e=>{this.logger.error("A transport error has occurred while handling an incoming INVITE request.")}},e.trying(),this.options.sipExtensionReplaces!==be.Unsupported){const t=e.message.parseHeader("replaces");if(t){const e=t.call_id;if("string"!=typeof e)throw new Error("Type of call id is not string");const n=t.replaces_to_tag;if("string"!=typeof n)throw new Error("Type of to tag is not string");const i=t.replaces_from_tag;if("string"!=typeof i)throw new Error("type of from tag is not string");const o=e+n+i,a=this.userAgentCore.dialogs.get(o);if(!a)return void r.reject({statusCode:481});if(!a.early&&!0===t.early_only)return void r.reject({statusCode:486});const s=this._sessions[e+i]||this._sessions[e+n]||void 0;if(!s)throw new Error("Session does not exist.");r._replacee=s}}if(null===(t=this.delegate)||void 0===t?void 0:t.onInvite)return r.autoSendAnInitialProvisionalResponse?void r.progress().then((()=>{var e;if(void 0===(null===(e=this.delegate)||void 0===e?void 0:e.onInvite))throw new Error("onInvite undefined.");this.delegate.onInvite(r)})):void this.delegate.onInvite(r);r.reject({statusCode:486})},onMessage:e=>{if(this.delegate&&this.delegate.onMessage){const t=new Le(e);this.delegate.onMessage(t)}else e.accept()},onNotify:e=>{if(this.delegate&&this.delegate.onNotify){const t=new xe(e);this.delegate.onNotify(t)}else this.options.allowLegacyNotifications?e.accept():e.reject({statusCode:481})},onRefer:e=>{this.logger.warn("Received an out of dialog REFER request"),this.delegate&&this.delegate.onReferRequest?this.delegate.onReferRequest(e):e.reject({statusCode:405})},onRegister:e=>{this.logger.warn("Received an out of dialog REGISTER request"),this.delegate&&this.delegate.onRegisterRequest?this.delegate.onRegisterRequest(e):e.reject({statusCode:405})},onSubscribe:e=>{this.logger.warn("Received an out of dialog SUBSCRIBE request"),this.delegate&&this.delegate.onSubscribeRequest?this.delegate.onSubscribeRequest(e):e.reject({statusCode:405})}})}initTransportCallbacks(){this.transport.onConnect=()=>this.onTransportConnect(),this.transport.onDisconnect=e=>this.onTransportDisconnect(e),this.transport.onMessage=e=>this.onTransportMessage(e)}onTransportConnect(){this.state!==$e.Stopped&&this.delegate&&this.delegate.onConnect&&this.delegate.onConnect()}onTransportDisconnect(e){this.state!==$e.Stopped&&(this.delegate&&this.delegate.onDisconnect&&this.delegate.onDisconnect(e),e&&this.options.reconnectionAttempts>0&&this.attemptReconnection())}onTransportMessage(e){const t=_e.parseMessage(e,this.getLogger("sip.Parser"));if(!t)return void this.logger.warn("Failed to parse incoming message. Dropping.");if(this.state===$e.Stopped&&t instanceof V)return void this.logger.warn(`Received ${t.method} request while stopped. Dropping.`);const r=()=>{const e=["from","to","call_id","cseq","via"];for(const r of e)if(!t.hasHeader(r))return this.logger.warn(`Missing mandatory header field : ${r}.`),!1;return!0};if(t instanceof V){if(!r())return void this.logger.warn("Request missing mandatory header field. Dropping.");if(!t.toTag&&t.callId.substr(0,5)===this.options.sipjsId)return void this.userAgentCore.replyStateless(t,{statusCode:482});const e=S(t.body),n=t.getHeader("content-length");if(n&&e<Number(n))return void this.userAgentCore.replyStateless(t,{statusCode:400})}if(t instanceof U){if(!r())return void this.logger.warn("Response missing mandatory header field. Dropping.");if(t.getHeaders("via").length>1)return void this.logger.warn("More than one Via header field present in the response. Dropping.");if(t.via.host!==this.options.viaHost||void 0!==t.via.port)return void this.logger.warn("Via sent-by in the response does not match UA Via host value. Dropping.");const e=S(t.body),n=t.getHeader("content-length");if(n&&e<Number(n))return void this.logger.warn("Message body length is lower than the value in Content-Length header field. Dropping.")}if(t instanceof V)this.userAgentCore.receiveIncomingRequestFromTransport(t);else{if(!(t instanceof U))throw new Error("Invalid message type.");this.userAgentCore.receiveIncomingResponseFromTransport(t)}}transitionState(e,t){const r=()=>{throw new Error(`Invalid state transition from ${this._state} to ${e}`)};switch(this._state){case $e.Started:e!==$e.Stopped&&r();break;case $e.Stopped:e!==$e.Started&&r();break;default:throw new Error("Unknown state.")}this.logger.log(`Transitioned from ${this._state} to ${e}`),this._state=e,this._stateEventEmitter.emit(this._state)}}var qe=r(7187);new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const We=new Error("request for lock canceled");var Ke=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};class Ge{constructor(e,t=We){if(this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}acquire(){const e=this.isLocked(),t=new Promise(((e,t)=>this._queue.push({resolve:e,reject:t})));return e||this._dispatch(),t}runExclusive(e){return Ke(this,void 0,void 0,(function*(){const[t,r]=yield this.acquire();try{return yield e(t)}finally{r()}}))}waitForUnlock(){return Ke(this,void 0,void 0,(function*(){return this.isLocked()?new Promise((e=>this._waiters.push({resolve:e}))):Promise.resolve()}))}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){const e=this._currentReleaser;this._currentReleaser=void 0,e()}}cancel(){this._queue.forEach((e=>e.reject(this._cancelError))),this._queue=[]}_dispatch(){const e=this._queue.shift();if(!e)return;let t=!1;this._currentReleaser=()=>{t||(t=!0,this._value++,this._resolveWaiters(),this._dispatch())},e.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach((e=>e.resolve())),this._waiters=[]}}class Ye{constructor(e){this._semaphore=new Ge(1,e)}acquire(){return e=this,r=function*(){const[,e]=yield this._semaphore.acquire();return e},new((t=void 0)||(t=Promise))((function(n,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(o,a)}s((r=r.apply(e,[])).next())}));var e,t,r}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}}function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Xe(e){var t=function(e,t){if("object"!=ze(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ze(t)?t:t+""}r(5003),r(9337),r(3321);var Je=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peerConnection=t,this.peerConnectionDelegate=void 0,this.logger=r,this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0,this.iceGatheringCompleteTimeoutId=void 0,this.iceTimeout=0,this.iceRestart=!1}var t,r;return t=e,(r=[{key:"setPeerConnectionDelegate",value:function(e){this.peerConnectionDelegate=e}},{key:"setIceOptions",value:function(e){void 0!==e.iceTimeout&&(this.iceTimeout=e.iceTimeout),void 0!==e.iceRestart&&(this.iceRestart=e.iceRestart)}},{key:"initEventHandlers",value:function(){this.peerConnection.onicecandidate=this.handleIceCandidate.bind(this),this.peerConnection.onicecandidateerror=this.handleIceCandidateError.bind(this),this.peerConnection.oniceconnectionstatechange=this.handleIceConnectionStateChange.bind(this),this.peerConnection.onicegatheringstatechange=this.handleIceGatheringStateChange.bind(this)}},{key:"handleIceCandidate",value:function(e){var t,r;this.logger.debug(null===(t=e.candidate)||void 0===t?void 0:t.candidate),null!==(r=this.peerConnectionDelegate)&&void 0!==r&&r.onicecandidate&&this.peerConnectionDelegate.onicecandidate(e)}},{key:"handleIceCandidateError",value:function(e){var t;this.logger.debug("SessionDescriptionHandler.onicecandidateerror"),null!==(t=this.peerConnectionDelegate)&&void 0!==t&&t.onicecandidateerror&&this.peerConnectionDelegate.onicecandidateerror(e)}},{key:"handleIceConnectionStateChange",value:function(e){var t,r=this.peerConnection.iceConnectionState;this.logger.debug("SessionDescriptionHandler.oniceconnectionstatechange ".concat(r)),null!==(t=this.peerConnectionDelegate)&&void 0!==t&&t.oniceconnectionstatechange&&this.peerConnectionDelegate.oniceconnectionstatechange(e)}},{key:"handleIceGatheringStateChange",value:function(e){var t,r=this.peerConnection.iceGatheringState;this.logger.debug("SessionDescriptionHandler.onicegatheringstatechange ".concat(r)),"complete"===r&&this.completeIceGathering(),null!==(t=this.peerConnectionDelegate)&&void 0!==t&&t.onicegatheringstatechange&&this.peerConnectionDelegate.onicegatheringstatechange(e)}},{key:"completeIceGathering",value:function(){this.logger.debug("SessionDescriptionHandler.completeIceGathering"),void 0!==this.iceGatheringCompleteTimeoutId&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - clearing timeout"),clearTimeout(this.iceGatheringCompleteTimeoutId),this.iceGatheringCompleteTimeoutId=void 0),void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.iceGatheringComplete - resolving promise"),this.iceGatheringCompleteResolve&&this.iceGatheringCompleteResolve(),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0)}},{key:"waitForIceGatheringComplete",value:function(){var e=this;return this.logger.debug("SessionDescriptionHandler.waitForIceGatheringComplete"),void 0===this.peerConnection?Promise.reject("Peer connection closed."):this.iceRestart||"complete"!==this.peerConnection.iceGatheringState?(void 0!==this.iceGatheringCompletePromise&&(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringComplete - rejecting prior waiting promise"),this.iceGatheringCompleteReject&&this.iceGatheringCompleteReject(new Error("Promise superseded.")),this.iceGatheringCompletePromise=void 0,this.iceGatheringCompleteResolve=void 0,this.iceGatheringCompleteReject=void 0),this.iceGatheringCompletePromise=new Promise((function(t,r){e.iceGatheringCompleteResolve=t,e.iceGatheringCompleteReject=r,e.iceTimeout>0&&(e.logger.debug("SessionDescriptionHandler.waitForIceGatheringComplete - timeout in "+e.iceTimeout),e.iceGatheringCompleteTimeoutId=setTimeout((function(){e.logger.debug("SessionDescriptionHandler.waitForIceGatheringComplete - timeout"),e.completeIceGathering()}),e.iceTimeout))})),this.iceGatheringCompletePromise):(this.logger.debug("SessionDescriptionHandler.waitForIceGatheringComplete - already complete"),Promise.resolve())}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xe(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}function Qe(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function tt(e,t,r){return(t=nt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nt(n.key),n)}}function nt(e){var t=function(e,t){if("object"!=Ze(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ze(t)?t:t+""}function it(e,t){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},it(e,t)}function ot(e){var t=at();return function(){var r,n=st(e);if(t){var i=st(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==Ze(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function at(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(at=function(){return!!e})()}function st(e){return st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},st(e)}var ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&it(e,t)}(s,e);var t,r,n,i,o,a=ot(s);function s(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(r=a.call(this)).logger=e,r.sessionDescriptionHandlerConfiguration=t,r.remoteMediaStreamManager=void 0,r._peerConnection=new RTCPeerConnection(null==t?void 0:t.peerConnectionConfiguration),r._peerConnectionDelegate=void 0,r._iceManager=new Je(r._peerConnection,r.logger),r.initPeerConnectionEventHandlers(),r._iceManager.initEventHandlers(),r.isConference=void 0,r}return t=s,r=[{key:"peerConnection",get:function(){return this._peerConnection}},{key:"peerConnectionDelegate",get:function(){return this._peerConnectionDelegate},set:function(e){this._peerConnectionDelegate=e,this._iceManager.setPeerConnectionDelegate(e)}},{key:"addTransceiverVideoTrack",value:function(e,t,r){this.logger.debug("SessionDescriptionHandler.addTransceiverVideoTrack"),this.logger.debug(r.getConfigs()),this.logger.debug(t),this._peerConnection.addTransceiver(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?et(Object(r),!0).forEach((function(t){tt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):et(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({streams:[e]},r.getConfigs()))}},{key:"close",value:function(){this.logger.debug("SessionDescriptionHandler.close"),void 0!==this._peerConnection&&(this._peerConnection.getReceivers().forEach((function(e){e.track&&e.track.stop()})),this._peerConnection.getSenders().forEach((function(e){e.track&&e.track.stop()})),this._peerConnection.close(),this._peerConnection=void 0)}},{key:"getDescription",value:function(e,t){var r=this;if(this.logger.debug("getDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));var n=void 0,i=void 0;return e&&(e.isConference&&(this.isConference=e.isConference),e.offerOptions&&(i=e.offerOptions.iceRestart),e.iceGatheringTimeout?n=e.iceGatheringTimeout:this.sessionDescriptionHandlerConfiguration&&this.sessionDescriptionHandlerConfiguration.iceGatheringTimeout&&(n=this.sessionDescriptionHandlerConfiguration.iceGatheringTimeout)),this._iceManager.setIceOptions({iceRestart:i,iceTimeout:n}),this.getLocalMediaStream(e).then((function(){return r.createLocalOfferOrAnswer(e)})).then((function(e){return r.applyModifiers(e,t)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return r._iceManager.waitForIceGatheringComplete()})).then((function(){return r.getLocalSessionDescription()})).then((function(e){return{body:e.sdp,contentType:"application/sdp"}})).catch((function(t){if(r.logger.error("getDescription failed - ".concat(t.name," ").concat(t.message)),"OverconstrainedError"===t.name&&r.logger.error("OverconstrainedError cause=".concat(t.constraint,", Constraints=").concat(JSON.stringify(e.constraints))),!(t instanceof Error)){var n=new Error(t.message);n.name=t.name,t=n}throw t}))}},{key:"hasDescription",value:function(e){return this.logger.debug("SessionDescriptionHandler.hasDescription"),"application/sdp"===e}},{key:"setDescription",value:function(e,t,r){var n=this;if(this.logger.debug("SessionDescriptionHandler.setDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));this.onDataChannel=null==t?void 0:t.onDataChannel;var i="have-local-offer"===this._peerConnection.signalingState?"answer":"offer";return this.getLocalMediaStream(t).then((function(){return n.applyModifiers({sdp:e,type:i},r)})).then((function(e){return n.setRemoteSessionDescription(e)})).catch((function(e){throw n.logger.error("SessionDescriptionHandler.setDescription failed - "+e),e}))}},{key:"applyModifiers",value:function(e,t){var r=this;return this.logger.debug("SessionDescriptionHandler.applyModifiers"),t&&0!==t.length?t.reduce((function(e,t){return e.then(t)}),Promise.resolve(e)).then((function(e){if(r.logger.debug("SessionDescriptionHandler.applyModifiers - modified sdp"),!e.sdp||!e.type)throw new Error("Invalid SDP.");return{sdp:e.sdp,type:e.type}})):Promise.resolve(e)}},{key:"createLocalOfferOrAnswer",value:function(e){if(void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));switch(this._peerConnection.signalingState){case"stable":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP offer"),this._peerConnection.createOffer(null==e?void 0:e.offerOptions);case"have-remote-offer":return this.logger.debug("SessionDescriptionHandler.createLocalOfferOrAnswer - creating SDP answer"),this._peerConnection.createAnswer(null==e?void 0:e.answerOptions);default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}}},{key:"getLocalMediaStream",value:(i=regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("getLocalMediaStream"),void 0!==this._peerConnection){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Peer connection closed.")));case 3:if(null==t&&(t={}),r=Object.assign({},void 0===t.constraints?void 0:t.constraints),!this.localMediaStreamConstraints){e.next=10;break}if(r.audio=r.audio||this.localMediaStreamConstraints.audio,r.video=r.video||this.localMediaStreamConstraints.video,JSON.stringify(this.localMediaStreamConstraints.audio)!==JSON.stringify(r.audio)||JSON.stringify(this.localMediaStreamConstraints.video)!==JSON.stringify(r.video)){e.next=10;break}return e.abrupt("return",Promise.resolve());case 10:if(this.localMediaStreamConstraints=r,this.remoteMediaStreamManager=t.remoteMediaStreamManager,n=t.localMediaStreamManager,!t.isVerify){e.next=15;break}return e.abrupt("return",this.setLocalMediaStream(new MediaStream([n.getDummyAudioTrack()]),t));case 15:return i=n.getSenderMediaStream(),e.abrupt("return",this.setLocalMediaStream(i,t));case 17:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){Qe(o,r,n,a,s,"next",e)}function s(e){Qe(o,r,n,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"setLocalMediaStream",value:function(e,t){var r=this;if(this.logger.debug("SessionDescriptionHandler.setLocalMediaStream"),!this._peerConnection)throw new Error("Peer connection undefined.");var n=this._peerConnection,i=t.localMediaStreamManager.getLocalMediaStream(),o=t.simulcastHandler||void 0,a=[],c=function(e){var t=e.kind;if("audio"!==t&&"video"!==t)throw new Error("Unknown new track kind ".concat(t,"."));var c=n.getSenders().find((function(e){return e.track&&e.track.kind===t}));c?a.push(new Promise((function(e){r.logger.debug("SessionDescriptionHandler.setLocalMediaStream - replacing sender ".concat(t," track")),e()})).then((function(){var n=c.track;return c.replaceTrack(e).then((function(){n&&n.stop(),i.addTrack(e),s.dispatchAddTrackEvent(i,e)})).catch((function(e){throw r.logger.error("SessionDescriptionHandler.setLocalMediaStream - failed to replace sender ".concat(t," track")),e}))}))):a.push(new Promise((function(e){r.logger.debug("SessionDescriptionHandler.setLocalMediaStream - adding sender ".concat(t," track")),e()})).then((function(){try{"video"===t&&void 0!==o?(o.updateTrack(e),r.addTransceiverVideoTrack(i,e,o)):n.addTrack(e,i)}catch(e){throw r.logger.error("SessionDescriptionHandler.setLocalMediaStream - failed to add sender ".concat(t," track")),e}s.dispatchAddTrackEvent(i,e)})))},u=e.getAudioTracks();u.length&&c(u[0]);var l=e.getVideoTracks();return l.length&&c(l[0]),a.reduce((function(e,t){return e.then((function(){return t}))}),Promise.resolve())}},{key:"getLocalSessionDescription",value:function(){if(this.logger.debug("SessionDescriptionHandler.getLocalSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));var e=this._peerConnection.localDescription;return e?Promise.resolve(e):Promise.reject(new Error("Failed to get local session description"))}},{key:"setLocalSessionDescription",value:function(e){return this.logger.debug("SessionDescriptionHandler.setLocalSessionDescription"),void 0===this._peerConnection?Promise.reject(new Error("Peer connection closed.")):this._peerConnection.setLocalDescription(e)}},{key:"rollbackLocalSessionDescription",value:function(){return this.logger.debug("SessionDescriptionHandler.rollbackLocalSessionDescription"),void 0===this._peerConnection?Promise.reject(new Error("Peer connection closed.")):this._peerConnection.setLocalDescription({type:"rollback"})}},{key:"setRemoteSessionDescription",value:function(e){if(this.logger.debug("SessionDescriptionHandler.setRemoteSessionDescription"),void 0===this._peerConnection)return Promise.reject(new Error("Peer connection closed."));var t,r=e.sdp;switch(this._peerConnection.signalingState){case"stable":t="offer";break;case"have-local-offer":t="answer";break;default:return Promise.reject(new Error("Invalid signaling state "+this._peerConnection.signalingState))}return r?this._peerConnection.setRemoteDescription({sdp:r,type:t}):(this.logger.error("SessionDescriptionHandler.setRemoteSessionDescription failed - cannot set null sdp"),Promise.reject(new Error("SDP is undefined")))}},{key:"setRemoteTrack",value:function(e){this.logger.debug("setRemoteTrack");var t=this.remoteMediaStreamManager.getRemoteMediaStream();t.getTrackById(e.id)?this.logger.debug("SessionDescriptionHandler.setRemoteTrack - have remote ".concat(e.kind," track")):"audio"===e.kind?(this.logger.debug("SessionDescriptionHandler.setRemoteTrack - adding remote ".concat(e.kind," track")),t.getAudioTracks().forEach((function(e){e.stop(),t.removeTrack(e),s.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),s.dispatchAddTrackEvent(t,e)):"video"!==e.kind||this.isConference||(this.logger.debug("SessionDescriptionHandler.setRemoteTrack - adding remote ".concat(e.kind," track")),t.getVideoTracks().forEach((function(e){e.stop(),t.removeTrack(e),s.dispatchRemoveTrackEvent(t,e)})),t.addTrack(e),s.dispatchAddTrackEvent(t,e))}},{key:"initPeerConnectionEventHandlers",value:function(){var e=this;if(this.logger.debug("initPeerConnectionEventHandlers"),!this._peerConnection)throw new Error("Peer connection undefined.");var t=this._peerConnection;t.onconnectionstatechange=function(r){var n=e._peerConnectionDelegate,i=t.connectionState;e.logger.debug("onconnectionstatechange ".concat(i)),"disconnected"!==i&&"connected"!==i&&"failed"!==i||e.emit("sdhconnection-".concat(i)),n&&n.onconnectionstatechange&&(e.logger.debug("in onconnectionstatechange == "),e._peerConnectionDelegate.onconnectionstatechange(r))},t.onnegotiationneeded=function(t){var r=e._peerConnectionDelegate;e.logger.debug("SessionDescriptionHandler.onnegotiationneeded"),r&&r.onnegotiationneeded&&e._peerConnectionDelegate.onnegotiationneeded(t)},t.onsignalingstatechange=function(r){var n=e._peerConnectionDelegate,i=t.signalingState;e.logger.debug("SessionDescriptionHandler.onsignalingstatechange ".concat(i)),n&&n.onsignalingstatechange&&e._peerConnectionDelegate.onsignalingstatechange(r)},t.onstatsended=function(t){var r=e._peerConnectionDelegate;e.logger.debug("SessionDescriptionHandler.onstatsended"),r&&r.onstatsended&&e._peerConnectionDelegate.onstatsended(t)},t.ontrack=function(t){var r=e._peerConnectionDelegate,n=t.track.kind,i=t.track.enabled?"enabled":"disabled";e.logger.debug("SessionDescriptionHandler.ontrack ".concat(n," ").concat(i)),e.logger.debug(t),t.transceiver.mid.startsWith("pss")||e.setRemoteTrack(t.track),r&&r.onTrack&&e._peerConnectionDelegate.onTrack(t)}}},{key:"clearDummyVideo",value:function(){this.logger.debug("wtpSessionDescriptionHandler clearDummyVideo"),this.dummyVideo&&(clearInterval(this.dummyVideo),this.dummyVideo=void 0)}},{key:"release",value:function(){this.logger.debug("Release wtpSessionDescriptionHandler"),this.changeIntervalOfDummyVideo&&(clearTimeout(this.changeIntervalOfDummyVideo),this.changeIntervalOfDummyVideo=void 0),this.clearDummyVideo()}},{key:"_getDummyVideoTrack",value:function(){var e=this,t=Object.assign(document.createElement("canvas"),{width:640,height:480}),r=function(){t.getContext("2d").fillRect(0,0,640,480)};return r(),this.dummyVideo=setInterval(r,50),this.changeIntervalOfDummyVideo=setTimeout((function(){e.clearDummyVideo(),e.dummyVideo=setInterval(r,3e3)}),2e4),t.captureStream().getVideoTracks()[0]}}],n=[{key:"dispatchAddTrackEvent",value:function(e,t){e.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:t}))}},{key:"dispatchRemoveTrackEvent",value:function(e,t){e.dispatchEvent(new MediaStreamTrackEvent("removetrack",{track:t}))}}],r&&rt(t.prototype,r),n&&rt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(qe);function ut(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function lt(e,t){if(e){if("string"==typeof e)return dt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?dt(e,t):void 0}}function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ht(){return!!function(){if(window.chrome)return!0;var e,t=pt();if("Safari"===t.browser){var r=function(e){if(Array.isArray(e))return e}(e=t.version.split("."))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,u=!1;try{for(o=(r=r.call(e)).next;!(c=(n=o.call(r)).done)&&(s.push(n.value),2!==s.length);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(e)||lt(e,2)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=r[0],i=r[1];return n=parseInt(n),i=parseInt(i),n>14||14===n&&i>=5}return!1}()&&!("undefined"==typeof RTCPeerConnection||!(new RTCPeerConnection).connectionState)}function pt(){if(navigator.userAgentData){var e,t,r=/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+/,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=lt(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(navigator.userAgentData.brands);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!/chromium/i.test(i.brand)&&!r.test(i.brand)){e=i;break}}}catch(e){n.e(e)}finally{n.f()}return e?{browser:e.brand.includes("Chrome")?"Chrome":e.brand.includes("Edge")?"Edge":e.brand.includes("Opera")?"Opera":e.brand.includes("Whale")?"Whale":"others",version:e.version}:{browser:"",version:""}}var o,a=navigator.userAgent,s=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d+.]+)/i)||[];return"Trident"===s[1]?{browser:"IE",version:(o=/\brv[ :]+([\d+.]+)/g.exec(a)||[])[1]||""}:"Chrome"===s[1]&&null!=(o=a.match(/(OPR|Edge)\/([\d+.]+)/))?{browser:"OPR"===o[0]?"Opera":"Edge",version:o[1]}:(s=void 0!==s[2]?[s[1],s[2]]:["","",""],null!=(o=a.match(/version\/([\d+.]+)/i))&&s.splice(1,1,o[1]),{browser:s[0],version:s[1]})}function ft(){var e=document.createElement("video"),t=!1;return e.canPlayType&&(t=""!==e.canPlayType('video/mp4; codecs="avc1.42E01E"')),t}function gt(e){if(void 0!==e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}}function vt(e){for(var t=new Uint8Array(e),r=t.byteLength,n="",i=0;i<r;i++)n+=String.fromCharCode(t[i]);return window.btoa(n)}function mt(e,t){return St.apply(this,arguments)}function St(){var e;return e=regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"default"!==t&&"communications"!==t){e.next=5;break}return e.next=4,navigator.mediaDevices.enumerateDevices().then((function(e){var n=e.find((function(e){return e.deviceId===t&&e.kind===r}));i=e.find((function(e){return e.groupId===n.groupId&&e.kind===r&&"default"!==e.deviceId&&"communications"!==e.deviceId}))}));case 4:n=i?i.deviceId:t;case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})),St=function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){ut(o,n,i,a,s,"next",e)}function s(e){ut(o,n,i,a,s,"throw",e)}a(void 0)}))},St.apply(this,arguments)}function Et(e){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Et(e)}function yt(e){var t=function(e,t){if("object"!=Et(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Et(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Et(t)?t:t+""}r(6699),r(2023),r(561);var _t=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"isSupported",value:function(){return ht()}},{key:"createMediaStream",value:function(e,t){var r=this,n=Object.assign({audio:!0},null==e?void 0:e);return this.mediaStreamFactory=function(e){return void 0===navigator.mediaDevices?Promise.reject(new Error("Media devices not available in insecure contexts.")):e.audio||e.video?navigator.mediaDevices.getUserMedia.call(navigator.mediaDevices,e):Promise.resolve(new MediaStream)},this.mediaStreamFactory(n).then((function(e){if(t&&e.getVideoTracks().length){t.srcObject=e,t.muted=!0;var n=t.play();void 0!==n&&n.then((function(){})).catch((function(e){r.logger.warn("catch error at playCustomVideo: ".concat(e))}))}return Promise.resolve(e)}))}},{key:"cleanupMediaStream",value:function(e){e&&e.getTracks().forEach((function(e){e.stop()}))}},{key:"setVideoMirror",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;Array.isArray(t)||(t=[t]),t.forEach((function(t){t&&(t.style.transform=e?"rotateY(180deg)":"",t.style.webkitTransform=e?"rotateY(180deg)":"",t.style.mozTransform=e?"rotateY(180deg)":"")}))}},{key:"isChromium",value:function(){for(var e in navigator.userAgentData.brands)if("Chromium"==e.brand)return!0;return!1}},{key:"getBrowserInfo",value:function(){return pt()}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yt(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Tt=(r(3371),Object.freeze({LINE:"line",PLANET_KIT:"planetkit"})),Rt=Object.freeze({STATE_INIT:"STATE_INIT",STATE_READY:"STATE_READY",STATE_CONNECTING:"STATE_CONNECTING",STATE_VERIFIED:"STATE_VERIFIED",STATE_ANSWERED:"STATE_ANSWERED",STATE_CONNECTED:"STATE_CONNECTED",STATE_DISCONNECTED:"STATE_DISCONNECTED",STATE_RELEASED:"STATE_RELEASED"}),bt=Object.freeze({INITIATOR:"initiator",RESPONDER:"responder",CONFERENCE:"conference"}),wt=Object.freeze({AUDIO:"A",VIDEO:"V",AUDIO_TO_VIDEO:"AV",VIDEO_TO_AUDIO:"VA"}),At=Object.freeze({INIT:-1,AUDIO:0,VIDEO_TO_AUDIO:1,AUDIO_TO_VIDEO:2,VIDEO:3}),Ct=Object.freeze({AUDIO:"audio",VIDEO:"video"}),It=Object.freeze({DISABLED:"disabled",ENABLED:"enabled",PAUSED:"paused"}),Ot=Object.freeze({THIS:"THIS",PEER:"PEER",OTHERS:"OTHERS"}),Pt=Object.freeze({NORMAL:0,PAUSED:1,BLOCKED:2,PAUSED_BLOCKED:3}),Nt=Object.freeze({BY_USER:0,BY_INTERRUPT:1,UNDEFINED:2,INTERNAL:3,ENABLE_VIDEO_RESPONSE:4,CAMERA_INACTIVE:5,HOLD:6});function kt(e){return Object.keys(Nt).find((function(t){return Nt[t]===e}))}var Mt=Object.freeze({NORMAL:0,PAUSED:1,BLOCKED:2,PAUSED_BLOCKED:3,ENABLE_VIDEO_RESPONSE:4,CAMERA_INACTIVE:5}),Dt=Object.freeze({STREAM_CTRL:"application/stream-ctrl+json",USER_INFO:"application/user-info+json",REQUEST_USER_INFO:"application/request-user-info+json",REQUEST_USER_VIEW:"application/request-user-view+json",NOTIFY_USER_STATUS:"application/notify-user-status+json",FEATURE_SHARE:"application/feature-share+json",FEATURE_SHARE_RESULT:"application/feature-share-result+json",FEATURE_QUERY:"application/feature-query+json",USER_MESSAGE:"application/user-message+json",DATA_INFO:"application/data-info+json",DATA_CTRL:"application/data-ctrl+json",APPLICATION_CONTROL:"application/application-control+json",RECORDING_STATUS:"application/recording-status+json"}),Lt=Object.freeze({MIC_STATUS:0,CAMERA_STATUS:1,HOLD_STATUS:2,SHARED_CONTENTS:3,EXCLUSIVELY_SHARED_CONTENTS:4,ROOM_SHARED_CONTENTS:5}),xt=Object.freeze({UNSET:0,SET:1}),Vt=Object.freeze({OK:0,NOK:1}),Ut=Object.freeze({INIT:0,START:1,STOP:2,RESTART:3,FAILED:4});function jt(e){return Object.keys(Ut).find((function(t){return Ut[t]===e}))}Object.freeze({UNDEFINED:0,USER:1,WND_MINIMIZED:2,EXCEPTION:101});var Ht=Object.freeze({WIDTH:1280,HEIGHT:720,VGA_WIDTH:640,VGA_HEIGHT:360}),Bt=Object.freeze({FALSE:0,TRUE:1}),$t=Object.freeze({DEBUG:3,LOG:2,WARN:1,ERROR:0}),Ft=Object.freeze({NONE:0,ANDROID:1,IOS:2,LINUX:3,MAC:4,WINDOWS:5,WEB:6,SIP_TERMINAL:100});function qt(e){var t;return null===(t=Object.keys(Ft).find((function(t){return Ft[t]===e})))||void 0===t?void 0:t.toLowerCase()}var Wt=Object.freeze({CALL_TX:2700,GROUPCALL_TX:3200,RX:6e3}),Kt=Object.freeze({INTERNAL:"internal",ACTIVATION_FAILED:"activation_failed"}),Gt=Object.freeze({UNDEFINED:0,AUDIO_CALLER:1e4,AUDIO_ECHO_CALLEE:10001,VIDEO_ECHO_CALLEE:10002,MENTAL_HEALTH_COUNSELOR:10003,RESERVED_1:10004,RESERVED_2:10005,RESERVED_3:10006,RESERVED_4:10007,RESERVED_5:10008,PARTICIPANT_INTERPRETER:2e4,PARTICIPANT_TRANSCRIBER:20001,PARTICIPANT_MENTAL_HEALTH_COUNSELOR:20002,PARTICIPANT_RESERVED_1:20003,PARTICIPANT_RESERVED_2:20004,PARTICIPANT_RESERVED_3:20005,PARTICIPANT_RESERVED_4:20006,PARTICIPANT_RESERVED_5:20007,UNKNOWN:99999}),Yt="4.4.0";function zt(e){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}function Xt(e){var t=function(e,t){if("object"!=zt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==zt(t)?t:t+""}var Jt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.devPlatform=t,this.lastPauseReason=Mt.NORMAL}var t,r;return t=e,r=[{key:"getVideoPauseReason",value:function(e){switch(e){case Mt.NORMAL:return this.selectValueAsPlatform(Pt.NORMAL,void 0);case Mt.PAUSED:return this.selectValueAsPlatform(Pt.PAUSED,Nt.BY_USER);case Mt.BLOCKED:return this.selectValueAsPlatform(Pt.BLOCKED,Nt.INTERNAL);case Mt.PAUSED_BLOCKED:return this.selectValueAsPlatform(Pt.PAUSED_BLOCKED,Nt.PAUSED);case Mt.ENABLE_VIDEO_RESPONSE:return this.selectValueAsPlatform(Pt.PAUSED,Nt.ENABLE_VIDEO_RESPONSE);case Mt.CAMERA_INACTIVE:return this.selectValueAsPlatform(Pt.PAUSED,Nt.CAMERA_INACTIVE)}}},{key:"selectValueAsPlatform",value:function(){switch(this.devPlatform){case Tt.LINE:return arguments.length<=0?void 0:arguments[0];case Tt.PLANET_KIT:return arguments.length<=1?void 0:arguments[1];default:return arguments.length<=0?void 0:arguments[0]}}},{key:"needSendVideoReason",value:function(e){return this.devPlatform===Tt.LINE||this.devPlatform!==Tt.PLANET_KIT||(e===Mt.NORMAL?(this.lastPauseReason=Mt.NORMAL,!0):e!==Mt.NORMAL&&this.lastPauseReason===Mt.NORMAL&&(this.lastPauseReason=e,!0))}},{key:"initLastPauseReason",value:function(){this.lastPauseReason=Mt.NORMAL}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xt(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Zt=function(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.log=new u,this.log.level=r,this.logger=this.log.getLogger(t)}));function Qt(e){switch(e){case $t.DEBUG:return"debug";case $t.LOG:return"log";case $t.WARN:return"warn";case $t.ERROR:return"error";default:return"log"}}function er(){return"hidden"in document?"hidden":(["ms","webkit","moz","o"].forEach((function(e){if(void 0!==document[e+"Hidden"])return e+"Hidden"})),null)}var tr=Object.freeze({AMP_TERM_CALL_THIS:1,AMP_TERM_CALL_THIS_IP_CHANGED:2,AMP_TERM_CALL_THIS_NO_ANSWER:3,AMP_TERM_CALL_THIS_DESTROY:4,AMP_TERM_CALL_THIS_PHONECALL_EVT:7,AMP_TERM_CALL_THIS_FCALL:8,AMP_TERM_CALL_THIS_CALL_BEFORE_AUTH:9,AMP_TERM_CALL_THIS_BY_SYSTEM:10,AMP_TERM_CALL_THIS_DEPRECATED:11,AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL:12,AMP_TERM_CALL_THIS_BY_SLEEP:13,AMP_TERM_CALL_THIS_BY_LOGOFF:14,AMP_TERM_CALL_PEER:51,AMP_TERM_CALL_PEER_DECLINED:52,AMP_TERM_CALL_PEER_NO_RESPONSE:53,AMP_TERM_CALL_PEER_DESTROY:54,AMP_TERM_CALL_PEER_PHONECALL_EVT:55,AMP_TERM_CALL_PEER_NO_MEDIA_PACKET_FROM_PEER:56,AMP_TERM_CALL_PEER_ACCEPT_FAIL:57,AMP_TERM_CALL_PEER_AUDIO_DEV_FAIL:58,AMP_TERM_CALL_PEER_IPCHANGE:59,AMP_TERM_CALL_PEER_SERVICE_SIG_FAIL:60,AMP_TERM_CALL_PEER_SERVICE_MED_FAIL:61,AMP_TERM_CALL_PEER_FCALL_NO_RESPONSE:62,AMP_TERM_CALL_PEER_SERVICE_MED_FAIL_CALLING:63,AMP_TERM_CALL_PEER_BY_SYSTEM:64,AMP_TERM_CALL_PEER_NO_AUDIO_SOURCE:65,AMP_TERM_CALL_PEER_NO_AUDIO_TX_STREAM:66,AMP_TERM_CALL_PEER_DEPRECATED:67,AMP_TERM_CALL_PEER_ACC_NET_UNAVAIL:68,AMP_TERM_CALL_PEER_BY_SLEEP:69,AMP_TERM_CALL_PEER_BY_LOGOFF:70,AMP_TERM_CALL_ERROR_NO_RESPONSE:101,AMP_TERM_CALL_ERROR_NO_MEDIA_PACKET_FROM_PEER:102,AMP_TERM_CALL_ERROR_ACCEPT_FAIL:103,AMP_TERM_CALL_ERROR_AUDIO_DEV_FAIL:104,AMP_TERM_CALL_ERROR_PASSWD:105,AMP_TERM_CALL_ERROR_NEWCALL:106,AMP_TERM_CALL_ERROR_IPCHANGE:108,AMP_TERM_CALL_ERROR_SOMEONE_CALLING_THIS:109,AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL:110,AMP_TERM_CALL_ERROR_SERVICE_MED_FAIL:111,AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA:116,AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE:117,AMP_TERM_CALL_ERROR_SERVICE_MED_FAIL_CALLING:118,AMP_TERM_CALL_ERROR_NO_AUDIO_SOURCE:119,AMP_TERM_CALL_ERROR_NO_AUDIO_TX_STREAM:120,AMP_TERM_CALL_ERROR_HANDLE_INVITE:121,AMP_TERM_CALL_ERROR_TCP_TUNNELLING_FAIL:122,AMP_TERM_CALL_ERROR_TCP_TUNNELLING_DOWN:123,AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE:124,AMP_TERM_CALL_CLI_ABORT:200,AMP_TERM_CALL_CLI_NOT_ALLOWED:201,AMP_TERM_CALL_CLI_NOT_FOUND:202,AMP_TERM_CALL_CLI_NOT_READABLE:203,AMP_TERM_CALL_CLI_OVERCONSTRAINED:204,AMP_TERM_CALL_CLI_SECURITY_ERROR:205,AMP_TERM_CALL_CLI_TYPE_ERROR:206,AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER:207,AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT:208,AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED:209,AMP_TERM_CALL_SERV_TIMEOUT:300,AMP_TERM_CALL_SERV_INTERNAL_SERVER_ERROR:301,AMP_TERM_CALL_SERV_RESOURCE_LIMIT:302,AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLER_DOMAIN:303,AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLED_DOMAIN:304,AMP_TERM_CALL_SERV_ALREADY_GOT_A_CALL:305,AMP_TERM_CALL_SERV_SESSION_REMAIN:306,AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE:307,AMP_TERM_CALL_SERV_DB_ERROR:308,AMP_TERM_CALL_SERV_CALLEE_BUSY:309,AMP_TERM_CALL_SERV_UNKNOWN_CALLEE:310,AMP_TERM_CALL_SERV_LINE_SERVER_ERROR:311,AMP_TERM_CALL_SERV_PUSH_ERROR:312,AMP_TERM_CALL_SERV_UNAUTHORIZED:313,AMP_TERM_CALL_SERV_RELAY_ERROR:314,AMP_TERM_CALL_SERV_CALL_STATE_MISMATCHED:315,AMP_TERM_CALL_SERV_MANDATORY_MISSING:316,AMP_TERM_CALL_SERV_CALL_KEY_MISMATCHED:317,AMP_TERM_CALL_SERV_CALL_DOES_NOT_EXIST:318,AMP_TERM_CALL_SERV_INVALID_SIP_MSG:319,AMP_TERM_CALL_SERV_HB_ERROR:320,AMP_TERM_CALL_SERV_INVITE_ERROR_RSP:321,AMP_TERM_CALL_SERV_INVALID_CALL_KEY:322,AMP_TERM_CALL_SERV_UNKNOWN_SERVICE:330,AMP_TERM_CALL_SERV_UNKNOWN_SERVICE_NODE:331,AMP_TERM_CALL_SERV_PROTOCOL_ERROR:332,AMP_TERM_CALL_SERV_BOT_SERVER_ERROR:340,AMP_TERM_CALL_SERV_RTM_SERVER_ERROR:341,AMP_TERM_CALL_SERV_RTS_SERVER_ERROR:342,AMP_TERM_CALL_SERV_MEDIA_TIMEOUT:343,AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT:400,AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT:401,AMP_TERM_CALL_SERV_MULTIDEV_MAX_EXCEEDED:402,AMP_TERM_CALL_SERV_TURN_OVERLOAD:410,AMP_TERM_CALL_SERV_MIXER_ONE_KICKOUT:411,AMP_TERM_CALL_SERV_MIXERCSCF_CONGESTION:412,AMP_TERM_CALL_SERV_CASTER_NOT_EXIST:413,AMP_TERM_CALL_SERV_CALL_END_BY_FORCE:500,AMP_TERM_CALL_SERV_SVC_NODE_FAILOVER:501,AMP_TERM_CALL_SERV_USER_KICKOUT:502,AMP_TERM_CALL_ERROR_UNKNOWN:600});function rr(e,t){var r={};switch(t){case 1:case 2:r=nr(e,"AMP_TERM_CALL_THIS","AMP_TERM_CALL_PEER","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 3:r=nr(e,"AMP_TERM_CALL_THIS","AMP_TERM_CALL_PEER_DECLINED","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 4:r=nr(e,"AMP_TERM_CALL_SERV_CALLEE_BUSY","AMP_TERM_CALL_SERV_CALLEE_BUSY","AMP_TERM_CALL_SERV_CALLEE_BUSY");break;case 5:case 214:r=nr(e,"AMP_TERM_CALL_THIS_NO_ANSWER","AMP_TERM_CALL_PEER_NO_RESPONSE","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 6:r=nr(e,"AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE","AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE","AMP_TERM_CALL_SERV_OTHER_DEVICE_IN_USE");break;case 7:r=nr(e,"AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_ACCEPT");break;case 8:r=nr(e,"AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT","AMP_TERM_CALL_SERV_MULTIDEV_OTHER_DEV_REJECT");break;case 100:r=nr(e,"AMP_TERM_CALL_SERV_MANDATORY_MISSING","AMP_TERM_CALL_SERV_MANDATORY_MISSING","AMP_TERM_CALL_SERV_MANDATORY_MISSING");break;case 101:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_CALL_STATE_MISMATCHED");break;case 102:case 200:case 213:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_INTERNAL_SERVER_ERROR");break;case 103:case 413:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_PROTOCOL_ERROR");break;case 104:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLER_DOMAIN");break;case 105:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_NOT_SUPPORTED_CALLED_DOMAIN");break;case 106:case 107:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 109:case 209:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_DB_ERROR");break;case 115:r=nr(e,"AMP_TERM_CALL_ERROR_NO_RESPONSE","AMP_TERM_CALL_ERROR_NO_RESPONSE","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 201:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_RELAY_ERROR");break;case 202:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_UNAUTHORIZED");break;case 203:case 204:case 206:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_LINE_SERVER_ERROR");break;case 205:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_PUSH_ERROR");break;case 207:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_UNKNOWN_CALLEE");break;case 210:case 211:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_CALL_DOES_NOT_EXIST");break;case 212:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_CALL_END_BY_FORCE");break;case 215:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_ALREADY_GOT_A_CALL");break;case 216:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_RESOURCE_LIMIT");break;case 217:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_TIMEOUT");break;case 218:r=nr(e,"AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL","AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL","AMP_TERM_CALL_SERV_HB_ERROR");break;case 230:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_PEER_ACC_NET_UNAVAIL");break;case 235:r=nr(e,"AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_ERROR_UNKNOWN","AMP_TERM_CALL_SERV_MULTIDEV_MAX_EXCEEDED");break;case 500:r=nr(e,"AMP_TERM_CALL_ERROR_NO_MEDIA_PACKET_FROM_PEER","AMP_TERM_CALL_PEER_NO_MEDIA_PACKET_FROM_PEER","AMP_TERM_CALL_PEER_NO_MEDIA_PACKET_FROM_PEER");break;case 501:r=nr(e,"AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE","AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE","AMP_TERM_CALL_ERROR_NETWORK_UNREACHABLE");break;case 502:r=nr(e,"AMP_TERM_CALL_ERROR_NO_AUDIO_SOURCE","AMP_TERM_CALL_PEER_NO_AUDIO_SOURCE","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 503:r=nr(e,"AMP_TERM_CALL_ERROR_NO_AUDIO_TX_STREAM","AMP_TERM_CALL_PEER_NO_AUDIO_TX_STREAM","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 504:r=nr(e,"AMP_TERM_CALL_ERROR_SERVICE_SIG_FAIL","AMP_TERM_CALL_PEER_SERVICE_SIG_FAIL","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 505:r=nr(e,"AMP_TERM_CALL_THIS_PHONECALL_EVT","AMP_TERM_CALL_PEER_PHONECALL_EVT","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 506:r=nr(e,"AMP_TERM_CALL_THIS_DESTROY","AMP_TERM_CALL_PEER_DESTROY","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 507:r=nr(e,"AMP_TERM_CALL_THIS_BY_SYSTEM","AMP_TERM_CALL_PEER_BY_SYSTEM","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 508:r=nr(e,"AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA","AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA","AMP_TERM_CALL_ERROR_UNSUPPORTED_MEDIA");break;case 509:r=nr(e,"AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE","AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE","AMP_TERM_CALL_ERROR_JSON_NOT_PARSABLE");break;case 510:r=nr(e,"AMP_TERM_CALL_ERROR_AUDIO_DEV_FAIL","AMP_TERM_CALL_PEER_AUDIO_DEV_FAIL","AMP_TERM_CALL_ERROR_UNKNOWN");break;case 512:r=nr(e,"AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL","AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL","AMP_TERM_CALL_THIS_ACC_NET_UNAVAIL");break;case 522:r=nr(e,"AMP_TERM_CALL_THIS_BY_SLEEP","AMP_TERM_CALL_PEER_BY_SLEEP","AMP_TERM_CALL_THIS_BY_SLEEP");break;case 523:r=nr(e,"AMP_TERM_CALL_THIS_BY_LOGOFF","AMP_TERM_CALL_PEER_BY_LOGOFF","AMP_TERM_CALL_THIS_BY_LOGOFF");break;case 600:r=nr(e,"AMP_TERM_CALL_CLI_ABORT","AMP_TERM_CALL_CLI_ABORT","AMP_TERM_CALL_CLI_ABORT");break;case 601:r=nr(e,"AMP_TERM_CALL_CLI_NOT_ALLOWED","AMP_TERM_CALL_CLI_NOT_ALLOWED","AMP_TERM_CALL_CLI_NOT_ALLOWED");break;case 602:r=nr(e,"AMP_TERM_CALL_CLI_NOT_FOUND","AMP_TERM_CALL_CLI_NOT_FOUND","AMP_TERM_CALL_CLI_NOT_FOUND");break;case 603:r=nr(e,"AMP_TERM_CALL_CLI_NOT_READABLE","AMP_TERM_CALL_CLI_NOT_READABLE","AMP_TERM_CALL_CLI_NOT_READABLE");break;case 604:r=nr(e,"AMP_TERM_CALL_CLI_OVERCONSTRAINED","AMP_TERM_CALL_CLI_OVERCONSTRAINED","AMP_TERM_CALL_CLI_OVERCONSTRAINED");break;case 605:r=nr(e,"AMP_TERM_CALL_CLI_SECURITY_ERROR","AMP_TERM_CALL_CLI_SECURITY_ERROR","AMP_TERM_CALL_CLI_SECURITY_ERROR");break;case 606:r=nr(e,"AMP_TERM_CALL_CLI_TYPE_ERROR","AMP_TERM_CALL_CLI_TYPE_ERROR","AMP_TERM_CALL_CLI_TYPE_ERROR");break;case 607:r=nr(e,"AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_SERVER");break;case 608:r=nr(e,"AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT","AMP_TERM_CALL_CLI_CALL_CONNECT_FAIL_BY_CLIENT");break;case 609:r=nr(e,"AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED","AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED","AMP_TERM_CALL_CLI_WEB_SIGNALING_UNEXPECTED_DISCONNECTED");break;default:r={code:void 0,strCode:"UNDEFINED"}}return r}function nr(e,t,r,n){var i={};switch(e){case Ot.THIS:i={code:tr[t],strCode:t};break;case Ot.PEER:i={code:tr[r],strCode:r};break;case Ot.OTHERS:i={code:tr[n],strCode:n};break;default:i={code:void 0,strCode:"UNDEFINED"}}return i}var ir=Object.freeze({UNDEFINED:0,NORMAL:1,CANCEL:2,REJECT:3,USER_BUSY:4,NO_ANSWER:5,MULTI_DEV_OTHER_DEV_IN_USE:6,MULTI_DEV_OTHER_DEV_ANSWER:7,MULTI_DEV_OTHER_DEV_REJECT:8,MANDATORY_INFO_MISSING:100,INVALID_STATE:101,MEM_FAIL:102,PROTOCOL_ERR:103,INVALID_I_ZONE:104,INVALID_R_ZONE:105,RETRY_AFTER:106,OBJ_CREATE_FAIL:107,SESS_NOT_FOUND:108,SCHAN_NOT_FOUND:109,MCHAN_NOT_FOUND:110,COMM_NOT_FOUND:111,INVALID_MSG:112,TRPT_ERR:113,TRPT_DISCONNECTED:114,REQ_TIMEOUT:115,STALE_EVENT:116,INVALID_FEATURE_SET:117,INVALID_FEATURE_QUERY:118,FEATURE_NOT_FOUND:119,INVALID_SVC_ID:120,INVALID_TGT_SVC_ID:121,MAX_CALL_TIME_EXCEED:122,INTERNAL_ERROR:200,RELAY_ERROR:201,AUTH_ERROR:202,PUSH_REQ_FAIL:203,TOKEN_REQ_FAIL:204,PUSH_ERROR:205,TOKEN_ERROR:206,USER_NOT_FOUND_PUSH:207,USER_NOT_FOUND_TOKEN:208,DB_ERROR:209,DB_COMM_NOT_FOUND:210,DB_CHAN_NOT_FOUND:211,REMAIN_COMM_CLEAN:212,HUNTING_ERROR:213,ANSWER_TIMEOUT_BY_SVR:214,ALREADY_GOT_A_CALL:215,NO_RESOURCE:216,IF_TIMEOUT:217,SESS_KEEPALIVE_TIMEOUT:218,SESS_ACTIVE_TIMEOUT:219,MEDIA_FACILITY_ERROR:220,MEDIA_BRIDGING_ERROR:221,SWITCH_OVER_ERROR:222,HAND_OVER_ERROR:223,SESS_NOT_SELECTED:224,B_SESS_ACTIVE_TIMEOUT:225,INVALID_TOKEN_RSP:226,B_SESS_KEEPALIVE_TIMEOUT:227,DB_STATUS_NOT_FOUND:228,MAX_CFG_LEN_EXCEEDED:229,UE_UNREACHABLE:230,INVALID_PUSH_RSP:231,MAX_CPS_EXCEEDED:232,RELEASE_BY_SO:233,RELEASE_BY_GDOWN:234,MAX_MULTI_DEV_EXCEEDED:235,SERVER_NO_RESPOND:236,RELEASE_BY_GC:300,ROOM_AUTH_ERROR:400,ROOM_IS_FULL:401,ROOM_NOT_FOUND:402,USER_ATTR_ERROR:403,ALONE_KICK_OUT:405,MAX_GCALL_TIME_EXCEEDED:406,NOT_JOINED:410,NOT_USER_INFO:411,CASTER_NOT_EXIST:412,ROOM_ATTRS_ERROR:413,ROOM_DESTROY:415,ROOM_DESTROY_BY_USER:416,ROOM_FORCE_CLOSE:417,ROOM_FORCE_CLOSE_BY_USER:418,ROOM_CHAN_CREATE_FAIL:450,ROOM_CHAN_ATTRS_ERROR:451,ROOM_CHAN_NOT_FOUND:452,NO_MEDIA_PACKETS:500,NETWORK_UNREACHABLE:501,NO_MEDIA_SRC:502,NO_MEDIA_SENT:503,SESSION_FAIL:504,CELLULAR_CALL:505,UE_DESTROY:506,UE_SYSTEM:507,HUY_NEGO_FAIL:508,SVR_CONFIG_LOAD_FAIL:509,AUDIO_DEV_FAIL:510,CONN_REQ_FAIL:511,NETWORK_UNAVAILABLE:512,USR_INTERNAL_ERR:513,APP_DEFINED_ERR:514,CHAN_UNSUBS_FAIL_ACTIVE_AUDIO:515,CHAN_UNSUBS_FAIL_ACTIVE_VIDEO:516,CHAN_UNSUBS_FAIL_NOT_IN_CHAN:517,CHAN_UNSUBS_FAIL_ACTIVE_PRESENTATION:518,CHAN_UNSUBS_FAIL_ACTIVE_DATA:519,ANOTHER_INSTANCE_TRY_TO_CONNECT:520,KIT_DEFINED_ERR:521,UE_SLEEP:522,UE_LOGOFF:523,MTU_EXCEEDED:524,ABORT:600,NOT_ALLOWED:601,NOT_FOUND:602,NOT_READABLE:603,OVERCONSTRAINED:604,SECURITY_ERROR:605,TYPE_ERROR:606,CALL_CONNECT_FAIL_BY_SERVER:607,CALL_CONNECT_FAIL_BY_CLIENT:608,WEB_SIGNALING_UNEXPECTED_DISCONNECTED:609,UNKNOWN_ERROR:1e3});function or(e){return{code:e,strCode:ar(e)}}function ar(e){return Object.keys(ir).find((function(t){return ir[t]===e}))}function sr(e,t){return"true"===t.opusStereo?e=ur(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=lr(e,"opus/48000","stereo")),"true"===t.opusFec?e=ur(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=lr(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=ur(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=lr(e,"opus/48000","usedtx")),null!==t.opusMinptime&&(e=ur(e,"opus/48000","minptime",t.opusMinptime)),t.opusMaxPbr&&(e=ur(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e}function cr(e,t){return null!==t.imageattr&&(e=function(e,t){var r=e.split("\r\n"),n=fr(r,"a=rtpmap","vp8/90000");if(null===n)return e;var i="a=imageattr:"+gr(r[n])+" send * recv *";return r.splice(n+1,0,i),r.join("\r\n")}(e)),e}function ur(e,t,r,n){var i=e.split("\r\n"),o=pr(i,t),a={};if(null===o){var s=fr(i,"a=rtpmap",t);if(null===s)return e;var c=gr(i[s]);a.pt=c.toString(),a.params={},a.params[r]=n,i.splice(s+1,0,hr(a))}else(a=dr(i[o])).params[r]=n,i[o]=hr(a);return i.join("\r\n")}function lr(e,t,r){var n=e.split("\r\n"),i=pr(n,t);if(null===i)return e;var o=dr(n[i]);delete o.params[r];var a=hr(o);return null===a?n.splice(i,1):n[i]=a,n.join("\r\n")}function dr(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split(";"),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<n.length;++s){var c=n[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t}function hr(e){if(!Object.prototype.hasOwnProperty.call(e,"pt")||!Object.prototype.hasOwnProperty.call(e,"params"))return null;var t=e.pt,r=e.params,n=[],i=0;for(var o in r)n[i]=o+"="+r[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+n.join(";")}function pr(e,t){var r=function(e,t){var r=fr(e,"a=rtpmap",t);return r?gr(e[r]):null}(e,t);return r?fr(e,"a=fmtp:"+r.toString()):null}function fr(e,t,r){return function(e,t,r,n,i,o){if(void 0===o&&(o="asc"),"asc"===(o=o||"asc")){for(var a=e.length,s=0;s<a;++s)if(0===e[s].indexOf(n)&&(!i||-1!==e[s].toLowerCase().indexOf(i.toLowerCase())))return s}else for(var c=0;c>=0;--c)if(0===e[c].indexOf(n)&&(!i||-1!==e[c].toLowerCase().indexOf(i.toLowerCase())))return c;return null}(e,0,0,t,r)}function gr(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null}r(2772);var vr=Object.freeze({THUMBNAIL:0,QVGA:1,VGA:2,HD:3}),mr=Object.freeze({INIT:0,READY:1,PLAY:2,STOP:3,CLEAN:4,FAILED:5}),Sr=Object.freeze({INIT:0,FEATURE_AHEAD:1,JOIN:2,JOIN_COMPLETE:3,VIDEO_STOP:4,VIDEO_START:5,REJOIN:6,LEAVE:7});function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function yr(e){var t=function(e,t){if("object"!=Er(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Er(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Er(t)?t:t+""}var _r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sdpMid=void 0,this.dSsrc=123456789,this.videoView=void 0,this.transceiver=void 0,this.mediaStream=new MediaStream,this.state=Ut.INIT}var t,r;return t=e,(r=[{key:"setVideoView",value:function(e){this.videoView=e}},{key:"setState",value:function(e){this.state=e}},{key:"setTransceiver",value:function(e){this.transceiver=e}},{key:"setupMedia",value:function(e,t){e&&(this.stopOldTrack("video",e.id),this.mediaStream.addTrack(e)),this.playVideo(t)}},{key:"playVideo",value:function(e){var t=this;this.videoView&&(this.videoView.srcObject=this.mediaStream,this.videoView.muted=!0,this.videoView.play().then((function(){e&&e.delegate&&e.delegate.onPlayed(),console.debug("".concat(t.sdpMid," play screen share..."))})).catch((function(e){return console.warn("Fail to play ".concat(t.sdpMid," video - ").concat(e.message))})))}},{key:"replaceSenderTrack",value:function(e){this.transceiver.sender.replaceTrack(e)}},{key:"stopOldTrack",value:function(e,t){var r=this;this.mediaStream.getTracks().filter((function(t){return t.kind===e})).forEach((function(e){e.id!==t&&(e.stop(),r.mediaStream.removeTrack(e))}))}},{key:"setAudioTrack",value:function(e){this.stopOldTrack("audio"),this.mediaStream.addTrack(e)}},{key:"changeVideoView",value:function(e,t){return t&&this.videoView&&(this.videoView.srcObject=null,this.videoView.pause()),e.srcObject=this.mediaStream,e.muted=!0,this.videoView=e,this.videoView.play()}},{key:"inactiveTransceiver",value:function(){this.transceiver&&(this.transceiver.direction="inactive")}},{key:"cleanupView",value:function(){this.state=Ut.STOP,this.videoView&&(this.videoView=void 0)}},{key:"cleanupVideo",value:function(){this.cleanupView(),this.stopOldTrack("audio"),this.stopOldTrack("video")}},{key:"failedSetupVideo",value:function(){this.cleanupVideo(),this.hadFailed=!0,this.state=Ut.FAILED}},{key:"isPlayed",value:function(){return this.state===Ut.START||this.state===Ut.RESTART}},{key:"isFailed",value:function(){return this.state===Ut.FAILED}},{key:"hasAudioTrack",value:function(){return this.mediaStream.getAudioTracks().length>0}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yr(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Tr(e){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tr(e)}function Rr(e){var t=function(e,t){if("object"!=Tr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Tr(t)?t:t+""}var br=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=void 0,this.spareTransceiverPool=[]}var t,r;return t=e,r=[{key:"setSession",value:function(e){this.session=e}},{key:"addSpareTransceiver",value:function(e){e&&this.spareTransceiverPool.push(e)}},{key:"getTransceiver",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sendrecv",n=arguments.length>2?arguments[2]:void 0;return this.spareTransceiverPool.length?(t=this.spareTransceiverPool.pop()).direction=r:t=this.session.sessionDescriptionHandler.peerConnection.addTransceiver(e,{direction:r}),n&&(t.streams=n),t}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Rr(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),wr=Object.freeze({CANDIDATE_PAIR:"candidate-pair",OUTBOUND_RTP:"outbound-rtp",INBOUND_RTP:"inbound-rtp"});function Ar(e){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(e)}function Cr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Ir(e){var t=function(e,t){if("object"!=Ar(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Ar(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ar(t)?t:t+""}var Or=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t}var t,r;return t=e,(r=[{key:"parseStats",value:function(e){var t=this;return new Promise((function(r,n){t.session&&t.session.sessionDescriptionHandler&&t.session.sessionDescriptionHandler.peerConnection||n(new Error("invalid-session")),t.session.sessionDescriptionHandler.peerConnection.getStats().then((function(t){var n,i={timestamp:Date.now(),"outbound-rtp":[],"inbound-rtp":[]},o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Cr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Cr(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(t);try{for(o.s();!(n=o.n()).done;){var a=n.value[1],s=a.type;if(void 0===e||e.includes(s)){var c={timestamp:i.timestamp};switch(s){case wr.CANDIDATE_PAIR:!i[wr.CANDIDATE_PAIR]&&a.availableOutgoingBitrate&&(c.availableOutgoingBitrate=a.availableOutgoingBitrate,c.availableIncomingBitrate=a.availableIncomingBitrate?a.availableIncomingBitrate:void 0,c.currentRoundTripTime=a.currentRoundTripTime,i[wr.CANDIDATE_PAIR]=c);break;case wr.OUTBOUND_RTP:c.ssrc=a.ssrc,c.kind=a.kind,c.packetsSent=a.packetsSent,c.bytesSent=a.bytesSent,"video"===a.kind&&(c.firCount=a.firCount,c.pliCount=a.pliCount,c.nackCount=a.nackCount,c.qpSum=a.qpSum,c.frameWidth=a.frameWidth,c.frameHeight=a.frameHeight,c.framesSent=a.framesSent,c.framesPerSecond=a.framesPerSecond,a.contentType&&(c.contentType=a.contentType),a.rid&&(c.rid=a.rid),a.targetBitrate&&(c.targetBitrate=a.targetBitrate)),i[wr.OUTBOUND_RTP].push(c);break;case wr.INBOUND_RTP:c.ssrc=a.ssrc,c.kind=a.kind,c.packetsReceived=a.packetsReceived,c.bytesReceived=a.bytesReceived,c.packetsLost=a.packetsLost,c.jitter=a.jitter,"video"===a.kind&&(c.firCount=a.firCount,c.pliCount=a.pliCount,c.nackCount=a.nackCount,c.qpSum=a.qpSum,c.frameWidth=a.frameWidth,c.frameHeight=a.frameHeight,c.framesReceived=a.framesReceived,c.framesPerSecond=a.framesPerSecond,c.framesDecoded=a.framesDecoded,c.framesDropped=a.framesDropped,a.codecId&&a.codecId.includes("pss")&&(c.contentType="screenshare")),i[wr.INBOUND_RTP].push(c)}}}}catch(e){o.e(e)}finally{o.f()}r(i)}))}))}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ir(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Pr(e){return Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pr(e)}function Nr(e){var t=function(e,t){if("object"!=Pr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Pr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pr(t)?t:t+""}var kr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.total=0,this.count=0}var t,r;return t=e,(r=[{key:"addPoint",value:function(e){this.total+=e,this.count++}},{key:"getAverage",value:function(){return 0===this.count?0:this.total/this.count}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Nr(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Mr(e){return Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mr(e)}function Dr(e){var t=function(e,t){if("object"!=Mr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Mr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Mr(t)?t:t+""}function Lr(e,t){return Lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lr(e,t)}function xr(e){var t=Vr();return function(){var r,n=Ur(e);if(t){var i=Ur(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==Mr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Vr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Vr=function(){return!!e})()}function Ur(e){return Ur=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ur(e)}var jr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lr(e,t)}(i,e);var t,r,n=xr(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=n.call(this,e)).interval=100,t.targetStatTypeList=[wr.CANDIDATE_PAIR],t.outgoingBandwidth=new kr,t.incomingBandwidth=new kr,t}return t=i,(r=[{key:"start",value:function(){this.statGathering=!0,this.gatherStats()}},{key:"end",value:function(){this.statGathering=!1}},{key:"gatherStats",value:function(){var e=this;console.log("start gatherStats"),this.parseStats(this.targetStatTypeList).then((function(t){t&&(e.outgoingBandwidth.addPoint(t[wr.CANDIDATE_PAIR].availableOutgoingBitrate),t[wr.CANDIDATE_PAIR].availableIncomingBitrate&&e.incomingBandwidth.addPoint(t[wr.CANDIDATE_PAIR].availableIncomingBitrate),setTimeout(e.gatherStats.bind(e),e.interval))})).catch((function(e){console.warn("range statistic test - catch error"),console.log(e)}))}},{key:"getStats",value:function(){return{outgoingBandwidth:this.outgoingBandwidth.getAverage()/1e3+"kbps",incomingBandwidth:this.incomingBandwidth.getAverage()/1e3+"kbps"}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dr(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(Or);function Hr(e){return Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hr(e)}function Br(e){var t=function(e,t){if("object"!=Hr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Hr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Hr(t)?t:t+""}function $r(e,t){return $r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$r(e,t)}function Fr(e){var t=qr();return function(){var r,n=Wr(e);if(t){var i=Wr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==Hr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function qr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(qr=function(){return!!e})()}function Wr(e){return Wr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Wr(e)}var Kr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$r(e,t)}(i,e);var t,r,n=Fr(i);function i(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,e)}return t=i,(r=[{key:"getStats",value:function(e){var t=this;return new Promise((function(r,n){t.parseStats(e).then((function(e){r(e)})).catch((function(e){return n(e)}))}))}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Br(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(Or);function Gr(e){return Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gr(e)}function Yr(e){var t=function(e,t){if("object"!=Gr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Gr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Gr(t)?t:t+""}var zr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaState=null,this.active=!1,this.standby=!1,this.standbyMediaState=null}var t,r;return t=e,r=[{key:"setMediaState",value:function(e){var t=this;return new Promise((function(r,n){setTimeout((function(){t.mediaState=e,r()}),0)}))}},{key:"init",value:function(){this.mediaState.initCallback(this.mediaState)}},{key:"activate",value:function(){var e=this;return this.active=!0,new Promise((function(t,r){e.mediaState.activateCallback(e.mediaState,(function(){e.active=!1,e.releseStandbyMediaState(),t()}),(function(t){e.active=!1,e.releseStandbyMediaState(),r(t)}))}))}},{key:"getState",value:function(){return this.mediaState.getState()}},{key:"isActivate",value:function(){return this.active}},{key:"setStandby",value:function(){this.standby=!0}},{key:"isStandby",value:function(){return this.standby}},{key:"releseStandbyMediaState",value:function(){this.standby=!1,this.standbyMediaState=null}},{key:"setStandbyMediaState",value:function(e){this.standbyMediaState=e}},{key:"getStandbyMediaState",value:function(){return this.standbyMediaState}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yr(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Xr(e){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xr(e)}function Jr(e){var t=function(e,t){if("object"!=Xr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Xr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xr(t)?t:t+""}var Zr=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t,this.initCallback=r,this.activateCallback=n}var t,r;return t=e,(r=[{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Jr(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Qr(e){return Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qr(e)}function en(e){var t=function(e,t){if("object"!=Qr(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Qr(t)?t:t+""}var tn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isSetExclusivelySharedContents=!1,this._peerIdSetExclusivelySharedContents=void 0,this._isProcessingUpdateExclusivelySharedContents=!1,this._isProcessingUpdateRoomSharedContents=!1}var t,r;return t=e,(r=[{key:"setExclusivelySharedContents",value:function(e){this._isSetExclusivelySharedContents=!0,this._peerIdSetExclusivelySharedContents=e}},{key:"unsetExclusivelySharedContents",value:function(){this._isSetExclusivelySharedContents=!1,this._peerIdSetExclusivelySharedContents=void 0}},{key:"canChangeExclusivelySharedContents",value:function(e){return!0!==this._isSetExclusivelySharedContents||this._peerIdSetExclusivelySharedContents===e}},{key:"isProcessingUpdateExclusivelySharedContents",value:function(){return this._isProcessingUpdateExclusivelySharedContents}},{key:"waitResultUpdateExclusivelySharedContents",value:function(){this._isProcessingUpdateExclusivelySharedContents=!0}},{key:"completeUpdateExclusivelySharedContents",value:function(){this._isProcessingUpdateExclusivelySharedContents=!1}},{key:"isProcessingUpdateRoomSharedContents",value:function(){return this._isProcessingUpdateRoomSharedContents}},{key:"waitResultUpdateRoomSharedContents",value:function(){this._isProcessingUpdateRoomSharedContents=!0}},{key:"completeUpdateRoomSharedContents",value:function(){this._isProcessingUpdateRoomSharedContents=!1}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,en(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function rn(e){return rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rn(e)}function nn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(e,t)||on(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function on(e,t){if(e){if("string"==typeof e)return an(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?an(e,t):void 0}}function an(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function sn(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function cn(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){sn(o,n,i,a,s,"next",e)}function s(e){sn(o,n,i,a,s,"throw",e)}a(void 0)}))}}function un(e){var t=function(e,t){if("object"!=rn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=rn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==rn(t)?t:t+""}function ln(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function dn(e,t,r){return function(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}(t,e),r}r(8478),r(5212);var hn=new WeakSet,pn=new WeakSet,fn=new WeakSet,gn=new WeakSet,vn=new WeakSet,mn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ln(this,vn),ln(this,gn),ln(this,fn),ln(this,pn),ln(this,hn),this.logger=t.logger,this.mediaStreamFactory=function(e){return void 0===navigator.mediaDevices?Promise.reject(new Error("Media devices not available in insecure contexts.")):e.audio||e.video?navigator.mediaDevices.getUserMedia.call(navigator.mediaDevices,e):Promise.resolve(new MediaStream)},this.localVideoElement=void 0,this.localCanvasElement=void 0,this.localMediaStream=new MediaStream,this.senderMediaStream=void 0,this.audioInputDeviceId=void 0,this.videoInputDeviceId=void 0,this.getUserMediaStateError=void 0}var t,r,n,i,o;return t=e,r=[{key:"init",value:(o=cn(regeneratorRuntime.mark((function e(t){var r,n,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("init",t),this.setLocalVideoElement(null===(r=t.media)||void 0===r||null===(n=r.local)||void 0===n?void 0:n.video),i=this.createInitMediaStream(t),e.next=5,this.getAdditionalConstraints(i,t);case 5:return o=e.sent,e.next=8,this.addAdditionalMediaStream(i,o,t.ignoreDeviceError);case 8:this.assignDeviceIds(i),this.addDummyMediaTracks(i),this.logger.debug("Final initMediaStream"),this.logger.debug(i.getTracks()),this.localMediaStream=i,this.setupSenderMediaStream(t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createInitMediaStream",value:function(e){return e.customMediaStream&&e.customMediaStream instanceof MediaStream?this.createInitMediaStreamWithCustomMediaStream(e):e.mediaStreamManager?this.createInitMediaStreamWithMediaStreamManager(e):(e.mediaId,new MediaStream)}},{key:"createInitMediaStreamWithCustomMediaStream",value:function(e){this.logger.debug("Set initMediaStream using customMediaStream");var t=e.customMediaStream;return this.removeVideoTracksBasedOnParams(t,e),t}},{key:"createInitMediaStreamWithMediaStreamManager",value:function(e){this.logger.debug("Set initMediaStream using mediaStreamManager");var t=e.mediaStreamManager.getMediaStream()||new MediaStream;return this.removeVideoTracksBasedOnParams(t,e),t}},{key:"removeVideoTracksBasedOnParams",value:function(e,t){!1!==t.cameraOn&&t.callType!==wt.AUDIO||(this.logger.debug("Removing video tracks based on params from mediaStream"),e.getVideoTracks().forEach((function(t){e.removeTrack(t),t.stop()})))}},{key:"getAdditionalConstraints",value:(i=cn(regeneratorRuntime.mark((function e(t,r){var n,i,o,a,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={audio:!1,video:!1},0!==(null==t?void 0:t.getAudioTracks().length)){e.next=13;break}if(null===(i=r.mediaId)||void 0===i||!i.audio){e.next=9;break}return e.next=5,mt(r.mediaId.audio,"audioinput");case 5:o=e.sent,n.audio=!o||{deviceId:{exact:o}},e.next=13;break;case 9:return e.next=11,dn(this,hn,Sn).call(this,"audioinput");case 11:e.sent&&(n.audio=!0);case 13:if(0!==t.getVideoTracks().length){e.next=28;break}if(r.callType!==wt.VIDEO||!r.cameraOn){e.next=28;break}if(s=r.isHDRestricted?Ht.VGA_WIDTH:Ht.WIDTH,c=r.isHDRestricted?Ht.VGA_HEIGHT:Ht.HEIGHT,null===(a=r.mediaId)||void 0===a||!a.video){e.next=24;break}return e.next=20,mt(r.mediaId.video,"videoinput");case 20:u=e.sent,n.video=u?{deviceId:{exact:u},width:s,height:c}:{width:s,height:c},e.next=28;break;case 24:return e.next=26,dn(this,hn,Sn).call(this,"videoinput");case 26:e.sent&&(n.video={width:s,height:c});case 28:return this.logger.debug("additionalConstraints - "+JSON.stringify(n)),e.abrupt("return",n);case 30:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"addAdditionalMediaStream",value:(n=cn(regeneratorRuntime.mark((function e(t,r,n){var i,o,a,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new MediaStream,!r.audio&&!r.video){e.next=35;break}return e.prev=2,e.next=5,this.mediaStreamFactory(r);case 5:i=e.sent,e.next=33;break;case 8:if(e.prev=8,e.t0=e.catch(2),this.logger.debug("Fail to get mediaStream using additionalConstraints."),this.getUserMediaStateError=e.t0,n){e.next=14;break}return e.abrupt("return",Promise.reject(e.t0));case 14:return e.next=16,dn(this,pn,yn).call(this,r);case 16:if(o=e.sent,a=nn(o,2),s=a[0],c=a[1],this.logger.debug("Check device availability. isMicrophoneAccessible: ".concat(s,", isCameraAccessible: ").concat(c)),s||(r.audio=!1),c||(r.video=!1),!r.audio&&!r.video){e.next=33;break}return e.prev=24,e.next=27,this.mediaStreamFactory(r);case 27:i=e.sent,e.next=33;break;case 30:e.prev=30,e.t1=e.catch(24),this.logger.log("Fail to get mediaStream using additionalConstraints after ignoreDeviceError.");case 33:this.logger.debug("Track length of additionalMediaStream. audio:".concat(i.getAudioTracks().length,", video:").concat(i.getVideoTracks().length)),i.getTracks().forEach((function(e){return t.addTrack(e)}));case 35:case"end":return e.stop()}}),e,this,[[2,8],[24,30]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"assignDeviceIds",value:function(e){var t,r=e.getAudioTracks()[0];r&&(this.audioInputDeviceId=null===(t=r.getCapabilities())||void 0===t?void 0:t.deviceId);var n,i=e.getVideoTracks()[0];i&&(this.videoInputDeviceId=null===(n=i.getCapabilities())||void 0===n?void 0:n.deviceId)}},{key:"addDummyMediaTracks",value:function(e){if(0===e.getVideoTracks().length){this.logger.debug("Add dummy video track");var t=dn(this,fn,Tn).call(this);t&&e.addTrack(t)}if(0===e.getAudioTracks().length){this.logger.debug("Add dummy audio track");var r=this.getDummyAudioTrack();r&&e.addTrack(r)}}},{key:"setupSenderMediaStream",value:function(e){var t;if(e.customMediaStream||null===(t=e.mediaStreamManager)||void 0===t||!t.isVirtualBackgroundActive())this.senderMediaStream=this.localMediaStream;else{var r=e.mediaStreamManager.getVirtualBackgroundVideoStream().getVideoTracks()[0];if(r){this.logger.debug("Make senderMediaStream with virtualBackground");var n=this.localMediaStream.getAudioTracks();this.senderMediaStream=new MediaStream([].concat(function(e){return function(e){if(Array.isArray(e))return an(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||on(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n),[r]))}else this.senderMediaStream=this.localMediaStream}}},{key:"getLocalMediaStream",value:function(){return this.localMediaStream}},{key:"setLocalMediaStream",value:function(e){this.localMediaStream=e}},{key:"getSenderMediaStream",value:function(){return this.senderMediaStream}},{key:"setLocalVideoElement",value:function(e){this.localVideoElement=e}},{key:"getLocalVideoElement",value:function(){return this.localVideoElement}},{key:"setLocalCanvasElement",value:function(e){this.localCanvasElement=e}},{key:"getLocalCanvasElement",value:function(){return this.localCanvasElement}},{key:"setupLocalMedia",value:function(){var e=this;if(this.localVideoElement){this.localVideoElement.srcObject=this.getLocalMediaStream(),this.localVideoElement.muted=!0;var t=this.localVideoElement.play();void 0!==t?t.then((function(){})).catch((function(t){var r;null===(r=e.logger)||void 0===r||r.log("Fail to setupLocalMedia ".concat(t))})):this.logger.log("local video play() returned undefined")}}},{key:"replaceLocalMediaStreamTracks",value:function(e,t){var r=this;("audio"===e?this.localMediaStream.getAudioTracks():this.localMediaStream.getVideoTracks()).forEach((function(e){r.localMediaStream.removeTrack(e),e.stop()})),t.forEach((function(e){r.localMediaStream.addTrack(e)}))}},{key:"releaseLocalMediaStream",value:function(){var e;null===(e=this.localMediaStream)||void 0===e||e.getTracks().forEach((function(e){e.stop()}))}},{key:"release",value:function(){this.logger.debug("Start Release");try{var e,t;null===(e=this.localMediaStream)||void 0===e||e.getTracks().forEach((function(e){e.stop()})),null===(t=this.senderMediaStream)||void 0===t||t.getTracks().forEach((function(e){e.stop()})),this.localVideoElement&&(this.localVideoElement.srcObject=null,this.localVideoElement.pause()),dn(this,gn,Rn).call(this),dn(this,vn,bn).call(this)}catch(e){this.logger.log("Release has error. ".concat(e.message))}this.logger=void 0,this.mediaStreamFactory=void 0,this.localVideoElement=void 0,this.localCanvasElement=void 0,this.localMediaStream=void 0,this.senderMediaStream=void 0,this.audioInputDeviceId=void 0,this.videoInputDeviceId=void 0,this.getUserMediaStateError=void 0}},{key:"getDummyAudioTrack",value:function(){var e=window.AudioContext||window.webkitAudioContext||!1;if(!e)return this.logger.warn("Fail to make a dummy audio track because this browser not support AudioContext."),null;var t=new e,r=t.createOscillator(),n=t.createGain();r.connect(n),n.gain.value=0;var i=n.connect(t.createMediaStreamDestination());return r.start(),this._audioContext=t,this._oscillator=r,this._gainNode=n,i.stream.getAudioTracks()[0]}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,un(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Sn(e){return En.apply(this,arguments)}function En(){return(En=cn(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices().then((function(e){return e.some((function(e){return e.kind===t}))}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yn(e){return _n.apply(this,arguments)}function _n(){return(_n=cn(regeneratorRuntime.mark((function e(t){var r,n,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,n=!1,!1===t.audio){e.next=14;break}return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:i=e.sent,r=!0,this.logger.debug("Microphone is accessible."),i.getTracks().forEach((function(e){return e.stop()})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(3);case 14:if(!1===t.video){e.next=26;break}return e.prev=15,e.next=18,navigator.mediaDevices.getUserMedia({video:!0});case 18:o=e.sent,n=!0,this.logger.debug("Camera is accessible."),o.getTracks().forEach((function(e){return e.stop()})),e.next=26;break;case 24:e.prev=24,e.t1=e.catch(15);case 26:return e.abrupt("return",[r,n]);case 27:case"end":return e.stop()}}),e,this,[[3,12],[15,24]])})))).apply(this,arguments)}function Tn(){var e=this;try{var t=Object.assign(document.createElement("canvas"),{width:640,height:480}),r=t.getContext("2d");if(!r||!t.captureStream)return this.logger.warn("Fail to make a dummy video track because this browser not support Canvas or captureStream."),null;var n=function(){r.fillRect(0,0,640,480)};return n(),this.dummyVideo=setInterval(n,50),this.changeIntervalOfDummyVideo=setTimeout((function(){dn(e,gn,Rn).call(e),e.dummyVideo=setInterval(n,3e3)}),2e4),t.captureStream().getVideoTracks()[0]}catch(e){return this.logger.warn("Fail to make a dummy video tracks.",e),null}}function Rn(){this.dummyVideo&&(clearInterval(this.dummyVideo),this.dummyVideo=null),this.changeIntervalOfDummyVideo&&(clearTimeout(this.changeIntervalOfDummyVideo),this.changeIntervalOfDummyVideo=null)}function bn(){this._oscillator&&(this._oscillator.stop(),this._oscillator.disconnect(),this._oscillator=null),this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null),this._audioContext&&(this._audioContext.close(),this._audioContext=null)}function wn(e){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wn(e)}function An(e){var t=function(e,t){if("object"!=wn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=wn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==wn(t)?t:t+""}var Cn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.remoteMediaStream=new MediaStream,this.remoteAudioElement=void 0,this.remoteVideoElement=void 0}var t,r;return t=e,(r=[{key:"getRemoteMediaStream",value:function(){return this.remoteMediaStream}},{key:"getRemoteAudioElement",value:function(){return this.remoteAudioElement}},{key:"setRemoteAudioElement",value:function(e){this.remoteAudioElement=e}},{key:"getRemoteVideoElement",value:function(){return this.remoteVideoElement}},{key:"setRemoteVideoElement",value:function(e){this.remoteVideoElement=e}},{key:"release",value:function(){try{var e;null===(e=this.remoteMediaStream)||void 0===e||e.getTracks().forEach((function(e){e.stop()})),this.remoteAudioElement&&(void 0!==this.remoteAudioElement.sinkId&&this.remoteAudioElement.setSinkId(""),this.remoteAudioElement.srcObject=null,this.remoteAudioElement.pause()),this.remoteVideoElement&&(this.remoteVideoElement.srcObject=null,this.remoteVideoElement.pause())}catch(e){console.warn("Release remoteStream has warn - ".concat(e.message))}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,An(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function In(e){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},In(e)}function On(e){var t=function(e,t){if("object"!=In(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=In(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==In(t)?t:t+""}var Pn=function(){function e(t){var r=t.service,n=t.hasConnected,i=t.getReleaser,o=t.getPlnRelCode,a=t.logger;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.service=r,this.getReleaser=i,this.hasConnected=n,this.getPlnRelCode=o,this.logger=a}var t,r;return t=e,(r=[{key:"init",value:function(e){e.ringToneUrl&&(this.ringTone=new Audio(e.ringToneUrl)),e.ringbackToneUrl&&(this.ringbackTone=new Audio(e.ringbackToneUrl)),e.endToneUrl&&(this.endTone=new Audio(e.endToneUrl)),this.playEndToneRegardlessOfCallState=e.playEndToneRegardlessOfCallState}},{key:"playTone",value:function(e){return e.currentTime=0,e.play()}},{key:"pauseTone",value:function(e){e.pause()}},{key:"playRingTone",value:function(){return this.ringTone?(this.ringTone.loop=!0,this.playTone(this.ringTone)):Promise.resolve()}},{key:"pauseRingTone",value:function(){this.ringTone&&this.pauseTone(this.ringTone)}},{key:"playRingbackTone",value:function(){return this.ringbackTone?(this.ringbackTone.loop=!0,this.playTone(this.ringbackTone)):Promise.resolve()}},{key:"pauseRingbackTone",value:function(){this.ringbackTone&&this.pauseTone(this.ringbackTone)}},{key:"playEndTone",value:function(){if(this.endTone&&(this.logger.debug("Play end tone | hasConnected: ".concat(this.hasConnected(),", playEndToneRegardlessOfCallState: ").concat(this.playEndToneRegardlessOfCallState,", releaser: ").concat(this.getReleaser(),", relCode: ").concat(this.getPlnRelCode())),this.hasConnected()||this.playEndToneRegardlessOfCallState))if("call"===this.service){if(this.getReleaser()!==Ot.THIS||![ir.NORMAL,ir.CANCEL,ir.NO_ANSWER,ir.REJECT].includes(this.getPlnRelCode()))return this.playTone(this.endTone)}else if(this.getReleaser()!==Ot.THIS||this.getPlnRelCode()!==ir.NORMAL)return this.playTone(this.endTone);return Promise.resolve()}},{key:"release",value:function(){this.ringTone=void 0,this.ringbackTone=void 0,this.endTone=void 0}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,On(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Nn=Object.freeze({TONE_SOUND_RING_TONE_PLAY_FAILED:"tone_sound_ring_tone_play_failed",TONE_SOUND_RING_TONE_PLAY_NOT_ALLOWED:"tone_sound_ring_tone_play_not_allowed",TONE_SOUND_RINGBACK_TONE_PLAY_FAILED:"tone_sound_ringback_tone_play_failed",TONE_SOUND_RINGBACK_TONE_PLAY_NOT_ALLOWED:"tone_sound_ringback_tone_play_not_allowed",TONE_SOUND_END_TONE_PLAY_FAILED:"tone_sound_end_tone_play_failed",TONE_SOUND_END_TONE_PLAY_NOT_ALLOWED:"tone_sound_end_tone_play_not_allowed",DEVICE_MEDIA_ABORT_ERROR:"device_media_abort_error",DEVICE_MEDIA_INVALID_STATE_ERROR:"device_media_invalid_state_error",DEVICE_MEDIA_NOT_ALLOWED_ERROR:"device_media_not_allowed_error",DEVICE_MEDIA_NOT_FOUND_ERROR:"device_media_not_found_error",DEVICE_MEDIA_NOT_READABLE_ERROR:"device_media_not_readable_error",DEVICE_MEDIA_OVERCONSTRAINED_ERROR:"device_media_overconstrained_error",DEVICE_MEDIA_SECURITY_ERROR:"device_media_security_error",DEVICE_MEDIA_TYPE_ERROR:"device_media_type_error"});function kn(e,t){var r,n=e;switch(e){case Nn.TONE_SOUND_RING_TONE_PLAY_FAILED:r="The ringtone cannot be played because the ringtone source is not available or there are other playback errors.";break;case Nn.TONE_SOUND_RING_TONE_PLAY_NOT_ALLOWED:r="The ringtone cannot be played because the user has not interacted with the document or because of browser settings. This behavior is required by browser security policies.";break;case Nn.TONE_SOUND_RINGBACK_TONE_PLAY_FAILED:r="The ringback tone cannot be played because the ringback tone source is not available or there are other playback errors.";break;case Nn.TONE_SOUND_RINGBACK_TONE_PLAY_NOT_ALLOWED:r="The ringback tone cannot be played because the user has not interacted with the document or because of browser settings. This behavior is required by browser security policies.";break;case Nn.TONE_SOUND_END_TONE_PLAY_FAILED:r="The end tone cannot be played because the end tone source is not available or there are other playback errors.";break;case Nn.TONE_SOUND_END_TONE_PLAY_NOT_ALLOWED:r="The end tone cannot be played because the user has not interacted with the document or because of browser settings. This behavior is required by browser security policies.";break;case Nn.DEVICE_MEDIA_ABORT_ERROR:case"AbortError":n=Nn.DEVICE_MEDIA_ABORT_ERROR,r="Access to the device's media input is prevented despite permissions being granted, without any hardware issues.";break;case Nn.DEVICE_MEDIA_INVALID_STATE_ERROR:case"InvalidStateError":n=Nn.DEVICE_MEDIA_INVALID_STATE_ERROR,r="Media input from the receiving device is not allowed because the document is not fully active or in a suitable state.";break;case Nn.DEVICE_MEDIA_NOT_ALLOWED_ERROR:case"NotAllowedError":n=Nn.DEVICE_MEDIA_NOT_ALLOWED_ERROR,r="The browser is not allowed to access the device, typically due to insecure context or user denial of permissions.";break;case Nn.DEVICE_MEDIA_NOT_FOUND_ERROR:case"NotFoundError":n=Nn.DEVICE_MEDIA_NOT_FOUND_ERROR,r="No media tracks of the specified type were found.";break;case Nn.DEVICE_MEDIA_NOT_READABLE_ERROR:case"NotReadableError":n=Nn.DEVICE_MEDIA_NOT_READABLE_ERROR,r="A hardware error prevents access to the device, despite user permission being granted.";break;case Nn.DEVICE_MEDIA_OVERCONSTRAINED_ERROR:case"OverconstrainedError":n=Nn.DEVICE_MEDIA_OVERCONSTRAINED_ERROR,r=t+" (No candidate devices meet the specified constraints, often due to overly restrictive criteria.)";break;case Nn.DEVICE_MEDIA_SECURITY_ERROR:case"SecurityError":n=Nn.DEVICE_MEDIA_SECURITY_ERROR,r="User media support is disabled for the application, often due to security settings.";break;case Nn.DEVICE_MEDIA_TYPE_ERROR:case"TypeError":n=Nn.DEVICE_MEDIA_TYPE_ERROR,r="Constraints on the getting device's media are empty, invalid, or called in an insecure context.";break;default:r="Undefined notice."}return{name:n,message:r}}function Mn(e){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(e)}function Dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Ln(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function xn(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Ln(o,n,i,a,s,"next",e)}function s(e){Ln(o,n,i,a,s,"throw",e)}a(void 0)}))}}function Vn(e){var t=function(e,t){if("object"!=Mn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Mn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Mn(t)?t:t+""}function Un(e,t){return Un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Un(e,t)}function jn(e){var t=Hn();return function(){var r,n=Bn(e);if(t){var i=Bn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==Mn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Hn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Hn=function(){return!!e})()}function Bn(e){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Bn(e)}var $n=Rt,Fn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Un(e,t)}(p,e);var t,r,n,i,o,a,s,c,u,l,d,h=jn(p);function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=h.call(this)).service=e,t}return t=p,r=[{key:"wtpInit",value:function(e){var t=this,r=new Map(Object.entries(e));this.wtpConfig={wtpGwUri:r.has("wtpGwUri")?r.get("wtpGwUri"):null,logLevel:r.has("logLevel")?r.get("logLevel"):$t.LOG,traceSip:!!r.has("traceSip")&&r.get("traceSip"),builtinEnabled:!!r.has("builtinEnabled")&&r.get("builtinEnabled"),devPlatform:r.has("devPlatform")?r.get("devPlatform"):"line"},this.callParams={},this.state=$n.STATE_INIT,this.hasConnected=!1,this.hasSetCustomMediaStreamWithAudio=!1,this.hasSetCustomMediaStreamWithVideo=!1,this.plnRelCode=ir.UNDEFINED,this.releaser=void 0,this.callDir="",this.callTerminate=!1,this.localVideoSsrc=[],this.remoteVideoSsrc=[],this.bundleLine="1",this.myScreenShare=new _r,this.wtpLogger=new Zt("wtp-lib",this.wtpConfig.logLevel),this.logger=this.wtpLogger.logger,this.platformAdapter=new Jt(this.wtpConfig.devPlatform),this.browserInfo=void 0,this.localMediaStreamManager=new mn(new Zt("wtp-LocalMediaStreamManager",this.wtpConfig.logLevel)),this.remoteMediaStreamManager=new Cn,this.transceiverHandler=new br,this.sdpMutex=new Ye,this.videoMutedManager=new zr,this.audioMutedManager=new zr,this.sharedContentsManager=new tn,this.toneSoundManager=new Pn({service:this.service,hasConnected:function(){return t.hasConnected},getReleaser:function(){return t.releaser},getPlnRelCode:function(){return t.plnRelCode},logger:this.logger}),"conference"!==this.service&&(this.peerScreenShare=new _r),this.logger.debug("wtpConfig"),this.logger.debug(this.wtpConfig)}},{key:"wtpEnableVideo",value:function(e){var t=this,r=Object.assign({cameraOn:!0,videoInputDeviceId:void 0,mediaStreamManager:void 0},e);return new Promise((function(e,n){if(t.logger.debug("Start wtpEnableVideo"),t.state!==$n.STATE_CONNECTED)return n(t.createErrorObject("NotConnected","Call should be CONNECTED to enable video"));if(t.isVideoCall())return n(t.createErrorObject("AlreadyVideoCall","This call is already video call"));var i;if(t.callParams.callType=wt.VIDEO,t.callParams.svckey="call"===t.service?"freecall.video":"groupcall.video",t.videoEnabled=!0,r.customMediaStream)t.logger.debug("enable video option with customMediaStream"),i=r.customMediaStream,t.hasSetCustomMediaStreamWithVideo=!0;else if(r.mediaStreamManager){t.logger.debug("enable video option with mediaStreamManager");var o=r.mediaStreamManager;i=o.getMediaStream(),o.virtualBackground&&(t.wtpRegisterVirtualBackground(o.virtualBackground),t.isVideoModified=o.isVirtualBackgroundActive(),t.isVideoModified&&t.wtpChangeVirtualBackgroundVideoElement(t.localMediaStreamManager.getLocalVideoElement()))}i&&(i.getAudioTracks().forEach((function(e){return e.stop()})),!1===r.cameraOn&&i.getVideoTracks().forEach((function(e){return e.stop()}))),!1===r.cameraOn?r.skipReplaceVideoTrack=!0:r.needCheckSimulcastResolution=!0,t._replaceVideoTrack(r).then((function(){var n={content:[{kind:"video",ctrl:"start"}],contentType:"application/stream-ctrl+json",delegate:{onAccept:function(){!0===r.cameraOn&&!0===t.videoMutedManager.getState()?t.wtpResumeMyVideo({skipReplaceVideoTrack:!0}):!1===r.cameraOn&&(r&&r.onAcceptVideoToggle?r.onAcceptVideoToggle():t.wtpPauseMyVideo())}}};t.sendInfo(n).then((function(){r&&r.onAccept&&r.onAccept(),t.callTypeState=At.AUDIO_TO_VIDEO,t.setupLocalMedia(),t.setupRemoteMedia(),t.setMediaSsrc(),e()}))})).catch((function(e){n(e)}))}))}},{key:"wtpDisableVideo",value:function(){var e=this;return this.logger.debug("Start disable video"),this.state!==$n.STATE_CONNECTED?Promise.reject(this.createErrorObject("NotConnected","Call should be CONNECTED to disable video")):this.isVideoCall()?new Promise((function(t,r){e._waitForMutedComplete(e.videoMutedManager,(function(){e.callParams.callType=wt.AUDIO,e.videoEnabled=!1,e.isVideoModified&&e.wtpStopVirtualBackground(!0);var r=e._getDummyVideoStream().getVideoTracks()[0],n=e.localMediaStreamManager.getLocalMediaStream(),i=e.session.sessionDescriptionHandler.peerConnection.getSenders()[1],o=n.getVideoTracks()[0];if(o&&"video"===o.kind&&(n.removeTrack(o),n.addTrack(r),o.stop(),i.replaceTrack(r),e.hasSetCustomMediaStreamWithVideo=!1),!0===e.videoMutedManager.getState()){var a={"cam-off":!0,"off-reason":kt(Nt.BY_USER),"vid-disabled":!0};e.sendFeatureShare(Lt.CAMERA_STATUS,xt.SET,a)}e.sendInfo({content:[{kind:"video",ctrl:"stop"}],contentType:"application/stream-ctrl+json"}).then((function(){e.callTypeState=At.VIDEO_TO_AUDIO,e.isVideoModified=!1,e.platformAdapter.initLastPauseReason(),e.logger.debug("[wtpDisableVideo] Done send info"),"conference"===e.service&&e.wtpConferenceRemovePeerVideo(e.room.getPeersUserId()),t()}))}))})):Promise.reject(this.createErrorObject("AlreadyAudioCall","This call is already audio call"))}},{key:"wtpMuteMyAudio",value:function(){var e=this;if(!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToMuteMyAudio","MuteMyAudio failed because current call state is not valid"));var t=new Zr(this.audioMutedManager.getState(),(function(e){}),(function(t,r,n){e.logger.debug("wtpMuteMyAudio | Start"),t.state=!0,e.toggleMute(Ct.AUDIO,!1),e.state===$n.STATE_CONNECTED&&e.sendFeatureShare(Lt.MIC_STATUS,xt.SET,{"mic-st":!0}),r()}));return this._changeMediaMuteState(this.audioMutedManager,t)}},{key:"wtpUnmuteMyAudio",value:function(){var e=this;if(!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToUnmuteMyAudio","UnmuteMyAudio failed because current call state is not valid"));this.logger.debug("wtpUnmuteMyAudio | Start");var t=new Zr(this.audioMutedManager.getState(),(function(e){}),(function(t,r,n){t.state=!1,e.toggleMute(Ct.AUDIO,!0),e.state===$n.STATE_CONNECTED&&e.sendFeatureShare(Lt.MIC_STATUS,xt.UNSET),r()}));return this._changeMediaMuteState(this.audioMutedManager,t)}},{key:"wtpPauseMyVideo",value:function(e){var t=this;if(this.callParams.callType!==wt.VIDEO||!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToPauseMyVideo","PauseMyVideo failed because current call state is not valid"));this.logger.debug("wtpPauseMyVideo | Start");var r=new Zr(this.videoMutedManager.getState(),(function(e){}),(function(r,n,i){var o=Object.assign({reasonCode:Mt.PAUSED,plnVideoPauseReason:Nt.BY_USER,isUser:!0},e);o.isUser&&(r.state=!0),t.toggleMute(Ct.VIDEO,!1,o.reasonCode),t._replaceVideoTrack({wtpStream:t._getDummyVideoStream()}).then((function(){if("conference"===t.service&&null!==o.plnVideoPauseReason){var e={"cam-off":!0,"off-reason":kt(o.plnVideoPauseReason)};t.sendFeatureShare(Lt.CAMERA_STATUS,xt.SET,e)}n()})).catch((function(e){i(e)}))}));return this._changeMediaMuteState(this.videoMutedManager,r)}},{key:"wtpResumeMyVideo",value:function(e){var t=this;if(this.callParams.callType!==wt.VIDEO||!this._isValidStateToMute())return Promise.reject(this.createErrorObject("NotValidToResumeMyVideo","ResumeMyVideo failed because current call state is not valid"));this.logger.debug("wtpResumeMyVideo | Start");var r=new Zr(this.videoMutedManager.getState(),(function(e){}),(function(r,n,i){r.state=!1;var o=Object.assign({cameraOn:!0,videoInputDeviceId:void 0,skipReplaceVideoTrack:!!t.hasSetCustomMediaStreamWithVideo},e);t._replaceVideoTrack(o).then((function(){t.sendStreamCtrlInfo(Ct.VIDEO,!0,Mt.NORMAL),"conference"===t.service&&t.sendFeatureShare(Lt.CAMERA_STATUS,xt.UNSET),n()})).catch((function(e){i(e)}))}));return this._changeMediaMuteState(this.videoMutedManager,r)}},{key:"wtpChangeInputAudioDevice",value:(d=xn(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getValidDeviceId(t,"audioinput");case 2:return r=e.sent,e.abrupt("return",this.changeInputDevice("audio",r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"wtpChangeInputVideoDevice",value:function(e){return this.callParams.callType===wt.VIDEO?this.changeInputDevice("video",e):Promise.reject(this.createErrorObject("InvalidCallType","Fail to changeInputVideoDevice because call type is not video"))}},{key:"wtpChangeOutputAudioDevice",value:(l=xn(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getValidDeviceId(t,"audiooutput");case 3:if(r=e.sent,"function"==typeof HTMLMediaElement.prototype.setSinkId){e.next=6;break}throw this.createErrorObject("AudioOutputDeviceChangeNotSupported","This browser does not support changing the audio output device.");case 6:return n="conference"===this.service||this.callParams.callType===wt.AUDIO?this.remoteMediaStreamManager.getRemoteAudioElement():this.remoteMediaStreamManager.getRemoteVideoElement(),e.next=9,n.setSinkId(r);case 9:this.logger.debug("Success, audio output device attached: ".concat(r)),e.next=18;break;case 12:throw e.prev=12,e.t0=e.catch(0),i=e.t0,"SecurityError"===e.t0.name&&(i=this.createErrorObject("SecurityError","You need to use HTTPS for selecting audio output device: ".concat(e.t0))),this.logger.warn("Failed to change audio output device: ".concat(i.message)),i;case 18:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return l.apply(this,arguments)})},{key:"wtpChangeMyView",value:(u=xn(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("wtpChangeMyView | Start"),t){e.next=3;break}throw this.createErrorObject("InvalidElement","Fail to change my view because videoElement is invalid.");case 3:return n=this.localMediaStreamManager.getLocalMediaStream(),i=r?this.localMediaStreamManager.getLocalVideoElement():void 0,t.srcObject=n,t.muted=!0,this.localMediaStreamManager.setLocalVideoElement(t),e.prev=8,e.next=11,t.play();case 11:i&&(i.srcObject=null,i.pause()),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),this.logger.warn("Catch exception localVideoPromise : ".concat(e.t0.message));case 17:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e,t){return u.apply(this,arguments)})},{key:"wtpGetMyMediaStream",value:function(){var e;return null===(e=this.localMediaStreamManager)||void 0===e?void 0:e.getLocalMediaStream()}},{key:"wtpRequestPeerMute",value:function(e,t){var r=this,n=[];e.forEach((function(e){n.push({mid:e,svc_id:r.callParams.toSvcId})}));var i={content:{body_type:".jfs-mic-ctrl",body:{"mic-ct":t},target_ue:n,source:this.callParams.myId,source_svc_id:this.callParams.fromSvcId},contentType:Dt.USER_MESSAGE};this.sendInfo(i)}},{key:"wtpStartMyScreenShare",value:function(e,t){var r=this;if(this.logger.debug("[wtpStartMyScreenShare] start"),!navigator.mediaDevices.getDisplayMedia)return Promise.reject(this.createErrorObject("NotSupportScreenShare","This browser not support screen share"));var n=this.session.sessionDescriptionHandler,i=n.peerConnection,o=this.myScreenShare;return t=this._getConstraints(t),navigator.mediaDevices.getDisplayMedia(t).then(function(){var e=xn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.sdpMutex.acquire();case 2:return e.abrupt("return",Promise.resolve(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var t=xn(regeneratorRuntime.mark((function t(n){var a,s,c,u,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.isCompleteStartMyScreenShare=!1,void 0!==(a=n.getVideoTracks()[0])){t.next=4;break}return t.abrupt("return",Promise.reject(r.createErrorObject("NoVideoTrack","This device unavaliable to get screenShare track")));case 4:if("safari"!==r.browserInfo.browser.toLowerCase()){t.next=17;break}if("window"!==(s=a.getCapabilities()).displaySurface){t.next=17;break}if(r.logger.debug("Safari window screen share capabilities - ".concat(JSON.stringify(s))),c=s.width.max,u=s.height.max,l=[{width:1920,height:1080},{width:1280,height:720},{width:960,height:640},{width:640,height:480},{width:480,height:320}].find((function(e){return e.width<=c&&e.height<=u}))){t.next=14;break}return t.abrupt("return",Promise.reject(r.createErrorObject("OverconstrainedError","The selected screen resolution is too small for screen sharing.")));case 14:return r.logger.debug("Safari screen share adjust resolution - ".concat(JSON.stringify(l))),t.next=17,a.applyConstraints({width:{max:l.width},height:{max:l.height}});case 17:o.videoView=e,r.logger.debug("screenshare state : ".concat(o.state)),t.t0=o.state,t.next=t.t0===Ut.INIT||t.t0===Ut.FAILED?22:t.t0===Ut.STOP?27:30;break;case 22:return d=r.transceiverHandler.getTransceiver(a,"sendonly",[n]),o.transceiver=d,o.sdpMid="mss",o.setState(Ut.START),t.abrupt("break",31);case 27:return o.setState(Ut.RESTART),o.replaceSenderTrack(a),t.abrupt("break",31);case 30:return t.abrupt("return",Promise.reject(r.createErrorObject("NotValidScreenShareState","ScreenShare state is not vaild to start (currentState=".concat(jt(o.state),")"))));case 31:return o.setupMedia(a),o.mediaStream.getVideoTracks()[0].onended=function(){r.wtpStopMyScreenShare().then((function(){return r.emit("screenShareStoppedOnBrowser")})).catch((function(e){"ScreenShareStartNotCompleted"===e.name?r.postponeEventScreenShareStoppedOnBrowser=!0:r.emit("screenShareStoppedOnBrowser")}))},n.getAudioTracks()[0]&&o.setAudioTrack(n.getAudioTracks()[0]),r.logger.debug("[wtpStartMyScreenShare] peerConnection signaling state = ".concat(i.signalingState)),t.abrupt("return",Promise.resolve());case 36:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(){return r._getScreenShareChain(n,o.state)})).then((function(){var e;r.sdpMutex.release();var t={content:{event:1,d_ssrc:r.myScreenShare.dSsrc},contentType:Dt.DATA_CTRL};if(r.sendInfo(t).then((function(){})),o.hadFailed&&(o.mediaStream.getVideoTracks().length&&o.replaceSenderTrack(o.mediaStream.getVideoTracks()[0]),o.hadFailed=!1),o.hasAudioTrack()){var n=r._getMixAudioTrack(o.mediaStream);r._replaceSenderAudioTrack(n)}return null===(e=r.txBitrateManager)||void 0===e||e.activeScreenShare(),r._completeStartMyScreenShare(),Promise.resolve()})).catch((function(e){return r.logger.debug("Fail to wtpStartMyScreenShare"),r._completeStartMyScreenShare(),r.sdpMutex&&r.sdpMutex.release(),Promise.reject(e)}))}},{key:"wtpStopMyScreenShare",value:function(){var e=this;return new Promise((function(t,r){e.startMyScreenShareCompleteReject&&e.startMyScreenShareCompleteReject(e.createErrorObject("ReplacePromise","Replace promise of stopMyScreenShare")),e.startMyScreenShareCompleteResolve=t,e.startMyScreenShareCompleteReject=r,e.isCompleteStartMyScreenShare?t():e.startMyScreenShareCompleteTimeout=setTimeout((function(){e.timeoutStopMyScreenShare=!0,e.logger.debug("Fail to stop my screen share because setting of startMyScreenShare is not completed"),r(e.createErrorObject("ScreenShareStartNotCompleted","Not available to stop screen share right now"))}),3e3)})).then((function(){return e.sdpMutex.acquire().then((function(){return e._activeHD(!0)})).then((function(t){return e.logger.debug("wtpStopMyScreenShare, needUpdate: ".concat(t)),!0===t?e._updateSimulcast().then((function(){var t=e.session.sessionDescriptionHandler,r=t.peerConnection;return t.createLocalOfferOrAnswer().then((function(t){return e.mungeOfferSdp(t)})).then((function(e){return t.setLocalSessionDescription(e)})).then((function(){return e.simulcastHandler.replaceRecvMungeSdp(r.currentRemoteDescription)})).then((function(e){return r.setRemoteDescription(e)})).catch((function(t){return e.logger.debug("Error while set myScreenShare sessionDescription. pc state is ".concat(r.signalingState)),e.logger.debug(t),Promise.reject(e.createErrorObject("SessionDescriptionFail","Fail to set myScreenShare session description"))}))})):Promise.resolve()})).then((function(){return e.sdpMutex.release(),Promise.resolve()}))})).then((function(){var t;e._cleanPromiseStartMyScreenShare(),null===(t=e.txBitrateManager)||void 0===t||t.inactiveScreenShare();var r={content:{event:0,d_ssrc:e.myScreenShare.dSsrc},contentType:Dt.DATA_CTRL};return e.sendInfo(r).then((function(){e.logger.debug("[wtpStopMyScreenShare] start");var t=e.myScreenShare;if(!t.isPlayed())return Promise.reject(e.createErrorObject("ScreenShareNotPlaying","My Screen share is not playing"));var r=e.session.sessionDescriptionHandler;e.logger.debug("[wtpStopMyScreenShare] peerConnection signaling state = ".concat(r.peerConnection.signalingState)),t.cleanupVideo();var n=e.localMediaStreamManager.getLocalMediaStream();return e._replaceSenderAudioTrack(n.getAudioTracks()[0]),e.postponeEventScreenShareStoppedOnBrowser&&(e.postponeEventScreenShareStoppedOnBrowser=void 0,e.emit("screenShareStoppedOnBrowser")),Promise.resolve()}))})).catch((function(t){return e._cleanPromiseStartMyScreenShare(),e.logger.debug("[wtpStopMyScreenShare] fail to stop myScreenShare because of ".concat(t.name)),e.sdpMutex&&e.sdpMutex.release(),Promise.reject(t)}))}},{key:"wtpMuteMyScreenShareAudio",value:function(e){this.logger.debug("wtpMuteMyScreenShareAudio ".concat(e));var t=this.myScreenShare;t.hasAudioTrack()&&t.mediaStream.getAudioTracks().forEach((function(t){t.enabled=e}))}},{key:"wtpChangeMyScreenShareView",value:function(e,t){var r=this;return new Promise((function(n,i){var o=r.myScreenShare;o.isPlayed()?o.changeVideoView(e,t).then((function(){r.logger.debug("My screen share view is changed"),n()})).catch((function(e){r.logger.warn("Fail to change My ScreenShare view"),i(e)})):i(r.createErrorObject("ScreenShareNotPlaying","Change my screen share is failed because not playing"))}))}},{key:"wtpGetPreview",value:function(){var e,t=this.session.sessionDescriptionHandler.peerConnection;return t.getSenders&&(e=new MediaStream,t.getSenders().forEach((function(t){var r=t.track;r&&"video"===r.kind&&e.addTrack(r)}))),e}},{key:"wtpRelease",value:function(){var e=this;this.wtpReleasePromise?this.logger.warn("Wtp Release is already in progress"):this.wtpReleasePromise=new Promise((function(t,r){e.session=void 0,e.logger.debug("release transport"),e.ua&&e.ua.transport&&e.plnRelCode!==ir.WEB_SIGNALING_UNEXPECTED_DISCONNECTED?e.ua.transport.disconnect().then(t()):t()})).then((function(){return e.logger.debug("release ua"),e.ua&&e.ua.userAgentCore&&e.ua.userAgentCore.dispose(),Promise.resolve()})).then((function(){e.logger.debug("release settings"),e.ua=void 0,e.plnRelCode=ir.UNDEFINED,e.releaser=void 0,e.callDir="",e.audioMutedManager=null,e.videoMutedManager=null,e.callTerminate=!1,e.localVideoSsrc=[],e.remoteVideoSsrc=[],e.callParams={},e.wtpReleasePromise=void 0,e.changeState($n.STATE_RELEASED)}))}},{key:"wtpSetCustomMediaStream",value:(c=xn(regeneratorRuntime.mark((function e(t){var r,n,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("Start wtpSetCustomMediaStream"),void 0!==this.session&&void 0!==this.localMediaStreamManager){e.next=3;break}throw this.createErrorObject("InvalidState","Fail to set custom media stream because current call state is invalid.");case 3:if(!this.isVideoModified){e.next=5;break}throw this.createErrorObject("InvalidOperationError","Fail to set custom media stream because a virtual background is active.");case 5:if(r=t.getAudioTracks(),n=t.getVideoTracks(),!(r&&r.length>0)){e.next=15;break}return o=this.myScreenShare.hasAudioTrack()?this._getMixAudioTrack(this.myScreenShare.mediaStream,t):r[0],this.audioMutedManager.getState()&&(o.enabled=!1),e.next=12,this._replaceSenderAudioTrack(o);case 12:this.localMediaStreamManager.replaceLocalMediaStreamTracks("audio",r),null!==(i=this.myTalkingStatusManager)&&void 0!==i&&i.isStarted()&&this.myTalkingStatusManager.restart(),this.hasSetCustomMediaStreamWithAudio=!0;case 15:if(!(n&&n.length>0)){e.next=22;break}if(!this.isVideoCall()){e.next=22;break}if(this.videoMutedManager.getState()){e.next=21;break}return e.next=20,this._replaceSenderVideoTrack(t);case 20:this.localMediaStreamManager.replaceLocalMediaStreamTracks("video",n);case 21:this.hasSetCustomMediaStreamWithVideo=!0;case 22:this.localMediaStreamManager.setupLocalMedia();case 23:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"wtpUnsetCustomMediaStream",value:(s=xn(regeneratorRuntime.mark((function e(){var t,r,n,i,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:if(n=e.sent,i=n.filter((function(e){return"audioinput"===e.kind})),o=n.filter((function(e){return"videoinput"===e.kind})),t=i.length>0?i[0].deviceId:"empty",r=o.length>0?o[0].deviceId:"empty",!this.hasSetCustomMediaStreamWithAudio){e.next=12;break}return this.hasSetCustomMediaStreamWithAudio=!1,e.next=12,this.wtpChangeInputAudioDevice(t);case 12:if(!this.hasSetCustomMediaStreamWithVideo){e.next=21;break}return this.hasSetCustomMediaStreamWithVideo=!1,a=this.localMediaStreamManager.getLocalMediaStream(),s=new MediaStream,a.getTracks().forEach((function(e){"video"!==e.kind?s.addTrack(e):e.stop()})),this.localMediaStreamManager.setLocalMediaStream(s),e.next=20,this.wtpChangeInputVideoDevice(r);case 20:this.localMediaStreamManager.setupLocalMedia();case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),this.logger.debug("Error has occurred doing unsetCustomMediaStream. ".concat(e.t0.message));case 26:case"end":return e.stop()}}),e,this,[[0,23]])}))),function(){return s.apply(this,arguments)})},{key:"wtpHasSetCustomMediaStreamWithAudio",value:function(){return this.hasSetCustomMediaStreamWithAudio}},{key:"wtpHasSetCustomMediaStreamWithVideo",value:function(){return this.hasSetCustomMediaStreamWithVideo}},{key:"wtpGetVersion",value:function(){return Yt}},{key:"wtpGetStats",value:function(){if(void 0===this.pointStatistic){if(!this.session)return this.logger.error("GetStats fail because of no session"),new Promise.reject("no-session");this.pointStatistic=new Kr(this.session)}return this.pointStatistic.getStats()}},{key:"wtpStartMeasureStats",value:function(){if(void 0===this.rangeStatistic){if(!this.session)return;this.rangeStatistic=new jr(this.session)}this.rangeStatistic.start()}},{key:"wtpEndMeasureStats",value:function(){this.rangeStatistic&&this.rangeStatistic.end()}},{key:"wtpGetMeasureStats",value:function(){if(this.rangeStatistic)return this.rangeStatistic.getStats()}},{key:"wtpSendShortData",value:function(e){var t=this,r={content:e,contentType:Dt.USER_MESSAGE};return new Promise((function(e){t.sendInfo(r).then((function(){return e()}))}))}},{key:"wtpSetSharedContents",value:function(e){var t=this;return this.checkValiditySharedContentsData(e).then((function(){return t.sendFeatureShare(Lt.SHARED_CONTENTS,xt.SET,vt(e))}))}},{key:"wtpUnsetSharedContents",value:function(){return this.sendFeatureShare(Lt.SHARED_CONTENTS,xt.UNSET)}},{key:"wtpSetExclusivelySharedContents",value:function(e){var t=this;return this.sharedContentsManager.isProcessingUpdateExclusivelySharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateExclusivelySharedContents","Update exclusively shared contents process is in progress")):"call"!==this.service||this.sharedContentsManager.canChangeExclusivelySharedContents(this.callParams.myId)?new Promise((function(r,n){t.resolveExclusivelySharedContents=r,t.rejectExclusivelySharedContents=n,t.checkValiditySharedContentsData(e).then(xn(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return"call"===t.service&&t.sharedContentsManager.setExclusivelySharedContents(t.callParams.myId),r.next=3,t.sendFeatureShare(Lt.EXCLUSIVELY_SHARED_CONTENTS,xt.SET,vt(e));case 3:t.sharedContentsManager.waitResultUpdateExclusivelySharedContents();case 4:case"end":return r.stop()}}),r)})))).catch((function(e){n(e)}))})):Promise.reject(this.createErrorObject("AlreadySet","Exclusively shared contents is already set"))}},{key:"wtpUnsetExclusivelySharedContents",value:function(){var e=this;return this.sharedContentsManager.isProcessingUpdateExclusivelySharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateExclusivelySharedContents","Update exclusively shared contents process is in progress")):"call"!==this.service||this.sharedContentsManager.canChangeExclusivelySharedContents(this.callParams.myId)?new Promise((function(t,r){e.resolveExclusivelySharedContents=t,e.rejectExclusivelySharedContents=r,e.sendFeatureShare(Lt.EXCLUSIVELY_SHARED_CONTENTS,xt.UNSET).then(xn(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"call"===e.service&&e.sharedContentsManager.unsetExclusivelySharedContents(),t.next=3,e.sendFeatureShare(Lt.EXCLUSIVELY_SHARED_CONTENTS,xt.UNSET);case 3:e.sharedContentsManager.waitResultUpdateExclusivelySharedContents();case 4:case"end":return t.stop()}}),t)})))).catch((function(e){r(e)}))})):Promise.reject(this.createErrorObject("AlreadySet","Peer set exclusively shared contents"))}},{key:"wtpSetVideoMirror",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===this.wtpUtil&&(this.wtpUtil=new _t),this.wtpUtil.setVideoMirror(e,void 0===t?this.localMediaStreamManager.getLocalVideoElement():t)}},{key:"wtpRegisterVirtualBackground",value:(a=xn(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("Register virtual background"),"Safari"!==(r=pt()).browser&&"others"!==r.browser){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("Virtual Background is not supported in this browser.")));case 4:this.virtualBackground=t;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"wtpIsVirtualBackgroundRegistered",value:function(){return void 0!==this.virtualBackground}},{key:"wtpStartVirtualBackgroundBlur",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if(!this.virtualBackground)return Promise.reject(new Error("VirtualBackground is not registered."));if(!this.isVideoCall())return Promise.reject(new Error("Virtual background requires a video call."));if(this.hasSetCustomMediaStreamWithVideo||this.hasSetCustomMediaStreamWithAudio)throw this.createErrorObject("InvalidOperationError","Fail to start a virtual background because custom media stream is set.");this.logger.debug("Start virtual background blur.");var r=e||this.localMediaStreamManager.getLocalCanvasElement();return this.localMediaStreamManager.setLocalCanvasElement(r),this.virtualBackground.startVirtualBackgroundBlur(this.localMediaStreamManager.getLocalVideoElement(),r,t),this.isVideoModified=!0,this._replaceSenderVideoTrack(this.virtualBackground.getVirtualBackgroundVideoStream())}},{key:"wtpStartVirtualBackgroundImage",value:function(e,t){if(!this.virtualBackground)return Promise.reject(new Error("VirtualBackground is not registered."));if(!this.isVideoCall())return Promise.reject(new Error("Virtual background requires a video call."));if(this.hasSetCustomMediaStreamWithVideo||this.hasSetCustomMediaStreamWithAudio)throw this.createErrorObject("InvalidOperationError","Fail to start a virtual background because custom media stream is set.");if(!(t instanceof HTMLImageElement||t instanceof ImageBitmap))return Promise.reject(new Error("Provided object is not an Image instance."));this.logger.debug("Start virtual background image.");var r=e||this.localMediaStreamManager.getLocalCanvasElement();return this.localMediaStreamManager.setLocalCanvasElement(r),this.virtualBackground.startVirtualBackgroundImage(this.localMediaStreamManager.getLocalVideoElement(),r,t),this.isVideoModified=!0,this._replaceSenderVideoTrack(this.virtualBackground.getVirtualBackgroundVideoStream())}},{key:"wtpStopVirtualBackground",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.virtualBackground?this.isVideoModified||this.virtualBackground.isActive()?(this.logger.debug("Stop virtual background."),this.virtualBackground.stopVirtualBackground(),this.isVideoModified=!1,e?Promise.resolve():this._replaceSenderVideoTrack(this.localMediaStreamManager.getLocalMediaStream())):Promise.reject(new Error("No active virtual background to stop.")):Promise.reject(new Error("VirtualBackground is not registered."))}},{key:"wtpGetVirtualBackgroundVideoStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;return this.virtualBackground?this.virtualBackground.getVirtualBackgroundVideoStream(e):void 0}},{key:"wtpChangeVirtualBackgroundVideoElement",value:function(e){return this.virtualBackground?(this.logger.debug("Change video source of virtual background"),this.virtualBackground.changeVideoSource(e),this.wtpChangeMyView(e)):Promise.reject(new Error("VirtualBackground is not registered."))}},{key:"wtpChangeVirtualBackgroundCanvasElement",value:function(e){if(!this.virtualBackground)return Promise.reject(new Error("VirtualBackground is not registered."));this.logger.debug("Change canvas of virtual background");var t=e||this.localMediaStreamManager.getLocalCanvasElement();return this.localMediaStreamManager.setLocalCanvasElement(t),this.virtualBackground.changeOutputCanvas(e),this.isVideoModified?this._replaceSenderVideoTrack(this.virtualBackground.getVirtualBackgroundVideoStream()):Promise.resolve()}},{key:"wtpIsVirtualBackgroundActive",value:function(){return!!this.virtualBackground&&this.virtualBackground.isActive()}},{key:"changeState",value:function(e){this.logger.debug("[WTP_STATE_CHANGE] ".concat(this.state," -> ").concat(e)),this.state=e}},{key:"createErrorObject",value:function(e,t){var r=new Error(t);return r.name=e,r}},{key:"checkValidationCallParams",value:function(e){var t=this,r=function(e){return{isValidCallParams:!1,callParamsError:t.createErrorObject("InvalidCallParams",e)}};if(void 0===e.myId||void 0===e.inviteHeaders)return r("Mandatory field in call param is missing.");if("call"===this.service){if(void 0===e.peerId)return r("A peerId in call param is missing.")}else{if(void 0===e.roomId)return r("A roomId in call param is missing.");if(void 0!==e.customUserType&&!this._validateCustomUserType(e.customUserType))return r("The custom user type is not valid values.")}return{isValidCallParams:!0,callParamsError:null}}},{key:"setCallParams",value:function(e){var t,r,n,i,o;if(this.callParams={myId:e.myId,fromSvcId:e.fromSvcId?e.fromSvcId:void 0,peerId:"call"===this.service?e.peerId:e.roomId,toSvcId:e.toSvcId?e.toSvcId:void 0,callType:e.callType?e.callType:wt.AUDIO,stid:e.stid?e.stid:void 0,cameraOn:!1!==e.cameraOn&&0!==e.cameraOn,micOn:!1!==e.micOn&&0!==e.micOn,svckey:e.svckey?e.svckey:void 0,pauseVideoByPageHidden:!1!==e.pauseVideoByPageHidden&&0!==e.pauseVideoByPageHidden,ignoreDeviceError:!0===e.ignoreDeviceError||1===e.ignoreDeviceError,enableTalkingStatusEvent:!0===e.enableTalkingStatusEvent||1===e.enableTalkingStatusEvent,media:e.media?e.media:{},mediaId:e.mediaId?e.mediaId:void 0,inviteHeaders:e.inviteHeaders,planetKitVersion:e.planetKitVersion?e.planetKitVersion:void 0,displayName:e.displayName?e.displayName:"",maxSendLinkBandwidth:"number"==typeof e.maxSendLinkBandwidth&&e.maxSendLinkBandwidth>0?e.maxSendLinkBandwidth:void 0,maxReceiveLinkBandwidth:"number"==typeof e.maxReceiveLinkBandwidth&&e.maxReceiveLinkBandwidth>0?e.maxReceiveLinkBandwidth:void 0,recordOnCloud:!0===e.recordOnCloud||1===e.recordOnCloud,ringToneUrl:e.ringToneUrl?e.ringToneUrl:void 0,ringbackToneUrl:e.ringbackToneUrl?e.ringbackToneUrl:void 0,endToneUrl:e.endToneUrl?e.endToneUrl:void 0,playEndToneRegardlessOfCallState:!0===e.playEndToneRegardlessOfCallState||1===e.playEndToneRegardlessOfCallState,mediaStreamManager:e.mediaStreamManager?e.mediaStreamManager:void 0,customMediaStream:e.customMediaStream?e.customMediaStream:void 0,customUserType:e.customUserType?e.customUserType:void 0},null!==(t=this.callParams.mediaId)&&void 0!==t&&t.video&&(this.videoInputDeviceId=this.callParams.mediaId.video),this.callParams.customMediaStream&&(this.hasSetCustomMediaStreamWithAudio=(null===(r=this.callParams.customMediaStream)||void 0===r||null===(n=r.getAudioTracks())||void 0===n?void 0:n.length)>0,this.hasSetCustomMediaStreamWithVideo=(null===(i=this.callParams.customMediaStream)||void 0===i||null===(o=i.getVideoTracks())||void 0===o?void 0:o.length)>0),e.mediaStreamManager&&e.mediaStreamManager.virtualBackground){var a,s=e.mediaStreamManager.virtualBackground;this.wtpRegisterVirtualBackground(s),this.isVideoModified=this.wtpIsVirtualBackgroundActive(),null!==(a=this.callParams.media.local)&&void 0!==a&&a.video&&this.wtpChangeVirtualBackgroundVideoElement(this.callParams.media.local.video)}this.printCallParam(this.callParams)}},{key:"printCallParam",value:function(e){this.logger.debug("\n        myId: ".concat(e.myId,"\n        peerId: ").concat(e.peerId,"\n        fromSvcId: ").concat(e.fromSvcId,"\n        toSvcId: ").concat(e.toSvcId,"\n        callType: ").concat(e.callType,"\n        micOn: ").concat(e.micOn,"\n        cameraOn: ").concat(e.cameraOn,"\n        ignoreDeviceError: ").concat(e.ignoreDeviceError,"\n        svckey: ").concat(e.svckey,"\n        enableTalkingStatusEvent: ").concat(e.enableTalkingStatusEvent,"\n        stid: ").concat(e.stid,"\n        pauseVideoByPageHidden: ").concat(e.pauseVideoByPageHidden,"\n        maxSendLinkBandwidth: ").concat(e.maxSendLinkBandwidth,"\n        maxReceiveLinkBandwidth: ").concat(e.maxReceiveLinkBandwidth,"\n        recordOnCloud: ").concat(e.recordOnCloud,"\n        displayName: ").concat(e.displayName,"\n        ringToneUrl: ").concat(e.ringToneUrl,"\n        ringbackToneUrl: ").concat(e.ringbackToneUrl,"\n        endToneUrl: ").concat(e.endToneUrl,"\n        playEndToneRegardlessOfCallState: ").concat(e.playEndToneRegardlessOfCallState,"\n        mediaId: ").concat(e.mediaId?JSON.stringify(e.mediaId):e.mediaId,"\n        media: ").concat(e.media?"set":"undefined","\n        mediaStreamManager: ").concat(e.mediaStreamManager?"set":"undefined","\n        customMediaStream: ").concat(e.customMediaStream?"set":"undefined","\n        customUserType: ").concat(e.customUserType?"set":"undefined"))}},{key:"setPlnExtraInviteHeaders",value:function(e){var t=this.callParams.inviteHeaders,r=JSON.parse(t.commParam),n=[];n.push("X-callType: "+this.callParams.callType),n.push("X-fromZone: "+t.fromZone),n.push("X-voipUdpPort: "+t.voipUdpPort),n.push("X-voipTcpPort: "+t.voipTcpPort),n.push("X-ctm: "+r.ctm),n.push("X-ict: "+r.ict),n.push("X-mpkey: "+r.mpkey),void 0!==this.callParams.svckey&&n.push("X-svckey: "+this.callParams.svckey),void 0!==this.callParams.fromSvcId&&void 0!==this.callParams.toSvcId&&(n.push("X-fromSvcId: "+this.callParams.fromSvcId),n.push("X-toSvcId: "+this.callParams.toSvcId)),this.callParams.allowVerifyOnMultipleWindow||n.push("X-deviceId: "+this._getDeviceId()),e===bt.CONFERENCE?(n.push("X-callDir: "+bt.INITIATOR),n.push("X-toZone: "+t.polarisZone),n.push("X-orion_ip: "+t.orionAddress),n.push("X-mix_ip: "+t.polarisAddress),n.push("X-mix_port: "+t.polarisUdpPort),void 0!==this.callParams.customUserType&&n.push("X-cdu_type: "+this.callParams.customUserType)):(n.push("X-toZone: "+t.toZone),n.push("X-callDir: "+e)),e===bt.INITIATOR||e===bt.CONFERENCE?(n.push("X-voipAddress: "+t.voipAddress),n.push("X-stid: "+(this.callParams.stid?this.callParams.stid:t.stid)),e===bt.INITIATOR?(n.push("X-fromToken: "+t.fromToken),n.push("X-req_rec: "+this.callParams.recordOnCloud)):n.push("X-fromToken: "+t.token)):(n.push("X-sid: "+t.sid),n.push("X-toToken: "+t.callToken),n.push("X-voipAddress: "+t.voipSrv)),null!=t.fakeCall&&n.push("X-fc: "+(t.fakeCall?Bt.TRUE:Bt.FALSE));var i=document.createElement("video"),o=!1;i.canPlayType&&(this.logger.debug(i.canPlayType('video/mp4; codecs="avc1.42E01E"')),o=""!==i.canPlayType('video/mp4; codecs="avc1.42E01E"')),n.push("X-h264_support: "+o),this.browserInfo=pt();var a=[this.browserInfo.browser,this.browserInfo.version,"","",this.callParams.planetKitVersion?"web_"+this.callParams.planetKitVersion:"","wtp_"+Yt,"",""];n.push("X-userAgent: "+a.join(";"));var s=[Ft.WEB,this.callParams.displayName,"",""];n.push("X-userExtraInfo: "+s.join(";"));var c=this.callParams.maxReceiveLinkBandwidth<=Wt.RX?this.callParams.maxReceiveLinkBandwidth:Wt.RX;return n.push("X-rx_link_bw: "+c),n}},{key:"createUa",value:function(e){var t=this,r=Fe.makeURI("sip:"+e+"@"+this.wtpConfig.wtpGwUri);r||this.logger.error("Failed to create URI");var n={uri:r,transportOptions:{traceSip:this.wtpConfig.traceSip,wsServers:"wss://"+this.wtpConfig.wtpGwUri,server:"wss://"+this.wtpConfig.wtpGwUri,keepAliveInterval:60},sessionDescriptionHandlerFactory:function(e,t){var r={iceGatheringTimeout:void 0!==(null==t?void 0:t.iceGatheringTimeout)?null==t?void 0:t.iceGatheringTimeout:5e3,peerConnectionConfiguration:t.peerConnectionConfiguration},n=e.userAgent.getLogger("wtp-SessionDescriptionHandler");return new ct(n,r)},sessionDescriptionHandlerFactoryOptions:{peerConnectionConfiguration:{rtcConfiguration:{iceServers:[]}}},userAgentString:"wtp.js/"+this.wtpGetVersion(),logBuiltinEnabled:this.wtpConfig.builtinEnabled,logLevel:Qt(this.wtpConfig.logLevel),register:!1,delegate:{onDisconnect:function(e){void 0!==e&&(t.logger.debug("ua delegate onDisconnect"),t.onTransportError(e))}}};this.ua=new Fe(n)}},{key:"createInviteSession",value:function(e,t){var r=this;this.logger.debug("Start createInviteSession");var n=Fe.makeURI("sip:"+(this.callDir===bt.RESPONDER?this.callParams.myId:this.callParams.peerId)+"@"+this.wtpConfig.wtpGwUri),i={extraHeaders:e};this.session=new Be(this.ua,n,i),this.session.stateChange.addListener((function(e){switch(r.logger.debug("session state change : ".concat(e)),e){case Re.Initial:case Re.Establishing:case Re.Established:break;case Re.Terminated:r.callTerminate&&(r.callTerminate=!1,r.onEnded())}})),this.session.delegate={onAck:function(e){r.logger.debug("wtp SessionDelegate onAck"),r.logger.debug(e)},onInfo:function(e){r.logger.debug("wtp SessionDelegate onInfo");var n=e.incomingInfoRequest,i={message:n.message,delegate:t&&t.delegate?t.delegate:void 0};n.accept(),r.onDialogInfo(i)},onBye:function(e){r.logger.debug("wtp session delegate bye"),r.onBye(e.incomingByeRequest.message)},onSessionDescriptionHandler:function(e,n){r.logger.debug("onSessionDescriptionHandler"),t&&t.peerConnectionDelegate&&(r.session.sessionDescriptionHandler.peerConnectionDelegate=t.peerConnectionDelegate),e.on("sdhconnection-disconnected",(function(){(r.state!==$n.STATE_CONNECTED||r.callTypeState<At.VIDEO_TO_AUDIO)&&void 0===r.sdhconnectionTimer&&(r.sdhconnectionTimer=setTimeout((function(){r.logger.debug("wtp SessionDescriptionHandler disconnected - timeout"),r.releaser=Ot.THIS,r.plnRelCode=ir.CALL_CONNECT_FAIL_BY_CLIENT,r.endBeforeBye=!0,e.close(),r.onFailed()}),3e4))})),e.on("sdhconnection-connected",(function(){void 0!==r.sdhconnectionTimer&&(clearTimeout(r.sdhconnectionTimer),r.sdhconnectionTimer=void 0),r._isTestCall()&&void 0===r.testCallResult.timestamp.connected&&(r.logger.debug("set TestCall init stats"),r.testCallResult.timestamp.connected=Date.now(),r.wtpGetStats().then((function(e){return r.startStats=e})))})),e.on("sdhconnection-failed",(function(){r.logger.debug("sdhconnection state is changed to failed"),r.releaser=Ot.THIS,r.plnRelCode=!1===navigator.onLine?ir.NETWORK_UNREACHABLE:ir.UNKNOWN_ERROR,r.endBeforeBye=!0,e.close(),r.onFailed()})),e.on("failToGetMedia",(function(e){r.emit("debugNotice",kn(e.name,e.message))}))}}}},{key:"sendInvite",value:function(e){var t=this;if(!this.session)throw new Error("No session to sendInvtie");this.logger.debug("Start sendInvite");var r={onAccept:function(e){t.logger.debug("wtp iniviteDelegate: onAccept"),t.onAccepted()},onProgress:function(e){t.logger.debug("wtp iniviteDelegate: onProgress"),t.onProgress(e)},onRedirect:function(e){t.logger.debug("wtp iniviteDelegate: onRedirect")},onReject:function(e){t.logger.debug("wtp iniviteDelegate: onReject"),t.onRejected(e.message)},onTrying:function(e){}};e.inviteDelegate&&Object.assign(r,e.inviteDelegate);var n={requestDelegate:r,requestOptions:e.requestOptions?e.requestOptions:{},sessionDescriptionHandlerOptions:e.sdhOptions?e.sdhOptions:{constraints:this.getConstraints()},sessionDescriptionHandlerModifiers:e.sdpModifier?e.sdpModifier:[]};return this.session.invite(n).then((function(){t.logger.debug("Succesfully INVITE is sent")})).catch((function(e){return t.logger.debug("Failed INVITE"),Promise.reject(e)}))}},{key:"sendInfo",value:function(e){var t={requestDelegate:{onAccept:function(t){e.delegate&&e.delegate.onAccept&&e.delegate.onAccept()},onProgress:function(e){}},requestOptions:{body:{contentDisposition:"render",contentType:e.contentType,content:JSON.stringify(e.content)}}};return this.session.info(t)}},{key:"sendStreamCtrlInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e===Ct.VIDEO&&this.platformAdapter.needSendVideoReason(r)&&this.state===$n.STATE_CONNECTED){var n=[],i=this.platformAdapter.getVideoPauseReason(r);this.localVideoSsrc.forEach((function(r){n.push({kind:e,ssrc:parseInt(r).toString(16),ctrl:t?"resume":"pause",reason:i})}));var o={content:n,contentType:"application/stream-ctrl+json"};this.sendInfo(o)}}},{key:"getConstraints",value:function(){var e,t;if(this.callParams.callType==wt.AUDIO)t=!1;else{var r,n=this.simulcastHandler&&!1===this.simulcastHandler.isHDSupported?Ht.VGA_WIDTH:Ht.WIDTH,i=this.simulcastHandler&&!1===this.simulcastHandler.isHDSupported?Ht.VGA_HEIGHT:Ht.HEIGHT;t=null!==(r=this.callParams.mediaId)&&void 0!==r&&r.video?{deviceId:{exact:this.callParams.mediaId.video},width:n,height:i}:{width:n,height:i}}var o={audio:null===(e=this.callParams.mediaId)||void 0===e||!e.audio||{deviceId:{exact:this.callParams.mediaId.audio}},video:t};return this.logger.debug("Constraints = "+JSON.stringify(o)),o}},{key:"setupLocalMedia",value:function(){this.logger.debug("Start setupLocalMedia"),this.session?this.callParams.callType===wt.VIDEO&&this.localMediaStreamManager.setupLocalMedia():this.logger.warn("No ession to set local media on")}},{key:"setupRemoteMedia",value:function(){var e=this;if(this.logger.debug("Start setupRemoteMedia"),this.session){var t=this.remoteMediaStreamManager.getRemoteMediaStream(),r=function(r){r&&(r.srcObject=t,r.play().then((function(){e.logger.log("play media")})).catch((function(t){e.logger.debug("Fail to play : ".concat(t.message))})),r.onaddtrack=function(t){e.logger.debug("Stream onaddtrack handler"),r.play().then((function(){e.logger.log("play media")})).catch((function(t){e.logger.debug("Fail to play : ".concat(t.message))}))})};"conference"===this.service||this.callParams.callType===wt.VIDEO&&r(this.remoteMediaStreamManager.getRemoteVideoElement()),r(this.remoteMediaStreamManager.getRemoteAudioElement())}else this.logger.warn("No session to set remote media on")}},{key:"toggleMute",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.session){this.sendStreamCtrlInfo(e,t,r);var n,i,o=this.localMediaStreamManager.getLocalMediaStream(),a=this.session.sessionDescriptionHandler.peerConnection.getSenders();o&&(e===Ct.AUDIO?(n=o.getAudioTracks()[0],this.myScreenShare.hasAudioTrack()||(i=a[0].track)):(n=o.getVideoTracks()[0],i=a[1].track),n&&(e===Ct.AUDIO?n.enabled=t:n.stop()),i&&(i.enabled=t))}else this.logger.warn("Fail to toggle mute because no session")}},{key:"changeInputDevice",value:function(e,t){var r,n,i=this;if(null===(r=this.session)||void 0===r||!r.sessionDescriptionHandler)return Promise.reject(this.createErrorObject("InvailidCallState","Fail to changeInputDevice because invalid call state."));if(!t||"null"===t.toLowerCase())return Promise.reject(this.createErrorObject("InvalidDeviceId","Fail to changeInputDevice because invalid deviceid(".concat(t,").")));if(this.callParams.pauseVideoByPageHidden&&document[er()])return"video"===e&&(this.videoInputDeviceId=t),Promise.resolve();var o=this.session.sessionDescriptionHandler.peerConnection;return o.getSenders?new Promise((function(r,n){if("empty"===t)if("audio"===e){var o=new AudioContext,a=o.createOscillator(),s=o.createGain();a.connect(s),s.gain.value=0;var c=s.connect(o.createMediaStreamDestination());a.start(),r(new MediaStream(c.stream.getAudioTracks()))}else r(i._getDummyVideoStream());else r("audio"===e?navigator.mediaDevices.getUserMedia({audio:{deviceId:t?{exact:t}:void 0},video:void 0}):i.videoMutedManager.getState()?i._getDummyVideoStream():navigator.mediaDevices.getUserMedia({audio:void 0,video:{width:i.isHDRestricted?Ht.VGA_WIDTH:Ht.WIDTH,height:i.isHDRestricted?Ht.VGA_HEIGHT:Ht.HEIGHT,deviceId:t?{exact:t}:void 0}}))})).then((function(r){var a;if(n=r,"audio"===e?(a=r.getAudioTracks()[0],i.audioMutedManager.getState()&&(a.enabled=!1),i.hasSetCustomMediaStreamWithAudio=!1):"video"===e&&(i.videoInputDeviceId=t,a=r.getVideoTracks()[0],i.hasSetCustomMediaStreamWithVideo=!1),a){var s,c,u=i.localMediaStreamManager.getLocalMediaStream();if("audio"===e?(s=o.getSenders()[0],c=u.getAudioTracks()[0]):(s=o.getSenders()[1],c=u.getVideoTracks()[0],"conference"===i.service&&(i.logger.debug("changeInputDevice - change video resolution"),i.logger.debug(JSON.stringify(a.getSettings())),i._changeSimulcastResolution(a).catch((function(e){return i.logger.debug("changeInputDevice - fail to change simulcast resolution because ".concat(e.message))})))),u.addTrack(a),("audio"===e||"video"===e&&!0!==i.isVideoModified)&&s.replaceTrack(a),c&&(u.removeTrack(c),c.stop()),"audio"===e){var l;if(i.myScreenShare.hasAudioTrack()){var d=i._getMixAudioTrack(i.myScreenShare.mediaStream);i._replaceSenderAudioTrack(d)}null!==(l=i.myTalkingStatusManager)&&void 0!==l&&l.isStarted()&&i.myTalkingStatusManager.restart()}}})).catch((function(e){return n&&n.getTracks().forEach((function(e){return e.stop()})),Promise.reject(e)})):Promise.reject(this.createErrorObject("FailToChangeInputDevice","Fail to changeInputDevice"))}},{key:"cleanupMedia",value:function(){this.localMediaStreamManager&&(this.localMediaStreamManager.release(),this.localMediaStreamManager=void 0),this.remoteMediaStreamManager&&(this.remoteMediaStreamManager.release(),this.remoteMediaStreamManager=void 0),this._clearDummyVideoStream(),this.myScreenShare.isPlayed()&&this.myScreenShare.cleanupVideo()}},{key:"cleanupWtp",value:function(){var e,t,r,n;null===(e=this.myTalkingStatusManager)||void 0===e||e.stop(),null===(t=this.peerTalkingStatusManager)||void 0===t||t.stop(),null===(r=this.peersTalkingStatusManager)||void 0===r||r.stop(),null===(n=this.txBitrateManager)||void 0===n||n.stop(),this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.release(),void 0!==this.sdhconnectionTimer&&(clearTimeout(this.sdhconnectionTimer),this.sdhconnectionTimer=void 0),this.toneSoundManager.release(),this.virtualBackground&&this.virtualBackground.release()}},{key:"setMediaSsrc",value:function(){if(this.session){var e=this.session.sessionDescriptionHandler.peerConnection.currentLocalDescription.sdp.split("m=video")[1];e&&(this.localVideoSsrc=function(e){var t=new RegExp("^a=ssrc-group:.[a-zA-Z]+ (.*$)","m"),r=e.match(t);if(!r)return[0];if(2===r.length&&r[1])return r[1].split(" ");t=new RegExp("^a=ssrc:\\d+ cname.*$","gm"),r=e.match(t);var n=[];return r.forEach((function(e){n.push(e.match("^a=ssrc:(\\d+)")[1])})),n}(e))}else this.logger.error("setMediaSsrc - No session")}},{key:"sendFeatureShare",value:function(e,t,r){var n={content:{feature_id:e,info:[{src_mid:this.callParams.myId,src_svc_id:this.callParams.fromSvcId,set:t}]},contentType:Dt.FEATURE_SHARE};return t===xt.SET&&(n.content.info[0].data=r),this.sendInfo(n)}},{key:"sendFeatureQuery",value:function(e,t){var r={content:{feature_id:e,info:[{src_mid:t,src_svc_id:this.callParams.toSvcId}]},contentType:Dt.FEATURE_QUERY};this.sendInfo(r)}},{key:"checkPermission",value:(o=xn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia(t);case 3:return e.sent.stop(),e.abrupt("return",{permission:!0});case 8:if(e.prev=8,e.t0=e.catch(0),"NotAllowedError"!==e.t0.name){e.next=14;break}return e.abrupt("return",{permission:!1,reason:"NotAllowedError"});case 14:if("NotFoundError"!==e.t0.name){e.next=18;break}return e.abrupt("return",{permission:!1,reason:"NotFoundError"});case 18:return e.abrupt("return",{permission:!1,reason:"others"});case 19:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(e){return o.apply(this,arguments)})},{key:"mungeOfferSdp",value:function(e,t){this.logger.debug("[mungeOfferSdp] start");var r="";e.sdp.split(/(^m=video.*$)/m).forEach((function(e,t){t<=2?r+=e:e.startsWith("m=video")?r+=e.replace(/m=video \d*/,"m=video 9"):r+=e.replace(/c=IN IP4 \d*.\d*.\d*.\d*/,"c=IN IP4 0.0.0.0")}));var n,i=new RegExp("a=group:BUNDLE 0","m");if(r=r.replace(i,"a=group:BUNDLE"),t)switch(t.type){case"screenshare":this.logger.debug("[mungeOfferSdp] screen share"),i=new RegExp("(a=group:BUNDLE[ \\w\\d]*) ([\\w\\d]*)","m");var o=r.match(i)[2].trim();if(r=r.replace(i,"$1 "+t.sdpMid),this.bundleLine+=" "+t.sdpMid,i=new RegExp("a=mid:"+o,"m"),r=r.replace(i,"a=mid:".concat(t.sdpMid)),t.ssrc){i=new RegExp("(a=mid:".concat(t.sdpMid,")"),"m");var a=(n=r.split(i))[2].match(/a=ssrc-group:FID (\d*)/)[1],s=parseInt(t.ssrc,16);i=new RegExp("a=ssrc:".concat(a),"gm"),n[2]=n[2].replace(/a=ssrc-group:FID (\d*)/,"a=ssrc-group:FID "+s),n[2]=n[2].replace(i,"a=ssrc:".concat(s)),r=n.join("")}break;case"inactive":this.logger.debug("[mungeOfferSdp] direction inactive"),i=new RegExp("(a=mid:".concat(t.sdpMid,")"),"m"),(n=r.split(i))[2]=n[2].replace("a=".concat(t.direction),"a=inactive"),r=n.join("");break;case"active":this.logger.debug("[mungeOfferSdp] direction active"),i=new RegExp("(a=mid:".concat(t.sdpMid,")"),"m"),(n=r.split(i))[2]=n[2].replace("a=inactive","a=".concat(t.direction)),r=n.join("")}return this.logger.debug("Munge Offer SDP"),this.logger.debug(r),Promise.resolve({sdp:r,type:e.type})}},{key:"addVideoMungeAnswerSdp",value:function(e){this.logger.debug("[addVideoMungeAnswerSdp] start");var t=this.session.sessionDescriptionHandler.peerConnection.currentRemoteDescription.sdp,r=t.split("m=video")[1],n=t.split(/^a=group:BUNDLE.*$/m);t=n[0]+"a=group:BUNDLE "+this.bundleLine+n[1];var i=new RegExp("^a=msid-semantic: WMS (.*)","m"),o=t.match(i)[1];i=new RegExp("^a=ssrc:\\d+ cname:(.*)","m");var a=t.match(i)[1];i=new RegExp("^a=ice-ufrag:.*$","m");var s=r.match(i)[0]+"\n";i=new RegExp("^a=ice-pwd:.*$","m");var c=r.match(i)[0]+"\n";i=new RegExp("^a=fingerprint:sha-256 .*$","m");var u=r.match(i)[0]+"\n";i=new RegExp("^a=extmap:.*$","gm");var l="";r.match(i).forEach((function(e){l+=e+"\n"})),i=new RegExp("a=rtpmap:(\\d+) VP8");var d,h=r.match(i)[1],p="",f=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Dn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dn(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(e);try{for(f.s();!(d=f.n()).done;){var g=d.value;p+="m=video 9 UDP/TLS/RTP/SAVPF ".concat(h,"\n"),p+="c=IN IP4 0.0.0.0\n",void 0!==g.bandwidth&&(p+="b=AS:".concat(g.bandwidth,"\n")),p+="a=rtcp:9 IN IP4 0.0.0.0\n",p+=s,p+=c,p+=u,p+="a=setup:active\n",p+="a=mid:".concat(g.sdpMid,"\n"),p+=l,p+="a=".concat(g.direction,"\n"),p+="a=rtcp-mux\n",p+="a=rtcp-rsize\n",p+="a=rtpmap:".concat(h," VP8/90000\n"),p+="a=rtcp-fb:".concat(h," nack\n"),p+="a=rtcp-fb:".concat(h," nack pli\n"),p+="a=ssrc:"+parseInt(g.ssrc,16)+" cname:"+a+"\n",p+="a=ssrc:"+parseInt(g.ssrc,16)+" msid:"+o+" v".concat(g.sdpMid,"\n"),p+="a=ssrc:"+parseInt(g.ssrc,16)+" mslabel:"+o+"\n",p+="a=ssrc:"+parseInt(g.ssrc,16)+" label:"+" v".concat(g.sdpMid,"\n")}}catch(e){f.e(e)}finally{f.f()}return this.logger.debug("[addVideoMungeAnswerSdp] Answer munging result"),this.logger.debug(t+p),Promise.resolve({sdp:t+p,type:"answer"})}},{key:"changeVideoDirectionMungeAnswerSdp",value:function(e,t,r){this.logger.debug("[changeVideoDirectionMungeAnswerSdp] start ".concat(t," -> ").concat(r));var n=this.session.sessionDescriptionHandler.peerConnection.currentRemoteDescription.sdp,i=new RegExp("(a=mid:".concat(e,")"),"m"),o=n.split(i);return o[2]=o[2].replace("a=".concat(t),"a=".concat(r)),n=o.join(""),this.logger.debug(n),Promise.resolve({sdp:n,type:"answer"})}},{key:"checkValiditySharedContentsData",value:function(e){var t=this;return new Promise((function(r,n){e instanceof Uint8Array||n(t.createErrorObject("WrongDataType","data type should be Uint8Array")),e.length>1e3&&n(t.createErrorObject("ExceedMaxSizeData","Data size must not exceed 1 kilobyte")),r()}))}},{key:"isVideoCall",value:function(){return this.callTypeState>1}},{key:"onProgress",value:function(e){var t=this;this.logger.debug("Start onProgress"),this.changeState($n.STATE_CONNECTING),this.callDir==bt.INITIATOR&&(this.toneSoundManager.playRingbackTone().catch((function(e){"NotAllowedError"===e.name?t.emit("debugNotice",kn(Nn.TONE_SOUND_RINGBACK_TONE_PLAY_NOT_ALLOWED)):t.emit("debugNotice",kn(Nn.TONE_SOUND_RINGBACK_TONE_PLAY_FAILED))})),this.emit("connecting",this.session))}},{key:"onAccepted",value:function(){var e=this;if(this.logger.debug("Start onAccepted"),this.callDir===bt.RESPONDER&&this.state===$n.STATE_CONNECTING)this.changeState($n.STATE_VERIFIED),this.toneSoundManager.playRingTone().catch((function(t){"NotAllowedError"===t.name?e.emit("debugNotice",kn(Nn.TONE_SOUND_RING_TONE_PLAY_NOT_ALLOWED)):e.emit("debugNotice",kn(Nn.TONE_SOUND_RING_TONE_PLAY_FAILED))})),this.emit("ringing",this.callParams);else if(this.state===$n.STATE_CONNECTED);else{var t,r;this.changeState($n.STATE_CONNECTED),this.hasConnected=!0,this.setupLocalMedia(),this.setupRemoteMedia(),this.setMediaSsrc(),this.callParams.pauseVideoByPageHidden&&this._webVisibilityChangeEvent(),this._webBeforeUnloadEvent(),null===(t=this.myTalkingStatusManager)||void 0===t||t.start({target:"my",callback:function(t){e.emit("myTalkingStatusUpdated",t)}}),null===(r=this.txBitrateManager)||void 0===r||r.start(),this.toneSoundManager.pauseRingbackTone(),this.emit("connected",this.session)}}},{key:"onRejected",value:function(e){this.logger.debug("Start onRejected"),this.plnRelCode!==ir.CANCEL&&this._parsePReason(e),this.onEnded("Unsuccessful final message")}},{key:"onBye",value:function(e){this.logger.debug("Start onBye"),this.endBeforeBye||(this.changeState($n.STATE_DISCONNECTED),e.extraHeaders||this._parsePReason(e),this.onEnded("End call by 'BYE'"))}},{key:"onUaStartFailed",value:function(e){this.logger.error("UserAgent start failed - ".concat(e.message)),this.releaser=Ot.THIS,this.plnRelCode=ir.CALL_CONNECT_FAIL_BY_SERVER,this.onFailed()}},{key:"onFailed",value:function(){this.logger.debug("Start onFailed"),this.callDir==bt.INITIATOR&&this.state===$n.STATE_CONNECTING&&this.session.cancel(),this.emit("failed"),this.onEnded("Ended by fail")}},{key:"onEnded",value:(i=xn(regeneratorRuntime.mark((function e(){var t,r,n,i=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>0&&void 0!==o[0]?o[0]:null,this.logger.debug("Start onEnded - ".concat(r)),this.wtpConfig.logLevel!==$t.DEBUG||!this.session){e.next=5;break}return e.next=5,this.wtpGetStats().then((function(e){return i.logger.debug("end statistics - ".concat(JSON.stringify(e)))})).catch((function(e){return i.logger.debug("end statistics fail because ".concat(e.message))}));case 5:if("testcall"!==this.service||void 0!==this.testCallDuration){e.next=8;break}return e.next=8,this._makeTestCallResult();case 8:this.toneSoundManager.pauseRingTone(),this.toneSoundManager.pauseRingbackTone(),this.toneSoundManager.playEndTone().catch((function(e){"NotAllowedError"===e.name?i.emit("debugNotice",kn(Nn.TONE_SOUND_END_TONE_PLAY_NOT_ALLOWED)):i.emit("debugNotice",kn(Nn.TONE_SOUND_END_TONE_PLAY_FAILED))})),this.cleanupMedia(),this.cleanupWtp(),this.changeState($n.STATE_RELEASED),n=rr(this.releaser,this.plnRelCode),this.callParams&&null!==(t=this.callParams.inviteHeaders)&&void 0!==t&&t.fakeCall&&("AMP_TERM_CALL_THIS"===n.strCode?n={code:tr.AMP_TERM_CALL_THIS_FCALL,strCode:"AMP_TERM_CALL_THIS_FCALL"}:"AMP_TERM_CALL_PEER_NO_RESPONSE"===n.strCode&&(n={code:tr.AMP_TERM_CALL_PEER_FCALL_NO_RESPONSE,strCode:"AMP_TERM_CALL_PEER_FCALL_NO_RESPONSE"})),"testcall"!==this.service?this.emit("ended",{ampTermCode:n,plnRelCode:or(this.plnRelCode),releaser:this.releaser}):(this.testCallResult.ampTermCode=n,this.testCallResult.plnRelCode=or(this.plnRelCode),this.emit("ended",this.testCallResult));case 17:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"onDialogInfo",value:function(e){var t,r,n,i=this;e.message.headers&&e.message.headers["Content-Type"]&&e.message.headers["Content-Type"][0]&&e.message.headers["Content-Type"][0].parsed&&(n=e.message.headers["Content-Type"][0].parsed);var o=JSON.parse(e.message.body);switch(n){case Dt.STREAM_CTRL:o.forEach((function(e){"video"===e.kind&&("pause"==e.ctrl?i.emit("peerVideoPause",e.reason):"resume"==e.ctrl?i.emit("peerVideoResume",e.reason):"video"==e.kind&&"start"==e.ctrl?i.videoEnabled||i.emit("switchAudioToVideo"):"video"==e.kind&&"stop"==e.ctrl&&(i.wtpDisableVideo(),i.emit("switchVideoToAudio")))}));break;case Dt.USER_INFO:e.delegate.onUserInfo(o);break;case Dt.NOTIFY_USER_STATUS:e.delegate.onNotifyUserStatus(o);break;case Dt.REQUEST_USER_VIEW:o.forEach((function(t){t.mid===i.callParams.myId&&e.delegate.onRequestUserView(t)}));break;case Dt.FEATURE_SHARE:e.delegate&&e.delegate.onFeatureShare&&e.delegate.onFeatureShare(o);break;case Dt.FEATURE_SHARE_RESULT:e.delegate&&e.delegate.onFeatureShareResult&&e.delegate.onFeatureShareResult(o);break;case Dt.USER_MESSAGE:if(o.body_type&&".jfs-mic-ctrl"===o.body_type)if("call"===this.service)this.emit("muteRequested",o.body["mic-ct"]);else{var a=this.room.getPeer(o.source);void 0!==a&&this.emit("muteRequested",a.getPeerInfo(),o.body["mic-ct"])}else"call"===this.service?this.emit("shortDataReceived",o.body_type,gt(o.body)):this.emit("shortDataReceived",o.source,o.body_type,gt(o.body));break;case Dt.DATA_INFO:var s;this.myScreenShare.dSsrc=o.d_ssrc,o.rx_link_bw&&(null===(s=this.txBitrateManager)||void 0===s||s.resetMaxSendLinkBandwidth(o.rx_link_bw)),this.audioMutedManager.init(),this.videoMutedManager.init();break;case Dt.DATA_CTRL:e.delegate&&e.delegate.onDataCtrl&&e.delegate.onDataCtrl(o);break;case Dt.APPLICATION_CONTROL:null!==(t=e.delegate)&&void 0!==t&&t.onApplicationControl&&e.delegate.onApplicationControl(o);break;case Dt.RECORDING_STATUS:null!==(r=e.delegate)&&void 0!==r&&r.onRecordingStatus&&e.delegate.onRecordingStatus(o);break;default:this.logger.warn("Invalid Content-Type of INFO : ".concat(n))}}},{key:"onLocalMediaStreamManagerInitError",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(this.logger.debug("onLocalMediaStreamManagerInitError"),this.releaser=Ot.THIS,this.endBeforeBye=!0,e.name){case"AbortError":this.plnRelCode=ir.ABORT;break;case"NotAllowedError":this.plnRelCode=ir.NOT_ALLOWED;break;case"NotFoundError":this.plnRelCode=ir.NOT_FOUND;break;case"NotReadableError":this.plnRelCode=ir.NOT_READABLE;break;case"OverconstrainedError":this.plnRelCode=ir.OVERCONSTRAINED;break;case"SecurityError":this.plnRelCode=ir.SECURITY_ERROR;break;case"TypeError":this.plnRelCode=ir.TYPE_ERROR;break;default:this.plnRelCode=ir.UNKNOWN_ERROR}this.changeState($n.STATE_DISCONNECTED),t&&this.onEnded("INVITE Fail")}},{key:"onTransportError",value:function(e){this.logger.debug("onTransportError"),this.logger.error(e),this.state===$n.STATE_CONNECTED&&(this.releaser=Ot.THIS,this.plnRelCode=ir.WEB_SIGNALING_UNEXPECTED_DISCONNECTED,this.endBeforeBye=!0,this.changeState($n.STATE_DISCONNECTED),this.onEnded("Transport error"))}},{key:"setInitMediaState",value:function(e){this.logger.debug("setInitMediaState, cameraOn: ".concat(this.callParams.cameraOn,", micOn: ").concat(this.callParams.micOn)),this.videoMutedManager.setMediaState(new Zr(this.callParams.cameraOn,e.videoMuteCallback,(function(e){}))),this.audioMutedManager.setMediaState(new Zr(this.callParams.micOn,e.audioMuteCallback,(function(e){})))}},{key:"_waitForMutedComplete",value:function(e,t){var r=this;void 0!==t&&setTimeout((function(){0==e.isActivate()?t():r._waitForMutedComplete(e,t)}),200)}},{key:"_changeMediaMuteState",value:function(e,t){var r=this;return e.setMediaState(t).then((function(){var t=null;if(0==e.isActivate())t=e.activate();else{var n=e.getStandbyMediaState();null!==n&&e.releseStandbyMediaState(),e.setStandby(),n=new Promise((function(t,n){!function i(){setTimeout((function(){1==e.isStandby()?i():0==e.isActivate()?e.activate().then((function(){t()})).catch((function(e){n(e)})):n(r.createErrorObject("PreviousVideoMuteNotComplete","The previous operation of video mute is not completed"))}),10)}()})),e.setStandbyMediaState(n),t=n}return t}))}},{key:"_getScreenShareChain",value:function(e,t){var r=this,n=e.peerConnection,i=this.myScreenShare,o=Promise.resolve();return t!==Ut.START&&t!==Ut.RESTART||(o=this._activeHD(!1).then((function(e){return 1==e?r._updateSimulcast():Promise.resolve()})).then((function(){return e.createLocalOfferOrAnswer().then((function(e){var n=void 0;return t===Ut.START&&((n={sdpMid:i.sdpMid}).type="screenshare",n.ssrc=i.dSsrc),r.mungeOfferSdp(e,n)})).then((function(t){return e.setLocalSessionDescription(t)})).then((function(){return t===Ut.START?r.addVideoMungeAnswerSdp([{direction:"recvonly",ssrc:i.dSsrc,sdpMid:i.sdpMid,bandwidth:1200}]):Promise.resolve(n.currentRemoteDescription)})).then((function(e){return void 0!==r.simulcastHandler?r.simulcastHandler.replaceRecvMungeSdp(e):Promise.resolve(e)})).then((function(e){return n.setRemoteDescription(e)})).catch(function(){var t=xn(regeneratorRuntime.mark((function t(o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.logger.debug("Error while set myScreenShare sessionDescription. pc state is ".concat(n.signalingState)),r.logger.debug(o),"have-local-offer"!==n.signalingState){t.next=8;break}return r.transceiverHandler.addSpareTransceiver(i.transceiver),r.bundleLine=r.bundleLine.replace(" mss",""),i.failedSetupVideo(),t.next=8,e.rollbackLocalSessionDescription();case 8:return t.abrupt("return",Promise.reject(r.createErrorObject("SessionDescriptionFail","Fail to set myScreenShare session description")));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))),o}},{key:"_activeHD",value:function(e){var t=this;return new Promise((function(r,n){var i=t.localMediaStreamManager.getLocalMediaStream();if(void 0!==t.simulcastHandler){var o=null;i.getVideoTracks().length>0&&null!=(o=i.getVideoTracks()[0])&&t.simulcastHandler.updateTrack(o),t.simulcastHandler.activeHD=e,r(t.simulcastHandler.isHDSupported)}else r(!1)}))}},{key:"_updateSimulcast",value:function(){var e=this;return new Promise((function(t,r){var n=e.session.sessionDescriptionHandler.peerConnection;if(null!=n){var i=n.getSenders()[1];if(null!=i){var o=i.getParameters();o.encodings.forEach((function(t){e.simulcastHandler.updateSenderEncoding(t)})),i.setParameters(o),t()}else r()}else r()}))}},{key:"_parsePReason",value:function(e){this.logger.debug(e);var t=e.headers["P-Reason"];if(t&&t[0]){var r=t[0].raw.split(";");this.plnRelCode=Number(r[0]),this.releaser=this._getAmpReleaser(r[2])}else this.logger.log("P-Reason is not exist in message"),this.plnRelCode=ir.UNDEFINED,this.releaser=void 0}},{key:"_getAmpReleaser",value:function(e){switch(e){case"initiator":return this.callDir==bt.INITIATOR?Ot.THIS:Ot.PEER;case"responder":return this.callDir==bt.INITIATOR?Ot.PEER:Ot.THIS;default:return Ot.OTHERS}}},{key:"_isTestCall",value:function(){return"testcall"===this.service}},{key:"_isValidStateToMute",value:function(){if(this.callDir===bt.INITIATOR){if(this.state===$n.STATE_INIT||this.state===$n.STATE_READY)return this.logger.warn("Mute fail because STATE is not valid"),!1}else if(this.state!==$n.STATE_CONNECTED)return this.logger.warn("Mute fail because STATE is not valid"),!1;return!0}},{key:"_replaceVideoTrack",value:function(e){var t=this;if(!0===e.skipReplaceVideoTrack)return Promise.resolve();var r=function(){var r=xn(regeneratorRuntime.mark((function r(){var n,i,o,a,s,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.customMediaStream?n=null===(i=e.customMediaStream.getVideoTracks()[0])||void 0===i||null===(o=i.getCapabilities())||void 0===o?void 0:o.deviceId:e.mediaStreamManager?(a=e.mediaStreamManager,n=a.getVideoInputDeviceId()):e.videoInputDeviceId?n=e.videoInputDeviceId:t.videoInputDeviceId&&(n=t.videoInputDeviceId),r.next=3,navigator.mediaDevices.enumerateDevices();case 3:return s=r.sent,c=s.find((function(e){return e.deviceId===n})),n=void 0!==c?c.deviceId:void 0,t.videoInputDeviceId=n,t.logger.debug("replaceVideoTrack with deviceId=".concat(n)),r.abrupt("return",n);case 9:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),n=function(){var r=xn(regeneratorRuntime.mark((function r(n){var i,o,a,s,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!e.wtpStream){r.next=5;break}return r.abrupt("return",e.wtpStream);case 5:if(!e.customMediaStream){r.next=9;break}return r.abrupt("return",e.customMediaStream);case 9:if(!e.mediaStreamManager){r.next=13;break}return r.abrupt("return",e.mediaStreamManager.getMediaStream());case 13:return i=t.isHDRestricted?Ht.VGA_WIDTH:Ht.WIDTH,o=t.isHDRestricted?Ht.VGA_HEIGHT:Ht.HEIGHT,a=n?{deviceId:{exact:n},width:i,height:o}:{width:i,height:o},r.next=18,navigator.mediaDevices.getUserMedia({video:a});case 18:return s=r.sent,r.abrupt("return",s);case 20:r.next=31;break;case 22:if(r.prev=22,r.t0=r.catch(0),"OverconstrainedError"!==r.t0.name){r.next=30;break}throw(c=t.createErrorObject("OverconstrainedError","Constraints of replaceVideoTrack is not acceptable - deviceId=".concat(n," / width=").concat(i," / height=").concat(o))).constraint=r.t0.constraint,c;case 30:throw r.t0;case 31:case"end":return r.stop()}}),r,null,[[0,22]])})));return function(e){return r.apply(this,arguments)}}();return r().then((function(e){return n(e)})).then((function(e){return r=e,new Promise((function(e,n){try{t.logger.debug("[_replaceVideoTrack] Start replaceLocalVideoTrack");var i=t.localMediaStreamManager.getLocalMediaStream(),o=r.getVideoTracks()[0];if(o){var a=i.getVideoTracks()[0];a&&"video"===a.kind&&(i.removeTrack(a),i.addTrack(o),a.stop(),e(r))}}catch(e){r&&r.getTracks().forEach((function(e){return e.stop()})),n(t.createErrorObject("ReplaceLocalTrackFail","Fail to replace local video track while replaceVideoTrack"))}}));var r})).then((function(r){var n,i;return n=t.isVideoModified&&!e.wtpStream?t.virtualBackground.getVirtualBackgroundVideoStream():r,i=n,new Promise((function(r,n){try{t.logger.debug("[_replaceVideoTrack] Start replaceSenderTrack");var o=i.getVideoTracks()[0];o&&(o.enabled=e.cameraOn,t.session.sessionDescriptionHandler.peerConnection.getSenders()[1].replaceTrack(o).then((function(){"conference"===t.service&&(!1!==t.videoMutedManager.getState()&&!0!==e.needCheckSimulcastResolution||t._changeSimulcastResolution(o).catch((function(e){return t.logger.debug("replaceSenderTrack - fail to change simulcast resolution because ".concat(e.message))}))),r()})))}catch(e){i&&i.getTracks().forEach((function(e){return e.stop()})),n(t.createErrorObject("ReplaceSenderTrackFail","Fail to replace sender video track while replaceVideoTrack"))}}))})).catch((function(e){if(t.logger.warn("Fail to set video track. ".concat(e.message,". (Error=").concat(JSON.stringify(e),")")),"ReplaceLocalTrackFail"===e.name||"ReplaceSenderTrackFail"===e.name)throw e}))}},{key:"_replaceSenderVideoTrack",value:function(e){var t=this,r=e.getVideoTracks()[0];if(!r)return Promise.reject(this.createErrorObject("NoVideoTrack","Fail to replace video track of sender because stream has no video track"));var n=this.session.sessionDescriptionHandler.peerConnection.getSenders()[1],i=[];return"conference"===this.service&&i.push((function(){return t._changeSimulcastResolution(r)})),i.push((function(){return new Promise((function(e,t){var i=n.track;i&&"video"===i.kind&&n.replaceTrack(r).then((function(){e()})).catch((function(e){t(e)}))}))})),i.reduce((function(e,t){return e.then(t)}),Promise.resolve())}},{key:"_replaceSenderAudioTrack",value:function(e){var t=this.session.sessionDescriptionHandler.peerConnection;return new Promise((function(r,n){t.getSenders()[0].replaceTrack(e).then((function(){r()}))}))}},{key:"_getMixAudioTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.logger.debug("start _getMixAudioTrack");var r=new AudioContext,n=r.createMediaStreamDestination(),i=void 0===t?this.localMediaStreamManager.getLocalMediaStream():t;return r.createMediaStreamSource(e).connect(n),r.createMediaStreamSource(i).connect(n),n.stream.getTracks()[0]}},{key:"_changeSimulcastResolution",value:function(e){var t=this,r=this.session.sessionDescriptionHandler,n=this.session.sessionDescriptionHandler.peerConnection,i=this.myScreenShare;return this.logger.debug("_changeSimulcastResolution start"),this.logger.debug("_changeSimulcastResolution check, screenShare.state: "+i.state),this.logger.debug("_changeSimulcastResolution check, simulcastHandler.activeHD: "+this.simulcastHandler.activeHD),this.simulcastHandler.updateTrack(e),new Promise((function(e,i){t.sdpMutex.acquire().then((function(){if(t.logger.debug("_changeSimulcastResolution acquire"),t.simulcastHandler.needUpdateSdp()){t.logger.debug("_changeSimulcastResolution updateTrack - HD=".concat(t.simulcastHandler.isHDSupported," / isResolutionChanged=").concat(t.simulcastHandler.isResolutionChanged));var i=Promise.resolve();return 1==t.simulcastHandler.isResolutionChanged&&(i=t._updateSimulcast()),i.then((function(){var i=t.simulcastHandler.isHDSupported;return r.createLocalOfferOrAnswer().then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return t.simulcastHandler.replaceRecvMungeSdp(n.currentRemoteDescription)})).then((function(e){return t.simulcastHandler.isCurrentSdpHD=i,n.setRemoteDescription({sdp:e.sdp,type:"answer"})})).then((function(){t.sdpMutex.release(),e()})).catch(function(){var e=xn(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("have-local-offer"!==n.signalingState){e.next=3;break}return e.next=3,r.rollbackLocalSessionDescription();case 3:return t.logger.debug("Catch to _changeSimulcastResolution sdp munging"),e.abrupt("return",Promise.reject(i));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}t.logger.debug("_changeSimulcastResolution skip because sdpUpdate is not needed"),t.sdpMutex.release(),e()})).catch((function(e){t.logger.debug("_changeSimulcastResolution outer exception"),t.sdpMutex.release(),i(e)}))}))}},{key:"_completeStartMyScreenShare",value:function(){void 0!==this.startMyScreenShareCompleteTimeout&&(clearTimeout(this.startMyScreenShareCompleteTimeout),this.startMyScreenShareCompleteTimeout=void 0),this.startMyScreenShareCompleteResolve&&this.startMyScreenShareCompleteResolve(),this.isCompleteStartMyScreenShare=!0,this._cleanPromiseStartMyScreenShare(),this.timeoutStopMyScreenShare&&(this.timeoutStopMyScreenShare=void 0,this.wtpStopMyScreenShare())}},{key:"_cleanPromiseStartMyScreenShare",value:function(){this.startMyScreenShareCompleteResolve=void 0,this.startMyScreenShareCompleteReject=void 0}},{key:"_webVisibilityChangeEvent",value:function(){var e,t,r=this;e=function(){if(r.callParams.callType===wt.VIDEO&&!r.hasSetCustomMediaStreamWithVideo){var e=er();if(document[e]){r.logger.debug("Web document hidden.");var t={reasonCode:r.videoMutedManager.getState()?Mt.PAUSED_BLOCKED:Mt.BLOCKED,plnVideoPauseReason:Nt.BY_INTERRUPT,isUser:!1};r.wtpPauseMyVideo(t)}else r.logger.debug("Web document visible."),r.videoMutedManager.getState()?r.wtpPauseMyVideo({reasonCode:Mt.PAUSED,plnVideoPauseReason:null,isUser:!1}):r.wtpResumeMyVideo()}},void 0!==document.hidden?t="visibilitychange":["ms","webkit","moz","o"].forEach((function(e){void 0!==document[e+"Hidden"]&&(t=e+"visibilitychange")})),t?document.addEventListener(t,e,!1):console.error("Browser not support vicibilityChange EventListner")}},{key:"_webBeforeUnloadEvent",value:function(){var e=this;window.addEventListener("beforeunload",(function(t){var r=[];r.push("P-Reason: "+ir.UE_DESTROY+";UE_DESTROY;"+e.callDir),e.session.bye({requestOptions:{extraHeaders:r}})}))}},{key:"_getDummyVideoStream",value:function(){this._clearDummyVideoStream();var e=Object.assign(document.createElement("canvas"),{width:640,height:480}),t=function(){e.getContext("2d").fillRect(0,0,640,480)};return t(),this.dummyVideo=setInterval(t,3e3),e.captureStream()}},{key:"_clearDummyVideoStream",value:function(){this.dummyVideo&&(clearInterval(this.dummyVideo),this.dummyVideo=void 0)}},{key:"_getConstraints",value:function(e){try{if(Object.is(e,void 0))throw"undefined";if(Object.is(e,null))throw"null";if(Object.is(e,NaN))throw"NaN"}catch(t){e=this._getDefaultConstraints()}return e}},{key:"_getDefaultConstraints",value:function(){return{video:{width:{max:1920},height:{max:1080},frameRate:{max:10}},audio:!0}}},{key:"_getDeviceId",value:function(){var e=localStorage.getItem("deviceId");if(null==e||""===e){var t=window.crypto.getRandomValues(new Uint8Array(8));e="",t.forEach((function(t){e+=t.toString(16).padStart(2,"0")})),this.logger.debug("Set init deviceId: ".concat(e)),localStorage.setItem("deviceId",e)}return e}},{key:"_getValidDeviceId",value:(n=xn(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"default"!==t&&"communications"!==t){e.next=6;break}return e.next=4,navigator.mediaDevices.enumerateDevices().then((function(e){var n=e.find((function(e){return e.deviceId===t&&e.kind===r}));n&&(i=e.find((function(e){return e.groupId===n.groupId&&e.kind===r&&"default"!==e.deviceId&&"communications"!==e.deviceId})))}));case 4:n=i?i.deviceId:t,this.logger.debug("Change deviceId from ".concat(t," to ").concat(n));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_validateCustomUserType",value:function(e){return!(!Number.isInteger(e)||e<1||e>9999)}},{key:"getStats",value:function(){var e=this;this.session.sessionDescriptionHandler.peerConnection.getStats().then((function(t){e.logger.log(t),t.forEach((function(t){e.logger.log("===================================================================================================================================="),e.logger.log("".concat(t.type," / ").concat(t.id," / ").concat(t.timestamp)),Object.keys(t).forEach((function(r){"id"!==r&&"timestamp"!==r&&"type"!==r&&e.logger.debug("".concat(r," : ").concat(t[r]))}))}))}))}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Vn(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),p}(qe);function qn(e){return qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qn(e)}function Wn(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Kn(e){var t=function(e,t){if("object"!=qn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=qn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qn(t)?t:t+""}r(285),r(1637);var Gn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaStreamManager=t.mediaStreamManager,this.session=t.session;var r=window.AudioContext||window.webkitAudioContext||!1;this.audioContext=new r,this.audioWorkletNode=void 0,this.mediaStreamSource=void 0,this.target=void 0}var t,r,n,i;return t=e,r=[{key:"loadProcessor",value:(n=regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Blob(["\nconst audioLevelPower = [\n    0.0, 0.000000001, 0.000000004, 0.000000008, 0.000000015, 0.000000023, 0.000000034, 0.000000046, 0.00000006, 0.000000075, 0.000000093, 0.000000113, 0.000000134, 0.000000183, 0.00000021, 0.000000269, 0.000000336, 0.000000411, 0.000000536, 0.000000679, 0.000000838, 0.000001014, 0.000001275, 0.000001643, 0.000002057, 0.000002518, 0.000003242, 0.000004057, 0.0000051, 0.000006416, 0.000008055,\n    0.000010073, 0.000012749, 0.000015982, 0.000020125, 0.000025355, 0.000031875, 0.000039906, 0.000050128, 0.000063443, 0.000079953, 0.000100195, 0.000126123, 0.000158855, 0.000199647, 0.00025183, 0.000316546, 0.000398342, 0.000501756, 0.000632346, 0.000795141, 0.001001515, 0.001259678, 0.001586066, 0.0019961, 0.002514058, 0.003163376, 0.003982916, 0.005012751, 0.006310278, 0.007946269,\n    0.010001221, 0.012591788, 0.01585472, 0.019956045, 0.025124881, 0.03162206, 0.039809797, 0.05012089, 0.063096508, 0.079428054, 0.099997073, 0.125902832, 0.158485055, 0.199528202, 0.251191616, 0.316234618, 0.398099065, 0.501188636, 0.630930781, 0.794300437\n];\nconst audioLevelDB = [\n    -127, -90, -84, -80, -78, -76, -74, -73, -72, -71, -70, -69, -68, -67, -66, -65, -64, -63, -62, -61, -60, -59, -58, -57, -56, -55, -54, -53, -52, -51, -50, -49, -48, -47, -46, -45, -44, -43, -42, -41, -40, -39, -38, -37, -36, -35, -34, -33, -32, -31, -30, -29, -28, -27, -26, -25, -24, -23, -22, -21, -20, -19, -18, -17, -16, -15, -14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0\n];\nconst AVERAGE_LEVEL_COEFFICIENT = 0.95;\nconst kCutThreshold = 80;\nconst kCutRatio = 6;\nconst kBottom = 40;\nconst kDbMax = 127;\nconst kNormalizedMax = 100;\n\nclass AudioLevelCalculateProcessor extends AudioWorkletProcessor {\n    constructor(options) {\n        super();\n        // this.interval = options.processorOptions.interval;\n        this.accumulatedLevel = 0;\n    }\n\n    process(inputs, outputs) {\n        const currentTime = Date.now();\n\n        const audioChannel = inputs[0][0]; // first input channel\n        if (!audioChannel) return false;\n        let sum = 0;\n        let rms = 0;\n\n        for (let i = 0; i < audioChannel.length; ++i) {\n            sum += audioChannel[i] * audioChannel[i];\n        }\n\n        rms = Math.sqrt(sum / audioChannel.length); // RMS(root mean square)\n        const micAudioLevel = 20 * Math.log10(rms); // change rms to dBFS\n\n        this.accumulatedLevel = this.getMovingAverageDB(micAudioLevel);\n        const accumlatedLevelDB = this.getDB(this.accumulatedLevel);\n\n        let ret = accumlatedLevelDB + kDbMax;\n        if (ret < kCutThreshold) {\n            ret = ret > kBottom ? ret - kBottom : 0;\n            ret = ret / kCutRatio;\n        } else {\n            const factor = kNormalizedMax - kCutThreshold / kCutRatio;\n            const dividor = kDbMax - kCutThreshold;\n            const sub = (kDbMax * factor) / dividor - kNormalizedMax;\n            ret = (ret * factor) / dividor - sub;\n        }\n\n        this.port.postMessage({\n            type: 'normalizedAudioLevel',\n            value: ret\n        });\n        return true;\n    }\n\n    getIndex(array, target) {\n        let mid = 0;\n        let left = 0;\n        let right = array.length - 1;\n        while (left <= right) {\n            mid = Math.floor((left + right) / 2);\n            if (array[mid] === target) return mid;\n            else if (array[mid] < target) left = mid + 1;\n            else right = mid - 1;\n        }\n\n        if (right < 0) return 0;\n        else return right;\n    }\n\n    getDB(power) {\n        return audioLevelDB[this.getIndexOfPower(power)];\n    }\n    getPower(dB) {\n        return audioLevelPower[this.getIndexOfDB(dB)];\n    }\n\n    getIndexOfPower(target) {\n        return this.getIndex(audioLevelPower, target);\n    }\n\n    getIndexOfDB(target) {\n        return this.getIndex(audioLevelDB, target);\n    }\n\n    getMovingAverageDB(newDB) {\n        return AVERAGE_LEVEL_COEFFICIENT * this.accumulatedLevel + (1 - AVERAGE_LEVEL_COEFFICIENT) * this.getPower(newDB);\n    }\n}\n\nregisterProcessor('audio-level-calculate-processor', AudioLevelCalculateProcessor);\n\n"],{type:"text/javascript"}),n=URL.createObjectURL(r),this.target=t.target,this.mediaStreamSource=this.audioContext.createMediaStreamSource("my"===this.target?this.mediaStreamManager.getLocalMediaStream():this.mediaStreamManager.getRemoteMediaStream()),e.next=7,this.audioContext.audioWorklet.addModule(n);case 7:URL.revokeObjectURL(n),"suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioWorkletNode=new AudioWorkletNode(this.audioContext,"audio-level-calculate-processor"),this.mediaStreamSource.connect(this.audioWorkletNode),this.audioWorkletNode.connect(this.audioContext.destination),this.audioWorkletNode.port.onmessage=function(e){"normalizedAudioLevel"===e.data.type&&t.callback(e.data.value)},e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])})),i=function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){Wn(o,r,i,a,s,"next",e)}function s(e){Wn(o,r,i,a,s,"throw",e)}a(void 0)}))},function(e){return i.apply(this,arguments)})},{key:"refreshProcessor",value:function(){var e,t;null===(e=this.mediaStreamSource)||void 0===e||e.disconnect(),null===(t=this.audioWorkletNode)||void 0===t||t.disconnect(),this.mediaStreamSource=this.audioContext.createMediaStreamSource("my"===this.target?this.mediaStreamManager.getLocalMediaStream():this.mediaStreamManager.getRemoteMediaStream()),this.mediaStreamSource.connect(this.audioWorkletNode),this.audioWorkletNode.connect(this.audioContext.destination)}},{key:"unloadProcessor",value:function(){var e,t;null===(e=this.mediaStreamSource)||void 0===e||e.disconnect(),null===(t=this.audioWorkletNode)||void 0===t||t.disconnect(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close()}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Kn(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Yn(e){return Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yn(e)}function zn(e){var t=function(e,t){if("object"!=Yn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Yn(t)?t:t+""}var Xn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audioWorkletManager=new Gn(t),this.prevIsActive=void 0,this.curIsActive=!1,this._isStarted=!1}var t,r;return t=e,(r=[{key:"start",value:function(e){var t=this;this.audioWorkletManager.loadProcessor({callback:function(r){t.curIsActive=r>=20,t.prevIsActive!==t.curIsActive&&(t.prevIsActive=t.curIsActive,e.callback(t.curIsActive))},target:e.target}),this._isStarted=!0}},{key:"stop",value:function(){this.audioWorkletManager.unloadProcessor(),this._isStarted=!1}},{key:"restart",value:function(){this.audioWorkletManager.refreshProcessor()}},{key:"isStarted",value:function(){return this._isStarted}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zn(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Jn(e){return Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jn(e)}function Zn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Qn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Qn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ei(e){var t=function(e,t){if("object"!=Jn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Jn(t)?t:t+""}var ti=1500,ri=300,ni=100,ii=600,oi=1200,ai=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t.session,this.service=t.service,this.videoSsrc=void 0,this.maxSendLinkBandwidth=void 0===t.maxSendLinkBandwidth?void 0:t.maxSendLinkBandwidth,this.maxSendLinkBandwidthConfig={video:void 0,screenShare:void 0},this.wtpTargetBitrate=void 0,this.wtpScreenShareTargetBitrate=void 0,this.isActiveScreenShare=!1,this.prevPacketsLost=0,this.videoSentBitrate=0,this.sumVideoSentBitate=0,this.prevBytesSent=0,this.txBitrateSamples=[],this.targetBitrateUpdated=!1,this.isMaxSendLinkBandwidthAdjusted=!1,this.logger=t.logger}var t,r;return t=e,(r=[{key:"start",value:function(){var e=this;this.updateMaxSendLinkBandwidthConfig();var t=this.session.sessionDescriptionHandler.peerConnection,r=t.getSenders()[1];this.setVideoSsrc(),this.intervalId=setInterval((function(){e.session.sessionDescriptionHandler.peerConnection.getStats().then((function(n){var i,o=Zn(n);try{for(o.s();!(i=o.n()).done;){var a=i.value[1];if("outbound-rtp"===a.type){if("call"===e.service){if("video"===a.kind&&"screenshare"!==a.contentType){var s=a.targetBitrate||e.wtpTargetBitrate;if(void 0===s||s>1e3*e.maxSendLinkBandwidthConfig.video||e.targetBitrateUpdated){e.wtpTargetBitrate=1e3*e.maxSendLinkBandwidthConfig.video;var c=r.getParameters();c.encodings[0].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video,r.setParameters(c),e.logger.debug("Adjusting video txBitrate to ".concat(e.maxSendLinkBandwidthConfig.video," kbps")),e.targetBitrateUpdated=!1}e.calcVideoSentBitrate(a.bytesSent)}}else if("vga"===a.rid){var u=a.targetBitrate||e.wtpTargetBitrate;if(void 0===u||u>1e3*e.maxSendLinkBandwidthConfig.video.sum||e.targetBitrateUpdated){e.wtpTargetBitrate=1e3*e.maxSendLinkBandwidthConfig.video.sum;var l=r.getParameters();l.encodings[0].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video.qvga,l.encodings[1].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video.vga,0!==e.maxSendLinkBandwidthConfig.video.hd?l.encodings[2].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.video.hd:l.encodings[2].active=!1,r.setParameters(l),e.logger.debug("Adjusting video txBitrate to qvga ".concat(e.maxSendLinkBandwidthConfig.video.qvga," kbps, vga ").concat(e.maxSendLinkBandwidthConfig.video.vga," kbps, hd ").concat(e.maxSendLinkBandwidthConfig.video.hd," kbps")),e.targetBitrateUpdated=!1}e.calcVideoSentBitrate(a.bytesSent)}if(e.isActiveScreenShare&&"screenshare"===a.contentType&&(a.targetBitrate||e.wtpScreenShareTargetBitrate)>1e3*e.maxSendLinkBandwidthConfig.screenShare){e.wtpScreenShareTargetBitrate=1e3*e.maxSendLinkBandwidthConfig.screenShare;var d=t.getSenders().slice(2).find((function(e){return e.track})),h=d.getParameters();h.encodings[0].maxBitrate=1e3*e.maxSendLinkBandwidthConfig.screenShare,d.setParameters(h),e.logger.debug("Adjusting screenShare txBitrate to ".concat(e.maxSendLinkBandwidthConfig.screenShare," kbps"))}}else if(!e.isMaxSendLinkBandwidthAdjusted&&"remote-inbound-rtp"===a.type&&a.ssrc===e.videoSsrc){var p=a.packetsLost;(p-e.prevPacketsLost)/p>.02&&(e.logger.debug("video packetLost is detected: ".concat(p-e.prevPacketsLost)),e.adjustMaxSendLinkBandwidthForLowBitrate()),e.prevPacketsLost=p}}}catch(e){o.e(e)}finally{o.f()}}))}),1e3)}},{key:"stop",value:function(){clearInterval(this.intervalId)}},{key:"activeScreenShare",value:function(){this.isActiveScreenShare=!0,this.updateMaxSendLinkBandwidthConfig()}},{key:"inactiveScreenShare",value:function(){this.isActiveScreenShare=!1,this.updateMaxSendLinkBandwidthConfig()}},{key:"resetMaxSendLinkBandwidth",value:function(e){this.maxSendLinkBandwidth>e&&(this.maxSendLinkBandwidth=e,this.logger.debug("Reset maxSendLinkBandwidth to ".concat(this.maxSendLinkBandwidth)),this.targetBitrateUpdated=!0,this.updateMaxSendLinkBandwidthConfig())}},{key:"adjustMaxSendLinkBandwidthForLowBitrate",value:function(){var e="call"===this.service?this.maxSendLinkBandwidthConfig.video:this.maxSendLinkBandwidthConfig.video.vga;this.logger.debug("Compare currentMaxSendLinkBandwidth(".concat(1e3*e,") with currentBitrate(").concat(this.videoSentBitrate,")")),.8*e*1e3>this.videoSentBitrate&&(this.logger.debug("Adjust maxSendLinkBandwidth because of lower network bandwidth"),this.resetMaxSendLinkBandwidth(.6*this.maxSendLinkBandwidth),this.isMaxSendLinkBandwidthAdjusted=!0)}},{key:"updateMaxSendLinkBandwidthConfig",value:function(){if(this.isActiveScreenShare)this.maxSendLinkBandwidth<1500?(this.maxSendLinkBandwidthConfig.video="call"===this.service?ri:{qvga:100,vga:200,hd:0,sum:300},this.maxSendLinkBandwidth<1100?this.maxSendLinkBandwidthConfig.screenShare=800:this.maxSendLinkBandwidthConfig.screenShare=this.maxSendLinkBandwidth-ri):(this.maxSendLinkBandwidthConfig.screenShare=oi,"call"===this.service?this.maxSendLinkBandwidthConfig.video=this.maxSendLinkBandwidth-oi<ti?this.maxSendLinkBandwidth-oi:ti:this.maxSendLinkBandwidthConfig.video={qvga:ni,vga:this.maxSendLinkBandwidth-oi-ni<ii?this.maxSendLinkBandwidth-oi-ni:ii,hd:0,sum:this.maxSendLinkBandwidth-oi});else{var e="call"===this.service?Wt.CALL_TX:Wt.GROUPCALL_TX;this.maxSendLinkBandwidth>e?"call"===this.service?this.maxSendLinkBandwidthConfig.video=ti:this.maxSendLinkBandwidthConfig.video={qvga:ni,vga:ii,hd:2500,sum:3200}:this.maxSendLinkBandwidth<ri?"call"===this.service?this.maxSendLinkBandwidthConfig.video=ri:this.maxSendLinkBandwidthConfig.video={qvga:100,vga:200,hd:0,sum:300}:"call"===this.service?this.maxSendLinkBandwidthConfig.video=this.maxSendLinkBandwidth<ti?this.maxSendLinkBandwidth:ti:(this.maxSendLinkBandwidthConfig.video={},this.maxSendLinkBandwidthConfig.video.qvga=ni,this.maxSendLinkBandwidth-ni<=ii?(this.maxSendLinkBandwidthConfig.video.vga=this.maxSendLinkBandwidth-ni,this.maxSendLinkBandwidthConfig.video.hd=0):(this.maxSendLinkBandwidthConfig.video.vga=ii,this.maxSendLinkBandwidthConfig.video.hd=this.maxSendLinkBandwidth-700>=1200?this.maxSendLinkBandwidth-700:0),this.maxSendLinkBandwidthConfig.video.sum=ni+this.maxSendLinkBandwidthConfig.video.vga+this.maxSendLinkBandwidthConfig.video.hd)}var t="call"===this.service?1e3*this.maxSendLinkBandwidthConfig.video:1e3*this.maxSendLinkBandwidthConfig.video.sum;this.wtpTargetBitrate<t&&(this.targetBitrateUpdated=!0),this.logger.debug("Update maxSendLinkBandwidth config - ".concat(JSON.stringify(this.maxSendLinkBandwidthConfig)))}},{key:"setVideoSsrc",value:function(){var e=this;void 0===this.videoSsrc&&(this.session.sessionDescriptionHandler.peerConnection.getStats().then((function(t){var r,n=Zn(t);try{for(n.s();!(r=n.n()).done;){var i=r.value[1];if("outbound-rtp"===i.type)if("call"===e.service){if("video"===i.kind&&"screenshare"!==i.contentType)return void(e.videoSsrc=i.ssrc)}else if("vga"===i.rid)return void(e.videoSsrc=i.ssrc)}}catch(e){n.e(e)}finally{n.f()}})),void 0===this.videoSsrc&&setTimeout((function(){return e.setVideoSsrc()}),500))}},{key:"calcVideoSentBitrate",value:function(e){if(0!==e){var t=8*(e-this.prevBytesSent);if(!(t<0)){this.sumVideoSentBitate+=t,this.txBitrateSamples.push(t),this.txBitrateSamples.length>5&&(this.sumVideoSentBitate-=this.txBitrateSamples.shift());var r=this.sumVideoSentBitate/this.txBitrateSamples.length;this.prevBytesSent=e,this.videoSentBitrate=r}}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ei(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function si(e){return si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},si(e)}function ci(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function ui(e){var t=function(e,t){if("object"!=si(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=si(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==si(t)?t:t+""}function li(e,t){return li=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},li(e,t)}function di(e){var t=hi();return function(){var r,n=pi(e);if(t){var i=pi(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==si(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function hi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(hi=function(){return!!e})()}function pi(e){return pi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pi(e)}var fi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&li(e,t)}(s,e);var r,n,i,o,a=di(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.call(this,"call")}return r=s,n=[{key:"wtpCallInit",value:function(){var e=this;this.changeState($n.STATE_READY),this.callTypeState=this.callParams.callType===wt.AUDIO?At.AUDIO:At.VIDEO,this.setInitMediaState({videoMuteCallback:function(t){t.setState(!e.callParams.cameraOn),e.callParams.cameraOn||e.callTypeState!==At.VIDEO||e.wtpPauseMyVideo()},audioMuteCallback:function(t){t.setState(!e.callParams.micOn),0==e.callParams.micOn&&e.wtpMuteMyAudio()}}),this.toneSoundManager.init(this.callParams)}},{key:"wtpCallMake",value:function(e){var r=this;if(!ht())return Promise.reject(this.createErrorObject("BrowserNotSupported","This browser is not supported."));var n=this.checkValidationCallParams(e),i=n.isValidCallParams,o=n.callParamsError;return i?(this.setCallParams(e),this.logger.debug("Start wtpCallMake"),this.callDir=bt.INITIATOR,this.wtpCallInit(),this.createUa(this.callParams.myId),this.ua.start().then((function(){return r.localMediaStreamManager.init(r.callParams)})).catch((function(e){return r.onLocalMediaStreamManagerInitError(e,!1),Promise.reject(e)})).then((function(){var e,t,n,i;if(r.logger.debug("wtpCallMake | Start UserAgent"),r.remoteMediaStreamManager.setRemoteAudioElement(null===(e=r.callParams.media)||void 0===e||null===(t=e.remote)||void 0===t?void 0:t.audio),r.remoteMediaStreamManager.setRemoteVideoElement(null===(n=r.callParams.media)||void 0===n||null===(i=n.remote)||void 0===i?void 0:i.video),r.localMediaStreamManager.getUserMediaStateError){var o=r.localMediaStreamManager.getUserMediaStateError;r.emit("debugNotice",kn(o.name,o.message))}r.changeState($n.STATE_CONNECTING);var a=r.setPlnExtraInviteHeaders(bt.INITIATOR);r.createInviteSession(a,{delegate:{onDataCtrl:function(e){return r.onDataCtrl(e)},onFeatureShare:function(e){return r.onFeatureShare(e)},onFeatureShareResult:function(e){return r.onFeatureShareResult(e)},onRecordingStatus:function(e){return r.onRecordingStatus(e)}},peerConnectionDelegate:{onTrack:function(e){return r.onTrackAdditional(e)}}})})).then((function(){r.transceiverHandler.setSession(r.session),r.callParams.enableTalkingStatusEvent&&(r.myTalkingStatusManager=new Xn({mediaStreamManager:r.localMediaStreamManager}),r.peerTalkingStatusManager=new Xn({mediaStreamManager:r.remoteMediaStreamManager})),r.txBitrateManager=new ai({session:r.session,service:r.service,maxSendLinkBandwidth:void 0!==r.callParams.maxSendLinkBandwidth?r.callParams.maxSendLinkBandwidth:Wt.CALL_TX,logger:r.logger}),r.videoInputDeviceId=r.localMediaStreamManager.videoInputDeviceId;var e={sdpModifier:[function(e){var t=sr(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=cr(t,{imageattr:"true"}),e.sdp=t,Promise.resolve(e)},t],sdhOptions:{cameraOn:r.callParams.cameraOn,micOn:r.callParams.micOn,constraints:r.getConstraints(),localMediaStreamManager:r.localMediaStreamManager,remoteMediaStreamManager:r.remoteMediaStreamManager,ignoreDeviceError:r.callParams.ignoreDeviceError},inviteDelegate:{onAccept:function(){var e;r.onCallInviteAccept(),null===(e=r.peerTalkingStatusManager)||void 0===e||e.start({target:"peer",callback:function(e){r.emit("peerTalkingStatusUpdated",e)}})}}};return r.sendInvite(e)})).catch((function(e){return r.plnRelCode?r.onFailed():r.onUaStartFailed(e),Promise.reject(e)}))):(this.logger.warn("wtpCallMake | Invalid call params: ".concat(o)),Promise.reject(o))}},{key:"wtpCallVerify",value:function(e){var r=this;if(!ht())return Promise.reject(this.createErrorObject("BrowserNotSupported","This browser is not supported."));var n=this.checkValidationCallParams(e),i=n.isValidCallParams,o=n.callParamsError;return i?(this.setCallParams(e),void 0!==e.allowVerifyOnMultipleWindow&&!0!==e.allowVerifyOnMultipleWindow||(this.callParams.allowVerifyOnMultipleWindow=!0),this.logger.debug("Start wtpCallVerify"),this.callDir=bt.RESPONDER,this.wtpCallInit(),this.createUa(this.callParams.peerId),this.ua.start().then((function(){r.logger.debug("Start UserAgent"),r.changeState($n.STATE_CONNECTING);var e=r.setPlnExtraInviteHeaders(bt.RESPONDER);r.createInviteSession(e,{delegate:{onDataCtrl:function(e){return r.onDataCtrl(e)},onFeatureShare:function(e){return r.onFeatureShare(e)},onFeatureShareResult:function(e){return r.onFeatureShareResult(e)},onRecordingStatus:function(e){return r.onRecordingStatus(e)}},peerConnectionDelegate:{onTrack:function(e){return r.onTrackAdditional(e)}}})})).then((function(){r.transceiverHandler.setSession(r.session),r.callParams.enableTalkingStatusEvent&&(r.myTalkingStatusManager=new Xn({mediaStreamManager:r.localMediaStreamManager}),r.peerTalkingStatusManager=new Xn({mediaStreamManager:r.remoteMediaStreamManager})),r.txBitrateManager=new ai({session:r.session,service:r.service,maxSendLinkBandwidth:void 0!==r.callParams.maxSendLinkBandwidth?r.callParams.maxSendLinkBandwidth:Wt.CALL_TX,logger:r.logger});var e={sdpModifier:[function(e){var t=sr(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=cr(t,{imageattr:"true"}),e.sdp=t,e.sdp=e.sdp.replace(/^a=sendrecv/gim,"a=recvonly"),Promise.resolve(e)},t],sdhOptions:{isVerify:!0,localMediaStreamManager:r.localMediaStreamManager,remoteMediaStreamManager:r.remoteMediaStreamManager,constraints:{audio:!1,video:!1}}};return r.sendInvite(e)})).catch((function(e){return r.onUaStartFailed(e),Promise.reject(e)}))):Promise.reject(o)}},{key:"wtpCallAnswer",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state!==$n.STATE_VERIFIED)return this.logger.warn("Fail to answer call because Call should be VERIFIED ahead."),Promise.reject(this.createErrorObject("InvalidState","Fail to answer call because Call should be VERIFIED ahead."));if(this.toneSoundManager.pauseRingTone(),!this.session)return Promise.reject(this.createErrorObject("InvalidState","No Session to Answer."));var n={sdpModifier:[function(e){var t=sr(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=cr(t,{imageattr:"true"}),e.sdp=t,Promise.resolve(e)},t],sdhOptions:{cameraOn:this.callParams.cameraOn,micOn:this.callParams.micOn,constraints:this.getConstraints(),localMediaStreamManager:this.localMediaStreamManager,remoteMediaStreamManager:this.remoteMediaStreamManager,ignoreDeviceError:this.callParams.ignoreDeviceError,offerOptions:{iceRestart:!0}},inviteDelegate:{onAccept:function(){var t;e.onCallInviteAccept(),null===(t=e.peerTalkingStatusManager)||void 0===t||t.start({target:"peer",callback:function(t){e.emit("peerTalkingStatusUpdated",t)}})}},requestOptions:{extraHeaders:["X-req_rec: "+r]}};return this.localMediaStreamManager.init(this.callParams).then((function(){var t,r,i,o;if(e.videoInputDeviceId=e.localMediaStreamManager.videoInputDeviceId,e.remoteMediaStreamManager.setRemoteAudioElement(null===(t=e.callParams.media)||void 0===t||null===(r=t.remote)||void 0===r?void 0:r.audio),e.remoteMediaStreamManager.setRemoteVideoElement(null===(i=e.callParams.media)||void 0===i||null===(o=i.remote)||void 0===o?void 0:o.video),e.localMediaStreamManager.getUserMediaStateError){var a=e.localMediaStreamManager.getUserMediaStateError;e.emit("debugNotice",kn(a.name,a.message))}return e.changeState($n.STATE_ANSWERED),e.sendInvite(n)})).catch((function(t){e.logger.debug("Fail to answerCall - ".concat(t)),e.onLocalMediaStreamManagerInitError(t,!1);var r=or(e.plnRelCode);e.callTerminate=!0;var n=["P-Reason: "+r.code+";"+r.strCode+";"+e.callDir];return e.session.bye({requestOptions:{extraHeaders:n}}),Promise.reject(t)}))}},{key:"wtpCallEnd",value:function(){if(this.state===$n.STATE_CONNECTED||this.state===$n.STATE_CONNECTING||this.state===$n.STATE_VERIFIED||this.state===$n.STATE_ANSWERED){if(this.releaser=Ot.THIS,this.state===$n.STATE_CONNECTING)return this.plnRelCode=ir.CANCEL,this.session.cancel();if(this.session){this.callTerminate=!0;var e,t=[];if(this.callDir===bt.INITIATOR)this.state===$n.STATE_CONNECTED?(this.plnRelCode=ir.NORMAL,e="NORMAL"):(this.plnRelCode=ir.UNDEFINED,e="UNDEFINED");else switch(this.state){case $n.STATE_CONNECTED:this.plnRelCode=ir.NORMAL,e="NORMAL";break;case $n.STATE_VERIFIED:this.plnRelCode=ir.REJECT,e="REJECT";break;default:this.plnRelCode=ir.UNDEFINED,e="UNDEFINED"}return t.push("P-Reason: "+this.plnRelCode+";"+e+";"+this.callDir),this.session.bye({requestOptions:{extraHeaders:t}})}}else this.logger.warn("No active call to hang up on")}},{key:"wtpCallEnableVideo",value:function(e){return this.wtpEnableVideo(e)}},{key:"wtpCallDisableVideo",value:function(){return this.wtpDisableVideo()}},{key:"wtpCallEnableVideoWithPauseResponse",value:function(){var e=this,t={cameraOn:!1,videoInputDeviceId:void 0,onAcceptVideoToggle:function(){e.wtpPauseMyVideo({reasonCode:Mt.ENABLE_VIDEO_RESPONSE,isUser:!0})}};return this.wtpCallEnableVideo(t)}},{key:"wtpCallRequestPeerMute",value:function(e){this.wtpRequestPeerMute([this.callParams.peerId],e)}},{key:"wtpCallChangePeerView",value:(i=regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("wtpChangePeerView | Start"),t){e.next=3;break}throw this.createErrorObject("InvalidElement","Fail to change peer view because videoElement is invalid.");case 3:return n=this.remoteMediaStreamManager.getRemoteMediaStream(),i=r?this.remoteMediaStreamManager.getRemoteVideoElement():void 0,t.srcObject=n,t.muted=!0,this.remoteMediaStreamManager.setRemoteVideoElement(t),e.prev=8,e.next=11,t.play();case 11:i&&(i.srcObject=null,i.pause()),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),this.logger.warn("wtpCallChangePeerView | Fail to play the new peer view. ".concat(e.t0.message));case 17:case"end":return e.stop()}}),e,this,[[8,14]])})),o=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){ci(o,r,n,a,s,"next",e)}function s(e){ci(o,r,n,a,s,"throw",e)}a(void 0)}))},function(e,t){return o.apply(this,arguments)})},{key:"wtpCallAddPeerScreenShareView",value:function(e){var t=this;this.logger.debug("[wtpCallAddPeerScreenShareView] start");var r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=this.peerScreenShare;return this.sdpMutex.acquire().then((function(){switch(i.videoView=e,i.state){case Ut.INIT:var r=n.addTransceiver("video",{direction:"recvonly"});return i.transceiver=r,i.sdpMid="pss",i.state=Ut.START,Promise.resolve("NEW");case Ut.STOP:return i.transceiver.direction="recvonly",i.state=Ut.RESTART,Promise.resolve("RESTART");default:return Promise.reject(t.createErrorObject("NotValidScreenShareState","Peer screenShare state is not vaild to start (currentState=".concat(i.state,")")))}})).then((function(e){return"NEW"===e?r.createLocalOfferOrAnswer().then((function(e){var r={sdpMid:i.sdpMid};return i.state===Ut.START?r.type="screenshare":(r.type="active",r.direction="recvonly"),t.mungeOfferSdp(e,r)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return t.addVideoMungeAnswerSdp([{direction:"sendonly",ssrc:i.dSsrc,sdpMid:i.sdpMid}])})).then((function(e){return n.setRemoteDescription(e)})).then((function(){return t.logger.debug("wtpCallAddPeerScreenShareView done"),t.sdpMutex.release()})).catch((function(e){return t.sdpMutex.release(),t.logger.debug("Fail to add peer screenshare - ".concat(e.message)),Promise.reject(e)})):(t.logger.debug("Restart peer screenshare"),i.playVideo(),t.sdpMutex.release(),Promise.resolve())})).catch((function(e){return t.logger.debug("wtpCallAddPeerScreenShareView fail - ".concat(e.message)),t.logger.debug(e),Promise.reject(e)}))}},{key:"wtpCallRemovePeerScreenShareView",value:function(){this.logger.debug("[wtpCallRemovePeerScreenShareView] start");var e=this.peerScreenShare;return e.state===Ut.START||e.state===Ut.RESTART?(e.cleanupView(),Promise.resolve()):Promise.reject(this.createErrorObject("NotValidScreenShareState","Peer screenShare state is not valid to remove (currentState=".concat(e.state,")")))}},{key:"wtpCallChangePeerScreenShareView",value:function(e,t){var r=this;return new Promise((function(n,i){var o=r.peerScreenShare;o.state===Ut.START||o.state===Ut.RESTART?o.changeVideoView(e,t).then((function(){r.logger.debug("peer screen share view is changed"),n()})).catch((function(e){return r.logger.debug("catch error : ".concat(e))})):i(r.createErrorObject("ScreenShareNotPlaying","Peer screenShare is not playing"))}))}},{key:"wtpCallSendShortData",value:function(e,t){if(!(t instanceof Uint8Array))return Promise.reject(this.createErrorObject("WrongDataType","data type should be Uint8Array"));if(e.length>100)return Promise.reject(this.createErrorObject("ExceedMaxSizeType","Type must not exceed 100 bytes"));if(t.length>800)return Promise.reject(this.createErrorObject("ExceedMaxSizeData","Data must not exceed 900 bytes"));var r={body_type:e,body:vt(t),source:this.callParams.myId,source_svc_id:this.callDir===bt.INITIATOR?this.callParams.fromSvcId:this.callParams.toSvcId};return this.wtpSendShortData(r)}},{key:"wtpCallIsRecordOnCloudActivated",value:function(){return this.isRecordOnCloudActivated}},{key:"onDataCtrl",value:function(e){if(this.logger.debug("start onDataCtrl"),void 0!==e.event)switch(e.event){case 0:this.emit("peerScreenShareStopped");break;case 1:this.peerScreenShare.dSsrc=e.d_ssrc,this.emit("peerScreenShareStarted")}}},{key:"onFeatureShare",value:function(e){var t=this;this.logger.debug("start onFeatureShare - ".concat(JSON.stringify(e)));var r=e.feature_id,n=e.info;switch(r){case Lt.MIC_STATUS:n.forEach((function(e){e.set===xt.UNSET?t.emit("peerMicUnmuted"):t.emit("peerMicMuted")}));break;case Lt.SHARED_CONTENTS:case Lt.EXCLUSIVELY_SHARED_CONTENTS:var i=n[0];i.set===xt.SET?this.emit(r===Lt.SHARED_CONTENTS?"peerSharedContentsSet":"peerExclusivelySharedContentsSet",gt(i.data),void 0!==i.elapsed?i.elapsed:0):this.emit(r===Lt.SHARED_CONTENTS?"peerSharedContentsUnset":"peerExclusivelySharedContentsUnset"),r===Lt.EXCLUSIVELY_SHARED_CONTENTS&&(i.set===xt.SET?this.sharedContentsManager.setExclusivelySharedContents(this.callParams.peerId):this.sharedContentsManager.unsetExclusivelySharedContents());break;default:this.logger.debug("onFeatureShare default case")}}},{key:"onFeatureShareResult",value:function(e){this.logger.debug("start onFeatureShareResult - ".concat(JSON.stringify(e)));var t=e.feature_id,r=e.result;t===Lt.EXCLUSIVELY_SHARED_CONTENTS&&(r===Vt.OK?this.resolveExclusivelySharedContents():this.rejectExclusivelySharedContents(this.createErrorObject("FailSetExclusivelySharedContents",e.rel_phrase)),this.sharedContentsManager.completeUpdateExclusivelySharedContents())}},{key:"onRecordingStatus",value:function(e){this.logger.debug("start onRecordingStatus - ".concat(JSON.stringify(e)));var t,r=e.body;switch(this.isRecordOnCloudActivated="activated"===r["recording-status"],r["fail-reason"]){case"recording-activation-failed":case"recording-activation-failed-so":t=Kt.ACTIVATION_FAILED;break;default:t=Kt.INTERNAL}this.emit("recordOnCloudUpdated",this.isRecordOnCloudActivated,t)}},{key:"onTrackAdditional",value:function(e){this.logger.debug("call onTrackAdditional"),this.logger.debug(JSON.stringify(e)),e.transceiver.mid.startsWith("pss")&&(this.logger.debug("peerScreenShare ontrack start"),this.peerScreenShare.setupMedia(e.track))}},{key:"onCallInviteAccept",value:function(){this.onAccepted()}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ui(n.key),n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(Fn),gi=(r(7727),r(2479),Object.freeze({DISCONNECT:0,CONNECT:1})),vi=Object.freeze({STOP:0,PAUSE:1,RESUME:2}),mi=Object.freeze({STOP:0,START:1}),Si=Object.freeze({UPDATE_RESOLUTION:0,NEW_STREAM:1});function Ei(e){return Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ei(e)}function yi(e){var t=function(e,t){if("object"!=Ei(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Ei(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ei(t)?t:t+""}var _i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._planetKitUserType=Gt.UNDEFINED,this._customUserType=null,null!=t&&(Number.isInteger(t)?t>=1&&t<=9999?(this._customUserType=t,this._planetKitUserType=null):Object.values(Gt).includes(t)?this._planetKitUserType=t:this._planetKitUserType=Gt.UNKNOWN:this._planetKitUserType=Gt.UNKNOWN)}var t,r;return t=e,(r=[{key:"getPlanetKitUserType",value:function(){return this._planetKitUserType}},{key:"getCustomUserType",value:function(){return this._customUserType}},{key:"isPlanetKitUserType",value:function(){return null!==this._planetKitUserType}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yi(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ti(e){return Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ti(e)}function Ri(e){var t=function(e,t){if("object"!=Ti(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Ti(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ti(t)?t:t+""}var bi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userId=t.mid,this.aSsrc=t.a_ssrc,this.vSsrc=t.v_ssrc,this.dSsrc=t.d_ssrc,this.infoState=Sr.INIT,this.videoState=void 0===t.v_ssrc?It.DISABLED:It.ENABLED,this.screenShare=void 0,this.isSendingScreenShare=!1,this.videoView=void 0,this.transceiver=void 0,this.mediaStream=new MediaStream,this.videoStreamState=mr.INIT,this.videoRequested=!1,this.micMuted=!1,this.isSetDefaultSharedContents=!1,this.userEquipmentType=qt(t.ue_type),this.displayName=t.display_name,this.sipLocalIP=t.local_ip,this.sipDeviceInfo=t.device_info,this.userType=new _i(t.cdu_type)}var t,r;return t=e,(r=[{key:"getPeerInfo",value:function(){return{userId:this.userId,videoState:this.videoState,isSendingScreenShare:this.isSendingScreenShare,isPlayingScreenShare:this.isScreenSharePlayed(),videoRequested:this.videoRequested,micMuted:this.micMuted,userEquipmentType:this.userEquipmentType,displayName:this.displayName,sipLocalIP:this.sipLocalIP,sipDeviceInfo:this.sipDeviceInfo,vSsrc:parseInt(this.vSsrc,16),dSsrc:parseInt(this.dSsrc,16),userType:this.userType}}},{key:"getPeerVideoStatus",value:function(e){return{peer:this.getPeerInfo(),videoStatus:{state:this.videoState,pauseReason:void 0!==e?e:Nt.UNDEFINED}}}},{key:"getId",value:function(){return this.userId}},{key:"getInfoState",value:function(){return this.infoState}},{key:"setInfoState",value:function(e){this.infoState=e}},{key:"getVideoView",value:function(){this.videoView}},{key:"setVideoView",value:function(e){this.videoView=e}},{key:"getTransceiver",value:function(){return this.transceiver}},{key:"setTransceiver",value:function(e){this.transceiver=e}},{key:"getVideoState",value:function(){return this.videoState}},{key:"setVideoState",value:function(e){this.videoState=e}},{key:"getVideoRequested",value:function(){return this.videoRequested}},{key:"setVideoRequested",value:function(e){this.videoRequested=e}},{key:"getVideoStreamState",value:function(){return this.videoStreamState}},{key:"setVideoStreamState",value:function(e){this.videoStreamState=e}},{key:"setMicMute",value:function(){this.micMuted=!0}},{key:"setMicUnmute",value:function(){this.micMuted=!1}},{key:"setScreenShareSsrc",value:function(e){void 0===this.screenShare&&(this.screenShare=new _r),this.screenShare.dSsrc=e}},{key:"setSendingScreenShare",value:function(e){this.isSendingScreenShare=e}},{key:"inactiveTransceiver",value:function(){this.transceiver&&(this.transceiver.direction="inactive")}},{key:"hasVideoSsrc",value:function(){return void 0!==this.vSsrc}},{key:"isSendingVideo",value:function(){return this.videoState!==It.DISABLED}},{key:"isScreenSharePlayed",value:function(){return!!this.screenShare&&this.screenShare.isPlayed()}},{key:"setupMedia",value:function(e){var t=this;this.videoStreamState=mr.PLAY,"video"===e.kind&&this.mediaStream.getVideoTracks().forEach((function(r){e.id!==r.id&&(r.stop(),t.mediaStream.removeTrack(r))})),this.mediaStream.addTrack(e),this.mediaStream.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:e})),this.playVideo()}},{key:"playVideo",value:function(){var e=this;this.videoView&&(this.videoView.srcObject=this.mediaStream,this.videoView.play().then((function(){console.log("".concat(e.userId," play video..."))})).catch((function(t){return console.warn("Fail to play ".concat(e.userId," video - ").concat(t.message))})),this.videoView.onaddtrack=function(t){e.videoView.play().then((function(){console.log("play media")})).catch((function(e){console.warn("Fail to play : ".concat(e.message))}))})}},{key:"failedSetupVideo",value:function(){this.videoStreamState=mr.FAILED,this.videoRequested=!1,this.transceiver=void 0}},{key:"changeCallType",value:function(e){e===wt.AUDIO?(this.infoState=Sr.VIDEO_STOP,this.videoState=It.DISABLED):(this.infoState=Sr.VIDEO_START,this.videoState=It.ENABLED)}},{key:"cleanupVideo",value:function(){this.videoStreamState=mr.CLEAN,this.videoView&&(this.videoView.srcObject=null,this.videoView.pause(),this.videoView=void 0)}},{key:"release",value:function(){this.vSsrc&&(this.transceiver=void 0,this.mediaStream=void 0),this.infoState=Sr.LEAVE,this.aSsrc=void 0,this.vSsrc=void 0,this.dSsrc=void 0}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ri(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function wi(e){return wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wi(e)}function Ai(e){var t=function(e,t){if("object"!=wi(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=wi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==wi(t)?t:t+""}var Ci=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.roomId=void 0,this.roomServiceId=void 0,this.peersMap=new Map,this.assrc10PeerIdMap={},this.vssrcPeerIdMap={},this.dssrcPeerIdMap={},this.sdpMidPeerIdMap={}}var t,r;return t=e,(r=[{key:"getPeer",value:function(e){return this.peersMap.get(e)}},{key:"removePeer",value:function(e){this.peersMap.delete(e)}},{key:"getPeersUserId",value:function(){return Array.from(this.peersMap.keys())}},{key:"getPeerInfo",value:function(e){var t=this.peersMap.get(e);if(t)return t.getPeerInfo()}},{key:"getPeerBySdpMid",value:function(e){var t=this.sdpMidPeerIdMap[e];if(t)return this.peersMap.get(t)}},{key:"getPeerByVssrc",value:function(e){var t=this.vssrcPeerIdMap[e];if(t)return this.peersMap.get(t)}},{key:"getPeerByDssrc",value:function(e){var t=this.dssrcPeerIdMap[e];if(t)return this.peersMap.get(t)}},{key:"updatePeer",value:function(e){if(e.connect===gi.DISCONNECT){if(this.isPeer(e.mid)){var t=this.peersMap.get(e.mid);if(t.transceiver){var r=t.transceiver.mid;this.sdpMidPeerIdMap[r]=void 0}t.aSsrc&&delete this.assrc10PeerIdMap[parseInt(t.aSsrc,16)],t.vSsrc&&(this.vssrcPeerIdMap[t.vSsrc]=void 0),t.dSsrc&&(this.dssrcPeerIdMap[t.dSsrc]=void 0),t.release(),this.logger.debug("Room | ".concat(t.userId," leave the room"))}}else if(this.isPeer(e.mid)){var n=this.peersMap.get(e.mid);if(n.getInfoState()!==Sr.FEATURE_AHEAD)if(e.v_ssrc)n.vSsrc&&n.vSsrc!==e.v_ssrc||n.aSsrc&&n.aSsrc!==e.a_ssrc?this.rejoinPeer(n,e):(n.changeCallType(wt.VIDEO),n.vSsrc=e.v_ssrc,this.vssrcPeerIdMap[n.vSsrc]=n.userId);else if(n.aSsrc!==e.a_ssrc)this.rejoinPeer(n,e);else{if(n.videoState===It.DISABLED)return!1;n.changeCallType(wt.AUDIO)}else void 0!==n.aSsrc?(this.logger.debug("Room | feature_ahead user ".concat(n.userId," re-join the room")),this.rejoinPeer(n,e)):(n.aSsrc=e.a_ssrc,n.vSsrc=e.v_ssrc,n.dSsrc=e.d_ssrc,n.infoState=Sr.JOIN,n.videoStreamState=mr.INIT,n.userEquipmentType=qt(e.ue_type),n.displayName=e.display_name,n.sipLocalIP=e.local_ip,n.sipDeviceInfo=e.device_info,n.userType=new _i(e.cdu_type),this.assrc10PeerIdMap[parseInt(e.a_ssrc,16)]=n.userId,e.v_ssrc&&(this.vssrcPeerIdMap[e.v_ssrc]=n.userId,n.videoState===It.DISABLED&&n.setVideoState(It.ENABLED)),e.d_ssrc&&(this.dssrcPeerIdMap[e.d_ssrc]=n.userId),this.logger.debug("Room | ".concat(n.userId," join the room after feature share")))}else this.addPeerToRoom(e,Sr.JOIN);return!0}},{key:"addPeerToRoom",value:function(e,t){var r=new bi(e),n=e.mid;r.setInfoState(t),this.peersMap.set(n,r),e.a_ssrc&&(this.assrc10PeerIdMap[parseInt(e.a_ssrc,16)]=n),e.v_ssrc&&(this.vssrcPeerIdMap[e.v_ssrc]=n),e.d_ssrc&&(this.dssrcPeerIdMap[e.d_ssrc]=n),this.logger.debug("Room | Add peer to room - ".concat(n))}},{key:"addPeerToRoomByFeatureAhead",value:function(e,t){var r,n=t.src_mid;this.isPeer(n)?r=this.peersMap.get(n):(r=new bi({mid:n}),this.logger.debug("add new peer by feature ahead- ".concat(n))),r.infoState=Sr.FEATURE_AHEAD,e===Lt.CAMERA_STATUS?t.set===xt.UNSET?r.setVideoState(It.ENABLED):r.setVideoState(It.PAUSED):t.set===xt.UNSET?r.setMicUnmute():r.setMicMute(),this.peersMap.set(n,r)}},{key:"rejoinPeer",value:function(e,t){this.logger.debug("".concat(e.userId," re-join the room")),e.userId&&this.peersMap.delete(e.userId),e.aSsrc&&delete this.assrc10PeerIdMap[parseInt(e.aSsrc,16)],e.vSsrc&&(this.vssrcPeerIdMap[e.vSsrc]=void 0),e.dSsrc&&(this.dssrcPeerIdMap[e.dSsrc]=void 0),e.transceiver&&(this.sdpMidPeerIdMap[e.transceiver.mid]=void 0),e.cleanupVideo(),e.release(),this.addPeerToRoom(t,Sr.REJOIN)}},{key:"cleanRoom",value:function(){this.peersMap.forEach((function(e){e.release()}))}},{key:"isPeer",value:function(e){return this.peersMap.has(e)}},{key:"getNumberOfPeer",value:function(){return this.peersMap.size+1}},{key:"setLogger",value:function(e){this.logger=e}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ai(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ii(e){return Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ii(e)}function Oi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oi(Object(r),!0).forEach((function(t){Ni(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ni(e,t,r){return(t=ki(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ki(e){var t=function(e,t){if("object"!=Ii(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Ii(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ii(t)?t:t+""}var Mi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isHDRestricted=t.isHDRestricted,this._isHDSupported=!0!==this._isHDRestricted&&void 0,this._isResolutionChanged=void 0,this._isCurrentSdpHD=void 0,this.defaultConfigs={direction:"sendonly"},this._activeHD=!1!==this._isHDSupported}var t,r;return t=e,(r=[{key:"updateTrack",value:function(e){var t=e.getSettings(),r=t.width*t.height>=518400;this._isHDRestricted?this._isHDSupported=!1:(void 0===this._isHDSupported||(this._isResolutionChanged=r!==this._isHDSupported),this._isHDSupported=r)}},{key:"updateSenderEncoding",value:function(e){switch(e.rid){case"qvga":e.scaleResolutionDownBy=this.isHDSupported?4:2;break;case"vga":e.scaleResolutionDownBy=this.isHDSupported?2:1;break;case"hd":e.active=this.isHDSupported&&this._activeHD}}},{key:"getConfigs",value:function(){var e=this.isHDSupported;return Pi(Pi({},this.defaultConfigs),{},{sendEncodings:[{rid:"qvga",active:!0,scaleResolutionDownBy:e?4:2,maxBitrate:15e4,priority:"high"},{rid:"vga",active:!0,scaleResolutionDownBy:e?2:1,priority:"low"},{rid:"hd",active:e&&this._activeHD},{rid:"thumb",active:!1,scaleResolutionDownBy:8}]})}},{key:"needUpdateSdp",value:function(){return this.isCurrentSdpHD!=this.isHDSupported}},{key:"replaceRecvMungeSdp",value:function(e){if(null!=e){var t=e.sdp,r=new RegExp("a=simulcast:recv [\\w~;]*","m");return t=!0===this._activeHD&&!0===this._isHDSupported?t.replace(r,"a=simulcast:recv qvga;vga;hd"):t.replace(r,"a=simulcast:recv qvga;vga;~hd"),Promise.resolve({sdp:t,type:e.type})}return Promise.reject()}},{key:"isHDSupported",get:function(){return this._isHDSupported}},{key:"isResolutionChanged",get:function(){return this._isResolutionChanged}},{key:"isCurrentSdpHD",get:function(){return this._isCurrentSdpHD},set:function(e){this._isCurrentSdpHD=e}},{key:"activeHD",get:function(){return this._activeHD},set:function(e){this._activeHD=e}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ki(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Di(e){return Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Di(e)}function Li(e){var t=function(e,t){if("object"!=Di(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Di(t)?t:t+""}var xi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.extensionIdMap={},this.currentMaxExtmapId=-1}var t,r;return t=e,(r=[{key:"init",value:function(e){for(var t,r=/a=extmap:(\d+)/g,n=-1;null!==(t=r.exec(e));)n=n>parseInt(t[1])?n:parseInt(t[1]);this.currentMaxExtmapId=n}},{key:"getExtensionAddedSdp",value:function(e,t){if(this.hasRegistered(t))return e;var r=RegExp("(a=extmap:\\d+)","g"),n=e.split(r);return n[0]=n[0]+"a=extmap:".concat(++this.currentMaxExtmapId," ").concat(t,"\n"),this.extensionIdMap[t]=this.currentMaxExtmapId,n.join("")}},{key:"registerExtension",value:function(e,t){this.extensionIdMap[e]=t}},{key:"hasRegistered",value:function(e){return Object.keys(this.extensionIdMap).some((function(t){return t===e}))}},{key:"getExtensionId",value:function(e){return this.extensionIdMap[e]}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Li(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Vi(e){return Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vi(e)}function Ui(e,t){if(e){if("string"==typeof e)return ji(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ji(e,t):void 0}}function ji(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Hi(e){var t=function(e,t){if("object"!=Vi(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Vi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vi(t)?t:t+""}r(189);var Bi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.previousTalkers=new Set,this.timestampDiff=void 0}var t,r;return t=e,(r=[{key:"start",value:function(e){var t=this,r=e.room.assrc10PeerIdMap;this.intervalId=setInterval((function(){if(t.session){var n,i=null===(n=t.session.sessionDescriptionHandler.peerConnection)||void 0===n?void 0:n.getReceivers()[0];if(!i)return;var o,a=[],s=[],c=[],u=Date.now(),l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ui(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(i.getContributingSources());try{for(l.s();!(o=l.n()).done;){var d=o.value;void 0===t.timestampDiff&&(t.timestampDiff=u-d.timestamp);var h=r[d.source];void 0!==h&&(t.previousTalkers.has(h)?(u-t.timestampDiff-d.timestamp>500?s.push(h):c.push(h),t.previousTalkers.delete(h)):u-t.timestampDiff-d.timestamp<=500&&(a.push(h),c.push(h)))}}catch(e){l.e(e)}finally{l.f()}s.push.apply(s,function(e){return function(e){if(Array.isArray(e))return ji(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ui(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.previousTalkers)),t.previousTalkers=new Set(c),(a.length||s.length)&&e.callback({active:a,inactive:s})}}),500)}},{key:"stop",value:function(){clearInterval(this.intervalId)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Hi(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $i(e){return $i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$i(e)}function Fi(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function qi(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Fi(o,n,i,a,s,"next",e)}function s(e){Fi(o,n,i,a,s,"throw",e)}a(void 0)}))}}function Wi(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Ki(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ki(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Ki(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Gi(e){var t=function(e,t){if("object"!=$i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=$i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$i(t)?t:t+""}function Yi(e,t){return Yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yi(e,t)}function zi(e){var t=Xi();return function(){var r,n=Ji(e);if(t){var i=Ji(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==$i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Xi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Xi=function(){return!!e})()}function Ji(e){return Ji=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ji(e)}var Zi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yi(e,t)}(a,e);var r,n,i,o=zi(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,"conference")}return r=a,n=[{key:"wtpConferenceInit",value:function(){this.room=new Ci,this.room.setLogger(this.logger),this.userInfoMutex=new Ye,this.simulcastHandler=new Mi({isHDRestricted:this.isHDRestricted}),this.sdpManager=new xi,this.toneSoundManager.init(this.callParams)}},{key:"wtpConferenceJoin",value:function(e){var r=this;if(!ht())return Promise.reject(this.createErrorObject("BrowserNotSupported","This browser is not supported."));var n=this.checkValidationCallParams(e),i=n.isValidCallParams,o=n.callParamsError;if(!i)return Promise.reject(o);this.setCallParams(e),this.callParams.maxSendLinkBandwidth&&this.callParams.maxSendLinkBandwidth<1900&&(this.isHDRestricted=!0),this.logger.debug("wtpConferenceJoin | Start"),this.changeState($n.STATE_READY),this.wtpConferenceInit(),this.callDir=bt.CONFERENCE,this.callTypeState=this.callParams.callType===wt.AUDIO?At.AUDIO:At.VIDEO,this.setInitMediaState({videoMuteCallback:function(e){e.setState(!r.callParams.cameraOn),r.callParams.cameraOn||r.callTypeState!==At.VIDEO||r.wtpPauseMyVideo()},audioMuteCallback:function(e){e.setState(!r.callParams.micOn),0==r.callParams.micOn&&r.wtpMuteMyAudio()}}),this.createUa(this.callParams.myId);var a=this.room;return this.ua.start().then((function(){return r.localMediaStreamManager.init(Object.assign(r.callParams,{isHDRestricted:r.isHDRestricted}))})).catch((function(e){return r.onLocalMediaStreamManagerInitError(e,!1),Promise.reject(e)})).then((function(){var e,t;if(r.logger.debug("wtpConferenceJoin | Start UserAgent"),r.remoteMediaStreamManager.setRemoteAudioElement(null===(e=r.callParams.media)||void 0===e||null===(t=e.remote)||void 0===t?void 0:t.audio),r.localMediaStreamManager.getUserMediaStateError){var n=r.localMediaStreamManager.getUserMediaStateError;r.emit("debugNotice",kn(n.name,n.message))}r.changeState($n.STATE_CONNECTING);var i=r.setPlnExtraInviteHeaders(bt.CONFERENCE);r.createInviteSession(i,{delegate:{onUserInfo:function(e){var t,n=Date.now(),i=e.member_count,o=[],s=[],c=[],u=[],l=[],d=[],h=[],p=Wi(e.info);try{for(p.s();!(t=p.n()).done;){var f=t.value;if(r.logger.debug("onUserInfo | ".concat(n," | Start ").concat(JSON.stringify(f))),a.updatePeer(f)){var g=r.room.getPeer(f.mid);if(void 0!==g){var v;if(f.connect===gi.DISCONNECT)null!==(v=g.screenShare)&&void 0!==v&&v.isPlayed()&&d.push({peerId:g.getId(),screenShare:g.screenShare}),g.isSendingVideo()&&(g.getVideoStreamState()!==mr.STOP&&r.wtpConferenceRemovePeerVideo(g.getId()),g.getVideoStreamState()!==mr.PLAY&&g.getVideoStreamState()!==mr.STOP||(g.setVideoStreamState(mr.CLEAN),h.push({peerId:g.getId(),videoView:g.getVideoView(),transceiver:g.getTransceiver()})));else if(g.infoState===Sr.REJOIN){var m=Object.assign(g.getPeerInfo(),{state:Sr.LEAVE});c.push(m),r.logger.debug("Send feature-query for rejoin user ".concat(g.getId())),r.sendFeatureQuery(Lt.MIC_STATUS,g.getId()),r.sendFeatureQuery(Lt.CAMERA_STATUS,g.getId()),g.infoState=Sr.JOIN}switch(g.infoState){case Sr.LEAVE:var S=g.getPeerInfo();!0===g.isSetDefaultSharedContents&&u.push(S.userId),s.push(S),r.room.removePeer(S.userId);break;case Sr.JOIN:o.push(g),g.isSendingVideo()&&l.push(g);break;case Sr.VIDEO_START:case Sr.VIDEO_STOP:l.push(g)}}}}}catch(e){p.e(e)}finally{p.f()}r.sdpMutex.acquire().then((function(){c.length&&(r.logger.debug("onUserInfo | ".concat(n," | peersRemoved before rejoin")),c.forEach((function(e){r.sendFeatureQuery(Lt.SHARED_CONTENTS,e.userId)})),r.emit("confPeerListUpdated",{addedPeers:[],removedPeers:c,totalPeersCount:i-1})),d.forEach((function(e){r.cleanupScreenShare(e)})),h.forEach((function(e){r.cleanupPeerVideo(e)})),u.length&&r.emit("peersSharedContentsUnset",u);var e=[];if(o.length||s.length){o.forEach((function(t){void 0!==t&&t.getInfoState()===Sr.JOIN&&(t.setInfoState(Sr.JOIN_COMPLETE),e.push(t.getPeerInfo()))}));var t={addedPeers:e,removedPeers:s,totalPeersCount:i};r.logger.debug("onUserInfo | ".concat(n," | PeerListUpdated event param = ").concat(JSON.stringify(t))),r.emit("confPeerListUpdated",t)}if(r.isVideoCall()&&l.length){var a=[];l.forEach((function(e){void 0!==e&&a.push(e.getPeerVideoStatus())})),r.logger.debug("onUserInfo | ".concat(n," | PeerVideoUpdated event param = ").concat(JSON.stringify(a))),r.emit("confPeersVideoUpdated",a)}})).finally((function(){return r.sdpMutex.release()}))},onNotifyUserStatus:function(e){for(var t=[],n=function(n){var i=void 0,o=e[n];o.s===vi.STOP?(o.ssrc?i=r.room.getPeerByVssrc(o.ssrc):r.logger.warn("Not found peer by notify-user-status"),void 0!==i?(r.logger.debug("onNotifyUserStatus STOP - ".concat(i.getId())),i.getVideoState()!==It.DISABLED&&(i.changeCallType(wt.AUDIO),t.push(i.getPeerVideoStatus())),r.isVideoCall()&&r.wtpConferenceRemovePeerVideo(i.getId()).catch((function(e){r.logger.warn(e)})).finally((function(){n===e.length-1&&t.length&&r.emit("confPeersVideoUpdated",t)}))):r.logger.debug("Skip notifyUserStatus becuase peer is undefined - userId=".concat(o.mid,"/ssrc=").concat(o.ssrc))):r.logger.warn("onNotifyUserStatus invalid status - ".concat(o.s))},i=0;i<e.length;i++)n(i)},onRequestUserView:function(e){},onFeatureShare:function(e){var t=e.feature_id,n=e.info;switch(t){case Lt.CAMERA_STATUS:r.logger.debug("onFeatureShare Camera status - ".concat(JSON.stringify(n)));var i=[],o=[];n.forEach((function(e){var t=r.room.getPeer(e.src_mid);void 0!==t&&t.getInfoState()!==Sr.FEATURE_AHEAD?e.set===xt.UNSET?t.getVideoState()===It.PAUSED&&(t.setVideoState(It.ENABLED),t.getInfoState()>=Sr.JOIN_COMPLETE&&o.push(t.getPeerInfo())):t.getVideoState()===It.ENABLED&&!0!==e.data["vid-disabled"]&&(t.setVideoState(It.PAUSED),t.getInfoState()>=Sr.JOIN_COMPLETE&&i.push({peer:t.getPeerInfo(),pauseReason:e.data["off-reason"]})):(r.logger.debug("Add ahead video paused peer - ".concat(e.src_mid)),r.room.addPeerToRoomByFeatureAhead(Lt.CAMERA_STATUS,e))})),r.isVideoCall()&&(i.length&&r.emit("confPeersVideoPaused",i),o.length&&r.emit("confPeersVideoResumed",o));break;case Lt.MIC_STATUS:r.logger.debug("onFeatureShare Mic status - ".concat(JSON.stringify(n)));var a=[],s=[];n.forEach((function(e){var t=r.room.getPeer(e.src_mid);void 0!==t&&t.getInfoState()!==Sr.FEATURE_AHEAD?e.set===xt.UNSET?(t.setMicUnmute(),t.getInfoState()>=Sr.JOIN_COMPLETE&&s.push(t.getPeerInfo())):(t.setMicMute(),t.getInfoState()>=Sr.JOIN_COMPLETE&&a.push(t.getPeerInfo())):(r.logger.debug("Add ahead mic muted peer - ".concat(e.src_mid)),r.room.addPeerToRoomByFeatureAhead(Lt.MIC_STATUS,e))})),a.length&&r.emit("confPeersMicMuted",a),s.length&&r.emit("confPeersMicUnmuted",s);break;case Lt.SHARED_CONTENTS:var c=[],u=[];n.forEach((function(e){var t=r.room.getPeer(e.src_mid);t&&(e.set===xt.SET?(t.isSetDefaultSharedContents=!0,c.push({userId:e.src_mid,data:gt(e.data),elapsedTimeAfterSetMs:void 0!==e.elapsed?e.elapsed:0})):(t.isSetDefaultSharedContents=!1,u.push(e.src_mid)))})),c.length&&r.emit("peersSharedContentsSet",c),u.length&&r.emit("peersSharedContentsUnset",u);break;case Lt.EXCLUSIVELY_SHARED_CONTENTS:case Lt.ROOM_SHARED_CONTENTS:var l=n[0];l.set===xt.SET?r.emit(t===Lt.EXCLUSIVELY_SHARED_CONTENTS?"peerExclusivelySharedContentsSet":"peerRoomSharedContentsSet",l.src_mid,gt(l.data),void 0!==l.elapsed?l.elapsed:0):r.emit(t===Lt.EXCLUSIVELY_SHARED_CONTENTS?"peerExclusivelySharedContentsUnset":"peerRoomSharedContentsUnset",l.src_mid);break;default:r.logger.debug("onFeatureShare default case")}},onFeatureShareResult:function(e){var t=e.feature_id,n=e.result;switch(t){case Lt.EXCLUSIVELY_SHARED_CONTENTS:n===Vt.OK?r.resolveExclusivelySharedContents():r.rejectExclusivelySharedContents(r.createErrorObject("FailSetExclusivelySharedContents",e.rel_phrase)),r.sharedContentsManager.completeUpdateExclusivelySharedContents();break;case Lt.ROOM_SHARED_CONTENTS:n===Vt.OK?r.resolveRoomSharedContents():r.rejectRoomSharedContents(r.createErrorObject("FailSetRoomSharedContents",e.rel_phrase)),r.sharedContentsManager.completeUpdateRoomSharedContents()}},onDataCtrl:function(e){r.logger.debug("onDataCtrl message - ".concat(JSON.stringify(e))),void 0!==e.event&&(e.d_ssrc?function e(t){var n,i=null===(n=r.room)||void 0===n?void 0:n.getPeerByDssrc(t.d_ssrc);if(void 0!==i)switch(void 0!==r.onDataCtrlTimer&&(clearTimeout(r.onDataCtrlTimer),r.onDataCtrlTimer=void 0),r.logger.debug("start onDataCtrl - ".concat(JSON.stringify(i.getPeerInfo()))),t.event){case 0:i.setSendingScreenShare(!1),r.emit("peerScreenShareStopped",i.getId());break;case 1:i.setSendingScreenShare(!0),i.setScreenShareSsrc(i.dSsrc),r.emit("peerScreenShareStarted",i.getId())}else r.logger.debug("DataCtrl couldn't find dssrc ".concat(t.d_ssrc)),r.onDataCtrlTimer=setTimeout((function(){e(t)}),1e3)}(e):r.logger.warn("d_ssrc is not exist in the info body"))},onApplicationControl:function(e){r.logger.debug("onApplicationControl message"),null!=e&&e.data&&r.emit("appControlMessageReceived",gt(null==e?void 0:e.data))}},peerConnectionDelegate:{onTrack:function(e){r.logger.debug("Conference | peerConnectionDelegate.onTrack");var t,n=e.transceiver.mid;if(n.match(/^\d/))0!=n&&1!=n&&void 0!==(t=a.getPeerBySdpMid(e.transceiver.mid))&&(r.logger.debug("Conference | Add track - userId=".concat(t.getId(),"/sdp=").concat(n)),t.setupMedia(e.track));else{var i=n.slice(3);(t=a.getPeerByDssrc(i)).screenShare.setupMedia(e.track),r.logger.debug("Conference | Add screen share track - userId=".concat(t.getId(),"/dSsrc=").concat(i))}}}})})).then((function(){r.transceiverHandler.setSession(r.session),r.callParams.enableTalkingStatusEvent&&(r.myTalkingStatusManager=new Xn({mediaStreamManager:r.localMediaStreamManager}),r.peersTalkingStatusManager=new Bi(r.session)),r.callParams.maxSendLinkBandwidth&&(r.txBitrateManager=new ai({session:r.session,service:r.service,maxSendLinkBandwidth:r.callParams.maxSendLinkBandwidth,logger:r.logger})),r.videoInputDeviceId=r.localMediaStreamManager.videoInputDeviceId;var e={sdpModifier:[function(e){var t=sr(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});t=cr(t,{imageattr:"true"});var n=new RegExp("a=group:BUNDLE 0","m");return e.sdp=t,e.sdp=e.sdp.replace(n,"a=group:BUNDLE"),"offer"===e.type&&(r.sdpManager.init(e.sdp),e.sdp=r.sdpManager.getExtensionAddedSdp(e.sdp,"urn:ietf:params:rtp-hdrext:csrc-audio-level")),Promise.resolve(e)},t],sdhOptions:{isConference:!0,cameraOn:r.callParams.cameraOn,micOn:r.callParams.micOn,constraints:r.getConstraints(),localMediaStreamManager:r.localMediaStreamManager,remoteMediaStreamManager:r.remoteMediaStreamManager,simulcastHandler:r.simulcastHandler,ignoreDeviceError:r.callParams.ignoreDeviceError},inviteDelegate:{onAccept:function(e){var t;r.onAccepted(),null===(t=r.peersTalkingStatusManager)||void 0===t||t.start({room:r.room,callback:function(e){r.emit("confPeersTalkingStatusUpdated",e)}})}}};return r.sendInvite(e)})).catch((function(e){return r.plnRelCode?r.onFailed():r.onUaStartFailed(e),Promise.reject(e)}))}},{key:"wtpConferenceLeave",value:function(){if(this.state===$n.STATE_CONNECTED){if(this.room.cleanRoom(),this.room=void 0,this.releaser=Ot.THIS,this.session){this.callTerminate=!0;var e,t=[];return this.state===$n.STATE_CONNECTED?(this.plnRelCode=ir.NORMAL,e="NORMAL"):(this.plnRelCode=ir.UNDEFINED,e="UNDEFINED"),t.push("P-Reason: "+this.plnRelCode+";"+e+";"+bt.INITIATOR),this.session.bye({requestOptions:{extraHeaders:t}})}}else this.logger.warn("No active conference to leave")}},{key:"wtpConferenceRequestPeerVideo",value:function(e){var t=this;if(!this.isVideoCall())return Promise.reject(this.createErrorObject("WrongMediaType","Media type should be video to request peer video"));Array.isArray(e)||(e=[e]);var r,n=this.room,i=[],o=Wi(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(void 0!==a.userId&&void 0!==a.resolution&&void 0!==a.videoViewElement){var s=this._changeToValidResolutionValue(a.resolution);if(null!==s){var c=a.userId;if(n.isPeer(c)){var u=n.getPeer(c);u.hasVideoSsrc()?u.videoRequested?this.logger.warn("".concat(c," has already requested video")):(u.setVideoRequested(!0),u.setVideoView(a.videoViewElement),i.push({mid:c,ssrc:u.vSsrc,rq:mi.START,layerid:s,start_op:Si.NEW_STREAM})):this.logger.warn("".concat(c," has no video ssrc"))}else this.logger.warn("".concat(c," is not peer of room"))}else this.logger.warn("RequestVideo fail - Wrong resolution settings ".concat(a.resolution))}else this.logger.error("RequestVideo fail - Mandatory field in param is mssing"),this.logger.warn(a)}}catch(e){o.e(e)}finally{o.f()}return 0===i.length?Promise.resolve():(this.logger.debug("wtpConferenceRequestPeerVideo | Start"),this.setupPeerVideo(i).then((function(){var e={content:i,contentType:Dt.REQUEST_USER_VIEW};return t.sendInfo(e).then((function(){return t.logger.debug("wtpConferenceRequestPeerVideo | sendInfo done"),Promise.resolve()}))})).catch((function(e){return Promise.reject(e)})))}},{key:"wtpConferenceRemovePeerVideo",value:function(e){var t=this;Array.isArray(e)||(e=[e]);var r,n=this.room,i=[],o=Wi(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(n.isPeer(a)){var s=n.getPeer(a);s.hasVideoSsrc()?s.videoRequested?(s.setVideoStreamState(mr.STOP),s.setVideoRequested(!1),i.push({mid:a,ssrc:s.vSsrc,rq:mi.STOP,start_op:Si.UPDATE_RESOLUTION})):this.logger.debug("".concat(a," has already removed video")):this.logger.debug("".concat(a," has no video ssrc"))}else this.logger.debug("".concat(a," is not peer of room"))}}catch(e){o.e(e)}finally{o.f()}if(0===i.length)return Promise.resolve();var c={content:i,contentType:Dt.REQUEST_USER_VIEW};return this.sendInfo(c).then((function(){var e;return t.logger.debug("wtpConferenceRemovePeerVideo | sendInfo done"),i.forEach((function(t){(e=n.getPeer(t.mid)).videoView.srcObject=null,e.videoView.pause()})),Promise.resolve()}))}},{key:"wtpConferenceRequestPeerMute",value:function(e,t){this.wtpRequestPeerMute([e],t)}},{key:"wtpConferenceRequestPeersMute",value:function(e){this.wtpRequestPeerMute(this.wtpConferenceGetPeersUserId(),e)}},{key:"wtpConferenceUpdatePeerVideo",value:function(e,t){var r=this._changeToValidResolutionValue(t);if(null===r)return this.logger.warn("UpdatePeerVideo fail - Wrong resolution settings ".concat(t)),Promise.reject(this.createErrorObject("NotValidResolution","Wrong resolution settings '".concat(r,"'")));Array.isArray(e)||(e=[e]),this.logger.debug("wtpConferenceUpdatePeerVideo | start");var n,i=[],o=Wi(e);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(this.room.isPeer(a)){var s=this.room.getPeer(a);s.hasVideoSsrc()?s.videoRequested?i.push({mid:a,ssrc:s.vSsrc,rq:mi.START,layerid:r,start_op:Si.UPDATE_RESOLUTION}):this.logger.warn("".concat(a," video was removed")):this.logger.warn("".concat(a," has no video ssrc"))}else this.logger.warn("".concat(a," is not in the room"))}}catch(e){o.e(e)}finally{o.f()}if(this.logger.debug("wtpConferenceUpdatePeerVideo | info - ".concat(e.join()," / resolution=").concat(r)),0===i.length)return Promise.resolve();var c={content:i,contentType:Dt.REQUEST_USER_VIEW};return this.sendInfo(c)}},{key:"wtpConferenceChangePeerView",value:(i=qi(regeneratorRuntime.mark((function e(t,r,n){var i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("wtpConferenceChangePeerView | Start - userId=".concat(t)),this.room.isPeer(t)){e.next=4;break}throw this.logger.debug("wtpConferenceChangePeerView | ".concat(t," is not in the room")),this.createErrorObject("NotPeer","Fail to change peer view because ".concat(t," is not in the room."));case 4:if(r){e.next=6;break}throw this.createErrorObject("InvalidElement","Fail to change peer view because videoElement is invalid.");case 6:return i=this.room.getPeer(t),o=n&&i.videoView?i.videoView:void 0,r.srcObject=i.mediaStream,r.muted=!0,i.setVideoView(r),e.prev=11,e.next=14,i.videoView.play();case 14:o&&(o.videoView.srcObject=null,o.videoView.pause()),this.logger.debug("wtpConferenceChangePeerView | Peer(".concat(t,") view is changed.")),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),this.logger.warn("wtpConferenceChangePeerView | Fail to play the changed peer view. ".concat(e.t0.message));case 21:case"end":return e.stop()}}),e,this,[[11,18]])}))),function(e,t,r){return i.apply(this,arguments)})},{key:"wtpConferenceRequestAllUserInfo",value:function(){var e={content:{contents_type:1,info:[]},contentType:Dt.REQUEST_USER_INFO};this.sendInfo(e)}},{key:"wtpConferenceEnableVideo",value:function(e){return this.wtpEnableVideo(Object.assign({onAccept:function(){}},e))}},{key:"wtpConferenceDisableVideo",value:function(){return this.wtpDisableVideo()}},{key:"wtpConferenceGetPeersInfo",value:function(){var e,t=[],r=Wi(this.room.peersMap.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;void 0!==n&&n.getInfoState()!==Sr.FEATURE_AHEAD&&t.push(n.getPeerInfo())}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"wtpConferenceGetPeerInfo",value:function(e){return this.room.getPeerInfo(e)}},{key:"wtpConferenceGetPeersUserId",value:function(){return this.room.getPeersUserId()}},{key:"wtpConferenceIsPeer",value:function(e){return this.room.isPeer(e)}},{key:"wtpConferenceAddPeerScreenShareView",value:function(e,t){var r,n,i=this,o=this.session.sessionDescriptionHandler,a=o.peerConnection;return this.sdpMutex.acquire().then((function(){if(!i.room.isPeer(e))return i.logger.debug("wtpConferenceAddPeerScreenShareView | ".concat(e," is not in the room")),Promise.reject(i.createErrorObject("NotPeer","Fail to add peer screenShare because ".concat(e," is not in the room")));if(!(r=i.room.getPeer(e)).screenShare)return Promise.reject(i.createErrorObject("NotValidScreenShare","".concat(e," can't set screen share because ssrc is not set")));switch((n=r.screenShare).setVideoView(t),i.logger.debug("wtpConferenceAddPeerScreenShareView | Start - userId=".concat(e,"/state=").concat(n.state)),n.state){case Ut.INIT:case Ut.FAILED:var o=i.transceiverHandler.getTransceiver("video","recvonly");return n.setTransceiver(o),n.sdpMid="pss".concat(r.dSsrc),n.setState(Ut.START),i.logger.debug("wtpConferenceAddPeerScreenShareView | peerConnection signaling state = ".concat(a.signalingState)),Promise.resolve("NEW");case Ut.START:case Ut.RESTART:return Promise.resolve("START");case Ut.STOP:return n.setState(Ut.RESTART),Promise.resolve("RESTART");default:return Promise.reject(i.createErrorObject("NotValidScreenShareState","Peer screenShare state is not vliad to start (currentState=".concat(jt(n.state),")")))}})).then((function(t){return"NEW"===t?o.createLocalOfferOrAnswer().then((function(e){return i.mungeOfferSdp(e,{sdpMid:n.sdpMid,type:"screenshare"})})).then((function(e){return o.setLocalSessionDescription(e)})).then((function(){return i.addVideoMungeAnswerSdp([{direction:"sendonly",ssrc:n.dSsrc,sdpMid:n.sdpMid}])})).then((function(e){return a.setRemoteDescription(e)})).then((function(){return i.logger.debug("wtpConferenceAddPeerScreenShareView | Add done - userId=".concat(e,"/sdpMid=").concat(n.sdpMid)),i.sdpMutex.release()})).catch(function(){var t=qi(regeneratorRuntime.mark((function t(r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.logger.debug("Error while set peerScreenShare sessionDescription. pc state is ".concat(a.signalingState)),i.logger.debug(r),"have-local-offer"!==a.signalingState){t.next=9;break}return i.transceiverHandler.addSpareTransceiver(n.transceiver),s=new RegExp(" ".concat(n.sdpMid,"\\b")),i.bundleLine=i.bundleLine.replace(s,""),n.failedSetupVideo(),t.next=9,o.rollbackLocalSessionDescription();case 9:return t.abrupt("return",Promise.reject(i.createErrorObject("SessionDescriptionFail","Fail to set ".concat(e," screenShare session description"))));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):"RESTART"===t?(i.logger.debug("wtpConferenceAddPeerScreenShareView | Restart peer screenShare - userId=".concat(e,"/dSsrc=").concat(n.dSsrc)),n.playVideo(),i.sdpMutex.release(),Promise.resolve()):(i.sdpMutex.release(),Promise.resolve())})).catch((function(t){return i.logger.debug("wtpConferenceAddPeerScreenShareView | Fail - userId=".concat(e)),i.sdpMutex.release(),Promise.reject(t)}))}},{key:"wtpConferenceRemovePeerScreenShareView",value:function(e){if(this.logger.debug("wtpConferenceRemovePeerScreenShareView | Start - userId=".concat(e)),!this.room.isPeer(e))return this.logger.debug("wtpConferenceRemovePeerScreenShareView | ".concat(e," is not in the room")),Promise.reject(this.createErrorObject("NotPeer","Fail to remove peer screenShare because ".concat(e," is not in the room")));var t=this.room.getPeer(e).screenShare;return t.state!==Ut.FAILED&&t.cleanupView(),Promise.resolve()}},{key:"wtpConferenceChangePeerScreenShareView",value:function(e,t,r){var n=this;return new Promise((function(i,o){if(!n.room.isPeer(e))return n.logger.debug("wtpConferenceChangePeerScreenShareView | ".concat(e," is not in the room")),void o(n.createErrorObject("NotPeer","Fail to change a peer screenShare view because ".concat(e," is not in the room")));var a=n.room.getPeer(e);!a.screenShare||a.screenShare.state!==Ut.START&&a.screenShare.state!==Ut.RESTART?o(n.createErrorObject("ScreenShareNotPlaying","Peer Screen share is not playing")):a.screenShare.changeVideoView(t,r).then((function(){n.logger.debug("wtpConferenceChangePeerScreenShareView | Conference peer screen share view is changed - userId=".concat(e)),i()})).catch((function(e){return n.logger.debug("wtpConferenceChangePeerScreenShareView | Catch exception : ".concat(e))}))}))}},{key:"wtpConferenceSendShortData",value:function(e,t,r){if(!(t instanceof Uint8Array))return Promise.reject(this.createErrorObject("WrongDataType","data type should be Uint8Array"));if(e.length>100)return Promise.reject(this.createErrorObject("ExceedMaxSizeType","Type must not exceed 100 bytes"));if(t.length>800)return Promise.reject(this.createErrorObject("ExceedMaxSizeData","Data must not exceed 800 bytes"));var n={body_type:e,body:vt(t),target:void 0!==r?r:this.wtpConferenceGetPeersUserId(),source:this.callParams.myId,source_svc_id:this.callParams.fromSvcId};return this.wtpSendShortData(n)}},{key:"wtpConferenceSetRoomSharedContents",value:function(e){var t=this;return this.sharedContentsManager.isProcessingUpdateRoomSharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateRoomSharedContents","Update room shared contents process is in progress")):new Promise((function(r,n){t.resolveRoomSharedContents=r,t.rejectRoomSharedContents=n,t.checkValiditySharedContentsData(e).then(qi(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.sendFeatureShare(Lt.ROOM_SHARED_CONTENTS,xt.SET,vt(e));case 2:t.sharedContentsManager.waitResultUpdateRoomSharedContents();case 3:case"end":return r.stop()}}),r)})))).catch((function(e){n(e)}))}))}},{key:"wtpConferenceRoomUnsetRoomSharedContents",value:function(){var e=this;return this.sharedContentsManager.isProcessingUpdateRoomSharedContents()?Promise.reject(this.createErrorObject("InProgressUpdateRoomSharedContents","Update room shared contents process is in progress")):new Promise((function(t,r){e.resolveRoomSharedContents=t,e.rejectRoomSharedContents=r,e.sendFeatureShare(Lt.ROOM_SHARED_CONTENTS,xt.UNSET).then((function(){e.sharedContentsManager.waitResultUpdateRoomSharedContents()})).catch((function(e){r(e)}))}))}},{key:"setupPeerVideo",value:function(e){var t=this;this.logger.debug("setupPeerVideo | Start"),this.logger.debug(JSON.stringify(e));var r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=new Map;return e.forEach((function(e){i.set(e.mid,{vSsrc:e.ssrc,transceiver:void 0})})),this.sdpMutex.acquire().then((function(){var r,o,a=!1,s=Wi(e);try{var c=function(){var e=o.value;if(!t.room.isPeer(e.mid))return i.delete(e.mid),t.logger.debug("setupPeerVideo | ".concat(e.mid," is not in the room")),"continue";if(r=t.room.getPeer(e.mid),t.logger.debug("setupPeerVideo | ".concat(r.getId()," video state is ").concat(r.getVideoStreamState())),r.getVideoStreamState()===mr.STOP||r.getVideoStreamState()===mr.PLAY)i.delete(r.getId()),r.setVideoStreamState(mr.PLAY),r.videoView.srcObject=r.mediaStream,r.videoView.play().then((function(){return t.logger.debug("".concat(e.mid," replay video"))})).catch((function(r){return t.logger.warn("Fail to replay ".concat(e.mid," video - ").concat(r.message))}));else{var n=i.get(r.getId());if(n.vSsrc!==r.vSsrc)return t.logger.debug("Skip setupPeerVideo because peer is renew instance - userId=".concat(r.getId())),i.delete(r.getId()),"continue";var s=t.transceiverHandler.getTransceiver("video","recvonly");r.setTransceiver(s),n.transceiver=s,r.setVideoStreamState(mr.READY),a=!0}};for(s.s();!(o=s.n()).done;)c()}catch(e){s.e(e)}finally{s.f()}return t.logger.debug("setupPeerVideo | peerConnection signaling state = ".concat(n.signalingState)),Promise.resolve(a)})).then((function(e){return e?r.createLocalOfferOrAnswer().then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){i.forEach((function(e,r){var n=t.room.getPeer(r),i=e.transceiver;e.vSsrc===(null==n?void 0:n.vSsrc)&&(t.room.sdpMidPeerIdMap[i.mid]=r),t.bundleLine+=" "+i.mid}))})).then((function(){return t._conferencePeerJoinMungeAnswerSdp(i)})).then((function(e){return n.setRemoteDescription(e)})).then((function(){return t.sdpMutex.release()})).catch(function(){var e=qi(regeneratorRuntime.mark((function e(o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("have-local-offer"!==n.signalingState){e.next=4;break}return i.forEach((function(e,r){t.transceiverHandler.addSpareTransceiver(e.transceiver),t.room.sdpMidPeerIdMap[e.transceiver.mid]=void 0,a=new RegExp(" ".concat(e.transceiver.mid,"\\b")),t.bundleLine=t.bundleLine.replace(a,"");var n=t.room.getPeer(r);e.vSsrc===n.vSsrc&&n.failedSetupVideo()})),e.next=4,r.rollbackLocalSessionDescription();case 4:return t.sdpMutex.release(),e.abrupt("return",Promise.reject(t.createErrorObject("SessionDescriptionFail","Fail to setup peer video session description")));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):(t.sdpMutex.release(),Promise.resolve())})).catch((function(e){return t.logger.warn("Fail to setupPeerVideo"),t.sdpMutex.release(),Promise.reject(e)}))}},{key:"cleanupPeerVideo",value:function(e){var t=this;if(this.logger.debug("cleanupPeerVideo | Start - userId=".concat(e.peerId)),void 0!==e.transceiver){var r=e.transceiver;r.direction="inactive";var n=this.session.sessionDescriptionHandler,i=n.peerConnection;return this.logger.debug("cleanupPeerVideo | peerConnection signaling state = ".concat(i.signalingState)),this.sdpMutex.acquire().then((function(){return n.createLocalOfferOrAnswer()})).then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return n.setLocalSessionDescription(e)})).then((function(){return t.changeVideoDirectionMungeAnswerSdp(r.mid,"sendonly","inactive")})).then((function(e){return i.setRemoteDescription(e)})).then((function(){return e.videoView&&(e.videoView.srcObject=null,e.videoView.pause()),t.sdpMutex.release()})).catch((function(r){return t.logger.error("Fail to clean ".concat(e.peerId," video - ").concat(r.message)),t.sdpMutex.release(),Promise.reject()}))}this.logger.debug("Skip cleanupPeerVideo ".concat(e.peerId," no transceiver"))}},{key:"cleanupScreenShare",value:function(e){var t=this,r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=e.screenShare;return this.sdpMutex.acquire().then((function(){return t.logger.debug("cleanupScreenShare | Start userId=".concat(e.peerId)),i.inactiveTransceiver(),t.logger.debug("cleanupScreenShare | peerConnection signaling state=".concat(n.signalingState)),Promise.resolve()})).then((function(){return r.createLocalOfferOrAnswer()})).then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){return t.changeVideoDirectionMungeAnswerSdp(i.transceiver.mid,"sendonly","inactive")})).then((function(e){return n.setRemoteDescription(e)})).then((function(){return i.cleanupVideo()})).catch((function(r){return t.logger.error("cleanupScreenShare | Fail to clean screenShare ".concat(e.peerId," video - ").concat(r.message))})).finally((function(){return t.sdpMutex.release()}))}},{key:"changeOutputVideoResolution",value:function(e){var t=this;if(this.callParams.callType===wt.VIDEO){this.logger.debug("changeOutputVideoResolution | Start");var r=this.session.sessionDescriptionHandler,n=r.peerConnection,i=n.getSenders()[1];if(1===e.rq){var o=e.ly-3,a=i.getParameters();a.encodings.forEach((function(e,t){e.active=!(o+t<0)})),this.sdpMutex.acquire().then((function(){return Promise.resolve(i.setParameters(a))})).then((function(){return r.createLocalOfferOrAnswer()})).then((function(e){return t.mungeOfferSdp(e)})).then((function(e){return r.setLocalSessionDescription(e)})).then((function(){var e=n.currentRemoteDescription.sdp;return n.setRemoteDescription({sdp:e,type:"answer"})})).then((function(){return t.sdpMutex.release()}))}}}},{key:"_conferencePeerJoinMungeAnswerSdp",value:function(e){var t=this;this.logger.debug("_conferencePeerJoinMungeAnswerSdp | start");var r=[];return e.forEach((function(e,n){t.logger.debug("_conferencePeerJoinMungeAnswerSdp | userId=".concat(n," / ssrc=").concat(e.vSsrc," / parseSsrc=").concat(parseInt(e.vSsrc,16))),r.push({direction:"sendonly",sdpMid:e.transceiver.mid,ssrc:e.vSsrc})})),this.addVideoMungeAnswerSdp(r)}},{key:"_changeToValidResolutionValue",value:function(e){if(!["thumbnail","qvga","vga","hd"].includes(e))return Object.values(vr).includes(e)?e:null;switch(e){case"qvga":return vr.QVGA;case"vga":return vr.VGA;case"hd":return vr.HD;case"thumbnail":return vr.THUMBNAIL}}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Gi(n.key),n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),a}(Fn);function Qi(e){return Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qi(e)}function eo(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function to(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){eo(o,n,i,a,s,"next",e)}function s(e){eo(o,n,i,a,s,"throw",e)}a(void 0)}))}}function ro(e){var t=function(e,t){if("object"!=Qi(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=Qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Qi(t)?t:t+""}function no(e,t){return no=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},no(e,t)}function io(e){var t=oo();return function(){var r,n=ao(e);if(t){var i=ao(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==Qi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function oo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(oo=function(){return!!e})()}function ao(e){return ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ao(e)}var so=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&no(e,t)}(h,e);var r,n,i,o,a,s,c,u,l,d=io(h);function h(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(e=d.call(this,"testcall")).startStats=void 0,e.startMyScreenShareStats=void 0,e.endMyScreenShareStats=void 0,e.startPeerScreenShareStats=void 0,e.endPeerScreenShareStats=void 0,e}return r=h,n=[{key:"wtpTestCallMakeAudio",value:function(e){this._makeTestCall(wt.AUDIO,e)}},{key:"wtpTestCallMakeVideo",value:function(e){this._makeTestCall(wt.VIDEO,e)}},{key:"wtpTestCallEnd",value:function(){var e=this;if(this.state===$n.STATE_CONNECTED||this.state===$n.STATE_CONNECTING){if(this.releaser=Ot.THIS,this.state===$n.STATE_CONNECTING)return this.plnRelCode=ir.CANCEL,this.session.cancel();if(this.session){this.callTerminate=!0;var t,r=[];return this.state===$n.STATE_CONNECTED?(this.plnRelCode=ir.NORMAL,t="NORMAL"):(this.plnRelCode=ir.UNDEFINED,t="UNDEFINED"),r.push("P-Reason: "+this.plnRelCode+";"+t+";"+this.callDir),this._makeTestCallResult().then((function(){return e.session.bye({requestOptions:{extraHeaders:r}})}))}}else this.logger.warn("No active call to hang up on")}},{key:"wtpTestCallStartScreenShare",value:function(e,t,r){var n=this;return this.callParams.callType===wt.AUDIO?Promise.reject(this.createErrorObject("ScreenShareNotSupported","ScreenShare is not possible in audio test call")):(void 0!==this.startMyScreenShareStats&&this.logger.warn("Only the result of first screenShare will be included in test call results"),this.logger.debug("[wtpTestCallStartScreenShare] start"),this.peerScreenShare.videoView=t,this.wtpStartMyScreenShare(e,r).then((function(){void 0===n.startMyScreenShareStats&&(Object.assign(n.testCallResult,{screenShareOutbound:{timestamp:{start:void 0,end:void 0}},screenShareInbound:{timestamp:{start:void 0,startPacketReceived:void 0,end:void 0}}}),n._setTimestampAsNow(n.testCallResult.screenShareOutbound.timestamp,"start"),n._getScreenShareStats(wr.OUTBOUND_RTP).then((function(e){return n.startMyScreenShareStats=e})),n.on("screenShareStoppedOnBrowser",(function(){n._setEndScreenShareStats()})))})).catch((function(e){return n.logger.debug("Fail to wtpTestCallStartScreenShare"),Promise.reject(e)})))}},{key:"wtpTestCallStopScreenShare",value:function(){var e=this;return this.myScreenShare.isPlayed()?(this.logger.debug("[wtpTestCallStopScreenShare] start"),this.wtpStopMyScreenShare().then((function(){return e._setEndScreenShareStats()})).catch((function(t){return e.logger.debug("Fail to wtpTestCallStopScreenShare"),Promise.reject(t)}))):Promise.reject(this.createErrorObject("ScreenShareNotPlaying","My screen share is not played"))}},{key:"_checkAudioInputDevice",value:(l=to(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._checkMediaDevice({audio:!t||!t.deviceId||{deviceId:{exact:t.deviceId}},video:!1});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_checkVideoInputDevice",value:(u=to(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._checkMediaDevice({audio:!1,video:t&&t.deviceId?{deviceId:{exact:t.deviceId},width:Ht.WIDTH,height:Ht.HEIGHT}:{width:Ht.WIDTH,height:Ht.HEIGHT}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_checkMediaDevice",value:(c=to(regeneratorRuntime.mark((function e(t){var r,n,i,o,a,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={check:"pass",fail:void 0},void 0!==navigator.mediaDevices){e.next=6;break}return n={name:"NotCompatibleBrowser",message:"MediaDevices not available in this browser"},r.check="fail",r.fail=n,e.abrupt("return",r);case 6:return i=t.audio?"audio":"video",e.next=9,navigator.mediaDevices.enumerateDevices().then((function(e){if(!e.some((function(e){return e.kind==i+"input"})))return r.check="fail",r.fail={name:"NoMediaDevice",message:"There is no ".concat(i," device")},r}));case 9:return r.deviceId=t[i]&&t[i].deviceId?t[i].deviceId.exact:"default",e.prev=10,e.next=13,navigator.mediaDevices.getUserMedia(t);case 13:return o=e.sent,t.video?(o.getVideoTracks().length&&(a=o.getVideoTracks()[0],s=a.getSettings(),r.hdSupport=s.width*s.height>=518400),r.vp8Support=MediaRecorder.isTypeSupported("video/webm;codecs=vp8"),r.h264Support=ft()):t.audio&&(r.opusSupport=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")),o.getTracks().forEach((function(e){return e.stop()})),e.abrupt("return",r);case 19:e.prev=19,e.t0=e.catch(10),r.check="fail",c="",e.t1=e.t0.name,e.next="AbortError"===e.t1?26:"NotAllowedError"===e.t1?28:"NotFoundError"===e.t1?30:"NotReadableError"===e.t1?32:"OverconstrainedError"===e.t1?34:"SecurityError"===e.t1?36:38;break;case 26:return c="Some problem occurred which prevented the device from being used",e.abrupt("break",39);case 28:return c="This error occurred when the user blocks the access permission or reject the device permission request through browser settings",e.abrupt("break",39);case 30:return c="There are no media tracks of the type specified were found that satisfy the given constraints",e.abrupt("break",39);case 32:return c="A hardware error occurred at the operating system, browser, or Web page level which prevented access to the device",e.abrupt("break",39);case 34:return c="The specified constraints resulted in no candidate devices which met the criteria requested",e.abrupt("break",39);case 36:return c="User media support is disabled on the Document on which getUserMedia() was called",e.abrupt("break",39);case 38:return e.abrupt("break",39);case 39:return r.fail={name:e.t0.name,message:c},e.abrupt("return",r);case 41:case"end":return e.stop()}}),e,null,[[10,19]])}))),function(e){return c.apply(this,arguments)})},{key:"onDataCtrl",value:function(e){var t=this;if(this.logger.debug("start onDataCtrl"),void 0!==e.event)switch(e.event){case 0:this._removePeerScreenShareView(),this.emit("peerScreenShareStopped");break;case 1:this.peerScreenShare.dSsrc=e.d_ssrc,this._setTimestampAsNow(this.testCallResult.screenShareInbound.timestamp,"start"),this._addPeerScreenShareView().catch((function(e){return t.logger.debug(e)})),this.emit("peerScreenShareStarted")}}},{key:"onTrackAdditional",value:function(e){var t=this;if(this.logger.debug("call onTrackAdditional"),this.logger.debug(JSON.stringify(e)),e.transceiver.mid.startsWith("pss")){this.logger.debug("Testcall peerScreenShare ontrack start");var r=void 0;void 0===this.startPeerScreenShareStats&&(r={delegate:{onPlayed:function(){t._setTimestampAsNow(t.testCallResult.screenShareInbound.timestamp,"startPacketReceived"),t._getScreenShareStats(wr.INBOUND_RTP).then((function(e){t.startPeerScreenShareStats=e}))}}}),this.peerScreenShare.setupMedia(e.track,r)}else this.callParams.callType===wt.AUDIO&&void 0===this.testCallResult.timestamp.connected&&(this.logger.debug("set TestCall init stats"),this.testCallResult.timestamp.connected=Date.now(),this.wtpGetStats().then((function(e){return t.startStats=e})))}},{key:"onCallInviteAccept",value:function(){this.onAccepted()}},{key:"_makeTestCall",value:(s=to(regeneratorRuntime.mark((function e(r,n){var i,o,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initTestCallResult(),n.callType=r,n.svckey=r===wt.AUDIO?"testcall.audio":"testcall.video",n.peerId="11112222",this.callDir=bt.INITIATOR,this.setCallParams(n)){e.next=7;break}throw new Error("Mandatory field in call param is mssing");case 7:if(this.changeState($n.STATE_READY),r!==wt.AUDIO){e.next=14;break}return e.next=11,this._checkAudioInputDevice(null!==(i=this.callParams.mediaId)&&void 0!==i&&i.audio?{deviceId:this.callParams.mediaId.audio}:void 0);case 11:this.testCallResult.audio=e.sent,e.next=17;break;case 14:return e.next=16,this._checkVideoInputDevice(null!==(o=this.callParams.mediaId)&&void 0!==o&&o.video?{deviceId:this.callParams.mediaId.video}:void 0);case 16:this.testCallResult.video=e.sent;case 17:this.createUa(this.callParams.myId),this.ua.start().then((function(){a.logger.debug("Start UserAgent"),a.changeState($n.STATE_CONNECTING);var e=a._setTestCallExtraInviteHeaders();a.createInviteSession(e,{delegate:{onDataCtrl:function(e){return a.onDataCtrl(e)}},peerConnectionDelegate:{onTrack:function(e){return a.onTrackAdditional(e)}}})})).then((function(){a.transceiverHandler.setSession(a.session),a.pointStatistic=new Kr(a.session);var e={sdpModifier:[function(e){var t=sr(e.sdp,{opusFec:"false",opusDtx:"false",opusStereo:"false",opusMinptime:20});return t=cr(t,{imageattr:"true"}),e.sdp=t,Promise.resolve(e)},t],sdhOptions:{constraints:r===wt.AUDIO?Object.assign(a.getConstraints(),{video:!1}):Object.assign(a.getConstraints(),{audio:!1}),hasDummyAudio:r!==wt.AUDIO,hasDummyVideo:r!==wt.VIDEO},inviteDelegate:{onAccept:function(){return a.onCallInviteAccept()}}};a.sendInvite(e)})).catch((function(e){return a.onUaStartFailed(e)}));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_makeTestCallResult",value:(a=to(regeneratorRuntime.mark((function e(){var t,r,n,i,o,a,s,c,u,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.session){e.next=3;break}return e.abrupt("return",this.testCallResult);case 3:if(!this.testCallResult.screenShareOutbound){e.next=6;break}return e.next=6,this._setEndScreenShareStats();case 6:return e.next=8,this.wtpGetStats();case 8:if(t=e.sent,this.logger.debug("Make testCallResult"),this.logger.debug(this.startStats),this.logger.debug(t),this.testCallDuration=(t.timestamp-this.startStats.timestamp)/1e3,!(this.testCallDuration<=0)){e.next=15;break}return e.abrupt("return",this.testCallResult);case 15:this.callParams.callType===wt.AUDIO?(r=this.startStats[wr.OUTBOUND_RTP][0],n=t[wr.OUTBOUND_RTP][0],i=this.startStats[wr.INBOUND_RTP][0],o=t[wr.INBOUND_RTP][0],this.testCallResult.outbound.audio=this._analyzeDataRateStats("outbound",r,n),this.testCallResult.inbound.audio=this._analyzeDataRateStats("inbound",i,o),Object.assign(this.testCallResult.inbound.audio,this._analyzePacketLoss(i,o))):(a=this.startStats[wr.INBOUND_RTP][1],s=t[wr.INBOUND_RTP].find((function(e){return"video"===e.kind&&333!==e.ssrc&&"screenshare"!==e.contentType})),c=this.startStats[wr.OUTBOUND_RTP][1],u=t[wr.OUTBOUND_RTP].find((function(e){return"video"===e.kind&&333!==e.ssrc})),this.testCallResult.outbound.video=this._analyzeDataRateStats("outbound",c,u),this.testCallResult.inbound.video=this._analyzeDataRateStats("inbound",a,s),Object.assign(this.testCallResult.outbound.video,this._analyzeFrameStats(u)),Object.assign(this.testCallResult.inbound.video,this._analyzeFrameStats(s)),Object.assign(this.testCallResult.inbound.video,this._analyzePacketLoss(a,s)),this.startMyScreenShareStats&&(l=this._analyzeDataRateStats("outbound",this.startMyScreenShareStats,this.endMyScreenShareStats),Object.assign(l,this._analyzeFrameStats(this.endMyScreenShareStats)),Object.assign(this.testCallResult.screenShareOutbound,l)),this.startPeerScreenShareStats&&(d=this._analyzeDataRateStats("inbound",this.startPeerScreenShareStats,this.endPeerScreenShareStats),Object.assign(d,this._analyzePacketLoss(this.startPeerScreenShareStats,this.endPeerScreenShareStats)),Object.assign(d,this._analyzeFrameStats(this.endPeerScreenShareStats)),Object.assign(this.testCallResult.screenShareInbound,d))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.logger.warn("Fail to makeTetsCallResult because ".concat(e.t0));case 21:return e.abrupt("return",this.testCallResult);case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return a.apply(this,arguments)})},{key:"_initTestCallResult",value:function(){this.testCallResult={inbound:{},outbound:{},timestamp:{connected:void 0}}}},{key:"_analyzeDataRateStats",value:function(e,t,r){var n="outbound"===e?"Sent":"Received",i={},o=(r.timestamp-t.timestamp)/1e3;return i.duration=o,i.bps=8*(r["bytes".concat(n)]-t["bytes".concat(n)])/o,i.pps=(r["packets".concat(n)]-t["packets".concat(n)])/o,r["frames".concat(n)]&&(i.fps=(r["frames".concat(n)]-t["frames".concat(n)])/o),i}},{key:"_analyzePacketLoss",value:function(e,t){return{packetLoss:(t.packetsLost-e.packetsLost)/(t.packetsReceived-e.packetsReceived)*100}}},{key:"_analyzeFrameStats",value:function(e){return{frameHeight:e.frameHeight,frameWidth:e.frameWidth}}},{key:"_addPeerScreenShareView",value:function(){var e=this;this.logger.debug("[wtpTestCall addPeerScreenShareView] start");var t=this.session.sessionDescriptionHandler,r=t.peerConnection,n=this.peerScreenShare;return this.sdpMutex.acquire().then((function(){switch(n.state){case Ut.INIT:var e=r.addTransceiver("video",{direction:"recvonly"});return n.transceiver=e,n.sdpMid="pss",n.state=Ut.START,Promise.resolve("NEW");case Ut.STOP:return n.transceiver.direction="recvonly",n.state=Ut.RESTART,Promise.resolve("RESTART");default:return Promise.reject("ScreenShare start state is not vaild - ".concat(n.state))}})).then((function(i){return"NEW"===i?t.createLocalOfferOrAnswer().then((function(t){var r={sdpMid:n.sdpMid};return n.state===Ut.START?r.type="screenshare":(r.type="active",r.direction="recvonly"),e.mungeOfferSdp(t,r)})).then((function(e){return t.setLocalSessionDescription(e)})).then((function(){return t.waitForIceGatheringComplete(!0,3e3)})).then((function(){return e.addVideoMungeAnswerSdp([{direction:"sendonly",ssrc:n.dSsrc,sdpMid:n.sdpMid}])})).then((function(e){return r.setRemoteDescription(e)})).then((function(){return e.logger.debug("addPeerScreenShareView done"),e.sdpMutex.release()})).catch((function(t){return e.sdpMutex.release(),e.logger.debug("Fail to add peer screenshare - ".concat(t)),Promise.reject(t)})):(e.logger.debug("Restart peer screenshare"),n.playVideo(),e.sdpMutex.release(),Promise.resolve())})).catch((function(t){return e.logger.debug("addPeerScreenShareView fail - ".concat(t)),e.logger.debug(t),Promise.reject(t)}))}},{key:"_removePeerScreenShareView",value:function(){this.logger.debug("[wtpTestCall removePeerScreenShareView] start");var e=this.peerScreenShare;return e.state===Ut.START||e.state===Ut.RESTART?(e.cleanupView(),Promise.resolve()):Promise.reject("Fail to remove screenshare - ".concat(e.state))}},{key:"_setEndScreenShareStats",value:(o=to(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.endMyScreenShareStats){e.next=4;break}return this._setTimestampAsNow(this.testCallResult.screenShareOutbound.timestamp,"end"),e.next=4,this._getScreenShareStats(wr.OUTBOUND_RTP).then((function(e){return t.endMyScreenShareStats=e}));case 4:if(void 0!==this.endPeerScreenShareStats){e.next=8;break}return this._setTimestampAsNow(this.testCallResult.screenShareInbound.timestamp,"end"),e.next=8,this._getScreenShareStats(wr.INBOUND_RTP).then((function(e){return t.endPeerScreenShareStats=e}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_getScreenShareStats",value:(i=to(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pointStatistic.getStats([t]);case 2:return r=e.sent,e.abrupt("return",r[t].find((function(e){return e.contentType&&"screenshare"===e.contentType})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_setTestCallExtraInviteHeaders",value:function(){var e=this.callParams.inviteHeaders,t=[];t.push("X-callDir: "+bt.INITIATOR),t.push("X-callType: "+this.callParams.callType),t.push("X-fromZone: "+e.fromZone),t.push("X-toZone: "+e.fromZone),t.push("X-svckey: "+this.callParams.svckey),t.push("X-Locale: "+navigator.language),t.push("X-h264_support: "+ft());var r=pt(),n=[r.browser,r.version,"","",this.callParams.planetKitVersion?"web_"+this.callParams.planetKitVersion:"","wtp_"+Yt,"",""];return t.push("X-userAgent: "+n.join(";")),t}},{key:"_setTimestampAsNow",value:function(e,t){void 0===e[t]&&(e[t]=Date.now())}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ro(n.key),n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),h}(Fn);function co(e){return co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},co(e)}function uo(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function lo(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){uo(o,n,i,a,s,"next",e)}function s(e){uo(o,n,i,a,s,"throw",e)}a(void 0)}))}}function ho(e){var t=function(e,t){if("object"!=co(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=co(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==co(t)?t:t+""}var po=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audioStream=void 0,this.videoStream=void 0,this.mediaStream=void 0,this.videoElement=document.createElement("video"),this.canvasElement=document.createElement("canvas"),this.virtualBackground=void 0,this.targetCanvas=void 0}var t,r,n,i,o,a,s,c,u,l,d,h,p,f,g,v;return t=e,r=[{key:"createAudioStream",value:(v=lo(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(i.length>0&&void 0!==i[0]?i[0]:{}).audioInputDeviceId,!this.audioStream){e.next=4;break}return e.next=4,this.releaseAudioStream();case 4:return e.prev=4,e.next=7,mt(t,"audioinput");case 7:return r=e.sent,e.next=10,navigator.mediaDevices.getUserMedia({audio:!r||{deviceId:{exact:r}}});case 10:return n=e.sent,this.audioStream=n,e.abrupt("return",this.audioStream);case 15:throw e.prev=15,e.t0=e.catch(4),console.warn("Error getting audio stream.",e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[4,15]])}))),function(){return v.apply(this,arguments)})},{key:"createVideoStream",value:(g=lo(regeneratorRuntime.mark((function e(){var t,r,n,i,o,a,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=s.length>0&&void 0!==s[0]?s[0]:{}).videoInputDeviceId,n=t.videoElement,!this.videoStream){e.next=4;break}return e.next=4,this.releaseVideoStream();case 4:return e.prev=4,e.next=7,mt(r,"videoinput");case 7:return i=e.sent,e.next=10,navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,deviceId:i?{exact:i}:void 0}});case 10:return o=e.sent,this.videoStream=o,(a=n||this.videoElement)&&(this.videoElement=a,this.videoElement.srcObject=o,this.videoElement.muted=!0,this.videoElement.play().catch((function(e){}))),e.abrupt("return",this.videoStream);case 17:throw e.prev=17,e.t0=e.catch(4),console.warn("Error getting video stream.",e.t0),e.t0;case 21:case"end":return e.stop()}}),e,this,[[4,17]])}))),function(){return g.apply(this,arguments)})},{key:"createMediaStream",value:(f=lo(regeneratorRuntime.mark((function e(){var t,r,n,i,o,a,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=s.length>0&&void 0!==s[0]?s[0]:{}).audioInputDeviceId,n=t.videoInputDeviceId,i=t.videoElement,e.prev=1,!this.mediaStream){e.next=5;break}return e.next=5,this.releaseMediaStream();case 5:return e.prev=5,e.next=8,this.createAudioStream({audioInputDeviceId:r});case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:return e.prev=12,e.next=15,this.createVideoStream({videoInputDeviceId:n,videoElement:i});case 15:e.next=19;break;case 17:e.prev=17,e.t1=e.catch(12);case 19:return this.mediaStream=new MediaStream,this.audioStream&&this.audioStream.getAudioTracks().length>0?(o=this.audioStream.getAudioTracks()[0],this.mediaStream.addTrack(o)):console.warn("No audio tracks available in audioStream."),this.videoStream&&this.videoStream.getVideoTracks().length>0?(a=this.videoStream.getVideoTracks()[0],this.mediaStream.addTrack(a)):console.warn("No video tracks available in videoStream."),e.abrupt("return",this.mediaStream);case 25:throw e.prev=25,e.t2=e.catch(1),console.warn(e.t2),e.t2;case 29:case"end":return e.stop()}}),e,this,[[1,25],[5,10],[12,17]])}))),function(){return f.apply(this,arguments)})},{key:"getAudioStream",value:function(){return this.audioStream}},{key:"getVideoStream",value:function(){return this.videoStream}},{key:"hasAudioStream",value:function(){return void 0!==this.audioStream}},{key:"hasVideoStream",value:function(){return null!=this.videoStream}},{key:"getMediaStream",value:function(){if(this.hasAudioStream()||this.hasVideoStream()){if(this.mediaStream=new MediaStream,this.audioStream&&this.audioStream.getAudioTracks().length>0){var e=this.audioStream.getAudioTracks()[0];this.mediaStream.addTrack(e)}if(this.videoStream&&this.videoStream.getVideoTracks().length>0){var t=this.videoStream.getVideoTracks()[0];this.mediaStream.addTrack(t)}return this.mediaStream}}},{key:"releaseAudioStream",value:function(){var e=this;return new Promise((function(t,r){try{var n;null===(n=e.audioStream)||void 0===n||n.getAudioTracks().forEach((function(e){e.stop()})),e.audioStream=void 0,t()}catch(e){r(e)}}))}},{key:"releaseVideoStream",value:function(){var e=this;return new Promise((function(t,r){try{var n;null===(n=e.videoStream)||void 0===n||n.getVideoTracks().forEach((function(e){e.stop()})),e.videoStream=void 0,t()}catch(e){r(e)}}))}},{key:"releaseMediaStream",value:(p=lo(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.releaseVideoStream();case 2:return e.next=4,this.releaseAudioStream();case 4:this.mediaStream&&(this.mediaStream.getTracks().forEach((function(e){e.stop()})),this.mediaStream=void 0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"changeVideoView",value:function(e){var t=this;return new Promise((function(r,n){if(!(e instanceof HTMLVideoElement))return n(new TypeError("The provided element is not a HTMLVideoElement."));var i=t.videoElement;t.videoElement=e,t.videoStream?(t.videoElement.srcObject=t.videoStream,t.videoElement.muted=!0,t.videoElement.play().then((function(){i&&(i.srcObject=null,i.pause()),r()})).catch((function(e){console.warn("Fail to play on new video element",e),n(e)}))):r()}))}},{key:"getAudioInputDeviceId",value:function(){var e,t;return null===(e=this.audioStream)||void 0===e||null===(t=e.getAudioTracks()[0])||void 0===t?void 0:t.getSettings().deviceId}},{key:"getVideoInputDeviceId",value:function(){var e,t;return null===(e=this.videoStream)||void 0===e||null===(t=e.getVideoTracks()[0])||void 0===t?void 0:t.getSettings().deviceId}},{key:"changeAudioInputDevice",value:(h=lo(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAudioStream({audioInputDeviceId:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"changeVideoInputDevice",value:(d=lo(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createVideoStream({videoInputDeviceId:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getDevices",value:(l=lo(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,e.abrupt("return",t);case 7:throw e.prev=7,e.t0=e.catch(0),console.warn("Error accessing media devices.",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"getAudioInputDevices",value:(u=lo(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,r=t.filter((function(e){return"audioinput"===e.kind})),e.abrupt("return",r);case 8:throw e.prev=8,e.t0=e.catch(0),console.warn("Error accessing media devices.",e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return u.apply(this,arguments)})},{key:"getVideoInputDevices",value:(c=lo(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,r=t.filter((function(e){return"videoinput"===e.kind})),e.abrupt("return",r);case 8:throw e.prev=8,e.t0=e.catch(0),console.warn("Error accessing media devices.",e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return c.apply(this,arguments)})},{key:"getAudioOutputDevices",value:(s=lo(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,r=t.filter((function(e){return"audiooutput"===e.kind})),e.abrupt("return",r);case 8:throw e.prev=8,e.t0=e.catch(0),console.warn("Error accessing media devices.",e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return s.apply(this,arguments)})},{key:"registerVirtualBackground",value:(a=lo(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Safari"!==(r=pt()).browser&&"others"!==r.browser){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Virtual Background is not supported in this browser.")));case 3:this.virtualBackground=t;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"isVirtualBackgroundRegistered",value:function(){return void 0!==this.virtualBackground}},{key:"startVirtualBackgroundBlur",value:(o=lo(regeneratorRuntime.mark((function e(t){var r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:15,this.virtualBackground){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("VirtualBackground is not registered.")));case 3:return n=t||this.canvasElement,e.abrupt("return",this.virtualBackground.startVirtualBackgroundBlur(this.videoElement,n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"startVirtualBackgroundImage",value:(i=lo(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.virtualBackground){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("VirtualBackground is not registered.")));case 2:if(r instanceof HTMLImageElement||r instanceof ImageBitmap){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("Provided object is not an Image instance.")));case 4:return n=t||this.canvasElement,e.abrupt("return",this.virtualBackground.startVirtualBackgroundImage(this.videoElement,n,r));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"stopVirtualBackground",value:(n=lo(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.virtualBackground){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("VirtualBackground is not registered.")));case 2:return e.abrupt("return",this.virtualBackground.stopVirtualBackground());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getVirtualBackgroundVideoStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;if(this.virtualBackground)return this.canvasElement.captureStream(e)}},{key:"changeVirtualBackgroundVideoElement",value:function(e){this.virtualBackground&&(this.videoElement=e,this.virtualBackground.changeVideoSource(e))}},{key:"changeVirtualBackgroundCanvasElement",value:function(e){this.virtualBackground&&(this.canvasElement=e,this.virtualBackground.changeOutputCanvas(e))}},{key:"isVirtualBackgroundActive",value:function(){return!!this.virtualBackground&&this.virtualBackground.isActive()}}],r&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ho(n.key),n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),fo=fi})(),n})(),e.exports=t()}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{Call:()=>X,Conference:()=>ne,DEBUG_NOTICE:()=>e.DEBUG_NOTICE,DISCONNECT_SOURCE:()=>_,KIT_DISCONNECT_REASON:()=>w,LOG_LEVEL:()=>M,MEDIA_TYPE:()=>g,MediaStreamManager:()=>e.MediaStreamManager,PLANET_KIT_USER_TYPE:()=>e.PLANET_KIT_USER_TYPE,RECORD_ON_CLOUD_DEACTIVATE_REASON:()=>R,RESOLUTION:()=>v,RESPONSE_ENABLE_VIDEO:()=>m,USER_EQUIPMENT_TYPE:()=>T,Util:()=>c,VIDEO_PAUSE_REASON:()=>E,VIDEO_STATE:()=>e.VIDEO_STATE,getStrVideoPauseReason:()=>y});var e=r(2968);function t(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function i(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}r(5666),r(8309),r(8304),r(489),r(1539),r(2419),r(9070),r(8011),r(8674),r(2526),r(1817),r(2165),r(6992),r(8783),r(3948),r(8478);var o=new WeakSet,a=new WeakSet,s=new WeakSet,c=function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t(this,s),t(this,a),t(this,o),this.util=new e.WtpUtil}var n,c;return n=r,(c=[{key:"isSupported",value:function(){return this.util.isSupported()}},{key:"createMediaStream",value:function(e,t){return this.util.createMediaStream(e,t)}},{key:"cleanupMediaStream",value:function(e){this.util.cleanupMediaStream(e)}},{key:"setVideoMirror",value:function(e,t){this.util.setVideoMirror(e,t)}},{key:"getScreenShareConstraints",value:function(e){var t=void 0;if(void 0!==e){var r=i(this,a,l).call(this,e),n=i(this,s,d).call(this,e);void 0!==r&&!1!==r&&((t={}).video=r,void 0!==n&&(t.audio=n))}return t}},{key:"getBrowserInfo",value:function(){return this.util.getBrowserInfo()}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,c),Object.defineProperty(n,"prototype",{writable:!1}),r}();function u(e){return"on"===e.toLowerCase()}function l(e){var t=void 0;if("string"==typeof e.videoState)if("custom"!==e.videoState.toLowerCase())t=i(this,o,u).call(this,e.videoState);else{var r=1920,n=1080,a=10;"number"==typeof e.width&&e.width>0&&(r=e.width),"number"==typeof e.height&&e.height>0&&(n=e.height),"number"==typeof e.frameRate&&(a=e.frameRate),t={width:{max:r},height:{max:n}},a>0&&(t.frameRate={max:a})}return t}function d(e){var t=void 0;return"string"==typeof e.audioState&&"custom"!==e.audioState.toLowerCase()&&(t=i(this,o,u).call(this,e.audioState)),t}r(3371);var h=Object.freeze({LOCAL:"LOCAL",TEST:"TEST",DEV:"DEV",BETA:"BETA",EVAL:"EVAL",PROD:"PROD"}),p=h.EVAL,f="5.4.0",g=(r(9601),r(4916),r(3161),r(9653),r(2222),r(9826),r(7941),Object.freeze({AUDIO:"audio",VIDEO:"video"})),v=Object.freeze({QVGA:"qvga",VGA:"vga",HD:"hd"}),m=Object.freeze({PAUSE:0,SEND:1}),S=Object.freeze({INITIATOR:"initiator",RESPONDER:"responder",CONFERENCE:"conference"}),E=Object.freeze({PLANETKIT_VIDEO_PAUSE_REASON_BY_USER:0,PLANETKIT_VIDEO_PAUSE_REASON_BY_INTERRUPT:1,PLANETKIT_VIDEO_PAUSE_REASON_UNDEFINED:2,PLANETKIT_VIDEO_PAUSE_REASON_INTERNAL:3,PLANETKIT_VIDEO_PAUSE_REASON_ENABLE_VIDEO_RESPONSE:4,PLANETKIT_VIDEO_PAUSE_REASON_CAMERA_INACTIVE:5});function y(e){return Object.keys(E).find((function(t){return E[t]===e}))}var _=Object.freeze({UNDEFINED:"undefined",CALLEE:"callee",CALLER:"caller",PARTICIPANT:"participant",CLOUD_SERVER:"cloud_server",APP_SERVER:"app_server"}),T=Object.freeze({NONE:"none",ANDROID:"android",IOS:"ios",LINUX:"linux",MAC:"mac",WINDOWS:"windows",WEB:"web",SIP_TERMINAL:"sip_terminal"}),R=Object.freeze({INTERNAL:"internal",ACTIVATION_FAILED:"activation_failed"}),b=Object.freeze({SATURN_APP_ERROR_AUTH_FAIL:"SA401",SATURN_APP_TOO_MANY_REQUESTS:"SA429",SATURN_APP_ERROR_EXCEED_LIMIT_OF_PARTICIPANTS:"SA431",SATURN_APP_ERROR_ROOM_NOT_FOUND:"SA432",SATURN_APP_ERROR_ROOM_FORBIDDEN:"SA433",SATURN_APP_ERROR_ROOM_TYPE_CONFLICT:"SA434",SATURN_APP_ERROR_INVALID_ID:"SA461",SATURN_APP_ERROR_INCOMPATIBLE_KIT_VERSION:"SA462",SATURN_APP_ERROR_INVALID_STATE:"SA463",SATURN_APP_ERROR_UNDER_MAINTENANCE:"SA520",SATURN_APP_ERROR_BUSY_EVERYWHERE:"SA531",SATURN_APP_ERROR_HTTP_ERROR:"SAhttperror",SATURN_APP_ERROR_NETWORK_UNAVAILABLE:"SAnetunavailable",SATURN_APP_ERROR_TIMEOUT:"SAtimeout"}),w=Object.freeze({PLANETKIT_DISCONNECT_REASON_NORMAL:1001,PLANETKIT_DISCONNECT_REASON_DECLINE:1002,PLANETKIT_DISCONNECT_REASON_CELL_CALL:1003,PLANETKIT_DISCONNECT_REASON_INTERNAL_ERROR:1109,PLANETKIT_DISCONNECT_REASON_USER_ERROR:1110,PLANETKIT_DISCONNECT_REASON_INTERNAL_KIT_ERROR:1111,PLANETKIT_DISCONNECT_REASON_AUDIO_TX_NO_SRC:1112,PLANETKIT_DISCONNECT_REASON_CANCEL:1201,PLANETKIT_DISCONNECT_REASON_BUSY:1202,PLANETKIT_DISCONNECT_REASON_NOANSWER:1203,PLANETKIT_DISCONNECT_REASON_ALREADY_GOT_A_CALL:1204,PLANETKIT_DISCONNECT_REASON_MULTIDEV_IN_USE:1205,PLANETKIT_DISCONNECT_REASON_MULTIDEV_ANSWER:1206,PLANETKIT_DISCONNECT_REASON_MULTIDEV_DECLINE:1207,PLANETKIT_DISCONNECT_REASON_MAX_CALL_TIME_EXCEEDED:1208,PLANETKIT_DISCONNECT_REASON_NETWORK_UNSTABLE:1301,PLANETKIT_DISCONNECT_REASON_PUSH_ERROR:1302,PLANETKIT_DISCONNECT_REASON_AUTH_ERROR:1303,PLANETKIT_DISCONNECT_REASON_RELEASED_CALL:1304,PLANETKIT_DISCONNECT_REASON_SERVER_INTERNAL_ERROR:1305,PLANETKIT_DISCONNECT_REASON_UNAVAILABLE_NETWORK:1308,PLANETKIT_DISCONNECT_REASON_APP_DESTROY:1309,PLANETKIT_DISCONNECT_REASON_SYSTEM_SLEEP:1310,PLANETKIT_DISCONNECT_REASON_SYSTEM_LOGOFF:1311,PLANETKIT_DISCONNECT_REASON_MTU_EXCEEDED:1312,PLANETKIT_DISCONNECT_REASON_ROOM_IS_FULL:1401,PLANETKIT_DISCONNECT_REASON_ALONE_KICK_OUT:1402,PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND:1404,PLANETKIT_DISCONNECT_REASON_SERVICE_ACCESS_TOKEN_ERROR:1501,PLANETKIT_DISCONNECT_REASON_SERVICE_INVALID_ID:1502,PLANETKIT_DISCONNECT_REASON_SERVICE_MAINTENANCE:1503,PLANETKIT_DISCONNECT_REASON_SERVICE_BUSY:1504,PLANETKIT_DISCONNECT_REASON_SERVICE_INTERNAL_ERROR:1505,PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_ERROR:1506,PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_CONNECTION_TIME_OUT:1507,PLANETKIT_DISCONNECT_REASON_SERVICE_INCOMPATIBLE_PLANETKIT_VER:1511,PLANETKIT_DISCONNECT_REASON_SERVICE_TOO_MANY_REQUESTS:1512,PLANETKIT_DISCONNECT_REASON_WEB_RTC_ABORT:1601,PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_ALLOWED:1602,PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_FOUND:1603,PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_READABLE:1604,PLANETKIT_DISCONNECT_REASON_WEB_RTC_OVERCONSTRAINED:1605,PLANETKIT_DISCONNECT_REASON_WEB_RTC_SECURITY_ERROR:1606,PLANETKIT_DISCONNECT_REASON_WEB_RTC_TYPE_ERROR:1607,PLANETKIT_DISCONNECT_REASON_WEB_NO_MEDIA_PACKET:1608,PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_SERVER:1609,PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_CLIENT:1610,PLANETKIT_DISCONNECT_REASON_WEB_SIGNALING_UNEXPECTED_DISCONNECTED:1611,PLANETKIT_DISCONNECT_REASON_WEB_BROWSER_NOT_SUPPORTED:1612});function A(t){var r=e.PLANET_REL_CODE;switch(t){case r.NORMAL:return C(w.PLANETKIT_DISCONNECT_REASON_NORMAL,"PLANETKIT_DISCONNECT_REASON_NORMAL");case r.REJECT:return C(w.PLANETKIT_DISCONNECT_REASON_DECLINE,"PLANETKIT_DISCONNECT_REASON_DECLINE");case r.CELLULAR_CALL:return C(w.PLANETKIT_DISCONNECT_REASON_CELL_CALL,"PLANETKIT_DISCONNECT_REASON_CELL_CALL");case r.NO_MEDIA_SRC:return C(w.PLANETKIT_DISCONNECT_REASON_AUDIO_TX_NO_SRC,"PLANETKIT_DISCONNECT_REASON_AUDIO_TX_NO_SRC");case r.APP_DEFINED_ERR:return C(w.PLANETKIT_DISCONNECT_REASON_USER_ERROR,"PLANETKIT_DISCONNECT_REASON_USER_ERROR");case r.KIT_DEFINED_ERR:return C(w.PLANETKIT_DISCONNECT_REASON_INTERNAL_KIT_ERROR,"PLANETKIT_DISCONNECT_REASON_INTERNAL_KIT_ERROR");case r.CANCEL:return C(w.PLANETKIT_DISCONNECT_REASON_CANCEL,"PLANETKIT_DISCONNECT_REASON_CANCEL");case r.USER_BUSY:return C(w.PLANETKIT_DISCONNECT_REASON_BUSY,"PLANETKIT_DISCONNECT_REASON_BUSY");case r.NO_ANSWER:return C(w.PLANETKIT_DISCONNECT_REASON_NOANSWER,"PLANETKIT_DISCONNECT_REASON_NOANSWER");case r.ALREADY_GOT_A_CALL:return C(w.PLANETKIT_DISCONNECT_REASON_ALREADY_GOT_A_CALL,"PLANETKIT_DISCONNECT_REASON_ALREADY_GOT_A_CALL");case r.MULTI_DEV_OTHER_DEV_IN_USE:return C(w.PLANETKIT_DISCONNECT_REASON_MULTIDEV_IN_USE,"PLANETKIT_DISCONNECT_REASON_MULTIDEV_IN_USE");case r.MULTI_DEV_OTHER_DEV_ANSWER:return C(w.PLANETKIT_DISCONNECT_REASON_MULTIDEV_ANSWER,"PLANETKIT_DISCONNECT_REASON_MULTIDEV_ANSWER");case r.MULTI_DEV_OTHER_DEV_REJECT:return C(w.PLANETKIT_DISCONNECT_REASON_MULTIDEV_DECLINE,"PLANETKIT_DISCONNECT_REASON_MULTIDEV_DECLINE");case r.MAX_CALL_TIME_EXCEED:return C(w.PLANETKIT_DISCONNECT_REASON_MAX_CALL_TIME_EXCEEDED,"PLANETKIT_DISCONNECT_REASON_MAX_CALL_TIME_EXCEEDED");case r.SESS_KEEPALIVE_TIMEOUT:case r.SESS_ACTIVE_TIMEOUT:case r.NETWORK_UNREACHABLE:case r.SESSION_FAIL:case r.UE_UNREACHABLE:case b.SATURN_APP_ERROR_NETWORK_UNAVAILABLE:return C(w.PLANETKIT_DISCONNECT_REASON_NETWORK_UNSTABLE,"PLANETKIT_DISCONNECT_REASON_NETWORK_UNSTABLE");case r.INVALID_PUSH_RSP:case r.PUSH_ERROR:case r.USER_NOT_FOUND_PUSH:case r.PUSH_REQ_FAIL:return C(w.PLANETKIT_DISCONNECT_REASON_PUSH_ERROR,"PLANETKIT_DISCONNECT_REASON_PUSH_ERROR");case r.AUTH_ERROR:case r.ROOM_AUTH_ERROR:return C(w.PLANETKIT_DISCONNECT_REASON_AUTH_ERROR,"PLANETKIT_DISCONNECT_REASON_AUTH_ERROR");case r.DB_COMM_NOT_FOUND:case r.DB_CHAN_NOT_FOUND:return C(w.PLANETKIT_DISCONNECT_REASON_RELEASED_CALL,"PLANETKIT_DISCONNECT_REASON_RELEASED_CALL");case r.NETWORK_UNAVAILABLE:return C(w.PLANETKIT_DISCONNECT_REASON_UNAVAILABLE_NETWORK,"PLANETKIT_DISCONNECT_REASON_UNAVAILABLE_NETWORK");case r.UE_DESTROY:case r.UE_SYSTEM:return C(w.PLANETKIT_DISCONNECT_REASON_APP_DESTROY,"PLANETKIT_DISCONNECT_REASON_APP_DESTROY");case r.UE_SLEEP:return C(w.PLANETKIT_DISCONNECT_REASON_SYSTEM_SLEEP,"PLANETKIT_DISCONNECT_REASON_SYSTEM_SLEEP");case r.UE_LOGOFF:return C(w.PLANETKIT_DISCONNECT_REASON_SYSTEM_LOGOFF,"PLANETKIT_DISCONNECT_REASON_SYSTEM_LOGOFF");case r.MTU_EXCEEDED:return C(w.PLANETKIT_DISCONNECT_REASON_MTU_EXCEEDED,"PLANETKIT_DISCONNECT_REASON_MTU_EXCEEDED");case r.ROOM_IS_FULL:return C(w.PLANETKIT_DISCONNECT_REASON_ROOM_IS_FULL,"PLANETKIT_DISCONNECT_REASON_ROOM_IS_FULL");case r.ALONE_KICK_OUT:return C(w.PLANETKIT_DISCONNECT_REASON_ALONE_KICK_OUT,"PLANETKIT_DISCONNECT_REASON_ALONE_KICK_OUT");case r.ROOM_NOT_FOUND:return C(w.PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND,"PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND");case r.NO_MEDIA_PACKETS:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_NO_MEDIA_PACKET,"PLANETKIT_DISCONNECT_REASON_WEB_NO_MEDIA_PACKET");case r.ABORT:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_ABORT,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_ABORT");case r.NOT_ALLOWED:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_ALLOWED,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_ALLOWED");case r.NOT_FOUND:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_FOUND,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_FOUND");case r.NOT_READABLE:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_READABLE,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_NOT_READABLE");case r.OVERCONSTRAINED:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_OVERCONSTRAINED,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_OVERCONSTRAINED");case r.SECURITY_ERROR:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_SECURITY_ERROR,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_SECURITY_ERROR");case r.TYPE_ERROR:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_RTC_TYPE_ERROR,"PLANETKIT_DISCONNECT_REASON_WEB_RTC_TYPE_ERROR");case r.CALL_CONNECT_FAIL_BY_SERVER:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_SERVER,"PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_SERVER");case r.CALL_CONNECT_FAIL_BY_CLIENT:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_CLIENT,"PLANETKIT_DISCONNECT_REASON_WEB_CALL_CONNECT_FAIL_BY_CLIENT");case r.WEB_SIGNALING_UNEXPECTED_DISCONNECTED:return C(w.PLANETKIT_DISCONNECT_REASON_WEB_SIGNALING_UNEXPECTED_DISCONNECTED,"PLANETKIT_DISCONNECT_REASON_WEB_SIGNALING_UNEXPECTED_DISCONNECTED");case b.SATURN_APP_ERROR_AUTH_FAIL:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_ACCESS_TOKEN_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVICE_ACCESS_TOKEN_ERROR");case b.SATURN_APP_ERROR_ROOM_NOT_FOUND:return C(w.PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND,"PLANETKIT_DISCONNECT_REASON_ROOM_NOT_FOUND");case b.SATURN_APP_ERROR_INVALID_ID:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_INVALID_ID,"PLANETKIT_DISCONNECT_REASON_SERVICE_INVALID_ID");case b.SATURN_APP_ERROR_INCOMPATIBLE_KIT_VERSION:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_INCOMPATIBLE_PLANETKIT_VER,"PLANETKIT_DISCONNECT_REASON_SERVICE_INCOMPATIBLE_PLANETKIT_VER");case b.SATURN_APP_TOO_MANY_REQUESTS:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_TOO_MANY_REQUESTS,"PLANETKIT_DISCONNECT_REASON_SERVICE_TOO_MANY_REQUESTS");case b.SATURN_APP_ERROR_INVALID_STATE:case b.SATURN_APP_ERROR_EXCEED_LIMIT_OF_PARTICIPANTS:case b.SATURN_APP_ERROR_ROOM_FORBIDDEN:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_INTERNAL_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVICE_INTERNAL_ERROR");case b.SATURN_APP_ERROR_UNDER_MAINTENANCE:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_MAINTENANCE,"PLANETKIT_DISCONNECT_REASON_SERVICE_MAINTENANCE");case b.SATURN_APP_ERROR_BUSY_EVERYWHERE:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_BUSY,"PLANETKIT_DISCONNECT_REASON_SERVICE_BUSY");case b.SATURN_APP_ERROR_TIMEOUT:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_CONNECTION_TIME_OUT,"PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_CONNECTION_TIME_OUT");case b.SATURN_APP_ERROR_HTTP_ERROR:return C(w.PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVICE_HTTP_ERROR");default:return t>=r.INTERNAL_ERROR&&t<r.NO_MEDIA_PACKETS?C(w.PLANETKIT_DISCONNECT_REASON_SERVER_INTERNAL_ERROR,"PLANETKIT_DISCONNECT_REASON_SERVER_INTERNAL_ERROR"):C(w.PLANETKIT_DISCONNECT_REASON_INTERNAL_ERROR,"PLANETKIT_DISCONNECT_REASON_INTERNAL_ERROR")}}function C(e,t){return{code:e,strCode:t}}var I=Object.freeze({NONE:"none",INVALID_PARAM:"invalid_param",DECODE_CALL_PARAM:"decode_call_param",ID_CONFLICT:"id_conflict",INVALID_USER_ID:"invalid_user_id",INVALID_SERVICE_ID:"invalid_service_id",INVALID_API_KEY:"invalid_api_key",INVALID_ROOM_ID:"invalid_room_id",TOO_LONG_APP_SERVER_DATA:"too_long_app_server_data",BROWSER_NOT_SUPPORTED:"browser_not_supported",INVALID_MEDIA_TYPE:"invalid_media_type",INVALID_CUSTOM_USER_TYPE:"invalid_custom_user_type",INTERNAL_INITIALIZATION_ERROR:"internal_initialization_error"});function O(e){if("string"!=typeof e)return!1;var t=e.split(":");if(2!=t.length)return!1;var r=t[0],n=t[1];return!isNaN(n)&&!!["line-apps.com","line-apps-rc.com","line-apps-beta.com","line-apps-alpha.com","line-apps-dev.com"].some((function(e){return r.endsWith(e)}))}function P(e){return null!=e}r(3123),r(5212),r(7852),r(9600),r(2564);var N=Object.freeze({LOCAL_INTERNAL_URL:"https://localhost:3000/pk_api",DEV_SERVICE_URL:"https://voipnx-saturn.line-apps-alpha.com",DEV_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps-alpha.com:20200",BETA_SERVICE_URL:"https://voipnx-saturn.line-apps-beta.com",BETA_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps-beta.com:20200",EVAL_SERVICE_URL:"https://voipnx-saturn.line-apps-rc.com",EVAL_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps-rc.com:20200",PROD_SERVICE_URL:"https://voipnx-saturn.line-apps.com",PROD_INTERNAL_URL:"http://voipnx-saturn-internal.line-apps.com:20200"});var k=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logger=r.getLogger("wpk-saturn-connector"),this.scInit()}var t,r;return t=e,(r=[{key:"scInit",value:function(){switch(p){case h.DEV:case h.TEST:this.planetBaseUrl=N.DEV_SERVICE_URL;break;case h.BETA:this.planetBaseUrl=N.BETA_SERVICE_URL;break;case h.EVAL:this.planetBaseUrl=N.EVAL_SERVICE_URL;break;case h.PROD:this.planetBaseUrl=N.PROD_SERVICE_URL;break;case h.LOCAL:this.planetBaseUrl=N.LOCAL_INTERNAL_URL}}},{key:"scAcquireCallRoute",value:function(e){var t,r=this;if(P(e.accessToken))t="v2";else{if(!P(e.apiKey))return Promise.reject(new Error("Mandatory field is required to acquireCallRoute"));t="v1"}var n={requestBody:{requestContext:{userId:e.myId,serviceId:e.myServiceId},stid:e.appServerData,callType:e.mediaType===g.VIDEO?"V":"A",to:{}},requestUrl:[this.planetBaseUrl,t,"call/acquire",e.peerServiceId,e.peerId].join("/")};return"v2"==t?n.accessToken=e.accessToken:n.requestBody.requestContext.slaKey=e.apiKey,P(e.myCountryCode)&&(n.requestBody.requestContext.countryCode=e.myCountryCode),P(e.peerCountryCode)&&(n.requestBody.to.peerCountryCode=e.peerCountryCode),new Promise((function(e,t){r._httpPostRequest(n).then((function(n){r.logger.debug(n),"success"===n.status?e(n.data):t(n)})).catch((function(e){return t(e)}))}))}},{key:"scAcquireGcallRoute",value:function(e){var t,r=this;if(P(e.accessToken))t="v2";else{if(!P(e.apiKey))return Promise.reject(new Error("Mandatory field is required to acquireCallRoute"));t="v1"}var n={requestBody:{requestContext:{userId:e.myId,serviceId:e.myServiceId},mediaType:e.mediaType===g.VIDEO?"V":"A"},requestUrl:[this.planetBaseUrl,t,"gcall",e.roomServiceId,e.roomId,"join"].join("/")};return"v2"==t?n.accessToken=e.accessToken:n.requestBody.requestContext.slaKey=e.apiKey,P(e.myCountryCode)&&(n.requestBody.requestContext.countryCode=e.myCountryCode),P(e.peerCountryCode)&&(n.requestBody.to.peerCountryCode=e.peerCountryCode),new Promise((function(e,t){r._httpPostRequest(n).then((function(n){r.logger.debug(n),"success"===n.status?e(n.data):t(n)})).catch((function(e){return t(e)}))}))}},{key:"convertToStandardSaturnErrorResponseCode",value:function(e){switch(e){case"401":return b.SATURN_APP_ERROR_AUTH_FAIL;case"429":return b.SATURN_APP_TOO_MANY_REQUESTS;case"431":return b.SATURN_APP_ERROR_EXCEED_LIMIT_OF_PARTICIPANTS;case"432":return b.SATURN_APP_ERROR_ROOM_NOT_FOUND;case"433":return b.SATURN_APP_ERROR_ROOM_FORBIDDEN;case"434":return b.SATURN_APP_ERROR_ROOM_TYPE_CONFLICT;case"461":return b.SATURN_APP_ERROR_INVALID_ID;case"462":return b.SATURN_APP_ERROR_INCOMPATIBLE_KIT_VERSION;case"463":return b.SATURN_APP_ERROR_INVALID_STATE;case"520":return b.SATURN_APP_ERROR_UNDER_MAINTENANCE;case"531":return b.SATURN_APP_ERROR_BUSY_EVERYWHERE;case"network_unavailable":return b.SATURN_APP_ERROR_NETWORK_UNAVAILABLE;case"saturn_timeout":return b.SATURN_APP_ERROR_TIMEOUT;default:return b.SATURN_APP_ERROR_HTTP_ERROR}}},{key:"_httpPostRequest",value:function(e){var t=this,r=new Headers;r.append("Accept","application/json"),r.append("Content-type","application/json");var n=(new c).getBrowserInfo();return r.append("X-PLN-INFO",["BROWSER",f,n.browser,n.version].join("\t")),e.accessToken&&r.append("Authorization","Bearer "+e.accessToken),Promise.race([fetch(e.requestUrl,{method:"POST",headers:r,body:JSON.stringify(e.requestBody)}).then((function(e){return e.json()})).catch((function(e){return t.logger.error(e),e})),new Promise((function(e){setTimeout((function(){!1===navigator.onLine?e({status:"error",code:"network_unavailable"}):e({status:"error",code:"saturn_timeout"})}),3e4)}))])}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),M=(r(3710),Object.freeze({DEBUG:"debug",LOG:"log",WARN:"warn",ERROR:"error"})),D=Object.freeze({DEBUG:0,LOG:1,WARN:2,ERROR:3});var L=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loggerFactory=t,this.name=r}var t,r;return t=e,(r=[{key:"debug",value:function(e){this.loggerFactory.printLog(D.DEBUG,this.name,e)}},{key:"log",value:function(e){this.loggerFactory.printLog(D.LOG,this.name,e)}},{key:"warn",value:function(e){this.loggerFactory.printLog(D.WARN,this.name,e)}},{key:"error",value:function(e){this.loggerFactory.printLog(D.ERROR,this.name,e)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loggers={},this.logger=this.getLogger("LoggerFactory"),this._level=0}var t,r;return t=e,(r=[{key:"level",get:function(){return this._level},set:function(e){if(e.toUpperCase&&Object.hasOwnProperty.call(M,e.toUpperCase()))switch(e){case M.DEBUG:this._level=0;break;case M.LOG:this._level=1;break;case M.WARN:this._level=2;break;case M.ERROR:this._level=3}else this.logger.warn("Invalid user log level(".concat(e,"), so log level will be set as default('log')"))}},{key:"getLogger",value:function(e){if(this.loggers[e])return this.loggers[e];var t=new L(this,e);return this.loggers[e]=t,t}},{key:"printLog",value:function(e,t,r){if(!(e<this.level))switch("string"==typeof r&&(r=[new Date,t,r].join(" | ")),e){case D.DEBUG:console.debug(r);break;case D.LOG:console.log(r);break;case D.WARN:console.warn(r);break;case D.ERROR:console.error(r)}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}var U=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.loggerFactory=new x,this.logger=this.loggerFactory.getLogger("wpk-"+e),this.saturnConnector=new k(this,this.loggerFactory),this.service=e,this.wtp=void 0}var r,n;return r=t,n=[{key:"muteMyAudio",value:function(e){return void 0===this.wtp?(this.logger.warn("Fail to mute my audio because there is no valid call instance."),Promise.reject()):e?this.wtp.wtpMuteMyAudio():this.wtp.wtpUnmuteMyAudio()}},{key:"pauseMyVideo",value:function(){return void 0===this.wtp?(this.logger.warn("Fail to pause my video because there is no valid call instance."),Promise.reject()):this.wtp.wtpPauseMyVideo()}},{key:"resumeMyVideo",value:function(){return void 0===this.wtp?(this.logger.warn("Fail to resume my video because there is no valid call instance."),Promise.reject()):this.wtp.wtpResumeMyVideo()}},{key:"enableVideo",value:function(e){var t=this,r=Object.assign({cameraOn:!0,videoInputDeviceId:void 0},e);if(this.callParams.mediaType===g.AUDIO)return"call"===this.service?this.wtp.wtpCallEnableVideo(r).then((function(){return t.callParams.mediaType=g.VIDEO,Promise.resolve()})).catch((function(e){return Promise.reject(e)})):this.wtp.wtpConferenceEnableVideo(r).then((function(){return t.callParams.mediaType=g.VIDEO,Promise.resolve()})).catch((function(e){return Promise.reject(e)}));var n=new Error("This call is already video call");return n.name="AlreadyVideoCall",Promise.reject(n)}},{key:"disableVideo",value:function(){var e=this;return this.callParams.mediaType===g.VIDEO?"call"===this.service?this.wtp.wtpCallDisableVideo().then((function(){return e.callParams.mediaType=g.AUDIO,Promise.resolve()})).catch((function(e){return Promise.reject(e)})):this.wtp.wtpConferenceDisableVideo().then((function(){return e.callParams.mediaType=g.AUDIO,Promise.resolve()})).catch((function(e){return Promise.reject(e)})):Promise.reject("Call is already Audio")}},{key:"changeAudioInputDevice",value:function(e){return this.wtp.wtpChangeInputAudioDevice(e)}},{key:"changeAudioOutputDevice",value:function(e){return this.wtp.wtpChangeOutputAudioDevice(e)}},{key:"changeVideoInputDevice",value:function(e){return this.wtp.wtpChangeInputVideoDevice(e)}},{key:"getAudioInputDeviceInfo",value:function(){return this.wtp.wtpGetInputAudioDeviceInfo()}},{key:"getAudioOutputDeviceInfo",value:function(){return this.wtp.wtpGetOutputAudioDeviceInfo()}},{key:"getVideoInputDeviceInfo",value:function(){return this.wtp.wtpGetInputVideoDeviceInfo()}},{key:"changeMyView",value:function(e,t){return this.wtp.wtpChangeMyView(e,t)}},{key:"getMyMediaStream",value:function(){return this.wtp.wtpGetMyMediaStream()}},{key:"startMyScreenShare",value:function(e,t){var r=(new c).getScreenShareConstraints(t);return this.wtp.wtpStartMyScreenShare(e,r)}},{key:"stopMyScreenShare",value:function(){return this.wtp.wtpStopMyScreenShare()}},{key:"muteMyScreenShareAudio",value:function(e){this.wtp.wtpMuteMyScreenShareAudio(e)}},{key:"changeMyScreenShareView",value:function(e,t){return this.wtp.wtpChangeMyScreenShareView(e,t)}},{key:"setVideoMirror",value:function(e,t){this.wtp.wtpSetVideoMirror(e,t)}},{key:"setCustomMediaStream",value:function(e){return this.wtp.wtpSetCustomMediaStream(e)}},{key:"unsetCustomMediaStream",value:function(){var e;return null===(e=this.wtp)||void 0===e?void 0:e.wtpUnsetCustomMediaStream()}},{key:"hasSetCustomMediaStreamWithAudio",value:function(){var e;return null===(e=this.wtp)||void 0===e?void 0:e.wtpHasSetCustomMediaStreamWithAudio()}},{key:"hasSetCustomMediaStreamWithVideo",value:function(){var e;return null===(e=this.wtp)||void 0===e?void 0:e.wtpHasSetCustomMediaStreamWithVideo()}},{key:"setSharedContents",value:function(e){return this.wtp.wtpSetSharedContents(e)}},{key:"unsetSharedContents",value:function(){return this.wtp.wtpUnsetSharedContents()}},{key:"setExclusivelySharedContents",value:function(e){return this.wtp.wtpSetExclusivelySharedContents(e)}},{key:"unsetExclusivelySharedContents",value:function(){return this.wtp.wtpUnsetExclusivelySharedContents()}},{key:"registerVirtualBackground",value:function(e){if(!this.wtp)throw new Error("Invalid call state.");return this.wtp.wtpRegisterVirtualBackground(e)}},{key:"isVirtualBackgroundRegistered",value:function(){var e;return null===(e=this.wtp)||void 0===e?void 0:e.wtpIsVirtualBackgroundRegistered()}},{key:"startVirtualBackgroundBlur",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;return this.wtp.wtpStartVirtualBackgroundBlur(e,t)}},{key:"startVirtualBackgroundImage",value:function(e,t){return this.wtp.wtpStartVirtualBackgroundImage(e,t)}},{key:"stopVirtualBackground",value:function(){return this.wtp.wtpStopVirtualBackground()}},{key:"getVirtualBackgroundVideoStream",value:function(){return this.wtp.wtpGetVirtualBackgroundVideoStream()}},{key:"changeVirtualBackgroundVideoElement",value:function(e){return this.wtp.wtpChangeVirtualBackgroundVideoElement(e)}},{key:"changeVirtualBackgroundCanvasElement",value:function(e){return this.wtp.wtpChangeVirtualBackgroundCanvasElement(e)}},{key:"isVirtualBackgroundActive",value:function(){return this.wtp.isVirtualBackgroundActive()}},{key:"getVersion",value:function(){return f}},{key:"getCurrentStats",value:function(){return this.wtp.wtpGetStats()}},{key:"checkPermission",value:function(e){return this.wtp.checkPermission(e)}},{key:"getWtpInitConfig",value:function(e){var t,r,n,i;switch(p){case h.PRIVATE:case h.LOCAL:case h.TEST:t="wtp.line-apps-beta.com:7443",r=!0,n=!0,i=3;break;case h.DEV:case h.BETA:t=e,r=!0,n=!0,i=3;break;case h.EVAL:t=e,r=!0,n=!0,i=2;break;case h.PROD:t=e,r=!1,n=!1,i=2}return{wtpGwUri:t,builtinEnabled:r,traceSip:n,logLevel:i,devPlatform:"planetkit"}}},{key:"getDisconnectedParam",value:function(t,r){var n;return n="THIS"===r?"call"===this.service?_.CALLER:_.PARTICIPANT:"PEER"===r?_.CALLEE:_.CLOUD_SERVER,t===e.PLANET_REL_CODE.ROOM_DESTROY_BY_USER?n=_.PARTICIPANT:t!==e.PLANET_REL_CODE.ROOM_DESTROY&&t!==e.PLANET_REL_CODE.ROOM_FORCE_CLOSE&&t!==e.PLANET_REL_CODE.ROOM_FORCE_CLOSE_BY_USER||(n=_.APP_SERVER),{source:n,reason:A(t)}}},{key:"playEndTone",value:function(){var t=this,r=this.callParams.endToneUrl;if(this.callParams.playEndToneRegardlessOfCallState&&r){var n=new Audio(r);n.play().catch((function(r){var n;null!==(n=t.kitDelegate)&&void 0!==n&&n.evtDebugNotice&&("NotAllowedError"===r.name?t.kitDelegate.evtDebugNotice({name:e.DEBUG_NOTICE.TONE_SOUND_END_TONE_PLAY_NOT_ALLOWED,message:"The end tone cannot be played because the user is not interacting with the document, as required by browser security policies."}):t.kitDelegate.evtDebugNotice({name:e.DEBUG_NOTICE.TONE_SOUND_END_TONE_PLAY_FAILED,message:"The end tone cannot be played because the end tone source is not available."}))})),n.currentTime=0}}},{key:"_checkValidationCallParams",value:function(e){var t=new TextEncoder,r=function(e){return/^[a-zA-Z0-9.-]*$/.test(e)&&t.encode(e).length<=64},n=function(e){return/^[a-zA-Z0-9-_]+$/.test(e)&&t.encode(e).length<=64},i=e.myId,o=e.myServiceId,a=e.mediaType;if("call"===this.service){var s=e.peerId,c=e.peerServiceId;if(!(P(i)&&P(o)&&P(s)&&P(c)&&P(a)))return{isValid:!1,startFailReason:I.INVALID_PARAM,startFailMessage:"Some mandatory parameters are not filled."};if(!n(s))return{isValid:!1,startFailReason:I.INVALID_USER_ID,startFailMessage:"The peerId string is not in a valid format."};if(i===s)return{isValid:!1,startFailReason:I.ID_CONFLICT,startFailMessage:"The peerId must not be same with the myId."};if(!r(c))return{isValid:!1,startFailReason:I.INVALID_SERVICE_ID,startFailMessage:"The peerServiceId string is not in a valid format."}}else{var u=e.roomId,l=e.roomServiceId;if(!(P(i)&&P(o)&&P(u)&&P(l)&&P(a)))return{isValid:!1,startFailReason:I.INVALID_PARAM,startFailMessage:"Some mandatory parameters are not filled."};if(!n(u))return{isValid:!1,startFailReason:I.INVALID_ROOM_ID,startFailMessage:"The roomId string is not in a valid format."};if(i===u)return{isValid:!1,startFailReason:I.ID_CONFLICT,startFailMessage:"The roomId must not be same with the myId."};if(!r(l))return{isValid:!1,startFailReason:I.INVALID_SERVICE_ID,startFailMessage:"The roomServiceId string is not in a valid format."}}if(!(this.role!==S.INITIATOR&&this.role!==S.CONFERENCE||P(e.accessToken)||P(e.apiKey)))return{isValid:!1,startFailReason:I.INVALID_PARAM,startFailMessage:"The token for authentication is not filled."};if(!/^[a-zA-Z0-9-_]+$/.test(i)||t.encode(i).length>64)return{isValid:!1,startFailReason:I.INVALID_USER_ID,startFailMessage:"The myId string is not in a valid format."};if(!/^[a-zA-Z0-9.-]*$/.test(o)||t.encode(o).length>64)return{isValid:!1,startFailReason:I.INVALID_SERVICE_ID,startFailMessage:"The myServiceId string is not in a valid format."};if("audio"!==a&&"video"!==a)return{isValid:!1,startFailReason:I.INVALID_MEDIA_TYPE,startFailMessage:"The mediaType is not a valid value."};if(e.appServerData&&t.encode(e.appServerData).length>4096)return{isValid:!1,startFailReason:I.TOO_LONG_APP_SERVER_DATA,startFailMessage:"The App server data is too long (Maximum size of app server data is 4096 bytes including null termination)."};if(e.apiKey){var d=e.apiKey;if(!/^[a-zA-Z0-9-_]+$/.test(d)||t.encode(d).length>128)return{isValid:!1,startFailReason:I.INVALID_API_KEY,startFailMessage:"The API-key string is not in a valid format."}}if(void 0!==e.customUserType&&null!==e.customUserType){var h=e.customUserType;if(!Number.isInteger(h)||h<1||h>9999)return{isValid:!1,startFailReason:I.INVALID_CUSTOM_USER_TYPE,startFailMessage:"The custom user type is not a valid value."}}return{isValid:!0}}},{key:"_checkParamType",value:function(e,t,r){void 0!==e&&V(e)!==r&&this.logger.warn("CallParam.".concat(t," should be '").concat(r,"' type"))}},{key:"_createStartFailReason",value:function(e,t){return{reason:e,message:t}}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}();function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $(e,t){var r=H(H({},{logLevel:M.LOG}),t);e.loggerFactory.level=r.logLevel,e.role="",e.kitDelegate=r.delegate}function F(e,t){var r=e.saturnConnector.convertToStandardSaturnErrorResponseCode(t.code),n=e.callParams.delegate;n.evtDisconnected&&n.evtDisconnected({source:_.CLOUD_SERVER,reason:A(r)})}function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function W(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function K(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){W(o,n,i,a,s,"next",e)}function s(e){W(o,n,i,a,s,"throw",e)}a(void 0)}))}}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}r(7327),r(5003),r(9554),r(4747),r(9337),r(3321);var X=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&G(e,t)}(l,t);var r,n,i,o,a,s,u=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(a);if(s){var r=z(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Y(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),$(Y(t=u.call(this,"call")),e),t}return r=l,n=[{key:"makeCall",value:(o=K(regeneratorRuntime.mark((function e(t){var r,n,i,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((new c).isSupported()){e.next=2;break}throw this._createStartFailReason(I.BROWSER_NOT_SUPPORTED,"The WebPlanetKit is not supported by this browser.");case 2:if(this.role=S.INITIATOR,r=this._checkValidationCallParams(t),n=r.isValid,i=r.startFailReason,o=r.startFailMessage,n){e.next=6;break}throw this._createStartFailReason(i,o);case 6:return this._setCallParams(t),e.prev=7,e.next=10,this.saturnConnector.scAcquireCallRoute(this.callParams);case 10:a=e.sent,e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(7),this.playEndTone(),F(this,e.t0),e.abrupt("return",this._createStartFailReason(I.NONE,""));case 18:return e.prev=18,s=this._getWtpCallParams(a),this.logger.debug("wtp params"),this.logger.debug(s),this.initWtp(s),e.next=25,this.wtp.wtpCallMake(s);case 25:e.next=31;break;case 27:if(e.prev=27,e.t1=e.catch(18),"InvalidCallParams"!==e.t1.name){e.next=31;break}throw this._createStartFailReason(I.INTERNAL_INITIALIZATION_ERROR,"An internal error occurred during initialization.");case 31:return e.abrupt("return",this._createStartFailReason(I.NONE,""));case 32:case"end":return e.stop()}}),e,this,[[7,13],[18,27]])}))),function(e){return o.apply(this,arguments)})},{key:"verifyCall",value:(i=K(regeneratorRuntime.mark((function e(t){var r,n,i,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((new c).isSupported()){e.next=2;break}throw this._createStartFailReason(I.BROWSER_NOT_SUPPORTED,"The WebPlanetKit is not supported by this browser.");case 2:if(this.role=S.RESPONDER,P(t.ccParam)){e.next=5;break}throw this._createStartFailReason(I.INVALID_PARAM,"The ccParam is not filled.");case 5:e.prev=5,(r=JSON.parse(atob(t.ccParam))).voipSrv=r.voipAddress,t.peerId=r.fromUserId,t.peerServiceId=r.fromServiceId,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(5),this._createStartFailReason(I.DECODE_CALL_PARAM,"Failed to decode the ccParam of the verifyCall() API.");case 15:if(n=this._checkValidationCallParams(t),i=n.isValid,o=n.startFailReason,a=n.startFailMessage,i){e.next=18;break}throw this._createStartFailReason(o,a);case 18:return this._setCallParams(t),e.prev=19,s=this._getWtpCallParams(r),this.logger.debug("wtp params"),this.logger.debug(s),this.initWtp(s),e.next=26,this.wtp.wtpCallVerify(s);case 26:e.next=32;break;case 28:if(e.prev=28,e.t1=e.catch(19),"InvalidCallParams"!==e.t1.name){e.next=32;break}throw this._createStartFailReason(I.INTERNAL_INITIALIZATION_ERROR,"An internal error occurred during initialization.");case 32:return e.abrupt("return",this._createStartFailReason(I.NONE,""));case 33:case"end":return e.stop()}}),e,this,[[5,12],[19,28]])}))),function(e){return i.apply(this,arguments)})},{key:"acceptCall",value:function(e){return this.wtp.wtpCallAnswer(e)}},{key:"endCall",value:function(){var t=this.wtp;t.state!=e.WTP_STATE.STATE_INIT&&t.state!=e.WTP_STATE.STATE_DISCONNECTED?t.wtpCallEnd():this.logger.warn("Call state is not valid to end call")}},{key:"changePeerView",value:function(e,t){return this.wtp.wtpCallChangePeerView(e,t)}},{key:"requestPeerMute",value:function(e){this.wtp.wtpCallRequestPeerMute(e)}},{key:"addPeerScreenShareView",value:function(e){return this.wtp.wtpCallAddPeerScreenShareView(e)}},{key:"removePeerScreenShareView",value:function(){return this.wtp.wtpCallRemovePeerScreenShareView()}},{key:"changePeerScreenShareView",value:function(e,t){return this.wtp.wtpCallChangePeerScreenShareView(e,t)}},{key:"sendShortData",value:function(e,t){return this.wtp.wtpCallSendShortData(e,t)}},{key:"isRecordOnCloudActivated",value:function(){return this.wtp.wtpCallIsRecordOnCloudActivated()}},{key:"initWtp",value:function(t){var r=this;this.wtp=new e.WtpCall;var n=this.wtp,i=this.getWtpInitConfig(t.inviteHeaders.w2pGw),o=i.wtpGwUri;if(!O(o))throw new Error("Invalid w2pGw URI : ".concat(o));n.wtpInit(i);var a=this.callParams.delegate;n.on("connecting",(function(){a.evtWaitConnected&&a.evtWaitConnected()})),n.on("connected",(function(){a.evtConnected&&a.evtConnected()})),n.on("ringing",(function(e){if(a.evtVerified){var t={peerId:e.peerId,mediaType:"A"===e.callType?g.AUDIO:g.VIDEO};a.evtVerified(t)}})),n.on("switchAudioToVideo",(function(){r.callParams.responseOnEnableVideo===m.PAUSE?(r.logger.debug("switchAudioToVideo - PAUSE"),r.callParams.mediaType=g.VIDEO,n.wtpCallEnableVideoWithPauseResponse().catch((function(e){r.logger.error("Fail to switchAudioToVideo with pause response",e)}))):r.callParams.responseOnEnableVideo===m.SEND?(r.callParams.mediaType=g.VIDEO,n.wtpCallEnableVideo().catch((function(e){r.logger.error("Fail to switchAudioToVideo with send response",e)}))):r.logger.error("Invalid responseOnEnableVideo values: ".concat(r.callParams.responseOnEnableVideo)),a.evtVideoEnabledByPeer&&a.evtVideoEnabledByPeer()})),n.on("switchVideoToAudio",(function(){r.callParams.mediaType=g.AUDIO,a.evtVideoDisabledByPeer&&a.evtVideoDisabledByPeer()})),n.on("peerVideoPause",(function(e){a.evtPeerVideoPaused&&a.evtPeerVideoPaused(e)})),n.on("peerVideoResume",(function(){a.evtPeerVideoResumed&&a.evtPeerVideoResumed()})),n.on("peerMicMuted",(function(){a.evtPeerMicMuted&&a.evtPeerMicMuted()})),n.on("peerMicUnmuted",(function(){a.evtPeerMicUnmuted&&a.evtPeerMicUnmuted()})),n.on("muteRequested",(function(e){a.evtMyMuteRequestedByPeer&&a.evtMyMuteRequestedByPeer(e)})),n.on("screenShareStoppedOnBrowser",(function(){a.evtMyScreenShareStoppedOnBrowser&&a.evtMyScreenShareStoppedOnBrowser()})),n.on("peerScreenShareStarted",(function(){a.evtPeerScreenShareStarted&&a.evtPeerScreenShareStarted()})),n.on("peerScreenShareStopped",(function(){a.evtPeerScreenShareStopped&&a.evtPeerScreenShareStopped()})),n.on("shortDataReceived",(function(e,t){a.evtShortDataReceived&&a.evtShortDataReceived(e,t)})),n.on("myTalkingStatusUpdated",(function(e){a.evtMyTalkingStatusUpdated&&a.evtMyTalkingStatusUpdated(e)})),n.on("peerTalkingStatusUpdated",(function(e){a.evtPeerTalkingStatusUpdated&&a.evtPeerTalkingStatusUpdated(e)})),n.on("peerSharedContentsSet",(function(e,t){a.evtPeerSharedContentsSet&&a.evtPeerSharedContentsSet(e,t)})),n.on("peerSharedContentsUnset",(function(){a.evtPeerSharedContentsUnset&&a.evtPeerSharedContentsUnset()})),n.on("peerExclusivelySharedContentsSet",(function(e,t){a.evtPeerExclusivelySharedContentsSet&&a.evtPeerExclusivelySharedContentsSet(e,t)})),n.on("peerExclusivelySharedContentsUnset",(function(){a.evtPeerExclusivelySharedContentsUnset&&a.evtPeerExclusivelySharedContentsUnset()})),n.on("recordOnCloudUpdated",(function(e,t){a.evtRecordOnCloudUpdated&&a.evtRecordOnCloudUpdated(e,t)})),n.on("ended",(function(e){n.wtpRelease(),a.evtDisconnected&&a.evtDisconnected(r.getDisconnectedParam(e.plnRelCode.code,e.releaser))})),n.on("failed",(function(){a.evtFailed&&a.evtFailed()})),n.on("debugNotice",(function(e){var t;null!==(t=r.kitDelegate)&&void 0!==t&&t.evtDebugNotice&&r.kitDelegate.evtDebugNotice(e)}))}},{key:"_setCallParams",value:function(e){return this._checkParamType(e.maxSendLinkBandwidth,"maxSendLinkBandwidth","number"),this._checkParamType(e.maxReceiveLinkBandwidth,"maxReceiveLinkBandwidth","number"),!e.customMediaStream||e.customMediaStream instanceof MediaStream||this.logger.warn("customMediaStream should be MediaStream instance."),this.callParams={myId:String(e.myId),myServiceId:String(e.myServiceId),peerId:String(e.peerId),peerServiceId:String(e.peerServiceId),mediaType:e.mediaType,delegate:e.delegate?e.delegate:{},cameraOn:!1!==e.cameraOn&&0!==e.cameraOn,micOn:!1!==e.micOn&&0!==e.micOn,pauseVideoByPageHidden:!1!==e.pauseVideoByPageHidden&&0!==e.pauseVideoByPageHidden,ignoreDeviceError:!0===e.ignoreDeviceError||1===e.ignoreDeviceError,enableTalkingStatusEvent:!0===e.enableTalkingStatusEvent||1===e.enableTalkingStatusEvent,responseOnEnableVideo:e.responseOnEnableVideo?e.responseOnEnableVideo:m.PAUSE,maxSendLinkBandwidth:void 0!==e.maxSendLinkBandwidth?e.maxSendLinkBandwidth:void 0,maxReceiveLinkBandwidth:void 0!==e.maxReceiveLinkBandwidth?e.maxReceiveLinkBandwidth:void 0,mediaHtmlElement:e.mediaHtmlElement?e.mediaHtmlElement:{},mediaDeviceId:e.mediaDeviceId?e.mediaDeviceId:void 0,customMediaStream:e.customMediaStream?e.customMediaStream:void 0,mediaStreamManager:e.mediaStreamManager?e.mediaStreamManager:void 0,accessToken:e.accessToken?e.accessToken:void 0,apiKey:e.apiKey?e.apiKey:void 0,endToneUrl:e.endToneUrl?e.endToneUrl:void 0,playEndToneRegardlessOfCallState:!0===e.playEndToneRegardlessOfCallState||1===e.playEndToneRegardlessOfCallState},this.role===S.INITIATOR?(this.callParams.appServerData=P(e.appServerData)?e.appServerData:void 0,this.callParams.recordOnCloud=!0===e.recordOnCloud||1===e.recordOnCloud,this.callParams.ringbackToneUrl=e.ringbackToneUrl?e.ringbackToneUrl:void 0):(this.callParams.allowVerifyOnMultipleWindow=!1!==e.allowVerifyOnMultipleWindow&&0!==e.allowVerifyOnMultipleWindow,this.callParams.ringToneUrl=e.ringToneUrl?e.ringToneUrl:void 0),P(e.myCountryCode)&&(this.callParams.myCountryCode=e.myCountryCode),P(e.peerCountryCode)&&(this.callParams.peerCountryCode=e.peerCountryCode),!0}},{key:"_getWtpCallParams",value:function(e){var t={myId:this.callParams.myId,fromSvcId:this.role===S.INITIATOR?this.callParams.myServiceId:this.callParams.peerServiceId,peerId:this.callParams.peerId,toSvcId:this.role===S.INITIATOR?this.callParams.peerServiceId:this.callParams.myServiceId,stid:this.callParams.appServerData,cameraOn:this.callParams.cameraOn,micOn:this.callParams.micOn,callType:this.callParams.mediaType===g.VIDEO?"V":"A",svckey:this.callParams.mediaType===g.VIDEO?"freecall.video":"freecall.audio",pauseVideoByPageHidden:this.callParams.pauseVideoByPageHidden,ignoreDeviceError:this.callParams.ignoreDeviceError,enableTalkingStatusEvent:this.callParams.enableTalkingStatusEvent,maxSendLinkBandwidth:this.callParams.maxSendLinkBandwidth,maxReceiveLinkBandwidth:this.callParams.maxReceiveLinkBandwidth,customMediaStream:this.callParams.customMediaStream,mediaStreamManager:this.callParams.mediaStreamManager,recordOnCloud:this.callParams.recordOnCloud,allowVerifyOnMultipleWindow:this.callParams.allowVerifyOnMultipleWindow,inviteHeaders:e,accessToken:this.callParams.accessToken,apiKey:this.callParams.apiKey,planetKitVersion:f,ringToneUrl:this.callParams.ringToneUrl,ringbackToneUrl:this.callParams.ringbackToneUrl,endToneUrl:this.callParams.endToneUrl,playEndToneRegardlessOfCallState:this.callParams.playEndToneRegardlessOfCallState},r={},n=this.callParams.mediaHtmlElement;n.my&&n.my.video&&(r.local={video:n.my.video}),n.peer&&(r.remote={},n.peer.audio&&(r.remote.audio=n.peer.audio),n.peer.video&&(r.remote.video=n.peer.video)),t.media=r;var i=this.callParams.mediaDeviceId;if(i){var o={};i.inputAudio&&(o.audio=i.inputAudio),i.inputVideo&&(o.video=i.inputVideo),t.mediaId=o}return t}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(U);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function ee(e,t){return ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}r(5306),r(7042),r(1038),r(9753);var ne=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&ee(e,t)}(l,t);var r,n,i,o,a,s,u=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=re(a);if(s){var r=re(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return te(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),$(te(t=u.call(this,"conference")),e),t}return r=l,n=[{key:"joinConference",value:(i=regeneratorRuntime.mark((function e(t){var r,n,i,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((new c).isSupported()){e.next=2;break}throw this._createStartFailReason(I.BROWSER_NOT_SUPPORTED,"The WebPlanetKit is not supported by this browser.");case 2:if(this.role=S.CONFERENCE,r=this._checkValidationCallParams(t),n=r.isValid,i=r.startFailReason,o=r.startFailMessage,n){e.next=6;break}throw this._createStartFailReason(i,o);case 6:return this._setCallParams(t),e.prev=7,e.next=10,this.saturnConnector.scAcquireGcallRoute(this.callParams);case 10:a=e.sent,e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(7),this.playEndTone(),F(this,e.t0),e.abrupt("return",this._createStartFailReason(I.NONE,""));case 18:return e.prev=18,s=this._getWtpGcallParams(a),this.logger.debug("wtp params"),this.logger.debug(s),this.initWtp(s),e.next=25,this.wtp.wtpConferenceJoin(s);case 25:e.next=31;break;case 27:if(e.prev=27,e.t1=e.catch(18),"InvalidCallParams"!==e.t1.name){e.next=31;break}throw this._createStartFailReason(I.INTERNAL_INITIALIZATION_ERROR,"An internal error occurred during initialization.");case 31:return e.abrupt("return",this._createStartFailReason(I.NONE,""));case 32:case"end":return e.stop()}}),e,this,[[7,13],[18,27]])})),o=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){Q(o,r,n,a,s,"next",e)}function s(e){Q(o,r,n,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"leaveConference",value:function(){var t=this.wtp;t.state!=e.WTP_STATE.STATE_INIT&&t.state!=e.WTP_STATE.STATE_DISCONNECTED?t.wtpConferenceLeave():this.logger.warn("Call state is not valid to leave")}},{key:"requestPeerVideo",value:function(e){return this.wtp.wtpConferenceRequestPeerVideo(e)}},{key:"removePeerVideo",value:function(e){return this.wtp.wtpConferenceRemovePeerVideo(e)}},{key:"updatePeerVideo",value:function(e,t){return this.wtp.wtpConferenceUpdatePeerVideo(e,t)}},{key:"changePeerView",value:function(e,t,r){return this.wtp.wtpConferenceChangePeerView(e,t,r)}},{key:"isPeer",value:function(e){return this.wtp.wtpConferenceIsPeer(e)}},{key:"getPeersUserId",value:function(){return this.wtp.wtpConferenceGetPeersUserId()}},{key:"getPeerInfo",value:function(e){return this.wtp.wtpConferenceGetPeerInfo(e)}},{key:"getPeersInfo",value:function(){return this.wtp.wtpConferenceGetPeersInfo()}},{key:"requestPeerMute",value:function(e,t){this.wtp.wtpConferenceRequestPeerMute(e,t)}},{key:"requestPeersMute",value:function(e){this.wtp.wtpConferenceRequestPeersMute(e)}},{key:"addPeerScreenShareView",value:function(e,t){return this.wtp.wtpConferenceAddPeerScreenShareView(e,t)}},{key:"removePeerScreenShareView",value:function(e){return this.wtp.wtpConferenceRemovePeerScreenShareView(e)}},{key:"changePeerScreenShareView",value:function(e,t,r){return this.wtp.wtpConferenceChangePeerScreenShareView(e,t,r)}},{key:"sendShortData",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.wtp.wtpConferenceSendShortData(e,t,r)}},{key:"setRoomSharedContents",value:function(e){return this.wtp.wtpConferenceSetRoomSharedContents(e)}},{key:"unsetRoomSharedContents",value:function(){return this.wtp.wtpConferenceRoomUnsetRoomSharedContents()}},{key:"initWtp",value:function(t){var r=this;this.wtp=new e.WtpConference;var n=this.wtp,i=this.getWtpInitConfig(t.inviteHeaders.w2pGw),o=i.wtpGwUri;if(!O(o))throw new Error("Invalid w2pGw URI : ".concat(o));n.wtpInit(i);var a=this.callParams.delegate;n.on("connected",(function(){a.evtConnected&&a.evtConnected()})),n.on("confPeerListUpdated",(function(e){a.evtPeerListUpdated&&a.evtPeerListUpdated(e)})),n.on("confPeersVideoUpdated",(function(e){a.evtPeersVideoUpdated&&a.evtPeersVideoUpdated(e)})),n.on("confPeersVideoPaused",(function(e){a.evtPeersVideoPaused&&a.evtPeersVideoPaused(e)})),n.on("confPeersVideoResumed",(function(e){a.evtPeersVideoResumed&&a.evtPeersVideoResumed(e)})),n.on("confPeersMicMuted",(function(e){a.evtPeersMicMuted&&a.evtPeersMicMuted(e)})),n.on("confPeersMicUnmuted",(function(e){a.evtPeersMicUnmuted&&a.evtPeersMicUnmuted(e)})),n.on("muteRequested",(function(e,t){a.evtMyMuteRequestedByPeer&&a.evtMyMuteRequestedByPeer(e,t)})),n.on("screenShareStoppedOnBrowser",(function(){a.evtMyScreenShareStoppedOnBrowser&&a.evtMyScreenShareStoppedOnBrowser()})),n.on("peerScreenShareStarted",(function(e){a.evtPeerScreenShareStarted&&a.evtPeerScreenShareStarted(e)})),n.on("peerScreenShareStopped",(function(e){a.evtPeerScreenShareStopped&&a.evtPeerScreenShareStopped(e)})),n.on("myTalkingStatusUpdated",(function(e){a.evtMyTalkingStatusUpdated&&a.evtMyTalkingStatusUpdated(e)})),n.on("confPeersTalkingStatusUpdated",(function(e){a.evtPeersTalkingStatusUpdated&&a.evtPeersTalkingStatusUpdated(e)})),n.on("shortDataReceived",(function(e,t,r){a.evtShortDataReceived&&a.evtShortDataReceived(e,t,r)})),n.on("appControlMessageReceived",(function(e){a.evtAppControlMessageReceived&&a.evtAppControlMessageReceived(e)})),n.on("peersSharedContentsSet",(function(e){a.evtPeersSharedContentsSet&&a.evtPeersSharedContentsSet(e)})),n.on("peersSharedContentsUnset",(function(e){a.evtPeersSharedContentsUnset&&a.evtPeersSharedContentsUnset(e)})),n.on("peerExclusivelySharedContentsSet",(function(e,t,r){a.evtPeerExclusivelySharedContentsSet&&a.evtPeerExclusivelySharedContentsSet(e,t,r)})),n.on("peerExclusivelySharedContentsUnset",(function(e){a.evtPeerExclusivelySharedContentsUnset&&a.evtPeerExclusivelySharedContentsUnset(e)})),n.on("peerRoomSharedContentsSet",(function(e,t,r){a.evtPeerRoomSharedContentsSet&&a.evtPeerRoomSharedContentsSet(e,t,r)})),n.on("peerRoomSharedContentsUnset",(function(e){a.evtPeerRoomSharedContentsUnset&&a.evtPeerRoomSharedContentsUnset(e)})),n.on("ended",(function(e){n.wtpRelease(),a.evtDisconnected&&a.evtDisconnected(r.getDisconnectedParam(e.plnRelCode.code,e.releaser))})),n.on("failed",(function(){a.evtFailed&&a.evtFailed()})),n.on("debugNotice",(function(e){var t;null!==(t=r.kitDelegate)&&void 0!==t&&t.evtDebugNotice&&r.kitDelegate.evtDebugNotice(e)}))}},{key:"_setCallParams",value:function(e){return this._checkParamType(e.maxSendLinkBandwidth,"maxSendLinkBandwidth","number"),this._checkParamType(e.maxReceiveLinkBandwidth,"maxReceiveLinkBandwidth","number"),!e.customMediaStream||e.customMediaStream instanceof MediaStream||this.logger.warn("customMediaStream should be MediaStream instance."),this.callParams={myId:String(e.myId),myServiceId:String(e.myServiceId),roomId:String(e.roomId),roomServiceId:String(e.roomServiceId),mediaType:e.mediaType,appServerData:P(e.appServerData)?e.appServerData:void 0,delegate:e.delegate?e.delegate:{},cameraOn:!1!==e.cameraOn&&0!==e.cameraOn,micOn:!1!==e.micOn&&0!==e.micOn,pauseVideoByPageHidden:!1!==e.pauseVideoByPageHidden&&0!==e.pauseVideoByPageHidden,ignoreDeviceError:!0===e.ignoreDeviceError||1===e.ignoreDeviceError,enableTalkingStatusEvent:!0===e.enableTalkingStatusEvent||1===e.enableTalkingStatusEvent,displayName:void 0!==e.displayName?this._sanitizeDisplayName(e.displayName):"",maxSendLinkBandwidth:void 0!==e.maxSendLinkBandwidth?e.maxSendLinkBandwidth:void 0,maxReceiveLinkBandwidth:void 0!==e.maxReceiveLinkBandwidth?e.maxReceiveLinkBandwidth:void 0,mediaHtmlElement:e.mediaHtmlElement?e.mediaHtmlElement:{},mediaDeviceId:e.mediaDeviceId?e.mediaDeviceId:void 0,customMediaStream:e.customMediaStream?e.customMediaStream:void 0,mediaStreamManager:e.mediaStreamManager?e.mediaStreamManager:void 0,accessToken:e.accessToken?e.accessToken:void 0,apiKey:e.apiKey?e.apiKey:void 0,endToneUrl:e.endToneUrl?e.endToneUrl:void 0,playEndToneRegardlessOfCallState:!0===e.playEndToneRegardlessOfCallState||1===e.playEndToneRegardlessOfCallState},P(e.myCountryCode)&&(this.callParams.myCountryCode=e.myCountryCode),P(e.peerCountryCode)&&(this.callParams.peerCountryCode=e.peerCountryCode),P(e.customUserType)&&(this.callParams.customUserType=e.customUserType),!0}},{key:"_getWtpGcallParams",value:function(e){var t={myId:this.callParams.myId,fromSvcId:this.callParams.myServiceId,roomId:this.callParams.roomId,toSvcId:this.callParams.roomServiceId,stid:this.callParams.appServerData,cameraOn:this.callParams.cameraOn,micOn:this.callParams.micOn,callType:this.callParams.mediaType===g.VIDEO?"V":"A",svckey:this.callParams.mediaType===g.VIDEO?"groupcall.video":"groupcall.audio",pauseVideoByPageHidden:this.callParams.pauseVideoByPageHidden,ignoreDeviceError:this.callParams.ignoreDeviceError,enableTalkingStatusEvent:this.callParams.enableTalkingStatusEvent,displayName:this.callParams.displayName,maxSendLinkBandwidth:this.callParams.maxSendLinkBandwidth,maxReceiveLinkBandwidth:this.callParams.maxReceiveLinkBandwidth,customMediaStream:this.callParams.customMediaStream,mediaStreamManager:this.callParams.mediaStreamManager,inviteHeaders:e,accessToken:this.callParams.accessToken,apiKey:this.callParams.apiKey,planetKitVersion:f,endToneUrl:this.callParams.endToneUrl,playEndToneRegardlessOfCallState:this.callParams.playEndToneRegardlessOfCallState,customUserType:this.callParams.customUserType},r={},n=this.callParams.mediaHtmlElement;n.myVideo&&(r.local={video:n.myVideo}),n.roomAudio&&(r.remote={audio:n.roomAudio}),t.media=r;var i=this.callParams.mediaDeviceId;if(i){var o={};i.inputAudio&&(o.audio=i.inputAudio),i.inputVideo&&(o.video=i.inputVideo),t.mediaId=o}return t}},{key:"_sanitizeDisplayName",value:function(e){var t,r=String(e||"").replace(/\\/g,"\\\\"),n=0,i=[],o=new TextEncoder,a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(r);try{for(a.s();!(t=a.n()).done;){var s=t.value,c=o.encode(s).length;if(n+c>127)break;i.push(s),n+=c}}catch(e){a.e(e)}finally{a.f()}return i.join("")}}],n&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(U)})(),n})()));